/*! For license information please see rmp-hls.min.js.LICENSE.txt */
(()=>{var e={6102:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DriverExtensionMixin=t.DriverExtensionMixer=void 0;const i=e=>{class r extends e{get _driver(){return this.constructor._driver}}return r._isPublic=!1,r};class DriverExtensionMixin extends((t.DriverExtensionMixer=i)(Object)){}t.DriverExtensionMixin=DriverExtensionMixin},8277:function(e,t,i){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MuxDataBuilder=t.MuxMonitor=void 0;const s=a(i(6486)),o=a(i(4125)),u=i(2064);t.MuxMonitor=class MuxMonitor{static apply(e){o.default.monitor(e.element,{data:new MuxDataBuilder(e).build()})}};class MuxDataBuilder{constructor(e){this._options=e,this._data={},this._initialize()}build(){return this._data}_initialize(){this._setGeneral(),this._setAssets(),this._setClientIP()}_setGeneral(){var e=this._options.driver.settings;s.default.merge(this._data,{env_key:e.monitor.muxEnvKey,sub_property_id:e.client.accountID,viewer_user_id:e.client.sessionID,view_session_id:e.stream.streamID,custom_1:e.client.id,player_name:this._options.playerName,stream_type:e.stream.streamType,video_stream_type:e.stream.streamType})}_setAssets(){var e=this._options.driver.settings;if(null!=e.global.assets){var t=u.HashTool.makeMD5Base16String(this._options.url).toLowerCase(),i=e.global.assets[t];if(null!=i){this._data.video_variant_id=i.id;for(let e=0;e<Math.min(i.tags.length,l.length);e++){var a=l[e],s=i.tags[e];null!=s&&""!==s&&(this._data[a]=s)}}}}_setClientIP(){self.mData&&s.default.merge(this._data,{custom_2:self.mData.ip})}}t.MuxDataBuilder=MuxDataBuilder;const l=["custom_6","custom_7","custom_8","custom_9"]},5449:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractBundlePlugin=void 0;const a=i(2016),s=i(7464),o=i(6102);class AbstractBundlePlugin extends o.DriverExtensionMixin{static register(e){this._isRegistered||(this._register(e),this._isRegistered=!0)}static _register(e){throw e=`_register(${e})`,new a.InternalError(s.MessageCode.ESV100,void 0,{name:e})}}(t.AbstractBundlePlugin=AbstractBundlePlugin)._isRegistered=!1},7984:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractPlayerAdapter=t.AbstractPlayerPlugin=void 0;const a=i(2016),s=i(7464),o=i(6102),u=i(8277);class AbstractPlayerPlugin extends o.DriverExtensionMixin{static _setup(){throw new a.InternalError(s.MessageCode.ESV100,void 0,{name:"_setup()"})}static create(...e){throw e=`create(${e})`,new a.InternalError(s.MessageCode.ESV100,void 0,{name:e})}}t.AbstractPlayerPlugin=AbstractPlayerPlugin;class AbstractPlayerAdapter extends o.DriverExtensionMixin{get element(){return this._element}_applyMonitor(){this._driver.settings.monitor.isMuxEnabled&&u.MuxMonitor.apply({url:this._url,driver:this._driver,element:this._element,playerName:this._playerName})}_exportMuxData(){return this._driver.settings.monitor.isMuxEnabled?{data:new u.MuxDataBuilder({url:this._url,driver:this._driver,element:this._element,playerName:this._playerName}).build()}:{}}}t.AbstractPlayerAdapter=AbstractPlayerAdapter},8002:function(e,t,i){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractHlsPlayerAdapter=t.AbstractHlsPlayerPlugin=void 0;const s=a(i(3575)),o=i(2016),u=i(7464),l=i(7984);class AbstractHlsPlayerPlugin extends l.AbstractPlayerPlugin{static create(...e){throw e=`create(${e})`,new o.InternalError(u.MessageCode.ESV100,void 0,{name:e})}}t.AbstractHlsPlayerPlugin=AbstractHlsPlayerPlugin;class AbstractHlsPlayerAdapter extends l.AbstractPlayerAdapter{constructor(){super(...arguments),this._isSupported=s.default.isSupported()}}t.AbstractHlsPlayerAdapter=AbstractHlsPlayerAdapter},1177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RadiantMPExtensionAbstractMixer=t.RadiantMPExtensionMixin=t.RadiantMPExtensionMixer=void 0;const i=e=>class n extends e{get _radiantMP(){return this.constructor._radiantMP}};class RadiantMPExtensionMixin extends((t.RadiantMPExtensionMixer=i)(Object)){}t.RadiantMPExtensionMixin=RadiantMPExtensionMixin;t.RadiantMPExtensionAbstractMixer=e=>class n extends e{get _radiantMP(){return this.constructor._radiantMP}}},5117:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RadiantMPHlsPlugin=void 0;const a=i(5449),s=i(7786);class RadiantMPHlsPlugin extends a.AbstractBundlePlugin{static register(e){super.register(e)}static _register(e){s.RadiantMPHlsPlayerPlugin._radiantMP=e,s.RadiantMPHlsPlayerPlugin._setup()}}(t.RadiantMPHlsPlugin=RadiantMPHlsPlugin)._isPublic=!0,RadiantMPHlsPlugin._publicName="RadiantMPHlsPlugin"},7786:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RadiantMPHlsPlayerPlugin=void 0;const a=i(8002),s=i(1177);class RadiantMPHlsPlayerPlugin extends((0,s.RadiantMPExtensionAbstractMixer)(a.AbstractHlsPlayerPlugin)){static _setup(){this._driver.extend(RadiantMPHlsPlayerAdapter),RadiantMPHlsPlayerAdapter._radiantMP=this._radiantMP}static create(e){return new RadiantMPHlsPlayerAdapter(e)}}(t.RadiantMPHlsPlayerPlugin=RadiantMPHlsPlayerPlugin)._isPublic=!0,RadiantMPHlsPlayerPlugin._publicName="RadiantMPHlsPlayerPlugin";class RadiantMPHlsPlayerAdapter extends((0,s.RadiantMPExtensionAbstractMixer)(a.AbstractHlsPlayerAdapter)){constructor(e){super(),this._playerName="RadiantMP",this._url=e.url,this._options=e,this._initialize()}get player(){return this._player}get protocol(){var e;return null==(e=this._processor)?void 0:e.protocol}_initialize(){console.log("ðŸš€ ~ file: plugin.ts:66 ~ RadiantMPHlsPlayerAdapter ~ _initialize ~ _initialize:"),this._mergeOptions(),this._buildPlayer()}_mergeOptions(){this._mergeSrc(),this._mergeMux()}_mergeSrc(){this._options.radiantMPSettings.src={hls:this._url}}_mergeMux(){var e=this._exportMuxData();this._options.radiantMPSettings.muxDataSettings=e}_buildPlayer(){this._player=new this._radiantMP(this._options.elementId),console.log("ðŸš€ ~ file: plugin.ts:90 ~ RadiantMPHlsPlayerAdapter ~ _buildPlayer ~ this._options.elementId:",this._options.elementId),this._player.init(this._options.radiantMPSettings),console.log("ðŸš€ ~ file: plugin.ts:93 ~ RadiantMPHlsPlayerAdapter ~ _buildPlayer ~ this._options.radiantMPSettings:",this._options.radiantMPSettings)}}},7464:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageCodeObject=t.MessageCode=t.StatusCodes=void 0;const a=i(4239);Object.defineProperty(t,"MessageCodeObject",{enumerable:!0,get:function(){return a.MessageCodeObject}}),Object.defineProperty(t,"StatusCodes",{enumerable:!0,get:function(){return a.StatusCodes}});class MessageCode extends a.MessageCode{}(t.MessageCode=MessageCode).ESC000=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC000","550","Kernel core: Internal error.","File request has been aborted."),MessageCode.ESC001=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC001","550","Kernel core: Internal error.","File downloader has been aborted."),MessageCode.ESC010=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC010","550","Kernel core: Internal error.","HTTP downloader proxy request failed."),MessageCode.ESC011=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC011","550","Kernel core: Internal error.","HTTP downloader proxy cannot handle the response."),MessageCode.ESC012=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC012","550","Kernel core: Internal error.","MCDN downloader proxy is not available within start delay."),MessageCode.ESC020=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC020","550","Kernel core: Internal error.","Node downloader proxy cannot fetch available node daemon."),MessageCode.ESC021=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC021","550","Kernel core: Internal error.","Node downloader proxy is detected with no progress."),MessageCode.ESC030=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC030","550","Kernel core: Internal error.","User downloader proxy cannot handle the unshareable resource."),MessageCode.ESC031=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC031","550","Kernel core: Internal error.","User downloader proxy cannot handle the urgent resource."),MessageCode.ESC032=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC032","550","Kernel core: Internal error.","User downloader proxy is not chosen this time."),MessageCode.ESC033=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC033","550","Kernel core: Internal error.","User downloader proxy cannot fetch available user daemon."),MessageCode.ESC034=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESC034","550","Kernel core: Internal error.","User downloader proxy is detected with no progress."),MessageCode.ISP200=new a.MessageCodeObject(a.StatusCodes.OK,"ISP200","200","Kernel protocol: OK.","OK."),MessageCode.ESP000=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESP000","560","Kernel protocol: External API error.","An error response is received."),MessageCode.ESP001=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESP001","562","Kernel protocol: Internal error.","An error occurrs while processing a request."),MessageCode.ESP010=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESP010","560","Kernel protocol: Internal error.","Peer broker cannot be found."),MessageCode.ESP011=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESP011","560","Kernel protocol: Internal error.","Node broker cannot be found."),MessageCode.ESP012=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESP012","560","Kernel protocol: Internal error.","Tracker broker cannot be found."),MessageCode.WSP020=new a.MessageCodeObject(a.StatusCodes.BAD_REQUEST,"WSP020","561","Kernel protocol: Invalid parameter.","Resource cache cannot be found."),MessageCode.ESS000=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS000","570","Kernel service: Internal error.","Peer broker has been closed."),MessageCode.ESS001=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS001","570","Kernel service: Internal error.","Peer daemon has exited."),MessageCode.WSS002=new a.MessageCodeObject(a.StatusCodes.BAD_REQUEST,"WSS002","571","Kernel service: Invalid parameter.","Peer daemon cannot handle the action."),MessageCode.ESS003=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS003","570","Kernel service: Internal error.","Peer daemon cannot handle the command."),MessageCode.ESS005=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS005","572","Kernel service: Internal error.","User manager has reached max peer connections."),MessageCode.ESS006=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS006","572","Kernel service: Internal error.","User manager rejects a peer which has failed."),MessageCode.ESS007=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS007","572","Kernel service: Internal error.","User manager rejects a peer which is in use."),MessageCode.ESS010=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS010","570","Kernel service: Internal error.","Swarm daemon cannot be found."),MessageCode.ESS011=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS011","570","Kernel service: Internal error.","Swarm daemon cannot handle the command."),MessageCode.ESS020=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS020","570","Kernel service: Internal error.","Tracker broker has been closed."),MessageCode.ESS021=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS021","570","Kernel service: Internal error.","Tracker daemon has exited."),MessageCode.ESS022=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESS022","570","Kernel service: Internal error.","Tracker launcher cannot handle the feedback."),MessageCode.ESB000=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESB000","450","System booter: Internal error.","System component activate failed."),MessageCode.WSB010=new a.MessageCodeObject(a.StatusCodes.BAD_REQUEST,"WSB010","451","System booter: Invalid parameter.","Kernel parameters cannot be validated successfully."),MessageCode.ESV000=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESV000","621","Driver integration: External API error.","SW proxy receives an error response."),MessageCode.WSV001=new a.MessageCodeObject(a.StatusCodes.BAD_REQUEST,"WSV001","620","Driver integration: Invalid parameter.","SW proxy cannot handle the action."),MessageCode.ESV002=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESV002","621","Driver integration: Internal error.","SW proxy encounters an error while processing a request."),MessageCode.WSV010=new a.MessageCodeObject(a.StatusCodes.BAD_REQUEST,"WSV010","620","Driver integration: Invalid parameter.","SW server cannot proxy a client which has gone offline."),MessageCode.ESV011=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESV011","621","Driver integration: Internal error.","SW server bypass fetch timeout exceeded."),MessageCode.ESV012=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESV012","621","Driver integration: Internal error.","SW server receives a message error event."),MessageCode.WSV050=new a.MessageCodeObject(a.StatusCodes.BAD_REQUEST,"WSV050","620","Driver integration: Invalid parameter.","HLS loader cannot handle the response type."),MessageCode.ESV051=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESV051","621","Driver integration: Internal error.","HLS controller cannot buffer a play segment which is aborted."),MessageCode.ESV100=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESV100","650","Driver peripheral: Internal error.","Player plugin method has never been implemented."),MessageCode.ESV110=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESV110","650","Driver peripheral: Internal error.","Video.js source plugin method has never been implemented."),MessageCode.ESV111=new a.MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"ESV111","650","Driver peripheral: Internal error.","Video.js source handler method has never been implemented.")},4239:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageCodeObject=t.MessageCode=t.StatusCodes=void 0;const a=i(5519);Object.defineProperty(t,"StatusCodes",{enumerable:!0,get:function(){return a.StatusCodes}});class MessageCodeObject{constructor(e,t,i,a,s){this._statusCode=e,this._logCode=t,this._metaCode=i,this._metaContent=a,this._logContent=s,this._initialize()}get statusCode(){return this._statusCode}get logCode(){return this._logCode}get logContent(){return`(${this._logCode}) `+this._logContent}get metaCode(){return parseInt(""+MessageCodeObject._metaCodePrefix+this._metaCode,10)}get metaStatus(){return this._statusCode<a.StatusCodes.BAD_REQUEST}get metaContent(){return this._metaContent}_initialize(){this._checkStatusCode(),this._checkLogCode(),this._storeLogCode(),this._checkMetaCode()}_checkStatusCode(){var e=this._statusCode,t=a.StatusCodes.CONTINUE,i=a.StatusCodes.NETWORK_AUTHENTICATION_REQUIRED;if(e<t||i<e)throw new Error(`Status code ${e} must be between ${t} and ${i}.`)}_checkLogCode(){var e=this._logCode,t=MessageCodeObject._messageCodePool,i=MessageCodeObject.LOG_CODE_REGEX;if(t.has(e))throw new Error(`Duplicate log code ${e} is found.`);if(!i.test(e))throw new Error(`Log code ${e} cannot match ${i}.`)}_storeLogCode(){MessageCodeObject._messageCodePool.set(this._logCode,this)}_checkMetaCode(){var e=this._metaCode,t=MessageCodeObject.META_CODE_REGEX;if(!t.test(e))throw new Error(`Meta code ${e} cannot match ${t}.`)}static get metaCodePrefix(){return this._metaCodePrefix}static set metaCodePrefix(e){this._metaCodePrefix=e}}(t.MessageCodeObject=MessageCodeObject).LOG_CODE_REGEX=/^[IWEF][A-Z]{2}[0-9]{3}$/,MessageCodeObject.META_CODE_REGEX=/^[0-9]{3}$/,MessageCodeObject._metaCodePrefix="1",MessageCodeObject._messageCodePool=new Map;class MessageCode{}(t.MessageCode=MessageCode).WMV400=new MessageCodeObject(a.StatusCodes.BAD_REQUEST,"WMV400","400","Restful view: Bad request.","Bad request."),MessageCode.WMV403=new MessageCodeObject(a.StatusCodes.FORBIDDEN,"WMV403","403","Restful view: Forbidden.","Forbidden."),MessageCode.WMV404=new MessageCodeObject(a.StatusCodes.NOT_FOUND,"WMV404","404","Restful view: Not found.","Not found."),MessageCode.EMV500=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMV500","500","Restful view: Internal server error.","Internal server error."),MessageCode.EMU000=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU000","520","Auxiliary util: Internal error.","Backoff operation has been exhausted."),MessageCode.EMU010=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU010","520","Auxiliary util: Internal error.","Future operation timeout exceeded."),MessageCode.EMU011=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU011","520","Auxiliary util: Internal error.","Future condition has been done."),MessageCode.EMU012=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU012","520","Auxiliary util: Internal error.","Future condition has never been done."),MessageCode.EMU013=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU013","520","Auxiliary util: Internal error.","Future precondition has been done."),MessageCode.EMU014=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU014","520","Auxiliary util: Internal error.","Future task has been cancelled."),MessageCode.EMU015=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU015","520","Auxiliary util: Internal error.","Future task loop has been cancelled."),MessageCode.EMU016=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU016","520","Auxiliary util: Internal error.","Future task retry exceeded."),MessageCode.EMU017=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU017","520","Auxiliary util: Internal error.","Future task manager has been aborted."),MessageCode.EMU018=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU018","520","Auxiliary util: Internal error.","Future lock has been released."),MessageCode.EMU019=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU019","520","Auxiliary util: Internal error.","Future channel has been closed."),MessageCode.EMU050=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU050","520","Auxiliary util: Internal error.","Flow key to a value must be in flow storage."),MessageCode.EMU060=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU060","520","Auxiliary util: Internal error.","Graceful processor received some process errors."),MessageCode.EMU070=new MessageCodeObject(a.StatusCodes.INTERNAL_SERVER_ERROR,"EMU070","525","Auxiliary util: Internal error.","Request carrier encountered an error before response."),MessageCode.EMU071=new MessageCodeObject(a.StatusCodes.SERVICE_UNAVAILABLE,"EMU071","526","Auxiliary util: External API error.","Request carrier received unexpected failure response."),MessageCode.WMU072=new MessageCodeObject(a.StatusCodes.BAD_REQUEST,"WMU072","527","Auxiliary util: External API error.","Request carrier received validation failure response.")},2064:function(e,t,i){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HashTool=void 0;const s=a(i(1354)),o=i(8925),u=i(6544);t.HashTool=class HashTool{static makeMD5Buffer(e){return this._wordArrayToBuffer(s.default.MD5(this._bufferToWordArray(e)))}static makeMD5Base16String(e){return u.RadixTool.bufferToBase16String(this.makeMD5Buffer(e))}static makeMD5Base32String(e){return u.RadixTool.bufferToBase32String(this.makeMD5Buffer(e))}static makeMD5Base32URLString(e){return u.RadixTool.bufferToBase32URLString(this.makeMD5Buffer(e))}static makeMD5Base64String(e){return u.RadixTool.bufferToBase64String(this.makeMD5Buffer(e))}static makeMD5Base64URLString(e){return u.RadixTool.bufferToBase64URLString(this.makeMD5Buffer(e))}static makeSHA256Buffer(e){return this._wordArrayToBuffer(s.default.SHA256(this._bufferToWordArray(e)))}static makeSHA256Base16String(e){return u.RadixTool.bufferToBase16String(this.makeSHA256Buffer(e))}static makeSHA256Base32String(e){return u.RadixTool.bufferToBase32String(this.makeSHA256Buffer(e))}static makeSHA256Base32URLString(e){return u.RadixTool.bufferToBase32URLString(this.makeSHA256Buffer(e))}static makeSHA256Base64String(e){return u.RadixTool.bufferToBase64String(this.makeSHA256Buffer(e))}static makeSHA256Base64URLString(e){return u.RadixTool.bufferToBase64URLString(this.makeSHA256Buffer(e))}static _bufferToWordArray(e){return s.default.lib.WordArray.create(o.Buffer.from(e))}static _wordArrayToBuffer(e){var t=new Uint8Array(new ArrayBuffer(e.sigBytes));for(let i=0;i<e.sigBytes;i++)t[i]=e.words[i>>>2]>>>24-i%4*8&255;return o.Buffer.from(t)}}},6544:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RadixTool=void 0;const a=i(9911),s=i(8925);t.RadixTool=class RadixTool{static bufferToBase16String(e){return a.base16.stringify(s.Buffer.from(e))}static base16StringToBuffer(e){return s.Buffer.from(a.base16.parse(e))}static stringToBase16String(e){return a.base16.stringify(s.Buffer.from(e))}static base16StringToString(e){return s.Buffer.from(a.base16.parse(e)).toString()}static bufferToBase32String(e){return a.base32.stringify(s.Buffer.from(e))}static base32StringToBuffer(e){return s.Buffer.from(a.base32.parse(e))}static stringToBase32String(e){return a.base32.stringify(s.Buffer.from(e))}static base32StringToString(e){return s.Buffer.from(a.base32.parse(e)).toString()}static bufferToBase32URLString(e){return a.base32.stringify(s.Buffer.from(e),{pad:!1})}static base32URLStringToBuffer(e){return s.Buffer.from(a.base32.parse(e,{loose:!0}))}static stringToBase32URLString(e){return a.base32.stringify(s.Buffer.from(e),{pad:!1})}static base32URLStringToString(e){return s.Buffer.from(a.base32.parse(e,{loose:!0})).toString()}static bufferToBase64String(e){return a.base64.stringify(s.Buffer.from(e))}static base64StringToBuffer(e){return s.Buffer.from(a.base64.parse(e))}static stringToBase64String(e){return a.base64.stringify(s.Buffer.from(e))}static base64StringToString(e){return s.Buffer.from(a.base64.parse(e)).toString()}static bufferToBase64URLString(e){return a.base64url.stringify(s.Buffer.from(e),{pad:!1})}static base64URLStringToBuffer(e){return s.Buffer.from(a.base64url.parse(e,{loose:!0}))}static stringToBase64URLString(e){return a.base64url.stringify(s.Buffer.from(e),{pad:!1})}static base64URLStringToString(e){return s.Buffer.from(a.base64url.parse(e,{loose:!0})).toString()}}},2016:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnexpectedError=t.ValidationError=t.InternalError=void 0;class InternalError extends Error{constructor(e,t,i){super(),this._code=e,this._cause=t,this._params=i}get name(){return this.constructor.name}get message(){var e;return`<${this.constructor.name}| ${this._code.logContent}> caused from: `+(null==(e=this._cause)?void 0:e.message)}get code(){return this._code}get cause(){return this._cause}get params(){return this._params}}class ValidationError extends(t.InternalError=InternalError){}t.ValidationError=ValidationError;class UnexpectedError extends InternalError{static aggravate(e){return e instanceof ValidationError?new UnexpectedError(e.code,e.cause,e.params):e}}t.UnexpectedError=UnexpectedError},8925:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=void 0;let a=i(896);const s=(a=a||i(8764)).Buffer;t.Buffer=s},896:e=>{"use strict";let t=null;globalThis&&(t={Buffer:globalThis.Buffer},Object.values(t).some((e=>null==e)))&&(t=null),e.exports=t},3575:function(e){var t;"undefined"!=typeof window&&(t=()=>(()=>{var e={"./src/config.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{enableStreamingMode:()=>I,hlsDefaultConfig:()=>A,mergeConfig:()=>w});var a=i("./src/controller/abr-controller.ts"),s=i("./src/controller/audio-stream-controller.ts"),o=i("./src/controller/audio-track-controller.ts"),u=i("./src/controller/subtitle-stream-controller.ts"),l=i("./src/controller/subtitle-track-controller.ts"),c=i("./src/controller/buffer-controller.ts"),d=i("./src/controller/timeline-controller.ts"),f=i("./src/controller/cap-level-controller.ts"),h=i("./src/controller/fps-controller.ts"),p=i("./src/controller/eme-controller.ts"),v=i("./src/controller/cmcd-controller.ts"),g=i("./src/utils/xhr-loader.ts"),m=i("./src/utils/fetch-loader.ts"),y=i("./src/utils/cues.ts"),E=i("./src/utils/mediakeys-helper.ts"),_=i("./src/utils/logger.ts");function T(){return T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},T.apply(this,arguments)}function b(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function S(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?b(Object(i),!0).forEach((function(t){R(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):b(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function R(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var A=S(S({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:g.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:a.default,bufferController:c.default,capLevelController:f.default,fpsController:h.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:E.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:y.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:u.SubtitleStreamController,subtitleTrackController:l.default,timelineController:d.TimelineController,audioStreamController:s.default,audioTrackController:o.default,emeController:p.default,cmcdController:v.default});function w(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return T({},e,t)}function I(e){var t=e.loader;t!==m.default&&t!==g.default?(_.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):(0,m.fetchSupported)()&&(e.loader=m.default,e.progressive=!0,e.enableSoftwareAES=!0,_.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var a=i("./src/polyfills/number.ts"),s=i("./src/utils/ewma-bandwidth-estimator.ts"),o=i("./src/events.ts"),u=i("./src/errors.ts"),l=i("./src/types/loader.ts"),c=i("./src/utils/logger.ts");function d(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}var f=function(){function e(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.loadingTime=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new s.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var t,i,f,h=e.prototype;return h.registerListeners=function(){var e=this.hls;e.on(o.Events.FRAG_LOADING,this.onFragLoading,this),e.on(o.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(o.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(o.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var e=this.hls;e.off(o.Events.FRAG_LOADING,this.onFragLoading,this),e.off(o.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(o.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(o.Events.ERROR,this.onError,this)},h.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},h.onFragLoading=function(e,t){var i,a=t.frag;a.type===l.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=a,this.partCurrent=null!=(i=t.part)?i:null,this.timer=self.setInterval(this.onCheck,100),this.loadingTime=performance.now()))},h.onLevelLoaded=function(e,t){var i=this.hls.config;t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)},h._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,i=this.hls,s=i.autoLevelEnabled,u=i.media;if(e&&u){var l=t?t.stats:e.stats,d=t?t.duration:e.duration;if(l.aborted||l.loaded&&l.loaded===l.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(s&&!u.paused&&u.playbackRate&&u.readyState){var f=i.mainForwardBufferInfo;if(null!==f&&!(performance.now()-this.loadingTime<1e3*d/2)){var h=performance.now()-l.loading.start,p=Math.abs(u.playbackRate);if(!(h<=500*d/p)){var v=l.loaded&&l.loading.first,g=this.bwEstimator.getEstimate(),m=i.levels,y=i.minAutoLevel,E=m[e.level],_=l.total||Math.max(l.loaded,Math.round(d*E.maxBitrate/8)),T=v?1e3*l.loaded/h:0,b=T?(_-l.loaded)/T:8*_/g,S=f.len/p;if(!(b<=S)){var R,A=Number.POSITIVE_INFINITY;for(R=e.level-1;R>y;R--){var w=m[R].maxBitrate;if((A=T?d*w/(6.4*T):d*w/g)<S)break}A>=b||(c.logger.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+R+"\n      Current BW estimate: "+((0,a.isFiniteNumber)(g)?(g/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+b.toFixed(3)+" s\n      Estimated load time for the next fragment: "+A.toFixed(3)+" s\n      Time to underbuffer: "+S.toFixed(3)+" s"),i.nextLoadLevel=R,v?this.bwEstimator.sample(h,l.loaded):this.bwEstimator.sample(1e3*d,d*m[R].maxBitrate/8*.5),this.clearTimer(),(e.loader||e.keyLoader)&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),i.trigger(o.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:l}))}}}}}},h.onFragLoaded=function(e,t){var i=t.frag,s=t.part;if(i.type===l.PlaylistLevelType.MAIN&&(0,a.isFiniteNumber)(i.sn)){var u=s?s.stats:i.stats,c=s?s.duration:i.duration;if(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[i.level],f=(d.loaded?d.loaded.bytes:0)+u.loaded,h=(d.loaded?d.loaded.duration:0)+c;d.loaded={bytes:f,duration:h},d.realBitrate=Math.round(8*f/h)}if(i.bitrateTest){var p={stats:u,frag:i,part:s,id:i.type};this.onFragBuffered(o.Events.FRAG_BUFFERED,p)}}},h.onFragBuffered=function(e,t){var i=t.frag,a=t.part,s=a?a.stats:i.stats;if(!s.aborted&&i.type===l.PlaylistLevelType.MAIN&&"initSegment"!==i.sn){var o=s.parsing.end-s.loading.start;this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},h.onError=function(e,t){var i;if((null===(i=t.frag)||void 0===i?void 0:i.type)===l.PlaylistLevelType.MAIN){if(t.type===u.ErrorTypes.KEY_SYSTEM_ERROR)return void this.clearTimer();switch(t.details){case u.ErrorDetails.FRAG_LOAD_ERROR:case u.ErrorDetails.FRAG_LOAD_TIMEOUT:case u.ErrorDetails.KEY_LOAD_ERROR:case u.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer()}}},h.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},h.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,i=this.hls,a=i.maxAutoLevel,s=i.config,o=i.minAutoLevel,u=i.media,l=t?t.duration:e?e.duration:0,d=u&&0!==u.playbackRate?Math.abs(u.playbackRate):1,f=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,h=i.mainForwardBufferInfo,p=(h?h.len:0)/d,v=this.findBestLevel(f,o,a,p,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(v>=0)return v;c.logger.trace((p?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var g=l?Math.min(l,s.maxStarvationDelay):s.maxStarvationDelay,m=s.abrBandWidthFactor,y=s.abrBandWidthUpFactor;if(!p){var E=this.bitrateTestDelay;E&&(g=(l?Math.min(l,s.maxLoadingDelay):s.maxLoadingDelay)-E,c.logger.trace("bitrate test took "+Math.round(1e3*E)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),m=y=1)}return v=this.findBestLevel(f,o,a,p+g,m,y),Math.max(v,0)},h.findBestLevel=function(e,t,i,s,o,u){for(var l,d=this.fragCurrent,f=this.partCurrent,h=this.lastLoadedFragLevel,p=this.hls.levels,v=p[h],g=!(null==v||null===(l=v.details)||void 0===l||!l.live),m=null==v?void 0:v.codecSet,y=f?f.duration:d?d.duration:0,E=i;E>=t;E--){var _=p[E];if(_&&(!m||_.codecSet===m)){var T=_.details,b=(f?null==T?void 0:T.partTarget:null==T?void 0:T.averagetargetduration)||y,S=void 0;S=E<=h?o*e:u*e;var R=p[E].maxBitrate,A=R*b/S;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+E+"/"+Math.round(S)+"/"+R+"/"+b+"/"+s+"/"+A),S>R&&(0===A||!(0,a.isFiniteNumber)(A)||g&&!this.bitrateTestDelay||A<s))return E}}return-1},t=e,(i=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;var i=this.getNextABRAutoLevel();return-1!==e&&this.hls.levels[i].loadError?e:(-1!==e&&(i=Math.min(e,i)),i)},set:function(e){this._nextAutoLevel=e}}])&&d(t.prototype,i),f&&d(t,f),Object.defineProperty(t,"prototype",{writable:!1}),e}();const h=f},"./src/controller/audio-stream-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>T});var a=i("./src/polyfills/number.ts"),s=i("./src/controller/base-stream-controller.ts"),o=i("./src/events.ts"),u=i("./src/utils/buffer-helper.ts"),l=i("./src/controller/fragment-tracker.ts"),c=i("./src/types/level.ts"),d=i("./src/types/loader.ts"),f=i("./src/loader/fragment.ts"),h=i("./src/demux/chunk-cache.ts"),p=i("./src/demux/transmuxer-interface.ts"),v=i("./src/types/transmuxer.ts"),g=i("./src/controller/fragment-finders.ts"),m=i("./src/utils/discontinuities.ts"),y=i("./src/errors.ts");function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},E.apply(this,arguments)}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}const T=function(e){var t,i;function T(t,i,a){var s;return(s=e.call(this,t,i,a,"[audio-stream-controller]")||this).videoBuffer=null,s.videoTrackCC=-1,s.waitingVideoCC=-1,s.audioSwitch=!1,s.trackId=-1,s.waitingData=null,s.mainDetails=null,s.bufferFlushed=!1,s.cachedTrackLoadedData=null,s._registerListeners(),s}i=e,(t=T).prototype=Object.create(i.prototype),t.prototype.constructor=t,_(t,i);var b=T.prototype;return b.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},b._registerListeners=function(){var e=this.hls;e.on(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(o.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(o.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(o.Events.ERROR,this.onError,this),e.on(o.Events.BUFFER_RESET,this.onBufferReset,this),e.on(o.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(o.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},b._unregisterListeners=function(){var e=this.hls;e.off(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(o.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(o.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(o.Events.ERROR,this.onError,this),e.off(o.Events.BUFFER_RESET,this.onBufferReset,this),e.off(o.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(o.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},b.onInitPtsFound=function(e,t){var i=t.frag,a=t.id,o=t.initPTS;if("main"===a){var u=i.cc;this.initPTS[i.cc]=o,this.log("InitPTS for cc: "+u+" found from main: "+o),this.videoTrackCC=u,this.state===s.State.WAITING_INIT_PTS&&this.tick()}},b.startLoad=function(e){if(!this.levels)return this.startPosition=e,void(this.state=s.State.STOPPED);var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t,this.state=s.State.IDLE):(this.loadedmetadata=!1,this.state=s.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},b.doTick=function(){switch(this.state){case s.State.IDLE:this.doTickIdle();break;case s.State.WAITING_TRACK:var t,i=this.levels,a=this.trackId,o=null==i||null===(t=i[a])||void 0===t?void 0:t.details;if(o){if(this.waitForCdnTuneIn(o))break;this.state=s.State.WAITING_INIT_PTS}break;case s.State.FRAG_LOADING_WAITING_RETRY:var l,c=performance.now(),d=this.retryDate;(!d||c>=d||null!==(l=this.media)&&void 0!==l&&l.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=s.State.IDLE);break;case s.State.WAITING_INIT_PTS:var f=this.waitingData;if(f){var h=f.frag,p=f.part,v=f.cache,m=f.complete;if(void 0!==this.initPTS[h.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=s.State.FRAG_LOADING;var y={frag:h,part:p,payload:v.flush(),networkDetails:null};this._handleFragmentLoadProgress(y),m&&e.prototype._handleFragmentLoadComplete.call(this,y)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+h.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var E=this.getLoadPosition(),_=u.BufferHelper.bufferInfo(this.mediaBuffer,E,this.config.maxBufferHole);(0,g.fragmentWithinToleranceTest)(_.end,this.config.maxFragLookUpTolerance,h)<0&&(this.log("Waiting fragment cc ("+h.cc+") @ "+h.start+" cancelled because another fragment at "+_.end+" is needed"),this.clearWaitingFragment())}}else this.state=s.State.IDLE}this.onTickEnd()},b.clearWaitingFragment=function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=s.State.IDLE)},b.resetLoadingState=function(){this.clearWaitingFragment(),e.prototype.resetLoadingState.call(this)},b.onTickEnd=function(){var e=this.media;e&&e.readyState&&(this.lastCurrentTime=e.currentTime)},b.doTickIdle=function(){var e=this.hls,t=this.levels,i=this.media,a=this.trackId,u=e.config;if(t&&t[a]&&(i||!this.startFragRequested&&u.startFragPrefetch)){var l=t[a].details;if(!l||l.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(l))this.state=s.State.WAITING_TRACK;else{var c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,f.ElementaryStreamTypes.AUDIO,d.PlaylistLevelType.AUDIO));var h=this.getFwdBufferInfo(c,d.PlaylistLevelType.AUDIO);if(null!==h){var p=this.audioSwitch;if(!p&&this._streamEnded(h,l))return e.trigger(o.Events.BUFFER_EOS,{type:"audio"}),void(this.state=s.State.ENDED);var v=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,d.PlaylistLevelType.MAIN);if(!(h.len>=this.getMaxBufferLength(null==v?void 0:v.len))||p){var g=l.fragments[0].start,m=h.end;if(p&&i){var y=this.getLoadPosition();m=y,l.PTSKnown&&y<g&&(h.end>g||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=g+.05)}if(!(v&&m>v.end+l.targetduration)&&(v&&v.len||!h.len)){var E=this.getNextFragment(m,l);E?this.loadFragment(E,l,m):this.bufferFlushed=!0}}}}}},b.getMaxBufferLength=function(t){var i=e.prototype.getMaxBufferLength.call(this);return t?Math.max(i,t):i},b.onMediaDetaching=function(){this.videoBuffer=null,e.prototype.onMediaDetaching.call(this)},b.onAudioTracksUpdated=function(e,t){var i=t.audioTracks;this.resetTransmuxer(),this.levels=i.map((function(e){return new c.Level(e)}))},b.onAudioTrackSwitching=function(e,t){var i=!!t.url;this.trackId=t.id;var a=this.fragCurrent;a&&a.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.audioSwitch=!0,this.state=s.State.IDLE):this.state=s.State.STOPPED,this.tick()},b.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},b.onLevelLoaded=function(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(o.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},b.onAudioTrackLoaded=function(e,t){var i;if(null!=this.mainDetails){var a=this.levels,o=t.details,u=t.id;if(a){this.log("Track "+u+" loaded ["+o.startSN+","+o.endSN+"],duration:"+o.totalduration);var l=a[u],c=0;if(o.live||null!==(i=l.details)&&void 0!==i&&i.live){var d=this.mainDetails;if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed||!d)return;!l.details&&o.hasProgramDateTime&&d.hasProgramDateTime?((0,m.alignMediaPlaylistByPDT)(o,d),c=o.fragments[0].start):c=this.alignPlaylists(o,l.details)}l.details=o,this.levelLastLoaded=u,this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(l.details,c),this.state!==s.State.WAITING_TRACK||this.waitForCdnTuneIn(o)||(this.state=s.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+u)}else this.cachedTrackLoadedData=t},b._handleFragmentLoadProgress=function(e){var t,i=e.frag,a=e.part,o=e.payload,u=this.config,l=this.trackId,c=this.levels;if(c){var f=c[l];console.assert(f,"Audio track is defined on fragment load progress");var g=f.details;console.assert(g,"Audio track details are defined on fragment load progress");var m=u.defaultAudioCodec||f.audioCodec||"mp4a.40.2",y=this.transmuxer;y||(y=this.transmuxer=new p.default(this.hls,d.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var E=this.initPTS[i.cc],_=null===(t=i.initSegment)||void 0===t?void 0:t.data;if(void 0!==E){var T=a?a.index:-1,b=-1!==T,S=new v.ChunkMetadata(i.level,i.sn,i.stats.chunkCount,o.byteLength,T,b);y.push(o,_,m,"",i,a,g.totalduration,!1,S,E)}else this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+g.startSN+" ,"+g.endSN+"],track "+l),(this.waitingData=this.waitingData||{frag:i,part:a,cache:new h.default,complete:!1}).cache.push(new Uint8Array(o)),this.waitingVideoCC=this.videoTrackCC,this.state=s.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},b._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:e.prototype._handleFragmentLoadComplete.call(this,t)},b.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},b.onBufferCreated=function(e,t){var i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)},b.onFragBuffered=function(e,t){var i,a=t.frag,s=t.part;a.type===d.PlaylistLevelType.AUDIO?this.fragContextChanged(a)?this.warn("Fragment "+a.sn+(s?" p: "+s.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==a.sn&&(this.fragPrevious=a,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(o.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(a,s)):this.loadedmetadata||a.type!==d.PlaylistLevelType.MAIN||null!==(i=this.videoBuffer||this.media)&&void 0!==i&&i.buffered.length&&(this.loadedmetadata=!0)},b.onError=function(t,i){if(i.type!==y.ErrorTypes.KEY_SYSTEM_ERROR)switch(i.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.FRAG_PARSING_ERROR:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.AUDIO,i);break;case y.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case y.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==s.State.ERROR&&this.state!==s.State.STOPPED&&(this.state=i.fatal?s.State.ERROR:s.State.IDLE,this.warn(i.details+" while loading frag, switching to "+this.state+" state"));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===i.parent&&(this.state===s.State.PARSING||this.state===s.State.PARSED)){var a=!0,o=this.getFwdBufferInfo(this.mediaBuffer,d.PlaylistLevelType.AUDIO);o&&o.len>.5&&(a=!this.reduceMaxBufferLength(o.len)),a&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(d.PlaylistLevelType.AUDIO,i)},b.onBufferFlushed=function(e,t){t.type===f.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===s.State.ENDED&&(this.state=s.State.IDLE))},b._handleTransmuxComplete=function(e){var t,i="audio",a=this.hls,u=e.remuxResult,l=e.chunkMeta,c=this.getCurrentContext(l);if(!c)return this.warn("The loading context changed while buffering fragment "+l.sn+" of level "+l.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(l.level);var d=c.frag,h=c.part,p=c.level.details,v=u.audio,g=u.text,m=u.id3,y=u.initSegment;if(!this.fragContextChanged(d)&&p){if(this.state=s.State.PARSING,this.audioSwitch&&v&&this.completeAudioSwitch(),null!=y&&y.tracks&&(this._bufferInitSegment(y.tracks,d,l),a.trigger(o.Events.FRAG_PARSING_INIT_SEGMENT,{frag:d,id:i,tracks:y.tracks})),v){var _=v.startPTS,T=v.endPTS,b=v.startDTS,S=v.endDTS;h&&(h.elementaryStreams[f.ElementaryStreamTypes.AUDIO]={startPTS:_,endPTS:T,startDTS:b,endDTS:S}),d.setElementaryStreamInfo(f.ElementaryStreamTypes.AUDIO,_,T,b,S),this.bufferFragmentData(v,d,h,l)}if(null!=m&&null!==(t=m.samples)&&void 0!==t&&t.length){var R=E({id:i,frag:d,details:p},m);a.trigger(o.Events.FRAG_PARSING_METADATA,R)}if(g){var A=E({id:i,frag:d,details:p},g);a.trigger(o.Events.FRAG_PARSING_USERDATA,A)}}},b._bufferInitSegment=function(e,t,i){if(this.state===s.State.PARSING){e.video&&delete e.video;var a=e.audio;if(a){a.levelCodec=a.codec,a.id="audio",this.log("Init audio buffer, container:"+a.container+", codecs[parsed]=["+a.codec+"]"),this.hls.trigger(o.Events.BUFFER_CODECS,e);var u=a.initSegment;if(null!=u&&u.byteLength){var l={type:"audio",frag:t,part:null,chunkMeta:i,parent:t.type,data:u};this.hls.trigger(o.Events.BUFFER_APPENDING,l)}this.tick()}}},b.loadFragment=function(t,i,o){var u=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||u===l.FragmentState.NOT_LOADED||u===l.FragmentState.PARTIAL)&&("initSegment"===t.sn?this._loadInitSegment(t,i):i.live&&!(0,a.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=s.State.WAITING_INIT_PTS):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,i,o)))},b.completeAudioSwitch=function(){var t=this.hls,i=this.media,a=this.trackId;i&&(this.log("Switching audio track : flushing all audio"),e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(o.Events.AUDIO_TRACK_SWITCHED,{id:a})},T}(s.default)},"./src/controller/audio-track-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>f});var a=i("./src/events.ts"),s=i("./src/errors.ts"),o=i("./src/controller/base-playlist-controller.ts"),u=i("./src/types/loader.ts");function l(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}var d=function(e){var t,i;function o(t){var i;return(i=e.call(this,t,"[audio-track-controller]")||this).tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.trackName="",i.selectDefaultTrack=!0,i.registerListeners(),i}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,c(t,i);var d,f,h,p=o.prototype;return p.registerListeners=function(){var e=this.hls;e.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(a.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){var e=this.hls;e.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(a.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(a.Events.ERROR,this.onError,this)},p.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,e.prototype.destroy.call(this)},p.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},p.onManifestParsed=function(e,t){this.tracks=t.audioTracks||[]},p.onAudioTrackLoaded=function(e,t){var i=t.id,a=t.details,s=this.tracksInGroup[i];if(s){var o=s.details;s.details=t.details,this.log("audioTrack "+i+" loaded ["+a.startSN+"-"+a.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,t,o))}else this.warn("Invalid audio track id "+i)},p.onLevelLoading=function(e,t){this.switchLevel(t.level)},p.onLevelSwitching=function(e,t){this.switchLevel(t.level)},p.switchLevel=function(e){var t=this.hls.levels[e];if(null!=t&&t.audioGroupIds){var i=t.audioGroupIds[t.urlId];if(this.groupId!==i){this.groupId=i;var s=this.tracks.filter((function(e){return!i||e.groupId===i}));this.selectDefaultTrack&&!s.some((function(e){return e.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=s;var o={audioTracks:s};this.log("Updating audio tracks, "+s.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(a.Events.AUDIO_TRACKS_UPDATED,o),this.selectInitialTrack()}}},p.onError=function(t,i){e.prototype.onError.call(this,t,i),!i.fatal&&i.context&&i.context.type===u.PlaylistContextType.AUDIO_TRACK&&i.context.id===this.trackId&&i.context.groupId===this.groupId&&this.retryLoadingOrFail(i)},p.setAudioTrack=function(e){var t=this.tracksInGroup;if(e<0||e>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var i=t[this.trackId];this.log("Now switching to audio-track index "+e);var s=t[e],o=s.id,u=s.groupId,l=void 0===u?"":u,c=s.name,d=s.type,f=s.url;if(this.trackId=e,this.trackName=c,this.selectDefaultTrack=!1,this.hls.trigger(a.Events.AUDIO_TRACK_SWITCHING,{id:o,groupId:l,name:c,type:d,url:f}),!s.details||s.details.live){var h=this.switchParams(s.url,null==i?void 0:i.details);this.loadPlaylist(h)}}},p.selectInitialTrack=function(){var e=this.tracksInGroup;console.assert(e.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,i=this.findTrackId(t)||this.findTrackId();-1!==i?this.setAudioTrack(i):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},p.findTrackId=function(e){for(var t=this.tracksInGroup,i=0;i<t.length;i++){var a=t[i];if((!this.selectDefaultTrack||a.default)&&(!e||e===a.name))return a.id}return-1},p.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var i=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(i)){var s=i.id,o=i.groupId,u=i.url;if(t)try{u=t.addDirectives(u)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(a.Events.AUDIO_TRACK_LOADING,{url:u,id:s,groupId:o,deliveryDirectives:t||null})}},d=o,(f=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}])&&l(d.prototype,f),h&&l(d,h),Object.defineProperty(d,"prototype",{writable:!1}),o}(o.default);const f=d},"./src/controller/base-playlist-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var a=i("./src/types/level.ts"),s=i("./src/controller/level-helper.ts"),o=i("./src/utils/logger.ts"),u=i("./src/errors.ts"),l=function(){function e(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=o.logger.log.bind(o.logger,t+":"),this.warn=o.logger.warn.bind(o.logger,t+":"),this.hls=e}var t=e.prototype;return t.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},t.onError=function(e,t){!t.fatal||t.type!==u.ErrorTypes.NETWORK_ERROR&&t.type!==u.ErrorTypes.KEY_SYSTEM_ERROR||this.stopLoad()},t.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(e,t){var i=null==t?void 0:t.renditionReports;if(i)for(var s=0;s<i.length;s++){var u=i[s],l=void 0;try{l=new self.URL(u.URI,t.url).href}catch(e){o.logger.warn("Could not construct new URL for Rendition Report: "+e),l=u.URI||""}if(l===e.slice(-l.length)){var c=parseInt(u["LAST-MSN"])||(null==t?void 0:t.lastPartSn),d=parseInt(u["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var f=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&f>t.partTarget&&(d+=1)}return new a.HlsUrlParameters(c,d>=0?d:void 0,a.HlsSkip.No)}}},t.loadPlaylist=function(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},t.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},t.playlistLoaded=function(e,t,i){var a=this,o=t.details,u=t.stats,l=self.performance.now(),c=u.loading.first?Math.max(0,l-u.loading.first):0;if(o.advancedDateTime=Date.now()-c,o.live||null!=i&&i.live){if(o.reloaded(i),i&&this.log("live playlist "+e+" "+(o.advanced?"REFRESHED "+o.lastPartSn+"-"+o.lastPartIndex:"MISSED")),i&&o.fragments.length>0&&(0,s.mergeDetails)(i,o),!this.canLoad||!o.live)return;var d,f=void 0,h=void 0;if(o.canBlockReload&&o.endSN&&o.advanced){var p=this.hls.config.lowLatencyMode,v=o.lastPartSn,g=o.endSN,m=o.lastPartIndex,y=v===g;-1!==m?(f=y?g+1:v,h=y?p?0:m:m+1):f=g+1;var E=o.age,_=E+o.ageHeader,T=Math.min(_-o.partTarget,1.5*o.targetduration);if(T>0){if(i&&T>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+T+" with playlist age: "+o.age),T=0;else{var b=Math.floor(T/o.targetduration);f+=b,void 0!==h&&(h+=Math.round(T%o.targetduration/o.partTarget)),this.log("CDN Tune-in age: "+o.ageHeader+"s last advanced "+E.toFixed(2)+"s goal: "+T+" skip sn "+b+" to part "+h)}o.tuneInGoal=T}if(d=this.getDeliveryDirectives(o,t.deliveryDirectives,f,h),p||!y)return void this.loadPlaylist(d)}else d=this.getDeliveryDirectives(o,t.deliveryDirectives,f,h);var S=this.hls.mainForwardBufferInfo,R=S?S.end-S.len:0,A=1e3*(o.edge-R),w=(0,s.computeReloadInterval)(o,A);o.updated?l>this.requestScheduled+w&&(this.requestScheduled=u.loading.start):this.requestScheduled=-1,void 0!==f&&o.canBlockReload?this.requestScheduled=u.loading.first+w-(1e3*o.partTarget||1e3):this.requestScheduled=(-1===this.requestScheduled?l:this.requestScheduled)+w;var I=this.requestScheduled-l;I=Math.max(0,I),this.log("reload live playlist "+e+" in "+Math.round(I)+" ms"),this.timer=self.setTimeout((function(){return a.loadPlaylist(d)}),I)}else this.clearTimer()},t.getDeliveryDirectives=function(e,t,i,s){var o=(0,a.getSkipValue)(e,i);return null!=t&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,o=a.HlsSkip.No),new a.HlsUrlParameters(i,s,o)},t.retryLoadingOrFail=function(e){var t,i=this,a=this.hls.config,s=this.retryCount<a.levelLoadingMaxRetry;if(s)if(this.requestScheduled=-1,this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&null!==(t=e.context)&&void 0!==t&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var o=Math.min(Math.pow(2,this.retryCount)*a.levelLoadingRetryDelay,a.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return i.loadPlaylist()}),o),this.warn("retry playlist loading #"+this.retryCount+" in "+o+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return s},e}()},"./src/controller/base-stream-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{State:()=>S,default:()=>R});var a=i("./src/polyfills/number.ts"),s=i("./src/task-loop.ts"),o=i("./src/controller/fragment-tracker.ts"),u=i("./src/utils/buffer-helper.ts"),l=i("./src/utils/logger.ts"),c=i("./src/events.ts"),d=i("./src/errors.ts"),f=i("./src/types/transmuxer.ts"),h=i("./src/utils/mp4-tools.ts"),p=i("./src/utils/discontinuities.ts"),v=i("./src/controller/fragment-finders.ts"),g=i("./src/controller/level-helper.ts"),m=i("./src/loader/fragment-loader.ts"),y=i("./src/crypt/decrypter.ts"),E=i("./src/utils/time-ranges.ts"),_=i("./src/types/loader.ts");function T(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}var S={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},R=function(e){var t,i;function s(t,i,a,s){var o;return(o=e.call(this)||this).hls=void 0,o.fragPrevious=null,o.fragCurrent=null,o.fragmentTracker=void 0,o.transmuxer=null,o._state=S.STOPPED,o.media=null,o.mediaBuffer=null,o.config=void 0,o.bitrateTest=!1,o.lastCurrentTime=0,o.nextLoadPosition=0,o.startPosition=0,o.loadedmetadata=!1,o.fragLoadError=0,o.retryDate=0,o.levels=null,o.fragmentLoader=void 0,o.keyLoader=void 0,o.levelLastLoaded=null,o.startFragRequested=!1,o.decrypter=void 0,o.initPTS=[],o.onvseeking=null,o.onvended=null,o.logPrefix="",o.log=void 0,o.warn=void 0,o.logPrefix=s,o.log=l.logger.log.bind(l.logger,s+":"),o.warn=l.logger.warn.bind(l.logger,s+":"),o.hls=t,o.fragmentLoader=new m.default(t.config),o.keyLoader=a,o.fragmentTracker=i,o.config=t.config,o.decrypter=new y.default(t.config),t.on(c.Events.LEVEL_SWITCHING,o.onLevelSwitching,function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o)),o}i=e,(t=s).prototype=Object.create(i.prototype),t.prototype.constructor=t,b(t,i);var R,A,w,I=s.prototype;return I.doTick=function(){this.onTickEnd()},I.onTickEnd=function(){},I.startLoad=function(e){},I.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var e=this.fragCurrent;e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=S.STOPPED},I._streamEnded=function(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;var i=t.partList;if(null!=i&&i.length){var a=i[i.length-1];return u.BufferHelper.isBuffered(this.media,a.start+a.duration/2)}var s=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)},I.getLevelDetails=function(){var e;if(this.levels&&null!==this.levelLastLoaded)return null===(e=this.levels[this.levelLastLoaded])||void 0===e?void 0:e.details},I.onMediaAttached=function(e,t){var i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);var a=this.config;this.levels&&a.autoStartLoad&&this.state===S.STOPPED&&this.startLoad(a.startPosition)},I.onMediaDetaching=function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},I.onMediaSeeking=function(){var e=this.config,t=this.fragCurrent,i=this.media,s=this.mediaBuffer,o=this.state,l=i?i.currentTime:0,c=u.BufferHelper.bufferInfo(s||i,l,e.maxBufferHole);if(this.log("media seeking to "+((0,a.isFiniteNumber)(l)?l.toFixed(3):l)+", state: "+o),this.state===S.ENDED)this.resetLoadingState();else if(t){var d=e.maxFragLookUpTolerance,f=t.start-d,h=t.start+t.duration+d;if(!c.len||h<c.start||f>c.end){var p=l>h;(l<f||p)&&(p&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests()),this.resetLoadingState())}}i&&(this.lastCurrentTime=l),this.loadedmetadata||c.len||(this.nextLoadPosition=this.startPosition=l),this.tickImmediate()},I.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},I.onLevelSwitching=function(e,t){this.fragLoadError=0},I.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},I.onHandlerDestroyed=function(){this.state=S.STOPPED,this.hls.off(c.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},I.loadFragment=function(e,t,i){this._loadFragForPlayback(e,t,i)},I._loadFragForPlayback=function(e,t,i){var a=this;this._doFragLoad(e,t,i,(function(t){if(a.fragContextChanged(e))return a.warn("Fragment "+e.sn+(t.part?" p: "+t.part.index:"")+" of level "+e.level+" was dropped during download."),void a.fragmentTracker.removeFragment(e);e.stats.chunkCount++,a._handleFragmentLoadProgress(t)})).then((function(t){if(t){a.fragLoadError=0;var i=a.state;a.fragContextChanged(e)?(i===S.FRAG_LOADING||!a.fragCurrent&&i===S.PARSING)&&(a.fragmentTracker.removeFragment(e),a.state=S.IDLE):("payload"in t&&(a.log("Loaded fragment "+e.sn+" of level "+e.level),a.hls.trigger(c.Events.FRAG_LOADED,t)),a._handleFragmentLoadComplete(t))}})).catch((function(t){a.state!==S.STOPPED&&a.state!==S.ERROR&&(a.warn(t),a.resetFragmentLoading(e))}))},I.flushMainBuffer=function(e,t,i){if(void 0===i&&(i=null),e-t){var a={startOffset:e,endOffset:t,type:i};this.fragLoadError=0,this.hls.trigger(c.Events.BUFFER_FLUSHING,a)}},I._loadInitSegment=function(e,t){var i=this;this._doFragLoad(e,t).then((function(t){if(!t||i.fragContextChanged(e)||!i.levels)throw new Error("init load aborted");return t})).then((function(t){var a=i.hls,s=t.payload,o=e.decryptdata;if(s&&s.byteLength>0&&o&&o.key&&o.iv&&"AES-128"===o.method){var u=self.performance.now();return i.decrypter.decrypt(new Uint8Array(s),o.key.buffer,o.iv.buffer).then((function(i){var s=self.performance.now();return a.trigger(c.Events.FRAG_DECRYPTED,{frag:e,payload:i,stats:{tstart:u,tdecrypt:s}}),t.payload=i,t}))}return t})).then((function(t){var a=i.fragCurrent,s=i.hls,o=i.levels;if(!o)throw new Error("init load aborted, missing levels");var u=o[e.level].details;console.assert(u,"Level details are defined when init segment is loaded");var l=e.stats;i.state=S.IDLE,i.fragLoadError=0,e.data=new Uint8Array(t.payload),l.parsing.start=l.buffering.start=self.performance.now(),l.parsing.end=l.buffering.end=self.performance.now(),t.frag===a&&s.trigger(c.Events.FRAG_BUFFERED,{stats:l,frag:a,part:null,id:e.type}),i.tick()})).catch((function(t){i.state!==S.STOPPED&&i.state!==S.ERROR&&(i.warn(t),i.resetFragmentLoading(e))}))},I.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId},I.fragBufferedComplete=function(e,t){var i,a,s,o,l=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level+" (frag:["+(null!=(i=e.startPTS)?i:NaN).toFixed(3)+"-"+(null!=(a=e.endPTS)?a:NaN).toFixed(3)+"] > buffer:"+(l?E.default.toString(u.BufferHelper.getBuffered(l)):"(detached)")+")"),this.state=S.IDLE,l&&(!this.loadedmetadata&&e.type==_.PlaylistLevelType.MAIN&&l.buffered.length&&(null===(s=this.fragCurrent)||void 0===s?void 0:s.sn)===(null===(o=this.fragPrevious)||void 0===o?void 0:o.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},I.seekToStartPos=function(){},I._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var i=e.frag,a=e.part,s=e.partsLoaded,o=!s||0===s.length||s.some((function(e){return!e})),u=new f.ChunkMetadata(i.level,i.sn,i.stats.chunkCount+1,0,a?a.index:-1,!o);t.flush(u)}},I._handleFragmentLoadProgress=function(e){},I._doFragLoad=function(e,t,i,s){var o,u=this;if(void 0===i&&(i=null),!this.levels)throw new Error("frag load aborted, missing levels");var l=null;if(!e.encrypted||null!==(o=e.decryptdata)&&void 0!==o&&o.key?!e.encrypted&&t.encryptedFragments.length&&this.keyLoader.loadClear(e,t.encryptedFragments):(this.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=S.KEY_LOADING,this.fragCurrent=e,l=this.keyLoader.load(e).then((function(e){if(!u.fragContextChanged(e.frag))return u.hls.trigger(c.Events.KEY_LOADED,e),u.state===S.KEY_LOADING&&(u.state=S.IDLE),e})),this.hls.trigger(c.Events.KEY_LOADING,{frag:e}),this.throwIfFragContextChanged("KEY_LOADING")),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&t){var d=t.partList;if(d&&s){i>e.end&&t.fragmentHint&&(e=t.fragmentHint);var f=this.getNextPart(d,e,i);if(f>-1){var h=d[f];return this.log("Loading part sn: "+e.sn+" p: "+h.index+" cc: "+e.cc+" of playlist ["+t.startSN+"-"+t.endSN+"] parts [0-"+f+"-"+(d.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=h.start+h.duration,this.state=S.FRAG_LOADING,this.hls.trigger(c.Events.FRAG_LOADING,{frag:e,part:d[f],targetBufferTime:i}),this.throwIfFragContextChanged("FRAG_LOADING parts"),l?l.then((function(t){return!t||u.fragContextChanged(t.frag)?null:u.doFragPartsLoad(e,d,f,s)})).catch((function(e){return u.handleFragLoadError(e)})):this.doFragPartsLoad(e,d,f,s).catch((function(e){return u.handleFragLoadError(e)}))}if(!e.url||this.loadedEndOfParts(d,i))return Promise.resolve(null)}}this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(t?"of ["+t.startSN+"-"+t.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(i.toFixed(3))),(0,a.isFiniteNumber)(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=S.FRAG_LOADING,this.hls.trigger(c.Events.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.throwIfFragContextChanged("FRAG_LOADING");var p=this.config.progressive;return p&&l?l.then((function(t){return!t||u.fragContextChanged(null==t?void 0:t.frag)?null:u.fragmentLoader.load(e,s)})).catch((function(e){return u.handleFragLoadError(e)})):Promise.all([this.fragmentLoader.load(e,p?s:void 0),l]).then((function(e){var t=e[0];return!p&&t&&s&&s(t),t})).catch((function(e){return u.handleFragLoadError(e)}))},I.throwIfFragContextChanged=function(e){if(null===this.fragCurrent)throw new Error("frag load aborted, context changed in "+e)},I.doFragPartsLoad=function(e,t,i,a){var s=this;return new Promise((function(o,u){var l=[];!function i(d){var f=t[d];s.fragmentLoader.loadPart(e,f,a).then((function(a){l[f.index]=a;var u=a.part;s.hls.trigger(c.Events.FRAG_LOADED,a);var h=t[d+1];if(!h||h.fragment!==e)return o({frag:e,part:u,partsLoaded:l});i(d+1)})).catch(u)}(i)}))},I.handleFragLoadError=function(e){if("data"in e){var t=e.data;e.data&&t.details===d.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(c.Events.ERROR,t)}else this.hls.trigger(c.Events.ERROR,{type:d.ErrorTypes.OTHER_ERROR,details:d.ErrorDetails.INTERNAL_EXCEPTION,err:e,fatal:!0});return null},I._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(t&&this.state===S.PARSING){var i=t.frag,a=t.part,s=t.level,o=self.performance.now();i.stats.parsing.end=o,a&&(a.stats.parsing.end=o),this.updateLevelTiming(i,a,s,e.partial)}else this.fragCurrent||this.state===S.STOPPED||this.state===S.ERROR||(this.state=S.IDLE)},I.getCurrentContext=function(e){var t=this.levels,i=e.level,a=e.sn,s=e.part;if(!t||!t[i])return this.warn("Levels object was unset while buffering fragment "+a+" of level "+i+". The current chunk will not be buffered."),null;var o=t[i],u=s>-1?(0,g.getPartWith)(o,a,s):null,l=u?u.fragment:(0,g.getFragmentWithSN)(o,a,this.fragCurrent);return l?{frag:l,part:u,level:o}:null},I.bufferFragmentData=function(e,t,i,a){if(e&&this.state===S.PARSING){var s=e.data1,o=e.data2,u=s;if(s&&o&&(u=(0,h.appendUint8Array)(s,o)),u&&u.length){var l={type:e.type,frag:t,part:i,chunkMeta:a,parent:t.type,data:u};this.hls.trigger(c.Events.BUFFER_APPENDING,l),e.dropped&&e.independent&&!i&&this.flushBufferGap(t)}}},I.flushBufferGap=function(e){var t=this.media;if(t)if(u.BufferHelper.isBuffered(t,t.currentTime)){var i=t.currentTime,a=u.BufferHelper.bufferInfo(t,i,0),s=e.duration,o=Math.min(2*this.config.maxFragLookUpTolerance,.25*s),l=Math.max(Math.min(e.start-o,a.end-o),i+o);e.start-l>o&&this.flushMainBuffer(l,e.start)}else this.flushMainBuffer(0,e.start)},I.getFwdBufferInfo=function(e,t){var i=this.config,s=this.getLoadPosition();if(!(0,a.isFiniteNumber)(s))return null;var o=u.BufferHelper.bufferInfo(e,s,i.maxBufferHole);if(0===o.len&&void 0!==o.nextStart){var l=this.fragmentTracker.getBufferedFrag(s,t);if(l&&o.nextStart<l.end)return u.BufferHelper.bufferInfo(e,s,Math.max(o.nextStart,i.maxBufferHole))}return o},I.getMaxBufferLength=function(e){var t,i=this.config;return t=e?Math.max(8*i.maxBufferSize/e,i.maxBufferLength):i.maxBufferLength,Math.min(t,i.maxMaxBufferLength)},I.reduceMaxBufferLength=function(e){var t=this.config,i=e||t.maxBufferLength;return t.maxMaxBufferLength>=i&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},I.getNextFragment=function(e,t){var i=t.fragments,a=i.length;if(!a)return null;var s,o=this.config,u=i[0].start;if(t.live){var l=o.initialLiveManifestSize;if(a<l)return this.warn("Not enough fragments to start playback (have: "+a+", need: "+l+")"),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(s=this.getInitialLiveFragment(t,i),this.startPosition=s?this.hls.liveSyncPosition||s.start:e)}else e<=u&&(s=i[0]);if(!s){var c=o.lowLatencyMode?t.partEnd:t.fragmentEnd;s=this.getFragmentAtPosition(e,c,t)}return this.mapToInitFragWhenRequired(s)},I.mapToInitFragWhenRequired=function(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment},I.getNextPart=function(e,t,i){for(var a=-1,s=!1,o=!0,u=0,l=e.length;u<l;u++){var c=e[u];if(o=o&&!c.independent,a>-1&&i<c.start)break;var d=c.loaded;d?a=-1:(s||c.independent||o)&&c.fragment===t&&(a=u),s=d}return a},I.loadedEndOfParts=function(e,t){var i=e[e.length-1];return i&&t>i.start&&i.loaded},I.getInitialLiveFragment=function(e,t){var i=this.fragPrevious,a=null;if(i){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),a=(0,v.findFragmentByPDT)(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!a){var s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){var o=t[s-e.startSN];i.cc===o.cc&&(a=o,this.log("Live playlist, switching playlist, load frag with next SN: "+a.sn))}a||(a=(0,v.findFragWithCC)(t,i.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+a.sn)}}else{var u=this.hls.liveSyncPosition;null!==u&&(a=this.getFragmentAtPosition(u,this.bitrateTest?e.fragmentEnd:e.edge,e))}return a},I.getFragmentAtPosition=function(e,t,i){var a,s=this.config,u=this.fragPrevious,l=i.fragments,c=i.endSN,d=i.fragmentHint,f=s.maxFragLookUpTolerance,h=!!(s.lowLatencyMode&&i.partList&&d);if(h&&d&&!this.bitrateTest&&(l=l.concat(d),c=d.sn),e<t){var p=e>t-f?0:f;a=(0,v.findFragmentByPTS)(u,l,e,p)}else a=l[l.length-1];if(a){var g=a.sn-i.startSN;if(this.fragmentTracker.getState(a)===o.FragmentState.OK&&(u=a),u&&a.sn===u.sn&&!h&&u&&a.level===u.level){var m=l[g+1];a.sn<c&&this.fragmentTracker.getState(m)!==o.FragmentState.OK?(this.log("SN "+a.sn+" just loaded, load next one: "+m.sn),a=m):a=null}}return a},I.synchronizeToLiveEdge=function(e){var t=this.config,i=this.media;if(i){var a=this.hls.liveSyncPosition,s=i.currentTime,o=e.fragments[0].start,u=e.edge,l=s>=o-t.maxFragLookUpTolerance&&s<=u;if(null!==a&&i.duration>a&&(s<a||!l)){var c=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&i.readyState<4||s<u-c)&&(this.loadedmetadata||(this.nextLoadPosition=a),i.readyState&&(this.warn("Playback: "+s.toFixed(3)+" is located too far from the end of live sliding playlist: "+u+", reset currentTime to : "+a.toFixed(3)),i.currentTime=a))}}},I.alignPlaylists=function(e,t){var i=this.levels,s=this.levelLastLoaded,o=this.fragPrevious,u=null!==s?i[s]:null,l=e.fragments.length;if(!l)return this.warn("No fragments in live playlist"),0;var c=e.fragments[0].start,d=!t,f=e.alignedSliding&&(0,a.isFiniteNumber)(c);if(d||!f&&!c){(0,p.alignStream)(o,u,e);var h=e.fragments[0].start;return this.log("Live playlist sliding: "+h.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" prev-sn: "+(o?o.sn:"na")+" fragments: "+l),h}return c},I.waitForCdnTuneIn=function(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)},I.setStartPosition=function(e,t){var i=this.startPosition;if(i<t&&(i=-1),-1===i||-1===this.lastCurrentTime){var s=e.startTimeOffset;(0,a.isFiniteNumber)(s)?(i=t+s,s<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log("Start time offset "+s+" found in playlist, adjust startPosition to "+i),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i},I.getLoadPosition=function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},I.handleFragLoadAborted=function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part"+t.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},I.resetFragmentLoading=function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===S.FRAG_LOADING_WAITING_RETRY)||(this.state=S.IDLE)},I.onFragmentOrKeyLoadError=function(e,t){if(t.fatal)return this.stopLoad(),void(this.state=S.ERROR);var i=this.config;if(t.chunkMeta){var a=this.getCurrentContext(t.chunkMeta);a&&(t.frag=a.frag,t.levelRetry=!0,this.fragLoadError=i.fragLoadingMaxRetry)}var s=t.frag;if(s&&s.type===e){var o=this.fragCurrent;if(console.assert(o&&s.sn===o.sn&&s.level===o.level&&s.urlId===o.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=i.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var u=Math.min(Math.pow(2,this.fragLoadError)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);this.warn("Fragment "+s.sn+" of "+e+" "+s.level+" failed to load, retrying in "+u+"ms"),this.retryDate=self.performance.now()+u,this.fragLoadError++,this.state=S.FRAG_LOADING_WAITING_RETRY}else t.levelRetry?(e===_.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=S.IDLE):(l.logger.error(t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.hls.stopLoad(),this.state=S.ERROR)}},I.afterBufferFlushed=function(e,t,i){if(e){var a=u.BufferHelper.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,a,i),this.state===S.ENDED&&this.resetLoadingState()}},I.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=S.IDLE},I.resetStartWhenNotLoaded=function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},I.updateLevelTiming=function(e,t,i,a){var s=this,o=i.details;console.assert(!!o,"level.details must be defined"),Object.keys(e.elementaryStreams).reduce((function(t,u){var l=e.elementaryStreams[u];if(l){var d=l.endPTS-l.startPTS;if(d<=0)return s.warn("Could not parse fragment "+e.sn+" "+u+" duration reliably ("+d+")"),t||!1;var f=a?0:(0,g.updateFragPTSDTS)(o,e,l.startPTS,l.endPTS,l.startDTS,l.endDTS);return s.hls.trigger(c.Events.LEVEL_PTS_UPDATED,{details:o,level:i,drift:f,type:u,frag:e,start:l.startPTS,end:l.endPTS}),!0}return t}),!1)||(this.warn("Found no media in fragment "+e.sn+" of level "+i.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=S.PARSED,this.hls.trigger(c.Events.FRAG_PARSED,{frag:e,part:t})},I.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},R=s,(A=[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}])&&T(R.prototype,A),w&&T(R,w),Object.defineProperty(R,"prototype",{writable:!1}),s}(s.default)},"./src/controller/buffer-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var a=i("./src/polyfills/number.ts"),s=i("./src/events.ts"),o=i("./src/utils/logger.ts"),u=i("./src/errors.ts"),l=i("./src/utils/buffer-helper.ts"),c=i("./src/utils/mediasource-helper.ts"),d=i("./src/loader/fragment.ts"),f=i("./src/controller/buffer-operation-queue.ts"),h=(0,c.getMediaSource)(),p=/([ha]vc.)(?:\.[^.,]+)+/,v=function(){function e(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=t.media,i=t.mediaSource;o.logger.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(s.Events.MEDIA_ATTACHED,{media:e})),i&&i.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){o.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){o.logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var e=t.media,i=t._objectUrl;e&&e.src!==i&&o.logger.error("Media element src was set while attaching MediaSource ("+i+" > "+e.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},t.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},t.registerListeners=function(){var e=this.hls;e.on(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(s.Events.BUFFER_RESET,this.onBufferReset,this),e.on(s.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(s.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(s.Events.BUFFER_EOS,this.onBufferEos,this),e.on(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(s.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(s.Events.FRAG_PARSED,this.onFragParsed,this),e.on(s.Events.FRAG_CHANGED,this.onFragChanged,this)},t.unregisterListeners=function(){var e=this.hls;e.off(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(s.Events.BUFFER_RESET,this.onBufferReset,this),e.off(s.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(s.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(s.Events.BUFFER_EOS,this.onBufferEos,this),e.off(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(s.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(s.Events.FRAG_PARSED,this.onFragParsed,this),e.off(s.Events.FRAG_CHANGED,this.onFragChanged,this)},t._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new f.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},t.onManifestParsed=function(e,t){var i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,o.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function(e,t){var i=this.media=t.media;if(i&&h){var a=this.mediaSource=new h;a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(a),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}},t.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,i=this._objectUrl;if(t){if(o.logger.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){o.logger.warn("[buffer-controller]: onMediaDetaching: "+e.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):o.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(s.Events.MEDIA_DETACHED,void 0)},t.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach((function(t){var i=e.sourceBuffer[t];try{i&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(i),e.sourceBuffer[t]=void 0)}catch(e){o.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",e)}})),this._initSourceBuffer()},t.onBufferCodecs=function(e,t){var i=this,a=this.getSourceBufferTypes().length;Object.keys(t).forEach((function(e){if(a){var s=i.tracks[e];if(s&&"function"==typeof s.buffer.changeType){var u=t[e],l=u.id,c=u.codec,d=u.levelCodec,f=u.container,h=u.metadata,v=(s.levelCodec||s.codec).replace(p,"$1"),g=(d||c).replace(p,"$1");if(v!==g){var m=f+";codecs="+(d||c);i.appendChangeType(e,m),o.logger.log("[buffer-controller]: switching codec "+v+" to "+g),i.tracks[e]={buffer:s.buffer,codec:c,container:f,levelCodec:d,metadata:h,id:l}}}}else i.pendingTracks[e]=t[e]})),a||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},t.appendChangeType=function(e,t){var i=this,a=this.operationQueue,s={execute:function(){var s=i.sourceBuffer[e];s&&(o.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),s.changeType(t)),a.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){o.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};a.append(s,e)},t.onBufferAppending=function(e,t){var i=this,a=this.hls,c=this.operationQueue,d=this.tracks,f=t.data,h=t.type,p=t.frag,v=t.part,g=t.chunkMeta,m=g.buffering[h],y=self.performance.now();m.start=y;var E=p.stats.buffering,_=v?v.stats.buffering:null;0===E.start&&(E.start=y),_&&0===_.start&&(_.start=y);var T=d.audio,b=!1;"audio"===h&&"audio/mpeg"===(null==T?void 0:T.container)&&(b=!this.lastMpegAudioChunk||1===g.id||this.lastMpegAudioChunk.sn!==g.sn,this.lastMpegAudioChunk=g);var S=p.start,R={execute:function(){if(m.executeStart=self.performance.now(),b){var e=i.sourceBuffer[h];if(e){var t=S-e.timestampOffset;Math.abs(t)>=.1&&(o.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+S+" (delta: "+t+") sn: "+p.sn+")"),e.timestampOffset=S)}}i.appendExecutor(f,h)},onStart:function(){},onComplete:function(){var e=self.performance.now();m.executeEnd=m.end=e,0===E.first&&(E.first=e),_&&0===_.first&&(_.first=e);var t=i.sourceBuffer,a={};for(var o in t)a[o]=l.BufferHelper.getBuffered(t[o]);i.appendError=0,i.hls.trigger(s.Events.BUFFER_APPENDED,{type:h,frag:p,part:v,chunkMeta:g,parent:p.type,timeRanges:a})},onError:function(e){o.logger.error("[buffer-controller]: Error encountered while trying to append to the "+h+" SourceBuffer",e);var t={type:u.ErrorTypes.MEDIA_ERROR,parent:p.type,details:u.ErrorDetails.BUFFER_APPEND_ERROR,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=u.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,t.details=u.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>a.config.appendErrorMaxRetry&&(o.logger.error("[buffer-controller]: Failed "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t.fatal=!0,a.stopLoad())),a.trigger(s.Events.ERROR,t)}};c.append(R,h)},t.onBufferFlushing=function(e,t){var i=this,a=this.operationQueue,u=function(e){return{execute:i.removeExecutor.bind(i,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(s.Events.BUFFER_FLUSHED,{type:e})},onError:function(t){o.logger.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}};t.type?a.append(u(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){a.append(u(e),e)}))},t.onFragParsed=function(e,t){var i=this,a=t.frag,u=t.part,l=[],c=u?u.elementaryStreams:a.elementaryStreams;c[d.ElementaryStreamTypes.AUDIOVIDEO]?l.push("audiovideo"):(c[d.ElementaryStreamTypes.AUDIO]&&l.push("audio"),c[d.ElementaryStreamTypes.VIDEO]&&l.push("video")),0===l.length&&o.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+a.type+" level: "+a.level+" sn: "+a.sn),this.blockBuffers((function(){var e=self.performance.now();a.stats.buffering.end=e,u&&(u.stats.buffering.end=e);var t=u?u.stats:a.stats;i.hls.trigger(s.Events.FRAG_BUFFERED,{frag:a,part:u,stats:t,id:a.type})}),l)},t.onFragChanged=function(e,t){this.flushBackBuffer()},t.onBufferEos=function(e,t){var i=this;this.getSourceBufferTypes().reduce((function(e,a){var s=i.sourceBuffer[a];return!s||t.type&&t.type!==a||(s.ending=!0,s.ended||(s.ended=!0,o.logger.log("[buffer-controller]: "+a+" sourceBuffer now EOS"))),e&&!(s&&!s.ended)}),!0)&&(o.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){i.getSourceBufferTypes().forEach((function(e){var t=i.sourceBuffer[e];t&&(t.ending=!1)}));var e=i.mediaSource;e&&"open"===e.readyState?(o.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&o.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+e.readyState)})))},t.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},t.flushBackBuffer=function(){var e=this.hls,t=this.details,i=this.media,u=this.sourceBuffer;if(i&&null!==t){var c=this.getSourceBufferTypes();if(c.length){var d=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if((0,a.isFiniteNumber)(d)&&!(d<0)){var f=i.currentTime,h=t.levelTargetDuration,p=Math.max(d,h),v=Math.floor(f/h)*h-p;c.forEach((function(i){var a=u[i];if(a){var c=l.BufferHelper.getBuffered(a);if(c.length>0&&v>c.start(0)){if(e.trigger(s.Events.BACK_BUFFER_REACHED,{bufferEnd:v}),t.live)e.trigger(s.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:v});else if(a.ended&&c.end(c.length-1)-f<2*h)return void o.logger.info("[buffer-controller]: Cannot flush "+i+" back buffer while SourceBuffer is in ended state");e.trigger(s.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:v,type:i})}}}))}}}},t.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,i=this.media,s=this.mediaSource,u=e.fragments[0].start+e.totalduration,l=i.duration,c=(0,a.isFiniteNumber)(s.duration)?s.duration:0;e.live&&t.config.liveDurationInfinity?(o.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),s.duration=1/0,this.updateSeekableRange(e)):(u>c&&u>l||!(0,a.isFiniteNumber)(l))&&(o.logger.log("[buffer-controller]: Updating Media Source duration to "+u.toFixed(3)),s.duration=u)}},t.updateSeekableRange=function(e){var t=this.mediaSource,i=e.fragments;if(i.length&&e.live&&null!=t&&t.setLiveSeekableRange){var a=Math.max(0,i[0].start),s=Math.max(a,a+e.totalduration);t.setLiveSeekableRange(a,s)}},t.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,i=this.pendingTracks,a=Object.keys(i).length;if(a&&!e||2===a){this.createSourceBuffers(i),this.pendingTracks={};var o=this.getSourceBufferTypes();if(0===o.length)return void this.hls.trigger(s.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});o.forEach((function(e){t.executeNext(e)}))}},t.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var a=0;for(var l in e)if(!t[l]){var c=e[l];if(!c)throw Error("source buffer exists for track "+l+", however track does not");var d=c.levelCodec||c.codec,f=c.container+";codecs="+d;o.logger.log("[buffer-controller]: creating sourceBuffer("+f+")");try{var h=t[l]=i.addSourceBuffer(f),p=l;this.addBufferListener(p,"updatestart",this._onSBUpdateStart),this.addBufferListener(p,"updateend",this._onSBUpdateEnd),this.addBufferListener(p,"error",this._onSBUpdateError),this.tracks[l]={buffer:h,codec:d,container:c.container,levelCodec:c.levelCodec,metadata:c.metadata,id:c.id},a++}catch(e){o.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message),this.hls.trigger(s.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:f})}}a&&this.hls.trigger(s.Events.BUFFER_CREATED,{tracks:this.tracks})},t._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},t._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},t._onSBUpdateError=function(e,t){o.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(s.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},t.removeExecutor=function(e,t,i){var s=this.media,u=this.mediaSource,l=this.operationQueue,c=this.sourceBuffer[e];if(!s||!u||!c)return o.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void l.shiftAndExecuteNext(e);var d=(0,a.isFiniteNumber)(s.duration)?s.duration:1/0,f=(0,a.isFiniteNumber)(u.duration)?u.duration:1/0,h=Math.max(0,t),p=Math.min(i,d,f);p>h&&!c.ending?(c.ended=!1,o.logger.log("[buffer-controller]: Removing ["+h+","+p+"] from the "+e+" SourceBuffer"),console.assert(!c.updating,e+" sourceBuffer must not be updating"),c.remove(h,p)):l.shiftAndExecuteNext(e)},t.appendExecutor=function(e,t){var i=this.operationQueue,a=this.sourceBuffer[t];if(!a)return o.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(t);a.ended=!1,console.assert(!a.updating,t+" sourceBuffer must not be updating"),a.appendBuffer(e)},t.blockBuffers=function(e,t){var i=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return o.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var a=this.operationQueue,s=t.map((function(e){return a.appendBlocker(e)}));Promise.all(s).then((function(){e(),t.forEach((function(e){var t=i.sourceBuffer[e];t&&t.updating||a.shiftAndExecuteNext(e)}))}))},t.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function(e,t,i){var a=this.sourceBuffer[e];if(a){var s=i.bind(this,e);this.listeners[e].push({event:t,listener:s}),a.addEventListener(t,s)}},t.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))},e}()},"./src/controller/buffer-operation-queue.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var a=i("./src/utils/logger.ts"),s=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function(e,t){var i=this.queues[t];i.push(e),1===i.length&&this.buffers[t]&&this.executeNext(t)},t.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},t.appendBlocker=function(e){var t,i=new Promise((function(e){t=e})),a={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(a,e),i},t.executeNext=function(e){var t=this.buffers,i=this.queues,s=t[e],o=i[e];if(o.length){var u=o[0];try{u.execute()}catch(t){a.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),u.onError(t),s&&s.updating||(o.shift(),this.executeNext(e))}}},t.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},t.current=function(e){return this.queues[e][0]},e}()},"./src/controller/cap-level-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var a=i("./src/events.ts");function s(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}var o=function(){function e(e){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t,i,o,u=e.prototype;return u.setStreamController=function(e){this.streamController=e},u.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},u.registerListeners=function(){var e=this.hls;e.on(a.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},u.unregisterListener=function(){var e=this.hls;e.off(a.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},u.onFpsDropLevelCapping=function(t,i){e.isLevelAllowed(i.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(i.droppedLevel)},u.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null},u.onManifestParsed=function(e,t){var i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()},u.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},u.onMediaDetaching=function(){this.stopCapping()},u.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},u.getMaxLevel=function(t){var i=this,a=this.hls.levels;if(!a.length)return-1;var s=a.filter((function(a,s){return e.isLevelAllowed(s,i.restrictedLevels)&&s<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)},u.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},u.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},u.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,t.width||t.height||(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t},e.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},e.getMaxLevelByMediaSize=function(e,t,i){if(!e||!e.length)return-1;for(var a,s,o=e.length-1,u=0;u<e.length;u+=1){var l=e[u];if((l.width>=t||l.height>=i)&&(a=l,!(s=e[u+1])||a.width!==s.width||a.height!==s.height)){o=u;break}}return o},t=e,(i=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}}])&&s(t.prototype,i),o&&s(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();const u=o},"./src/controller/cmcd-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var a=i("./src/events.ts"),s=i("./src/types/cmcd.ts"),o=i("./src/utils/buffer-helper.ts"),u=i("./src/utils/logger.ts");function l(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}function c(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return f(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},h.apply(this,arguments)}var p=function(){function e(t){var i=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){i.initialized&&(i.starved=!0),i.buffering=!0},this.onPlaying=function(){i.initialized||(i.initialized=!0),i.buffering=!1},this.applyPlaylistData=function(e){try{i.apply(e,{ot:s.CMCDObjectType.MANIFEST,su:!i.initialized})}catch(e){u.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=function(e){try{var t=e.frag,a=i.hls.levels[t.level],o=i.getObjectType(t),l={d:1e3*t.duration,ot:o};o!==s.CMCDObjectType.VIDEO&&o!==s.CMCDObjectType.AUDIO&&o!=s.CMCDObjectType.MUXED||(l.br=a.bitrate/1e3,l.tb=i.getTopBandwidth(o)/1e3,l.bl=i.getBufferLength(o)),i.apply(e,l)}catch(e){u.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=t;var a=this.config=t.config,o=a.cmcd;null!=o&&(a.pLoader=this.createPlaylistLoader(),a.fLoader=this.createFragmentLoader(),this.sid=o.sessionId||e.uuid(),this.cid=o.contentId,this.useHeaders=!0===o.useHeaders,this.registerListeners())}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this)},t.unregisterListeners=function(){var e=this.hls;e.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},t.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},t.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},t.onBufferCreated=function(e,t){var i,a;this.audioBuffer=null===(i=t.tracks.audio)||void 0===i?void 0:i.buffer,this.videoBuffer=null===(a=t.tracks.video)||void 0===a?void 0:a.buffer},t.createData=function(){var e;return{v:s.CMCDVersion,sf:s.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(e=this.media)||void 0===e?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},t.apply=function(t,i){void 0===i&&(i={}),h(i,this.createData());var a=i.ot===s.CMCDObjectType.INIT||i.ot===s.CMCDObjectType.VIDEO||i.ot===s.CMCDObjectType.MUXED;if(this.starved&&a&&(i.bs=!0,i.su=!0,this.starved=!1),null==i.su&&(i.su=this.buffering),this.useHeaders){var o=e.toHeaders(i);if(!Object.keys(o).length)return;t.headers||(t.headers={}),h(t.headers,o)}else{var u=e.toQuery(i);if(!u)return;t.url=e.appendQueryToUri(t.url,u)}},t.getObjectType=function(e){var t=e.type;return"subtitle"===t?s.CMCDObjectType.TIMED_TEXT:"initSegment"===e.sn?s.CMCDObjectType.INIT:"audio"===t?s.CMCDObjectType.AUDIO:"main"===t?this.hls.audioTracks.length?s.CMCDObjectType.VIDEO:s.CMCDObjectType.MUXED:void 0},t.getTopBandwidth=function(e){var t,i=0,a=this.hls;if(e===s.CMCDObjectType.AUDIO)t=a.audioTracks;else{var o=a.maxAutoLevel,u=o>-1?o+1:a.levels.length;t=a.levels.slice(0,u)}for(var l,c=d(t);!(l=c()).done;){var f=l.value;f.bitrate>i&&(i=f.bitrate)}return i>0?i:NaN},t.getBufferLength=function(e){var t=this.hls.media,i=e===s.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return i&&t?1e3*o.BufferHelper.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len:NaN},t.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,i=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new i(e)}var a=e.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(e,i,a){t(e),this.loader.load(e,i,a)},c(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},t.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,i=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new i(e)}var a=e.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(e,i,a){t(e),this.loader.load(e,i,a)},c(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},e.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)},e.serialize=function(e){for(var t,i=[],a=function(e){return!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e},s=function(e){return Math.round(e)},o=function(e){return 100*s(e/100)},u={br:s,d:s,bl:o,dl:o,mtp:o,nor:function(e){return encodeURIComponent(e)},rtp:o,tb:s},l=d(Object.keys(e||{}).sort());!(t=l()).done;){var c=t.value,f=e[c];if(a(f)&&!("v"===c&&1===f||"pr"==c&&1===f)){var h=u[c];h&&(f=h(f));var p=typeof f,v=void 0;v="ot"===c||"sf"===c||"st"===c?c+"="+f:"boolean"===p?c:"number"===p?c+"="+f:c+"="+JSON.stringify(f),i.push(v)}}return i.join(",")},e.toHeaders=function(t){for(var i={},a=["Object","Request","Session","Status"],s=[{},{},{},{}],o={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},u=0,l=Object.keys(t);u<l.length;u++){var c=l[u];s[null!=o[c]?o[c]:1][c]=t[c]}for(var d=0;d<s.length;d++){var f=e.serialize(s[d]);f&&(i["CMCD-"+a[d]]=f)}return i},e.toQuery=function(t){return"CMCD="+encodeURIComponent(e.serialize(t))},e.appendQueryToUri=function(e,t){if(!t)return e;var i=e.includes("?")?"&":"?";return""+e+i+t},e}()},"./src/controller/eme-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>S});var a=i("./src/events.ts"),s=i("./src/errors.ts"),o=i("./src/utils/logger.ts"),u=i("./src/utils/mediakeys-helper.ts"),l=i("./src/utils/keysystem-util.ts"),c=i("./src/utils/numeric-encoding-utils.ts"),d=i("./src/loader/level-key.ts"),f=i("./src/utils/hex.ts"),h=i("./src/utils/mp4-tools.ts"),p=i("./node_modules/eventemitter3/index.js"),v=i.n(p);function g(e){var t="function"==typeof Map?new Map:void 0;return g=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return m(e,arguments,E(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),y(a,e)},g(e)}function m(e,t,i){return m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,i){var a=[null];a.push.apply(a,t);var s=new(Function.bind.apply(e,a));return i&&y(s,i.prototype),s},m.apply(null,arguments)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function E(e){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},E(e)}var _="[eme]",T=function(){function e(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=e.CDMCleanupPromise?[e.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=o.logger.debug.bind(o.logger,_),this.log=o.logger.log.bind(o.logger,_),this.warn=o.logger.warn.bind(o.logger,_),this.error=o.logger.error.bind(o.logger,_),this.hls=t,this.config=t.config,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},t.registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(a.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(a.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.getLicenseServerUrl=function(e){var t=this.config,i=t.drmSystems,a=t.widevineLicenseUrl,s=i[e];if(s)return s.licenseUrl;if(e===u.KeySystems.WIDEVINE&&a)return a;throw new Error('no license server URL configured for key-system "'+e+'"')},t.getServerCertificateUrl=function(e){var t=this.config.drmSystems[e];if(t)return t.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},t.attemptKeySystemAccess=function(e){var t=this,i=this.hls.levels,a=function(e,t,i){return!!e&&i.indexOf(e)===t},o=i.map((function(e){return e.audioCodec})).filter(a),u=i.map((function(e){return e.videoCodec})).filter(a);return o.length+u.length===0&&u.push("avc1.42e01e"),new Promise((function(i,a){!function e(l){var c=l.shift();t.getMediaKeysPromise(c,o,u).then((function(e){return i({keySystem:c,mediaKeys:e})})).catch((function(t){l.length?e(l):a(t instanceof b?t:new b({type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))}(e)}))},t.requestMediaKeySystemAccess=function(e,t){var i=this.config.requestMediaKeySystemAccessFunc;if("function"!=typeof i){var a="Configured requestMediaKeySystemAccess is not a function "+i;return null===u.requestMediaKeySystemAccess&&"http:"===self.location.protocol&&(a="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(a))}return i(e,t)},t.getMediaKeysPromise=function(e,t,i){var a=this,s=(0,u.getSupportedMediaKeySystemConfigurations)(e,t,i,this.config.drmSystemOptions),o=this.keySystemAccessPromises[e],l=null==o?void 0:o.keySystemAccess;if(!l){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(s)),l=this.requestMediaKeySystemAccess(e,s);var c=this.keySystemAccessPromises[e]={keySystemAccess:l};return l.catch((function(t){a.log('Failed to obtain access to key-system "'+e+'": '+t)})),l.then((function(t){a.log('Access for key-system "'+t.keySystem+'" obtained');var i=a.fetchServerCertificate(e);return a.log('Create media-keys for "'+e+'"'),c.mediaKeys=t.createMediaKeys().then((function(t){return a.log('Media-keys created for "'+e+'"'),i.then((function(i){return i?a.setMediaKeysServerCertificate(t,e,i):t}))})),c.mediaKeys.catch((function(t){a.error('Failed to create media-keys for "'+e+'"}: '+t)})),c.mediaKeys}))}return l.then((function(){return o.mediaKeys}))},t.createMediaKeySessionContext=function(e){var t=e.decryptdata,i=e.keySystem,a=e.mediaKeys;console.assert(!!a,"mediaKeys is defined"),this.log('Creating key-system session "'+i+'" keyId: '+f.default.hexDump(t.keyId||[]));var s=a.createSession(),o={decryptdata:t,keySystem:i,mediaKeys:a,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o},t.renewKeySession=function(e){var t=e.decryptdata;if(t.pssh){var i=this.createMediaKeySessionContext(e),a=this.getKeyIdString(t);this.keyIdToKeySessionPromise[a]=this.generateRequestWithPreferredKeySession(i,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},t.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return f.default.hexDump(e.keyId)},t.updateKeySession=function(e,t){var i,a=e.mediaKeysSession;return this.log('Updating key-session "'+a.sessionId+'" for keyID '+f.default.hexDump((null===(i=e.decryptdata)||void 0===i?void 0:i.keyId)||[])+"\n      } (data length: "+(t?t.byteLength:t)+")"),a.update(t)},t.selectKeySystemFormat=function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+t.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise},t.getKeyFormatPromise=function(e){var t=this;return new Promise((function(i,a){var s=(0,u.getKeySystemsForConfig)(t.config),o=e.map(u.keySystemFormatToKeySystemDomain).filter((function(e){return!!e&&-1!==s.indexOf(e)}));return t.getKeySystemSelectionPromise(o).then((function(e){var t=e.keySystem,s=(0,u.keySystemDomainToKeySystemFormat)(t);s?i(s):a(new Error('Unable to find format for key-system "'+t+'"'))})).catch(a)}))},t.loadKey=function(e){var t=this,i=e.keyInfo.decryptdata,a=this.getKeyIdString(i),s="(keyId: "+a+' format: "'+i.keyFormat+'" method: '+i.method+" uri: "+i.uri+")";this.log("Starting session for key "+s);var o=this.keyIdToKeySessionPromise[a];return o||(o=this.keyIdToKeySessionPromise[a]=this.getKeySystemForKeyPromise(i).then((function(a){var o=a.keySystem,u=a.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+s),t.attemptSetMediaKeys(o,u).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({keySystem:o,mediaKeys:u,decryptdata:i});return t.generateRequestWithPreferredKeySession(e,"cenc",i.pssh,"playlist-key")}))}))).catch((function(e){return t.handleError(e)})),o},t.throwIfDestroyed=function(e){if(void 0===e&&(e="Invalid state"),!this.hls)throw new Error("invalid state")},t.handleError=function(e){this.hls&&(this.error(e.message),e instanceof b?this.hls.trigger(a.Events.ERROR,e.data):this.hls.trigger(a.Events.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},t.getKeySystemForKeyPromise=function(e){var t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){var a=(0,u.keySystemFormatToKeySystemDomain)(e.keyFormat),s=a?[a]:(0,u.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(s)}return i},t.getKeySystemSelectionPromise=function(e){if(e.length||(e=(0,u.getKeySystemsForConfig)(this.config)),0===e.length)throw new b({type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},t._onMediaEncrypted=function(e){var t=this,i=e.initDataType,a=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+i+'"'),null!==a){var s,o;if("sinf"===i&&this.config.drmSystems[u.KeySystems.FAIRPLAY]){var l=(0,h.bin2str)(new Uint8Array(a));try{var p=(0,c.base64Decode)(JSON.parse(l).sinf),v=(0,h.parseSinf)(new Uint8Array(p));if(!v)return;s=v.subarray(8,24),o=u.KeySystems.FAIRPLAY}catch(e){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var g=(0,h.parsePssh)(a);if(null===g)return;0===g.version&&g.systemId===u.KeySystemIds.WIDEVINE&&g.data&&(s=g.data.subarray(8,24)),o=(0,u.keySystemIdToKeySystemDomain)(g.systemId)}if(o&&s){for(var m=f.default.hexDump(s),y=this.keyIdToKeySessionPromise,E=this.mediaKeySessions,_=y[m],T=function(e){var o=E[e],u=o.decryptdata;if(u.pssh||!u.keyId)return"continue";var l=f.default.hexDump(u.keyId);return m===l||-1!==u.uri.replace(/-/g,"").indexOf(m)?(_=y[l],delete y[l],u.pssh=new Uint8Array(a),u.keyId=s,_=y[m]=_.then((function(){return t.generateRequestWithPreferredKeySession(o,i,a,"encrypted-event-key-match")})),"break"):void 0},b=0;b<E.length;b++){var S=T(b);if("continue"!==S&&"break"===S)break}_||(_=y[m]=this.getKeySystemSelectionPromise([o]).then((function(e){var o,l=e.keySystem,c=e.mediaKeys;t.throwIfDestroyed();var f=new d.LevelKey("ISO-23001-7",m,null!=(o=(0,u.keySystemDomainToKeySystemFormat)(l))?o:"");return f.pssh=new Uint8Array(a),f.keyId=s,t.attemptSetMediaKeys(l,c).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({decryptdata:f,keySystem:l,mediaKeys:c});return t.generateRequestWithPreferredKeySession(e,i,a,"encrypted-event-no-match")}))}))),_.catch((function(e){return t.handleError(e)}))}}},t._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},t.attemptSetMediaKeys=function(e,t){var i=this,a=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var s=Promise.all(a).then((function(){if(!i.media)throw new Error("Attempted to set mediaKeys without media element attached");return i.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(s),s.then((function(){i.log('Media-keys set for "'+e+'"'),a.push(s),i.setMediaKeysQueue=i.setMediaKeysQueue.filter((function(e){return-1===a.indexOf(e)}))}))},t.generateRequestWithPreferredKeySession=function(e,t,i,a){var o,c,d=this,f=null===(o=this.config.drmSystems)||void 0===o||null===(c=o[e.keySystem])||void 0===c?void 0:c.generateRequest;if(f)try{var h=f.call(this.hls,t,i,e);if(!h)throw new Error("Invalid response from configured generateRequest filter");t=h.initDataType,i=e.decryptdata.pssh=h.initData?new Uint8Array(h.initData):null}catch(e){var p;if(this.warn(e.message),null!==(p=this.hls)&&void 0!==p&&p.config.debug)throw e}if(null===i)return this.log('Skipping key-session request for "'+a+'" (no initData)'),Promise.resolve(e);var g=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+a+'": '+g+" (init data type: "+t+" length: "+(i?i.byteLength:null)+")");var m=new(v());e.mediaKeysSession.onmessage=function(t){var i=e.mediaKeysSession;if(i){var a=t.messageType,s=t.message;d.log('"'+a+'" message event for session "'+i.sessionId+'" message size: '+s.byteLength),"license-request"===a||"license-renewal"===a?d.renewLicense(e,s).catch((function(e){d.handleError(e),m.emit("error",e)})):"license-release"===a?e.keySystem===u.KeySystems.FAIRPLAY&&(d.updateKeySession(e,(0,l.strToUtf8array)("acknowledged")),d.removeSession(e)):d.warn('unhandled media key message type "'+a+'"')}else m.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(t){if(e.mediaKeysSession){d.onKeyStatusChange(e);var i=e.keyStatus;m.emit("keyStatus",i),"expired"===i&&(d.warn(e.keySystem+" expired for key "+g),d.renewKeySession(e))}else m.emit("error",new Error("invalid state"))};var y=new Promise((function(e,t){m.on("error",t),m.on("keyStatus",(function(i){i.startsWith("usable")?e():"output-restricted"===i?t(new b({type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===i?t(new b({type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+i+'"')):"expired"===i?t(new Error("key expired while generating request")):d.warn('unhandled key status change "'+i+'"')}))}));return e.mediaKeysSession.generateRequest(t,i).then((function(){var t;d.log('Request generated for key-session "'+(null===(t=e.mediaKeysSession)||void 0===t?void 0:t.sessionId)+'" keyId: '+g)})).catch((function(e){throw new b({type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},"Error generating key-session request: "+e)})).then((function(){return y})).catch((function(t){throw m.removeAllListeners(),d.removeSession(e),t})).then((function(){return m.removeAllListeners(),e}))},t.onKeyStatusChange=function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach((function(i,a){t.log('key status change "'+i+'" for keyStatuses keyId: '+f.default.hexDump("buffer"in a?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a))+" session keyId: "+f.default.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=i}))},t.fetchServerCertificate=function(e){var t=this;return new Promise((function(i,a){var o=t.getServerCertificateUrl(e);if(!o)return i();t.log('Fetching serverCertificate for "'+e+'"');var u=new XMLHttpRequest;u.open("GET",o,!0),u.responseType="arraybuffer",u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&(200===u.status?i(u.response):a(new b({type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:u},'"'+e+'" certificate request XHR failed ('+o+"). Status: "+u.status+" ("+u.statusText+")")))},u.send()}))},t.setMediaKeysServerCertificate=function(e,t,i){var a=this;return new Promise((function(o,u){e.setServerCertificate(i).then((function(s){a.log("setServerCertificate "+(s?"success":"not supported by CDM")+" ("+(null==i?void 0:i.byteLength)+') on "'+t+'"'),o(e)})).catch((function(e){u(new b({type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))},t.renewLicense=function(e,t){var i=this;return this.requestLicense(e,new Uint8Array(t)).then((function(t){return i.updateKeySession(e,new Uint8Array(t)).catch((function(e){throw new b({type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))}))},t.setupLicenseXHR=function(e,t,i,a){var s=this,o=this.config.licenseXhrSetup;return o?Promise.resolve().then((function(){if(!i.decryptdata)throw new Error("Key removed");return o.call(s.hls,e,t,i,a)})).catch((function(u){if(!i.decryptdata)throw u;return e.open("POST",t,!0),o.call(s.hls,e,t,i,a)})).then((function(i){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:i||a}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:a}))},t.requestLicense=function(e,t){var i=this;return new Promise((function(a,o){var u=i.getLicenseServerUrl(e.keySystem);i.log("Sending license request to URL: "+u);var l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=function(){if(!i.hls||!e.mediaKeysSession)return o(new Error("invalid state"));if(4===l.readyState)if(200===l.status){i._requestLicenseFailureCount=0;var c=l.response;i.log("License received "+(c instanceof ArrayBuffer?c.byteLength:c));var d=i.config.licenseResponseCallback;if(d)try{c=d.call(i.hls,l,u,e)}catch(e){i.error(e)}a(c)}else if(i._requestLicenseFailureCount++,i._requestLicenseFailureCount>3||l.status>=400&&l.status<500)o(new b({type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:l},"License Request XHR failed ("+u+"). Status: "+l.status+" ("+l.statusText+")"));else{var f=3-i._requestLicenseFailureCount+1;i.warn("Retrying license request, "+f+" attempts left"),i.requestLicense(e,t).then(a,o)}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=l,i.setupLicenseXHR(l,u,e,t).then((function(e){var t=e.xhr,i=e.licenseChallenge;t.send(i)}))}))},t.onMediaAttached=function(e,t){if(this.config.emeEnabled){var i=t.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}},t.onMediaDetached=function(){var t=this,i=this.media,a=this.mediaKeySessions;i&&(i.removeEventListener("encrypted",this.onMediaEncrypted),i.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},d.LevelKey.clearKeyUriToKeyIdMap();var s=a.length;e.CDMCleanupPromise=Promise.all(a.map((function(e){return t.removeSession(e)})).concat(null==i?void 0:i.setMediaKeys(null).catch((function(e){t.log("Could not clear media keys: "+e+". media.src: "+(null==i?void 0:i.src))})))).then((function(){s&&(t.log("finished closing key sessions and clearing media keys"),a.length=0)})).catch((function(e){t.log("Could not close sessions and clear media keys: "+e+". media.src: "+(null==i?void 0:i.src))}))},t.onManifestLoaded=function(e,t){var i=t.sessionKeys;if(i&&this.config.emeEnabled&&!this.keyFormatPromise){var a=i.reduce((function(e,t){return-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e}),[]);this.log("Selecting key-system from session-keys "+a.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(a)}},t.removeSession=function(e){var t=this,i=e.mediaKeysSession,a=e.licenseXhr;if(i){this.log("Remove licenses and keys and close session "+i.sessionId),i.onmessage=null,i.onkeystatuseschange=null,a&&a.readyState!==XMLHttpRequest.DONE&&a.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var s=this.mediaKeySessions.indexOf(e);return s>-1&&this.mediaKeySessions.splice(s,1),i.remove().catch((function(e){t.log("Could not remove session: "+e)})).then((function(){return i.close()})).catch((function(e){t.log("Could not close session: "+e)}))}},e}();T.CDMCleanupPromise=void 0;var b=function(e){var t,i;function a(t,i){var a;return(a=e.call(this,i)||this).data=void 0,a.data=t,t.err=t.error,a}return i=e,(t=a).prototype=Object.create(i.prototype),t.prototype.constructor=t,y(t,i),a}(g(Error));const S=T},"./src/controller/fps-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var a=i("./src/events.ts"),s=i("./src/utils/logger.ts");const o=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching)},t.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function(e,t){var i=this.hls.config;if(i.capLevelOnFPSDrop){var a=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=a,a&&"function"==typeof a.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},t.checkFPS=function(e,t,i){var o=performance.now();if(t){if(this.lastTime){var u=o-this.lastTime,l=i-this.lastDroppedFrames,c=t-this.lastDecodedFrames,d=1e3*l/u,f=this.hls;if(f.trigger(a.Events.FPS_DROP,{currentDropped:l,currentDecoded:c,totalDroppedFrames:i}),d>0&&l>f.config.fpsDroppedMonitoringThreshold*c){var h=f.currentLevel;s.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(-1===f.autoLevelCapping||f.autoLevelCapping>=h)&&(h-=1,f.trigger(a.Events.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:f.currentLevel}),f.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=o,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},t.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}()},"./src/controller/fragment-finders.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{findFragWithCC:()=>d,findFragmentByPDT:()=>o,findFragmentByPTS:()=>u,fragmentWithinToleranceTest:()=>l,pdtWithinToleranceTest:()=>c});var a=i("./src/polyfills/number.ts"),s=i("./src/utils/binary-search.ts");function o(e,t,i){if(null===t||!Array.isArray(e)||!e.length||!(0,a.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;i=i||0;for(var s=0;s<e.length;++s){var o=e[s];if(c(t,i,o))return o}return null}function u(e,t,i,a){void 0===i&&(i=0),void 0===a&&(a=0);var o=null;if(e?o=t[e.sn-t[0].sn+1]||null:0===i&&0===t[0].start&&(o=t[0]),o&&0===l(i,a,o))return o;var u=s.default.search(t,l.bind(null,i,a));return!u||u===e&&o?o:u}function l(e,t,i){if(void 0===e&&(e=0),void 0===t&&(t=0),i.start<=e&&i.start+i.duration>e)return 0;var a=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-a<=e?1:i.start-a>e&&i.start?-1:0}function c(e,t,i){var a=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return(i.endProgramDateTime||0)-a>e}function d(e,t){return s.default.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}},"./src/controller/fragment-tracker.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{FragmentState:()=>a,FragmentTracker:()=>u});var a,s=i("./src/events.ts"),o=i("./src/types/loader.ts");!function(e){e.NOT_LOADED="NOT_LOADED",e.APPENDING="APPENDING",e.PARTIAL="PARTIAL",e.OK="OK"}(a||(a={}));var u=function(){function e(e){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(s.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(s.Events.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function(){var e=this.hls;e.off(s.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(s.Events.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},t.getAppendedFrag=function(e,t){if(t===o.PlaylistLevelType.MAIN){var i=this.activeFragment,a=this.activeParts;if(!i)return null;if(a)for(var s=a.length;s--;){var u=a[s],l=u?u.end:i.appendedPTS;if(u.start<=e&&void 0!==l&&e<=l)return s>9&&(this.activeParts=a.slice(s-9)),u}else if(i.start<=e&&void 0!==i.appendedPTS&&e<=i.appendedPTS)return i}return this.getBufferedFrag(e,t)},t.getBufferedFrag=function(e,t){for(var i=this.fragments,a=Object.keys(i),s=a.length;s--;){var o=i[a[s]];if((null==o?void 0:o.body.type)===t&&o.buffered){var u=o.body;if(u.start<=e&&e<=u.end)return u}}return null},t.detectEvictedFragments=function(e,t,i){var a=this;this.timeRanges&&(this.timeRanges[e]=t),Object.keys(this.fragments).forEach((function(s){var o=a.fragments[s];if(o)if(o.buffered||o.loaded){var u=o.range[e];u&&u.time.some((function(e){var i=!a.isTimeBuffered(e.startPTS,e.endPTS,t);return i&&a.removeFragment(o.body),i}))}else o.body.type===i&&a.removeFragment(o.body)}))},t.detectPartialFragments=function(e){var t=this,i=this.timeRanges,a=e.frag,s=e.part;if(i&&"initSegment"!==a.sn){var o=c(a),u=this.fragments[o];u&&(Object.keys(i).forEach((function(e){var o=a.elementaryStreams[e];if(o){var l=i[e],c=null!==s||!0===o.partial;u.range[e]=t.getBufferedTimes(a,s,c,l)}})),u.loaded=null,Object.keys(u.range).length?(u.buffered=!0,u.body.endList&&(this.endListFragments[u.body.type]=u)):this.removeFragment(u.body))}},t.fragBuffered=function(e){var t=c(e),i=this.fragments[t];i&&(i.loaded=null,i.buffered=!0)},t.getBufferedTimes=function(e,t,i,a){for(var s={time:[],partial:i},o=t?t.start:e.start,u=t?t.end:e.end,l=e.minEndPTS||u,c=e.maxStartPTS||o,d=0;d<a.length;d++){var f=a.start(d)-this.bufferPadding,h=a.end(d)+this.bufferPadding;if(c>=f&&l<=h){s.time.push({startPTS:Math.max(o,a.start(d)),endPTS:Math.min(u,a.end(d))});break}if(o<h&&u>f)s.partial=!0,s.time.push({startPTS:Math.max(o,a.start(d)),endPTS:Math.min(u,a.end(d))});else if(u<=f)break}return s},t.getPartialFragment=function(e){var t,i,a,s=null,o=0,u=this.bufferPadding,c=this.fragments;return Object.keys(c).forEach((function(d){var f=c[d];f&&l(f)&&(i=f.body.start-u,a=f.body.end+u,e>=i&&e<=a&&(t=Math.min(e-i,a-e),o<=t&&(s=f.body,o=t)))})),s},t.isEndListAppended=function(e){var t=this.endListFragments[e];return void 0!==t&&(t.buffered||l(t))},t.getState=function(e){var t=c(e),i=this.fragments[t];return i?i.buffered?l(i)?a.PARTIAL:a.OK:a.APPENDING:a.NOT_LOADED},t.isTimeBuffered=function(e,t,i){for(var a,s,o=0;o<i.length;o++){if(a=i.start(o)-this.bufferPadding,s=i.end(o)+this.bufferPadding,e>=a&&t<=s)return!0;if(t<=a)return!1}return!1},t.onFragLoaded=function(e,t){var i=t.frag,a=t.part;if("initSegment"!==i.sn&&!i.bitrateTest&&!a){var s=c(i);this.fragments[s]={body:i,loaded:t,buffered:!1,range:Object.create(null)}}},t.onBufferAppended=function(e,t){var i=this,a=t.frag,s=t.part,u=t.timeRanges;if(a.type===o.PlaylistLevelType.MAIN)if(this.activeFragment!==a&&(this.activeFragment=a,a.appendedPTS=void 0),s){var l=this.activeParts;l||(this.activeParts=l=[]),l.push(s)}else this.activeParts=null;this.timeRanges=u,Object.keys(u).forEach((function(e){var t=u[e];if(i.detectEvictedFragments(e,t),!s&&a.type===o.PlaylistLevelType.MAIN){var l=a.elementaryStreams[e];if(!l)return;for(var c=0;c<t.length;c++){var d=t.end(c);d<=l.endPTS&&d>l.startPTS?a.appendedPTS=Math.max(d,a.appendedPTS||0):a.appendedPTS=l.endPTS}}}))},t.onFragBuffered=function(e,t){this.detectPartialFragments(t)},t.hasFragment=function(e){var t=c(e);return!!this.fragments[t]},t.removeFragmentsInRange=function(e,t,i){var a=this;Object.keys(this.fragments).forEach((function(s){var o=a.fragments[s];if(o&&o.buffered){var u=o.body;u.type===i&&u.start<t&&u.end>e&&a.removeFragment(u)}}))},t.removeFragment=function(e){var t=c(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),e.appendedPTS=void 0,delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},t.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},e}();function l(e){var t,i;return e.buffered&&((null===(t=e.range.video)||void 0===t?void 0:t.partial)||(null===(i=e.range.audio)||void 0===i?void 0:i.partial))}function c(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}},"./src/controller/gap-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{MAX_START_GAP_JUMP:()=>c,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>d,SKIP_BUFFER_RANGE_START:()=>f,STALL_MINIMUM_DURATION_MS:()=>l,default:()=>h});var a=i("./src/utils/buffer-helper.ts"),s=i("./src/errors.ts"),o=i("./src/events.ts"),u=i("./src/utils/logger.ts"),l=250,c=2,d=.1,f=.05,h=function(){function e(e,t,i,a){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=a}var t=e.prototype;return t.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},t.poll=function(e,t){var i=this.config,s=this.media,o=this.stalled;if(null!==s){var d=s.currentTime,f=s.seeking,h=this.seeking&&!f,p=!this.seeking&&f;if(this.seeking=f,d===e){if((p||h)&&(this.stalled=null),!(s.paused&&!f||s.ended||0===s.playbackRate)&&a.BufferHelper.getBuffered(s).length){var v=a.BufferHelper.bufferInfo(s,d,0),g=v.len>0,m=v.nextStart||0;if(g||m){if(f){var y=v.len>c,E=!m||t&&t.start<=d||m-d>c&&!this.fragmentTracker.getPartialFragment(d);if(y||E)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var _,T=Math.max(m,v.start||0)-d,b=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,S=(null==b||null===(_=b.details)||void 0===_?void 0:_.live)?2*b.details.targetduration:c;if(T>0&&T<=S)return void this._trySkipBufferHole(null)}var R=self.performance.now();if(null!==o){var A=R-o;if(f||!(A>=l)||(this._reportStall(v),this.media)){var w=a.BufferHelper.bufferInfo(s,d,i.maxBufferHole);this._tryFixBufferStall(w,A)}}else this.stalled=R}}}else if(this.moved=!0,null!==o){if(this.stallReported){var I=self.performance.now()-o;u.logger.warn("playback not stuck anymore @"+d+", after "+Math.round(I)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},t._tryFixBufferStall=function(e,t){var i=this.config,a=this.fragmentTracker,s=this.media;if(null!==s){var o=s.currentTime,l=a.getPartialFragment(o);if(l&&(this._trySkipBufferHole(l)||!this.media))return;e.len>i.maxBufferHole&&t>1e3*i.highBufferWatchdogPeriod&&(u.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},t._reportStall=function(e){var t=this.hls,i=this.media;!this.stallReported&&i&&(this.stallReported=!0,u.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(e)+")"),t.trigger(o.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e.len}))},t._trySkipBufferHole=function(e){var t=this.config,i=this.hls,l=this.media;if(null===l)return 0;for(var c=l.currentTime,h=0,p=a.BufferHelper.getBuffered(l),v=0;v<p.length;v++){var g=p.start(v);if(c+t.maxBufferHole>=h&&c<g){var m=Math.max(g+f,l.currentTime+d);return u.logger.warn("skipping hole, adjusting currentTime from "+c+" to "+m),this.moved=!0,this.stalled=null,l.currentTime=m,e&&i.trigger(o.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+c+" to "+m,frag:e}),m}h=p.end(v)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,i=this.media,a=this.nudgeRetry;if(null!==i){var l=i.currentTime;if(this.nudgeRetry++,a<e.nudgeMaxRetry){var c=l+(a+1)*e.nudgeOffset;u.logger.warn("Nudging 'currentTime' from "+l+" to "+c),i.currentTime=c,t.trigger(o.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else u.logger.error("Playhead still not moving while enough data buffered @"+l+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(o.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},e}()},"./src/controller/id3-track-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var a=i("./src/polyfills/number.ts"),s=i("./src/events.ts"),o=i("./src/utils/texttrack-utils.ts"),u=i("./src/demux/id3.ts"),l=i("./src/loader/date-range.ts"),c=i("./src/types/demuxer.ts");function d(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var f=function(){var e=d();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function h(e,t){return e.getTime()/1e3-t}var p=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},t._registerListeners=function(){var e=this.hls;e.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(s.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(s.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},t._unregisterListeners=function(){var e=this.hls;e.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(s.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(s.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},t.onMediaAttached=function(e,t){this.media=t.media},t.onMediaDetaching=function(){this.id3Track&&((0,o.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},t.onManifestLoading=function(){this.dateRangeCuesAppended={}},t.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},t.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var i=e[t];if("metadata"===i.kind&&"id3"===i.label)return(0,o.sendAddTrackEvent)(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(e,t){if(this.media){var i=this.hls.config,a=i.enableEmsgMetadataCues,s=i.enableID3MetadataCues;if(a||s){var o=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var l=d(),h=0;h<o.length;h++){var p=o[h].type;if((p!==c.MetadataSchema.emsg||a)&&s){var v=u.getID3Frames(o[h].data);if(v){var g=o[h].pts,m=g+o[h].duration;m>f&&(m=f),m-g<=0&&(m=g+.25);for(var y=0;y<v.length;y++){var E=v[y];if(!u.isTimeStampFrame(E)){this.updateId3CueEnds(g);var _=new l(g,m,"");_.value=E,p&&(_.type=p),this.id3Track.addCue(_)}}}}}}}},t.updateId3CueEnds=function(e){var t,i=null===(t=this.id3Track)||void 0===t?void 0:t.cues;if(i)for(var a=i.length;a--;){var s=i[a];s.startTime<e&&s.endTime===f&&(s.endTime=e)}},t.onBufferFlushing=function(e,t){var i=t.startOffset,a=t.endOffset,s=t.type,u=this.id3Track,l=this.hls;if(l){var d,f=l.config,h=f.enableEmsgMetadataCues,p=f.enableID3MetadataCues;u&&(h||p)&&(d="audio"===s?function(e){return e.type===c.MetadataSchema.audioId3&&p}:"video"===s?function(e){return e.type===c.MetadataSchema.emsg&&h}:function(e){return e.type===c.MetadataSchema.audioId3&&p||e.type===c.MetadataSchema.emsg&&h},(0,o.removeCuesInRange)(u,i,a,d))}},t.onLevelUpdated=function(e,t){var i=this,s=t.details;if(this.media&&s.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var o=this.dateRangeCuesAppended,u=this.id3Track,p=s.dateRanges,v=Object.keys(p);if(u)for(var g=Object.keys(o).filter((function(e){return!v.includes(e)})),m=function(e){var t=g[e];Object.keys(o[t].cues).forEach((function(e){u.removeCue(o[t].cues[e])})),delete o[t]},y=g.length;y--;)m(y);var E=s.fragments[s.fragments.length-1];if(0!==v.length&&(0,a.isFiniteNumber)(null==E?void 0:E.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var _=E.programDateTime/1e3-E.start,T=d(),b=function(e){var t=v[e],a=p[t],s=o[t],u=(null==s?void 0:s.cues)||{},d=(null==s?void 0:s.durationKnown)||!1,g=h(a.startDate,_),m=f,y=a.endDate;if(y)m=h(y,_),d=!0;else if(a.endOnNext&&!d){var E=v.reduce((function(e,t){var i=p[t];return i.class===a.class&&i.id!==t&&i.startDate>a.startDate&&e.push(i),e}),[]).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()}))[0];E&&(m=h(E.startDate,_),d=!0)}for(var b,S=Object.keys(a.attr),R=0;R<S.length;R++){var A=S[R];if(A!==l.DateRangeAttribute.ID&&A!==l.DateRangeAttribute.CLASS&&A!==l.DateRangeAttribute.START_DATE&&A!==l.DateRangeAttribute.DURATION&&A!==l.DateRangeAttribute.END_DATE&&A!==l.DateRangeAttribute.END_ON_NEXT){var w=u[A];if(w)d&&!s.durationKnown&&(w.endTime=m);else{var I=a.attr[A];w=new T(g,m,""),A!==l.DateRangeAttribute.SCTE35_OUT&&A!==l.DateRangeAttribute.SCTE35_IN||(b=I,I=Uint8Array.from(b.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),w.value={key:A,data:I},w.type=c.MetadataSchema.dateRange,i.id3Track.addCue(w),u[A]=w}}}o[t]={cues:u,dateRange:a,durationKnown:d}},S=0;S<v.length;S++)b(S)}}},e}();const v=p},"./src/controller/latency-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var a=i("./src/errors.ts"),s=i("./src/events.ts");function o(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}var u=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t,i,u,l=e.prototype;return l.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},l.registerListeners=function(){this.hls.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(s.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(s.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){this.hls.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(s.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(s.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(s.Events.ERROR,this.onError)},l.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},l.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},l.onManifestLoading=function(){this.levelDetails=null,this._latency=null},l.onLevelUpdated=function(e,t){var i=t.details;this.levelDetails=i,i.advanced&&this.timeupdate(),!i.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},l.onError=function(e,t){t.details,a.ErrorDetails.BUFFER_STALLED_ERROR},l.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var i=this.computeLatency();if(null!==i){this._latency=i;var a=this.config,s=a.lowLatencyMode,o=a.maxLiveSyncPlaybackRate;if(s&&1!==o){var u=this.targetLatency;if(null!==u){var l=i-u,c=l<Math.min(this.maxLatency,u+t.targetduration);if(t.live&&c&&l>.05&&this.forwardBufferLength>1){var d=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20;e.playbackRate=Math.min(d,Math.max(1,f))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}},l.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},l.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},t=e,(i=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,i=e.partHoldBack,a=e.targetduration,s=this.config,o=s.liveSyncDuration,u=s.liveSyncDurationCount,l=s.lowLatencyMode,c=this.hls.userConfig,d=l&&i||t;return(c.liveSyncDuration||c.liveSyncDurationCount||0===d)&&(d=void 0!==o?o:u*a),d}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(null===e||null===t||null===i)return null;var a=i.edge,s=e-t-this.edgeStalled,o=a-i.totalduration,u=a-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,s),u)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}}])&&o(t.prototype,i),u&&o(t,u),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./src/controller/level-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>g});var a=i("./src/types/level.ts"),s=i("./src/events.ts"),o=i("./src/errors.ts"),u=i("./src/utils/codecs.ts"),l=i("./src/controller/level-helper.ts"),c=i("./src/controller/base-playlist-controller.ts"),d=i("./src/types/loader.ts");function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},f.apply(this,arguments)}function h(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}var v=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),g=function(e){var t,i;function c(t){var i;return(i=e.call(this,t,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.onParsedComplete=void 0,i._registerListeners(),i}i=e,(t=c).prototype=Object.create(i.prototype),t.prototype.constructor=t,p(t,i);var g,m,y,E=c.prototype;return E._registerListeners=function(){var e=this.hls;e.on(s.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(s.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(s.Events.ERROR,this.onError,this)},E._unregisterListeners=function(){var e=this.hls;e.off(s.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(s.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(s.Events.ERROR,this.onError,this)},E.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},E.startLoad=function(){this._levels.forEach((function(e){e.loadError=0})),e.prototype.startLoad.call(this)},E.onManifestLoaded=function(e,t){var i,c,d=[],f=[],h=[],p={},g=!1,m=!1,y=!1;if(t.levels.forEach((function(e){var t=e.attrs;g=g||!(!e.width||!e.height),m=m||!!e.videoCodec,y=y||!!e.audioCodec,v&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0);var i=e.bitrate+"-"+e.attrs.RESOLUTION+"-"+e.attrs.CODECS;(c=p[i])?c.url.push(e.url):(c=new a.Level(e),p[i]=c,d.push(c)),t&&(t.AUDIO&&(0,l.addGroupId)(c,"audio",t.AUDIO),t.SUBTITLES&&(0,l.addGroupId)(c,"text",t.SUBTITLES))})),(g||m)&&y&&(d=d.filter((function(e){var t=e.videoCodec,i=e.width,a=e.height;return!!t||!(!i||!a)}))),d=d.filter((function(e){var t=e.audioCodec,i=e.videoCodec;return(!t||(0,u.isCodecSupportedInMp4)(t,"audio"))&&(!i||(0,u.isCodecSupportedInMp4)(i,"video"))})),t.audioTracks&&(f=t.audioTracks.filter((function(e){return!e.audioCodec||(0,u.isCodecSupportedInMp4)(e.audioCodec,"audio")})),(0,l.assignTrackIdsByGroup)(f)),t.subtitles&&(h=t.subtitles,(0,l.assignTrackIdsByGroup)(h)),d.length>0){i=d[0].bitrate,d.sort((function(e,t){return e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):g&&e.height!==t.height?e.height-t.height:0})),this._levels=d;for(var E=0;E<d.length;E++)if(d[E].bitrate===i){this._firstLevel=E,this.log("manifest loaded, "+d.length+" level(s) found, first bitrate: "+i);break}var _=y&&!m,T={levels:d,audioTracks:f,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:y,video:m,altAudio:!_&&f.some((function(e){return!!e.url}))};this.hls.trigger(s.Events.MANIFEST_PARSED,T),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(s.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},E.onError=function(t,i){var s,u;if(e.prototype.onError.call(this,t,i),!i.fatal){var l=i.context,c=this._levels[this.currentLevelIndex];if(l&&(l.type===d.PlaylistContextType.AUDIO_TRACK&&c.audioGroupIds&&l.groupId===c.audioGroupIds[c.urlId]||l.type===d.PlaylistContextType.SUBTITLE_TRACK&&c.textGroupIds&&l.groupId===c.textGroupIds[c.urlId]))this.redundantFailover(this.currentLevelIndex);else{var f,h=!1,p=!0;switch(i.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:if(i.frag){var v=i.frag.type===d.PlaylistLevelType.MAIN?i.frag.level:this.currentLevelIndex,g=this._levels[v];g?(g.fragmentError++,g.fragmentError>this.hls.config.fragLoadingMaxRetry&&(f=v)):f=v}break;case o.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var m=c.attrs["HDCP-LEVEL"];m&&(this.hls.maxHdcpLevel=a.HdcpLevels[a.HdcpLevels.indexOf(m)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'));case o.ErrorDetails.FRAG_PARSING_ERROR:case o.ErrorDetails.KEY_SYSTEM_NO_SESSION:f=(null===(s=i.frag)||void 0===s?void 0:s.type)===d.PlaylistLevelType.MAIN?i.frag.level:this.currentLevelIndex,i.levelRetry=!1;break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:l&&(l.deliveryDirectives&&(p=!1),f=l.level),h=!0;break;case o.ErrorDetails.REMUX_ALLOC_ERROR:f=null!=(u=i.level)?u:this.currentLevelIndex,h=!0}void 0!==f&&this.recoverLevel(i,f,h,p)}}},E.recoverLevel=function(e,t,i,a){var s=e.details,o=this._levels[t];if(o.loadError++,i){if(!this.retryLoadingOrFail(e))return void(this.currentLevelIndex=-1);e.levelRetry=!0}if(a){var u=o.url.length;if(u>1&&o.loadError<u)e.levelRetry=!0,this.redundantFailover(t);else if(-1===this.manualLevelIndex){for(var l=-1,c=this._levels,d=c.length;d--;){var f=(d+this.currentLevelIndex)%c.length;if(f!==this.currentLevelIndex&&0===c[f].loadError){l=f;break}}l>-1&&this.currentLevelIndex!==l?(this.warn(s+": switch to "+l),e.levelRetry=!0,this.hls.nextAutoLevel=l):!1===e.levelRetry&&(e.fatal=!0)}}},E.redundantFailover=function(e){var t=this._levels[e],i=t.url.length;if(i>1){var a=(t.urlId+1)%i;this.warn("Switching to redundant URL-id "+a),this._levels.forEach((function(e){e.urlId=a})),this.level=e}},E.onFragLoaded=function(e,t){var i=t.frag;if(void 0!==i&&i.type===d.PlaylistLevelType.MAIN){var a=this._levels[i.level];void 0!==a&&(a.fragmentError=0,a.loadError=0)}},E.onLevelLoaded=function(e,t){var i,a,s=t.level,o=t.details,u=this._levels[s];if(!u)return this.warn("Invalid level index "+s),void(null!==(a=t.deliveryDirectives)&&void 0!==a&&a.skip&&(o.deltaUpdateFailed=!0));s===this.currentLevelIndex?(0===u.fragmentError&&(u.loadError=0,this.retryCount=0),this.playlistLoaded(s,t,u.details)):null!==(i=t.deliveryDirectives)&&void 0!==i&&i.skip&&(o.deltaUpdateFailed=!0)},E.onAudioTrackSwitched=function(e,t){var i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){for(var a=-1,s=this.hls.audioTracks[t.id].groupId,o=0;o<i.audioGroupIds.length;o++)if(i.audioGroupIds[o]===s){a=o;break}a!==i.urlId&&(i.urlId=a,this.startLoad())}},E.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var i=this.currentLevelIndex,a=this._levels[i];if(this.canLoad&&a&&a.url.length>0){var o=a.urlId,u=a.url[o];if(t)try{u=t.addDirectives(u)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Attempt loading level index "+i+(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+o+" "+u),this.clearTimer(),this.hls.trigger(s.Events.LEVEL_LOADING,{url:u,level:i,id:o,deliveryDirectives:t||null})}},E.removeLevel=function(e,t){var i=function(e,i){return i!==t},a=this._levels.filter((function(a,s){return s!==e||a.url.length>1&&void 0!==t&&(a.url=a.url.filter(i),a.audioGroupIds&&(a.audioGroupIds=a.audioGroupIds.filter(i)),a.textGroupIds&&(a.textGroupIds=a.textGroupIds.filter(i)),a.urlId=0,!0)})).map((function(e,t){var i=e.details;return null!=i&&i.fragments&&i.fragments.forEach((function(e){e.level=t})),e}));this._levels=a,this.hls.trigger(s.Events.LEVELS_UPDATED,{levels:a})},g=c,(m=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t,i=this._levels;if(0!==i.length&&(this.currentLevelIndex!==e||null===(t=i[e])||void 0===t||!t.details)){if(e<0||e>=i.length){var a=e<0;if(this.hls.trigger(s.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:a,reason:"invalid level idx"}),a)return;e=Math.min(e,i.length-1)}this.clearTimer();var u=this.currentLevelIndex,l=i[u],c=i[e];this.log("switching to level "+e+" from "+u),this.currentLevelIndex=e;var d=f({},c,{level:e,maxBitrate:c.maxBitrate,uri:c.uri,urlId:c.urlId});delete d._urlId,this.hls.trigger(s.Events.LEVEL_SWITCHING,d);var h=c.details;if(!h||h.live){var p=this.switchParams(c.uri,null==l?void 0:l.details);this.loadPlaylist(p)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&h(g.prototype,m),y&&h(g,y),Object.defineProperty(g,"prototype",{writable:!1}),c}(c.default)},"./src/controller/level-helper.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{addGroupId:()=>l,addSliding:()=>y,adjustSliding:()=>m,assignTrackIdsByGroup:()=>c,computeReloadInterval:()=>E,getFragmentWithSN:()=>_,getPartWith:()=>T,mapFragmentIntersection:()=>g,mapPartIntersection:()=>v,mergeDetails:()=>p,updateFragPTSDTS:()=>h,updatePTS:()=>d});var a=i("./src/polyfills/number.ts"),s=i("./src/utils/logger.ts"),o=i("./src/loader/date-range.ts");function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},u.apply(this,arguments)}function l(e,t,i){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(i);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(i)}}function c(e){var t={};e.forEach((function(e){var i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++}))}function d(e,t,i){f(e[t],e[i])}function f(e,t){var i=t.startPTS;if((0,a.isFiniteNumber)(i)){var s,o=0;t.sn>e.sn?(o=i-e.start,s=e):(o=e.start-i,s=t),s.duration!==o&&(s.duration=o)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function h(e,t,i,o,u,l){o-i<=0&&(s.logger.warn("Fragment should have a positive duration",t),o=i+t.duration,l=u+t.duration);var c=i,d=o,h=t.startPTS,p=t.endPTS;if((0,a.isFiniteNumber)(h)){var v=Math.abs(h-i);(0,a.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(v,t.deltaPTS):t.deltaPTS=v,c=Math.max(i,h),i=Math.min(i,h),u=Math.min(u,t.startDTS),d=Math.min(o,p),o=Math.max(o,p),l=Math.max(l,t.endDTS)}t.duration=o-i;var g=i-t.start;t.start=t.startPTS=i,t.maxStartPTS=c,t.startDTS=u,t.endPTS=o,t.minEndPTS=d,t.endDTS=l;var m,y=t.sn;if(!e||y<e.startSN||y>e.endSN)return 0;var E=y-e.startSN,_=e.fragments;for(_[E]=t,m=E;m>0;m--)f(_[m],_[m-1]);for(m=E;m<_.length-1;m++)f(_[m],_[m+1]);return e.fragmentHint&&f(_[_.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,g}function p(e,t){for(var i=null,l=e.fragments,c=l.length-1;c>=0;c--){var d=l[c].initSegment;if(d){i=d;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var f,p,y,E,_,T=0;if(g(e,t,(function(e,s){e.relurl&&(T=e.cc-s.cc),(0,a.isFiniteNumber)(e.startPTS)&&(0,a.isFiniteNumber)(e.endPTS)&&(s.start=s.startPTS=e.startPTS,s.startDTS=e.startDTS,s.appendedPTS=e.appendedPTS,s.maxStartPTS=e.maxStartPTS,s.endPTS=e.endPTS,s.endDTS=e.endDTS,s.minEndPTS=e.minEndPTS,s.duration=e.endPTS-e.startPTS,s.duration&&(f=s),t.PTSKnown=t.alignedSliding=!0),s.elementaryStreams=e.elementaryStreams,s.loader=e.loader,s.stats=e.stats,s.urlId=e.urlId,e.initSegment&&(s.initSegment=e.initSegment,i=e.initSegment)})),i&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((function(e){var t;e.initSegment&&e.initSegment.relurl!==(null===(t=i)||void 0===t?void 0:t.relurl)||(e.initSegment=i)})),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed){s.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var b=t.skippedSegments;b--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=(p=e.dateRanges,y=t.dateRanges,E=t.recentlyRemovedDateranges,_=u({},p),E&&E.forEach((function(e){delete _[e]})),Object.keys(y).forEach((function(e){var t=new o.DateRange(y[e].attr,_[e]);t.isValid?_[e]=t:s.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(y[e].attr)+'"')})),_));var S=t.fragments;if(T){s.logger.warn("discontinuity sliding from playlist, take drift into account");for(var R=0;R<S.length;R++)S[R].cc+=T}t.skippedSegments&&(t.startCC=t.fragments[0].cc),v(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),f?h(t,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS):m(e,t),S.length&&(t.totalduration=t.edge-S[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var A=t.advancedDateTime;if(t.advanced&&A){var w=t.edge;t.driftStart||(t.driftStartTime=A,t.driftStart=w),t.driftEndTime=A,t.driftEnd=w}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function v(e,t,i){if(e&&t)for(var a=0,s=0,o=e.length;s<=o;s++){var u=e[s],l=t[s+a];u&&l&&u.index===l.index&&u.fragment.sn===l.fragment.sn?i(u,l):a--}}function g(e,t,i){for(var a=t.skippedSegments,s=Math.max(e.startSN,t.startSN)-t.startSN,o=(e.fragmentHint?1:0)+(a?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,u=t.startSN-e.startSN,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=s;d<=o;d++){var f=c[u+d],h=l[d];a&&!h&&d<a&&(h=t.fragments[d]=f),f&&h&&i(f,h)}}function m(e,t){var i=t.startSN+t.skippedSegments-e.startSN,a=e.fragments;i<0||i>=a.length||y(t,a[i].start)}function y(e,t){if(t){for(var i=e.fragments,a=e.skippedSegments;a<i.length;a++)i[a].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function E(e,t){void 0===t&&(t=1/0);var i=1e3*e.targetduration;if(e.updated){var a=e.fragments;if(a.length&&4*i>t){var s=1e3*a[a.length-1].duration;s<i&&(i=s)}}else i/=2;return Math.round(i)}function _(e,t,i){if(!e||!e.details)return null;var a=e.details,s=a.fragments[t-a.startSN];return s||((s=a.fragmentHint)&&s.sn===t?s:t<a.startSN&&i&&i.sn===t?i:null)}function T(e,t,i){if(!e||!e.details)return null;var a=e.details.partList;if(a)for(var s=a.length;s--;){var o=a[s];if(o.index===i&&o.fragment.sn===t)return o}return null}},"./src/controller/stream-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>E});var a=i("./src/polyfills/number.ts"),s=i("./src/controller/base-stream-controller.ts"),o=i("./src/is-supported.ts"),u=i("./src/events.ts"),l=i("./src/utils/buffer-helper.ts"),c=i("./src/controller/fragment-tracker.ts"),d=i("./src/types/loader.ts"),f=i("./src/loader/fragment.ts"),h=i("./src/demux/transmuxer-interface.ts"),p=i("./src/types/transmuxer.ts"),v=i("./src/controller/gap-controller.ts"),g=i("./src/errors.ts");function m(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}var E=function(e){var t,i;function E(t,i,a){var s;return(s=e.call(this,t,i,a,"[stream-controller]")||this).audioCodecSwap=!1,s.gapController=null,s.level=-1,s._forceStartLoad=!1,s.altAudio=!1,s.audioOnly=!1,s.fragPlaying=null,s.onvplaying=null,s.onvseeked=null,s.fragLastKbps=0,s.couldBacktrack=!1,s.backtrackFragment=null,s.audioCodecSwitch=!1,s.videoBuffer=null,s._registerListeners(),s}i=e,(t=E).prototype=Object.create(i.prototype),t.prototype.constructor=t,y(t,i);var _,T,b,S=E.prototype;return S._registerListeners=function(){var e=this.hls;e.on(u.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(u.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(u.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(u.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(u.Events.ERROR,this.onError,this),e.on(u.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(u.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(u.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(u.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(u.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(u.Events.FRAG_BUFFERED,this.onFragBuffered,this)},S._unregisterListeners=function(){var e=this.hls;e.off(u.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(u.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(u.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(u.Events.ERROR,this.onError,this),e.off(u.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(u.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(u.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(u.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(u.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(u.Events.FRAG_BUFFERED,this.onFragBuffered,this)},S.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},S.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var a=i.startLevel;-1===a&&(i.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=i.nextAutoLevel),this.level=i.nextLoadLevel=a,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=s.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=s.State.STOPPED},S.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},S.doTick=function(){switch(this.state){case s.State.IDLE:this.doTickIdle();break;case s.State.WAITING_LEVEL:var e,t=this.levels,i=this.level,a=null==t||null===(e=t[i])||void 0===e?void 0:e.details;if(a&&(!a.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(a))break;this.state=s.State.IDLE;break}break;case s.State.FRAG_LOADING_WAITING_RETRY:var o,u=self.performance.now(),l=this.retryDate;(!l||u>=l||null!==(o=this.media)&&void 0!==o&&o.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=s.State.IDLE)}this.onTickEnd()},S.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},S.doTickIdle=function(){var e=this.hls,t=this.levelLastLoaded,i=this.levels,a=this.media,o=e.config,l=e.nextLoadLevel;if(null!==t&&(a||!this.startFragRequested&&o.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&i&&i[l]){var h=i[l],p=this.getMainFwdBufferInfo();if(null!==p){var v=this.getLevelDetails();if(v&&this._streamEnded(p,v)){var g={};return this.altAudio&&(g.type="video"),this.hls.trigger(u.Events.BUFFER_EOS,g),void(this.state=s.State.ENDED)}this.level=e.nextLoadLevel=l;var m=h.details;if(!m||this.state===s.State.WAITING_LEVEL||m.live&&this.levelLastLoaded!==l)return this.level=l,void(this.state=s.State.WAITING_LEVEL);if(!(p.len>=this.getMaxBufferLength(h.maxBitrate))){this.backtrackFragment&&this.backtrackFragment.start>p.end&&(this.backtrackFragment=null);var y=this.backtrackFragment?this.backtrackFragment.start:p.end,E=this.getNextFragment(y,m);if(this.couldBacktrack&&!this.fragPrevious&&E&&"initSegment"!==E.sn&&this.fragmentTracker.getState(E)!==c.FragmentState.OK){var _,T=(null!=(_=this.backtrackFragment)?_:E).sn-m.startSN,b=m.fragments[T-1];b&&E.cc===b.cc&&(E=b,this.fragmentTracker.removeFragment(b))}else this.backtrackFragment&&p.len&&(this.backtrackFragment=null);if(E&&this.fragmentTracker.getState(E)===c.FragmentState.OK&&this.nextLoadPosition>y){var S=this.audioOnly&&!this.altAudio?f.ElementaryStreamTypes.AUDIO:f.ElementaryStreamTypes.VIDEO,R=(S===f.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,S,d.PlaylistLevelType.MAIN),E=this.getNextFragment(this.nextLoadPosition,m)}E&&(!E.initSegment||E.initSegment.data||this.bitrateTest||(E=E.initSegment),this.loadFragment(E,m,y))}}}},S.loadFragment=function(t,i,a){var s,o=this.fragmentTracker.getState(t);this.fragCurrent=t,o===c.FragmentState.NOT_LOADED?"initSegment"===t.sn?this._loadInitSegment(t,i):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,i)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,i,a)):o===c.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null===(s=this.media)||void 0===s?void 0:s.buffered.length)&&this.fragmentTracker.removeAllFragments()},S.getAppendedFrag=function(e){var t=this.fragmentTracker.getAppendedFrag(e,d.PlaylistLevelType.MAIN);return t&&"fragment"in t?t.fragment:t},S.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,d.PlaylistLevelType.MAIN)},S.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},S.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},S.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var i,a=this.getAppendedFrag(t.currentTime);if(a&&a.start>1&&this.flushMainBuffer(0,a.start-1),!t.paused&&e){var s=e[this.hls.nextLoadLevel],o=this.fragLastKbps;i=o&&this.fragCurrent?this.fragCurrent.duration*s.maxBitrate/(1e3*o)+1:0}else i=0;var u=this.getBufferedFrag(t.currentTime+i);if(u){var l=this.followingBufferedFrag(u);if(l){this.abortCurrentFrag();var c=l.maxStartPTS?l.maxStartPTS:l.start,d=l.duration,f=Math.max(u.end,c+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,.5*d),.75*d));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}},S.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&e.abortRequests(),this.state){case s.State.KEY_LOADING:case s.State.FRAG_LOADING:case s.State.FRAG_LOADING_WAITING_RETRY:case s.State.PARSING:case s.State.PARSED:this.state=s.State.IDLE}this.nextLoadPosition=this.getLoadPosition()},S.flushMainBuffer=function(t,i){e.prototype.flushMainBuffer.call(this,t,i,this.altAudio?"video":null)},S.onMediaAttached=function(t,i){e.prototype.onMediaAttached.call(this,t,i);var a=i.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),a.addEventListener("playing",this.onvplaying),a.addEventListener("seeked",this.onvseeked),this.gapController=new v.default(this.config,a,this.fragmentTracker,this.hls)},S.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},S.onMediaPlaying=function(){this.tick()},S.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:null;(0,a.isFiniteNumber)(t)&&this.log("Media seeked to "+t.toFixed(3)),this.tick()},S.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(u.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},S.onManifestParsed=function(e,t){var i,a=!1,s=!1;t.levels.forEach((function(e){(i=e.audioCodec)&&(-1!==i.indexOf("mp4a.40.2")&&(a=!0),-1!==i.indexOf("mp4a.40.5")&&(s=!0))})),this.audioCodecSwitch=a&&s&&!(0,o.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},S.onLevelLoading=function(e,t){var i=this.levels;if(i&&this.state===s.State.IDLE){var a=i[t.level];(!a.details||a.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(a.details))&&(this.state=s.State.WAITING_LEVEL)}},S.onLevelLoaded=function(e,t){var i,a=this.levels,o=t.level,l=t.details,c=l.totalduration;if(a){this.log("Level "+o+" loaded ["+l.startSN+","+l.endSN+"], cc ["+l.startCC+", "+l.endCC+"] duration:"+c);var d=this.fragCurrent;!d||this.state!==s.State.FRAG_LOADING&&this.state!==s.State.FRAG_LOADING_WAITING_RETRY||d.level!==t.level&&d.loader&&(this.state=s.State.IDLE,this.backtrackFragment=null,d.abortRequests());var f=a[o],h=0;if(l.live||null!==(i=f.details)&&void 0!==i&&i.live){if(l.fragments[0]||(l.deltaUpdateFailed=!0),l.deltaUpdateFailed)return;h=this.alignPlaylists(l,f.details)}if(f.details=l,this.levelLastLoaded=o,this.hls.trigger(u.Events.LEVEL_UPDATED,{details:l,level:o}),this.state===s.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(l))return;this.state=s.State.IDLE}this.startFragRequested?l.live&&this.synchronizeToLiveEdge(l):this.setStartPosition(l,h),this.tick()}else this.warn("Levels were reset while loading level "+o)},S._handleFragmentLoadProgress=function(e){var t,i=e.frag,a=e.part,s=e.payload,o=this.levels;if(o){var u=o[i.level],l=u.details;if(l){var c=u.videoCodec,f=l.PTSKnown||!l.live,v=null===(t=i.initSegment)||void 0===t?void 0:t.data,g=this._getAudioCodec(u),m=this.transmuxer=this.transmuxer||new h.default(this.hls,d.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=a?a.index:-1,E=-1!==y,_=new p.ChunkMetadata(i.level,i.sn,i.stats.chunkCount,s.byteLength,y,E),T=this.initPTS[i.cc];m.push(s,v,g,c,i,a,l.totalduration,f,_,T)}else this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},S.onAudioTrackSwitching=function(e,t){var i=this.altAudio,a=!!t.url,s=t.id;if(!a){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var l=this.hls;i&&l.trigger(u.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),l.trigger(u.Events.AUDIO_TRACK_SWITCHED,{id:s})}},S.onAudioTrackSwitched=function(e,t){var i=t.id,a=!!this.hls.audioTracks[i].url;if(a){var s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=a,this.tick()},S.onBufferCreated=function(e,t){var i,a,s=t.tracks,o=!1;for(var u in s){var l=s[u];if("main"===l.id){if(a=u,i=l,"video"===u){var c=s[u];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&i?(this.log("Alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},S.onFragBuffered=function(e,t){var i=t.frag,a=t.part;if(!i||i.type===d.PlaylistLevelType.MAIN){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(a?" p: "+a.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===s.State.PARSED&&(this.state=s.State.IDLE));var o=a?a.stats:i.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),"initSegment"!==i.sn&&(this.fragPrevious=i),this.fragBufferedComplete(i,a)}},S.onError=function(e,t){if(t.type!==g.ErrorTypes.KEY_SYSTEM_ERROR)switch(t.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.FRAG_PARSING_ERROR:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.MAIN,t);break;case g.ErrorDetails.LEVEL_LOAD_ERROR:case g.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==s.State.ERROR&&(t.fatal?(this.warn(""+t.details),this.state=s.State.ERROR):t.levelRetry||this.state!==s.State.WAITING_LEVEL||(this.state=s.State.IDLE));break;case g.ErrorDetails.BUFFER_FULL_ERROR:if("main"===t.parent&&(this.state===s.State.PARSING||this.state===s.State.PARSED)){var i=!0,a=this.getFwdBufferInfo(this.media,d.PlaylistLevelType.MAIN);a&&a.len>.5&&(i=!this.reduceMaxBufferLength(a.len)),i&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(d.PlaylistLevelType.MAIN,t)},S.checkBuffer=function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){if(this.loadedmetadata||!l.BufferHelper.getBuffered(e).length){var i=this.state!==s.State.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,i)}this.lastCurrentTime=e.currentTime}},S.onFragLoadEmergencyAborted=function(){this.state=s.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},S.onBufferFlushed=function(e,t){var i=t.type;if(i!==f.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var a=(i===f.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(a,i,d.PlaylistLevelType.MAIN)}},S.onLevelsUpdated=function(e,t){this.levels=t.levels},S.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},S.seekToStartPos=function(){var e=this.media;if(e){var t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking)return void this.log("could not seek to "+i+", already seeking at "+t);var a=l.BufferHelper.getBuffered(e),s=(a.length?a.start(0):0)-i;s>0&&(s<this.config.maxBufferHole||s<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+s+" to match buffer start"),i+=s,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+t),e.currentTime=i}}},S._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},S._loadBitrateTestFrag=function(e,t){var i=this;e.bitrateTest=!0,this._doFragLoad(e,t).then((function(t){var a=i.hls;if(t&&!i.fragContextChanged(e)){i.fragLoadError=0,i.state=s.State.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var o=e.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),a.trigger(u.Events.FRAG_LOADED,t),e.bitrateTest=!1}}))},S._handleTransmuxComplete=function(e){var t,i="main",o=this.hls,l=e.remuxResult,c=e.chunkMeta,d=this.getCurrentContext(c);if(!d)return this.warn("The loading context changed while buffering fragment "+c.sn+" of level "+c.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(c.level);var h=d.frag,p=d.part,v=d.level,g=l.video,m=l.text,y=l.id3,E=l.initSegment,_=v.details,T=this.altAudio?void 0:l.audio;if(!this.fragContextChanged(h)){if(this.state=s.State.PARSING,E){E.tracks&&(this._bufferInitSegment(v,E.tracks,h,c),o.trigger(u.Events.FRAG_PARSING_INIT_SEGMENT,{frag:h,id:i,tracks:E.tracks}));var b=E.initPTS,S=E.timescale;(0,a.isFiniteNumber)(b)&&(this.initPTS[h.cc]=b,o.trigger(u.Events.INIT_PTS_FOUND,{frag:h,id:i,initPTS:b,timescale:S}))}if(g&&!1!==l.independent){if(_){var R=g.startPTS,A=g.endPTS,w=g.startDTS,I=g.endDTS;if(p)p.elementaryStreams[g.type]={startPTS:R,endPTS:A,startDTS:w,endDTS:I};else if(g.firstKeyFrame&&g.independent&&1===c.id&&(this.couldBacktrack=!0),g.dropped&&g.independent){var D=this.getMainFwdBufferInfo();if((D?D.end:this.getLoadPosition())+this.config.maxBufferHole<(g.firstKeyFramePTS?g.firstKeyFramePTS:R)-this.config.maxBufferHole)return void this.backtrack(h);h.setElementaryStreamInfo(g.type,h.start,A,h.start,I,!0)}h.setElementaryStreamInfo(g.type,R,A,w,I),this.backtrackFragment&&(this.backtrackFragment=h),this.bufferFragmentData(g,h,p,c)}}else if(!1===l.independent)return void this.backtrack(h);if(T){var L=T.startPTS,k=T.endPTS,C=T.startDTS,O=T.endDTS;p&&(p.elementaryStreams[f.ElementaryStreamTypes.AUDIO]={startPTS:L,endPTS:k,startDTS:C,endDTS:O}),h.setElementaryStreamInfo(f.ElementaryStreamTypes.AUDIO,L,k,C,O),this.bufferFragmentData(T,h,p,c)}if(_&&null!=y&&null!==(t=y.samples)&&void 0!==t&&t.length){var P={id:i,frag:h,details:_,samples:y.samples};o.trigger(u.Events.FRAG_PARSING_METADATA,P)}if(_&&m){var x={id:i,frag:h,details:_,samples:m.samples};o.trigger(u.Events.FRAG_PARSING_USERDATA,x)}}},S._bufferInitSegment=function(e,t,i,a){var o=this;if(this.state===s.State.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var l=t.audio,c=t.video,d=t.audiovideo;if(l){var f=e.audioCodec,h=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(f&&(f=-1!==f.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==l.metadata.channelCount&&-1===h.indexOf("firefox")&&(f="mp4a.40.5")),-1!==h.indexOf("android")&&"audio/mpeg"!==l.container&&(f="mp4a.40.2",this.log("Android: force audio codec to "+f)),e.audioCodec&&e.audioCodec!==f&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+f+'"'),l.levelCodec=f,l.id="main",this.log("Init audio buffer, container:"+l.container+", codecs[selected/level/parsed]=["+(f||"")+"/"+(e.audioCodec||"")+"/"+l.codec+"]")}c&&(c.levelCodec=e.videoCodec,c.id="main",this.log("Init video buffer, container:"+c.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+c.codec+"]")),d&&this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+(e.attrs.CODECS||"")+"/"+d.codec+"]"),this.hls.trigger(u.Events.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var s=t[e].initSegment;null!=s&&s.byteLength&&o.hls.trigger(u.Events.BUFFER_APPENDING,{type:e,data:s,frag:i,part:null,chunkMeta:a,parent:i.type})})),this.tick()}},S.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,d.PlaylistLevelType.MAIN)},S.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=s.State.IDLE},S.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var i=e.currentTime;if(l.BufferHelper.isBuffered(e,i)?t=this.getAppendedFrag(i):l.BufferHelper.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;var a=this.fragPlaying,s=t.level;a&&t.sn===a.sn&&a.level===s&&t.urlId===a.urlId||(this.fragPlaying=t,this.hls.trigger(u.Events.FRAG_CHANGED,{frag:t}),a&&a.level===s||this.hls.trigger(u.Events.LEVEL_SWITCHED,{level:s}))}}},_=E,(T=[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var e=this.media;if(e){var t=e.currentTime,i=this.currentFrag;if(i&&(0,a.isFiniteNumber)(t)&&(0,a.isFiniteNumber)(i.programDateTime)){var s=i.programDateTime+1e3*(t-i.start);return new Date(s)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&m(_.prototype,T),b&&m(_,b),Object.defineProperty(_,"prototype",{writable:!1}),E}(s.default)},"./src/controller/subtitle-stream-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{SubtitleStreamController:()=>g});var a=i("./src/events.ts"),s=i("./src/utils/buffer-helper.ts"),o=i("./src/controller/fragment-finders.ts"),u=i("./src/utils/discontinuities.ts"),l=i("./src/controller/level-helper.ts"),c=i("./src/controller/fragment-tracker.ts"),d=i("./src/controller/base-stream-controller.ts"),f=i("./src/types/loader.ts"),h=i("./src/types/level.ts");function p(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}function v(e,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},v(e,t)}var g=function(e){var t,i;function g(t,i,a){var s;return(s=e.call(this,t,i,a,"[subtitle-stream-controller]")||this).levels=[],s.currentTrackId=-1,s.tracksBuffered=[],s.mainDetails=null,s._registerListeners(),s}i=e,(t=g).prototype=Object.create(i.prototype),t.prototype.constructor=t,v(t,i);var y,E,_,T=g.prototype;return T.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},T._registerListeners=function(){var e=this.hls;e.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(a.Events.ERROR,this.onError,this),e.on(a.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(a.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(a.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T._unregisterListeners=function(){var e=this.hls;e.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(a.Events.ERROR,this.onError,this),e.off(a.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(a.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(a.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T.startLoad=function(e){this.stopLoad(),this.state=d.State.IDLE,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},T.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},T.onLevelLoaded=function(e,t){this.mainDetails=t.details},T.onSubtitleFragProcessed=function(e,t){var i=t.frag,a=t.success;if(this.fragPrevious=i,this.state=d.State.IDLE,a){var s=this.tracksBuffered[this.currentTrackId];if(s){for(var o,u=i.start,l=0;l<s.length;l++)if(u>=s[l].start&&u<=s[l].end){o=s[l];break}var c=i.start+i.duration;o?o.end=c:(o={start:u,end:c},s.push(o)),this.fragmentTracker.fragBuffered(i)}}},T.onBufferFlushing=function(e,t){var i=t.startOffset,a=t.endOffset;if(0===i&&a!==Number.POSITIVE_INFINITY){var s=this.currentTrackId,o=this.levels;if(!o.length||!o[s]||!o[s].details)return;var u=a-o[s].details.targetduration;if(u<=0)return;t.endOffsetSubtitles=Math.max(0,u),this.tracksBuffered.forEach((function(e){for(var t=0;t<e.length;)if(e[t].end<=u)e.shift();else{if(!(e[t].start<u))break;e[t].start=u,t++}})),this.fragmentTracker.removeFragmentsInRange(i,u,f.PlaylistLevelType.SUBTITLE)}},T.onFragBuffered=function(e,t){var i;this.loadedmetadata||t.frag.type!==f.PlaylistLevelType.MAIN||null!==(i=this.media)&&void 0!==i&&i.buffered.length&&(this.loadedmetadata=!0)},T.onError=function(e,t){var i=t.frag;i&&i.type===f.PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=d.State.IDLE)},T.onSubtitleTracksUpdated=function(e,t){var i=this,a=t.subtitleTracks;this.tracksBuffered=[],this.levels=a.map((function(e){return new h.Level(e)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(e){i.tracksBuffered[e.id]=[]})),this.mediaBuffer=null},T.onSubtitleTrackSwitch=function(e,t){if(this.currentTrackId=t.id,this.levels.length&&-1!==this.currentTrackId){var i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}else this.clearInterval()},T.onSubtitleTrackLoaded=function(e,t){var i,a=t.details,s=t.id,c=this.currentTrackId,f=this.levels;if(f.length){var h=f[c];if(!(s>=f.length||s!==c)&&h){this.mediaBuffer=this.mediaBufferTimeRanges;var p=0;if(a.live||null!==(i=h.details)&&void 0!==i&&i.live){var v=this.mainDetails;if(a.deltaUpdateFailed||!v)return;var g=v.fragments[0];h.details?0===(p=this.alignPlaylists(a,h.details))&&g&&(p=g.start,(0,l.addSliding)(a,p)):a.hasProgramDateTime&&v.hasProgramDateTime?((0,u.alignMediaPlaylistByPDT)(a,v),p=a.fragments[0].start):g&&(p=g.start,(0,l.addSliding)(a,p))}h.details=a,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(h.details,p),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===d.State.IDLE&&((0,o.findFragmentByPTS)(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0))}}},T._handleFragmentLoadComplete=function(e){var t=this,i=e.frag,s=e.payload,o=i.decryptdata,u=this.hls;if(!this.fragContextChanged(i)&&s&&s.byteLength>0&&o&&o.key&&o.iv&&"AES-128"===o.method){var l=performance.now();this.decrypter.decrypt(new Uint8Array(s),o.key.buffer,o.iv.buffer).then((function(e){var t=performance.now();u.trigger(a.Events.FRAG_DECRYPTED,{frag:i,payload:e,stats:{tstart:l,tdecrypt:t}})})).catch((function(e){t.warn(e.name+": "+e.message),t.state=d.State.IDLE}))}},T.doTick=function(){if(this.media){if(this.state===d.State.IDLE){var e=this.currentTrackId,t=this.levels;if(!t.length||!t[e]||!t[e].details)return;var i=t[e].details,a=i.targetduration,u=this.config,l=this.getLoadPosition(),h=s.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l-a,u.maxBufferHole),p=h.end,v=h.len,g=this.getFwdBufferInfo(this.media,f.PlaylistLevelType.MAIN);if(v>this.getMaxBufferLength(null==g?void 0:g.len)+a)return;console.assert(i,"Subtitle track details are defined on idle subtitle stream controller tick");var m=i.fragments,y=m.length,E=i.edge,_=null,T=this.fragPrevious;if(p<E){var b=u.maxFragLookUpTolerance;!(_=(0,o.findFragmentByPTS)(T,m,Math.max(m[0].start,p),b))&&T&&T.start<m[0].start&&(_=m[0])}else _=m[y-1];if(!_)return;_=this.mapToInitFragWhenRequired(_),this.fragmentTracker.getState(_)===c.FragmentState.NOT_LOADED&&this.loadFragment(_,i,p)}}else this.state=d.State.IDLE},T.getMaxBufferLength=function(t){var i=e.prototype.getMaxBufferLength.call(this);return t?Math.max(i,t):i},T.loadFragment=function(t,i,a){this.fragCurrent=t,"initSegment"===t.sn?this._loadInitSegment(t,i):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,i,a))},y=g,(E=[{key:"mediaBufferTimeRanges",get:function(){return new m(this.tracksBuffered[this.currentTrackId]||[])}}])&&p(y.prototype,E),_&&p(y,_),Object.defineProperty(y,"prototype",{writable:!1}),g}(d.default),m=function(e){this.buffered=void 0;var t=function(t,i,a){if((i>>>=0)>a-1)throw new DOMException("Failed to execute '"+t+"' on 'TimeRanges': The index provided ("+i+") is greater than the maximum bound ("+a+")");return e[i][t]};this.buffered={get length(){return e.length},end:function(i){return t("end",i,e.length)},start:function(i){return t("start",i,e.length)}}}},"./src/controller/subtitle-track-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var a=i("./src/events.ts"),s=i("./src/utils/texttrack-utils.ts"),o=i("./src/controller/base-playlist-controller.ts"),u=i("./src/types/loader.ts");function l(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}var d=function(e){var t,i;function o(t){var i;return(i=e.call(this,t,"[subtitle-track-controller]")||this).media=null,i.tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.selectDefaultTrack=!0,i.queuedDefaultTrack=-1,i.trackChangeListener=function(){return i.onTextTracksChanged()},i.asyncPollTrackChange=function(){return i.pollTrackChange(0)},i.useTextTrackPolling=!1,i.subtitlePollingInterval=-1,i._subtitleDisplay=!0,i.registerListeners(),i}i=e,(t=o).prototype=Object.create(i.prototype),t.prototype.constructor=t,c(t,i);var d,h,p,v=o.prototype;return v.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,e.prototype.destroy.call(this)},v.registerListeners=function(){var e=this.hls;e.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(a.Events.ERROR,this.onError,this)},v.unregisterListeners=function(){var e=this.hls;e.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(a.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(a.Events.ERROR,this.onError,this)},v.onMediaAttached=function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},v.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},v.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),f(this.media.textTracks).forEach((function(e){(0,s.clearCurrentCues)(e)})),this.subtitleTrack=-1,this.media=null)},v.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},v.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},v.onSubtitleTrackLoaded=function(e,t){var i=t.id,a=t.details,s=this.trackId,o=this.tracksInGroup[s];if(o){var u=o.details;o.details=t.details,this.log("subtitle track "+i+" loaded ["+a.startSN+"-"+a.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,t,u))}else this.warn("Invalid subtitle track id "+i)},v.onLevelLoading=function(e,t){this.switchLevel(t.level)},v.onLevelSwitching=function(e,t){this.switchLevel(t.level)},v.switchLevel=function(e){var t=this.hls.levels[e];if(null!=t&&t.textGroupIds){var i=t.textGroupIds[t.urlId];if(this.groupId!==i){var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,o=this.tracks.filter((function(e){return!i||e.groupId===i}));this.tracksInGroup=o;var u=this.findTrackId(null==s?void 0:s.name)||this.findTrackId();this.groupId=i;var l={subtitleTracks:o};this.log("Updating subtitle tracks, "+o.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(a.Events.SUBTITLE_TRACKS_UPDATED,l),-1!==u&&this.setSubtitleTrack(u,s)}}},v.findTrackId=function(e){for(var t=this.tracksInGroup,i=0;i<t.length;i++){var a=t[i];if((!this.selectDefaultTrack||a.default)&&(!e||e===a.name))return a.id}return-1},v.onError=function(t,i){e.prototype.onError.call(this,t,i),!i.fatal&&i.context&&i.context.type===u.PlaylistContextType.SUBTITLE_TRACK&&i.context.id===this.trackId&&i.context.groupId===this.groupId&&this.retryLoadingOrFail(i)},v.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var i=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(i)){var s=i.id,o=i.groupId,u=i.url;if(t)try{u=t.addDirectives(u)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Loading subtitle playlist for id "+s),this.hls.trigger(a.Events.SUBTITLE_TRACK_LOADING,{url:u,id:s,groupId:o,deliveryDirectives:t||null})}},v.toggleTrackModes=function(e){var t=this,i=this.media,a=this.trackId;if(i){var s=f(i.textTracks),o=s.filter((function(e){return e.groupId===t.groupId}));if(-1===e)[].slice.call(s).forEach((function(e){e.mode="disabled"}));else{var u=o[a];u&&(u.mode="disabled")}var l=o[e];l&&(l.mode=this.subtitleDisplay?"showing":"hidden")}},v.setSubtitleTrack=function(e,t){var i,s=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(-1===e||null!==(i=s[e])&&void 0!==i&&i.details)||e<-1||e>=s.length)){this.clearTimer();var o=s[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,o){var u=o.id,l=o.groupId,c=void 0===l?"":l,d=o.name,f=o.type,h=o.url;this.hls.trigger(a.Events.SUBTITLE_TRACK_SWITCH,{id:u,groupId:c,name:d,type:f,url:h});var p=this.switchParams(o.url,null==t?void 0:t.details);this.loadPlaylist(p)}else this.hls.trigger(a.Events.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},v.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=f(this.media.textTracks),i=0;i<t.length;i++)if("hidden"===t[i].mode)e=i;else if("showing"===t[i].mode){e=i;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},d=o,(h=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}}])&&l(d.prototype,h),p&&l(d,p),Object.defineProperty(d,"prototype",{writable:!1}),o}(o.default);function f(e){for(var t=[],i=0;i<e.length;i++){var a=e[i];"subtitles"===a.kind&&a.label&&t.push(e[i])}return t}const h=d},"./src/controller/timeline-controller.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{TimelineController:()=>v});var a=i("./src/polyfills/number.ts"),s=i("./src/events.ts"),o=i("./src/utils/cea-608-parser.ts"),u=i("./src/utils/output-filter.ts"),l=i("./src/utils/webvtt-parser.ts"),c=i("./src/utils/texttrack-utils.ts"),d=i("./src/utils/imsc1-ttml-parser.ts"),f=i("./src/utils/mp4-tools.ts"),h=i("./src/types/loader.ts"),p=i("./src/utils/logger.ts"),v=function(){function e(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new u.default(this,"textTrack1"),i=new u.default(this,"textTrack2"),a=new u.default(this,"textTrack3"),l=new u.default(this,"textTrack4");this.cea608Parser1=new o.default(1,t,i),this.cea608Parser2=new o.default(3,a,l)}e.on(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(s.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(s.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(s.Events.FRAG_LOADING,this.onFragLoading,this),e.on(s.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(s.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(s.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(s.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(s.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=e.prototype;return t.destroy=function(){var e=this.hls;e.off(s.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(s.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(s.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(s.Events.FRAG_LOADING,this.onFragLoading,this),e.off(s.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(s.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(s.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(s.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(s.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(s.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(e,t,i,a,o){for(var u,l,c,d,f=!1,h=o.length;h--;){var p=o[h],v=(u=p[0],l=p[1],c=t,d=i,Math.min(l,d)-Math.max(u,c));if(v>=0&&(p[0]=Math.min(p[0],t),p[1]=Math.max(p[1],i),f=!0,v/(i-t)>.5))return}if(f||o.push([t,i]),this.config.renderTextTracksNatively){var g=this.captionsTracks[e];this.Cues.newCue(g,t,i,a)}else{var m=this.Cues.newCue(null,t,i,a);this.hls.trigger(s.Events.CUES_PARSED,{type:"captions",cues:m,track:e})}},t.onInitPtsFound=function(e,t){var i=this,a=t.frag,o=t.id,u=t.initPTS,l=t.timescale,c=this.unparsedVttFrags;"main"===o&&(this.initPTS[a.cc]=u,this.timescale[a.cc]=l),c.length&&(this.unparsedVttFrags=[],c.forEach((function(e){i.onFragLoaded(s.Events.FRAG_LOADED,e)})))},t.getExistingTrack=function(e){var t=this.media;if(t)for(var i=0;i<t.textTracks.length;i++){var a=t.textTracks[i];if(a[e])return a}return null},t.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},t.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,i=this.captionsTracks,a=this.media,s=t[e],o=s.label,u=s.languageCode,l=this.getExistingTrack(e);if(l)i[e]=l,(0,c.clearCurrentCues)(i[e]),(0,c.sendAddTrackEvent)(i[e],a);else{var d=this.createTextTrack("captions",o,u);d&&(d[e]=!0,i[e]=d)}}},t.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var i={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(s.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},t.createTextTrack=function(e,t,i){var a=this.media;if(a)return a.addTextTrack(e,t,i)},t.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},t.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){(0,c.clearCurrentCues)(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var i=0;i<t.length;i++)(0,c.clearCurrentCues)(t[i])}},t.onSubtitleTracksUpdated=function(e,t){var i=this;this.textTracks=[];var a=t.subtitleTracks||[],o=a.some((function(e){return e.textCodec===d.IMSC1_CODEC}));if(this.config.enableWebVTT||o&&this.config.enableIMSC1){var u=this.tracks&&a&&this.tracks.length===a.length;if(this.tracks=a||[],this.config.renderTextTracksNatively){var l=this.media?this.media.textTracks:[];this.tracks.forEach((function(e,t){var a;if(t<l.length){for(var s=null,o=0;o<l.length;o++)if(g(l[o],e)){s=l[o];break}s&&(a=s)}if(a)(0,c.clearCurrentCues)(a);else{var u=i._captionsOrSubtitlesFromCharacteristics(e);(a=i.createTextTrack(u,e.name,e.lang))&&(a.mode="disabled")}a&&(a.groupId=e.groupId,i.textTracks.push(a))}))}else if(!u&&this.tracks&&this.tracks.length){var f=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(s.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:f})}}},t._captionsOrSubtitlesFromCharacteristics=function(e){var t;if(null!==(t=e.attrs)&&void 0!==t&&t.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),a=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(i&&a)return"captions"}return"subtitles"},t.onManifestLoaded=function(e,t){var i=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(t){var a="textTrack"+t[1],s=i.captionsProperties[a];s&&(s.label=e.name,e.lang&&(s.languageCode=e.lang),s.media=e)}}))},t.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]},t.onFragLoading=function(e,t){var i=this.cea608Parser1,a=this.cea608Parser2,s=this.lastSn,o=this.lastPartIndex;if(this.enabled&&i&&a&&t.frag.type===h.PlaylistLevelType.MAIN){var u,l,c=t.frag.sn,d=null!=(u=null==t||null===(l=t.part)||void 0===l?void 0:l.index)?u:-1;c===s+1||c===s&&d===o+1||(i.reset(),a.reset()),this.lastSn=c,this.lastPartIndex=d}},t.onFragLoaded=function(e,t){var i=t.frag,o=t.payload,u=this.initPTS,l=this.unparsedVttFrags;if(i.type===h.PlaylistLevelType.SUBTITLE)if(o.byteLength){if(!(0,a.isFiniteNumber)(u[i.cc]))return l.push(t),void(u.length&&this.hls.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")}));var c=i.decryptdata,f="stats"in t;if(null==c||!c.encrypted||f){var p=this.tracks[i.level],v=this.vttCCs;v[i.cc]||(v[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),p&&p.textCodec===d.IMSC1_CODEC?this._parseIMSC1(i,o):this._parseVTTs(i,o,v)}}else this.hls.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(e,t){var i=this,a=this.hls;(0,d.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],(function(t){i._appendCues(t,e.level),a.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){p.logger.log("Failed to parse IMSC1: "+t),a.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))},t._parseVTTs=function(e,t,i){var a,o=this,u=this.hls,c=null!==(a=e.initSegment)&&void 0!==a&&a.data?(0,f.appendUint8Array)(e.initSegment.data,new Uint8Array(t)):t;(0,l.parseWebVTT)(c,this.initPTS[e.cc],this.timescale[e.cc],i,e.cc,e.start,(function(t){o._appendCues(t,e.level),u.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(i){o._fallbackToIMSC1(e,t),p.logger.log("Failed to parse VTT cue: "+i),u.trigger(s.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})}))},t._fallbackToIMSC1=function(e,t){var i=this,a=this.tracks[e.level];a.textCodec||(0,d.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],(function(){a.textCodec=d.IMSC1_CODEC,i._parseIMSC1(e,t)}),(function(){a.textCodec="wvtt"}))},t._appendCues=function(e,t){var i=this.hls;if(this.config.renderTextTracksNatively){var a=this.textTracks[t];if(!a||"disabled"===a.mode)return;e.forEach((function(e){return(0,c.addCueToTrack)(a,e)}))}else{var o=this.tracks[t];if(!o)return;var u=o.default?"default":"subtitles"+t;i.trigger(s.Events.CUES_PARSED,{type:"subtitles",cues:e,track:u})}},t.onFragDecrypted=function(e,t){var i=t.frag;if(i.type===h.PlaylistLevelType.SUBTITLE){if(!(0,a.isFiniteNumber)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(s.Events.FRAG_LOADED,t)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(e,t){var i=this.cea608Parser1,a=this.cea608Parser2;if(this.enabled&&i&&a){var s=t.frag,o=t.samples;if(s.type!==h.PlaylistLevelType.MAIN||"NONE"!==this.closedCaptionsForLevel(s))for(var u=0;u<o.length;u++){var l=o[u].bytes;if(l){var c=this.extractCea608Data(l);i.addData(o[u].pts,c[0]),a.addData(o[u].pts,c[1])}}}},t.onBufferFlushing=function(e,t){var i=t.startOffset,a=t.endOffset,s=t.endOffsetSubtitles,o=t.type,u=this.media;if(u&&!(u.currentTime<a)){if(!o||"video"===o){var l=this.captionsTracks;Object.keys(l).forEach((function(e){return(0,c.removeCuesInRange)(l[e],i,a)}))}if(this.config.renderTextTracksNatively&&0===i&&void 0!==s){var d=this.textTracks;Object.keys(d).forEach((function(e){return(0,c.removeCuesInRange)(d[e],i,s)}))}}},t.extractCea608Data=function(e){for(var t=[[],[]],i=31&e[0],a=2,s=0;s<i;s++){var o=e[a++],u=127&e[a++],l=127&e[a++];if((0!==u||0!==l)&&0!=(4&o)){var c=3&o;0!==c&&1!==c||(t[c].push(u),t[c].push(l))}}return t},e}();function g(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}},"./src/crypt/aes-crypto.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var a=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}()},"./src/crypt/aes-decryptor.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o,removePadding:()=>s});var a=i("./src/utils/typed-array.ts");function s(e){var t=e.byteLength,i=t&&new DataView(e.buffer).getUint8(t-1);return i?(0,a.sliceUint8)(e,0,t-i):e}var o=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),a=0;a<4;a++)i[a]=t.getUint32(4*a);return i},t.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,a=i[0],s=i[1],o=i[2],u=i[3],l=this.invSubMix,c=l[0],d=l[1],f=l[2],h=l[3],p=new Uint32Array(256),v=0,g=0,m=0;for(m=0;m<256;m++)p[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var y=g^g<<1^g<<2^g<<3^g<<4;y=y>>>8^255&y^99,e[v]=y,t[y]=v;var E=p[v],_=p[E],T=p[_],b=257*p[y]^16843008*y;a[v]=b<<24|b>>>8,s[v]=b<<16|b>>>16,o[v]=b<<8|b>>>24,u[v]=b,b=16843009*T^65537*_^257*E^16843008*v,c[y]=b<<24|b>>>8,d[y]=b<<16|b>>>16,f[y]=b<<8|b>>>24,h[y]=b,v?(v=E^p[p[p[T^E]]],g^=p[p[g]]):v=g=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,a=0;a<t.length&&i;)i=t[a]===this.key[a],a++;if(!i){this.key=t;var s=this.keySize=t.length;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size="+s);var o,u,l,c,d=this.ksRows=4*(s+6+1),f=this.keySchedule=new Uint32Array(d),h=this.invKeySchedule=new Uint32Array(d),p=this.sBox,v=this.rcon,g=this.invSubMix,m=g[0],y=g[1],E=g[2],_=g[3];for(o=0;o<d;o++)o<s?l=f[o]=t[o]:(c=l,o%s==0?(c=p[(c=c<<8|c>>>24)>>>24]<<24|p[c>>>16&255]<<16|p[c>>>8&255]<<8|p[255&c],c^=v[o/s|0]<<24):s>6&&o%s==4&&(c=p[c>>>24]<<24|p[c>>>16&255]<<16|p[c>>>8&255]<<8|p[255&c]),f[o]=l=(f[o-s]^c)>>>0);for(u=0;u<d;u++)o=d-u,c=3&u?f[o]:f[o-4],h[u]=u<4||o<=4?c:m[p[c>>>24]]^y[p[c>>>16&255]]^E[p[c>>>8&255]]^_[p[255&c]],h[u]=h[u]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,i){for(var a,s,o,u,l,c,d,f,h,p,v,g,m,y,E=this.keySize+6,_=this.invKeySchedule,T=this.invSBox,b=this.invSubMix,S=b[0],R=b[1],A=b[2],w=b[3],I=this.uint8ArrayToUint32Array_(i),D=I[0],L=I[1],k=I[2],C=I[3],O=new Int32Array(e),P=new Int32Array(O.length),x=this.networkToHostOrderSwap;t<O.length;){for(h=x(O[t]),p=x(O[t+1]),v=x(O[t+2]),g=x(O[t+3]),l=h^_[0],c=g^_[1],d=v^_[2],f=p^_[3],m=4,y=1;y<E;y++)a=S[l>>>24]^R[c>>16&255]^A[d>>8&255]^w[255&f]^_[m],s=S[c>>>24]^R[d>>16&255]^A[f>>8&255]^w[255&l]^_[m+1],o=S[d>>>24]^R[f>>16&255]^A[l>>8&255]^w[255&c]^_[m+2],u=S[f>>>24]^R[l>>16&255]^A[c>>8&255]^w[255&d]^_[m+3],l=a,c=s,d=o,f=u,m+=4;a=T[l>>>24]<<24^T[c>>16&255]<<16^T[d>>8&255]<<8^T[255&f]^_[m],s=T[c>>>24]<<24^T[d>>16&255]<<16^T[f>>8&255]<<8^T[255&l]^_[m+1],o=T[d>>>24]<<24^T[f>>16&255]<<16^T[l>>8&255]<<8^T[255&c]^_[m+2],u=T[f>>>24]<<24^T[l>>16&255]<<16^T[c>>8&255]<<8^T[255&d]^_[m+3],P[t]=x(a^D),P[t+1]=x(u^L),P[t+2]=x(o^k),P[t+3]=x(s^C),D=h,L=p,k=v,C=g,t+=4}return P.buffer},e}()},"./src/crypt/decrypter.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var a=i("./src/crypt/aes-crypto.ts"),s=i("./src/crypt/fast-aes-key.ts"),o=i("./src/crypt/aes-decryptor.ts"),u=i("./src/utils/logger.ts"),l=i("./src/utils/mp4-tools.ts"),c=i("./src/utils/typed-array.ts"),d=function(){function e(e,t){var i=(void 0===t?{}:t).removePKCS7Padding,a=void 0===i||i;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=a,a)try{var s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(e){}null===this.subtle&&(this.useSoftware=!0)}var t=e.prototype;return t.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},t.isSync=function(){return this.useSoftware},t.flush=function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?(0,o.removePadding)(i):i},t.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},t.decrypt=function(e,t,i){var a=this;return this.useSoftware?new Promise((function(s,o){a.softwareDecrypt(new Uint8Array(e),t,i);var u=a.flush();u?s(u.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,i)},t.softwareDecrypt=function(e,t,i){var a=this.currentIV,s=this.currentResult,u=this.remainderData;this.logOnce("JS AES decrypt"),u&&(e=(0,l.appendUint8Array)(u,e),this.remainderData=null);var d=this.getValidChunk(e);if(!d.length)return null;a&&(i=a);var f=this.softwareDecrypter;f||(f=this.softwareDecrypter=new o.default),f.expandKey(t);var h=s;return this.currentResult=f.decrypt(d.buffer,0,i),this.currentIV=(0,c.sliceUint8)(d,-16).buffer,h||null},t.webCryptoDecrypt=function(e,t,i){var o=this,l=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new s.default(l,t)),this.fastAesKey.expandKey().then((function(t){return l?(o.logOnce("WebCrypto AES decrypt"),new a.default(l,new Uint8Array(i)).decrypt(e.buffer,t)):Promise.reject(new Error("web crypto not initialized"))})).catch((function(a){return u.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+a.name+": "+a.message),o.onWebCryptoError(e,t,i)}))},t.onWebCryptoError=function(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);var a=this.flush();if(a)return a.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},t.getValidChunk=function(e){var t=e,i=e.length-e.length%16;return i!==e.length&&(t=(0,c.sliceUint8)(e,0,i),this.remainderData=(0,c.sliceUint8)(e,i)),t},t.logOnce=function(e){this.logEnabled&&(u.logger.log("[decrypter]: "+e),this.logEnabled=!1)},e}()},"./src/crypt/fast-aes-key.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var a=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var a=i("./src/demux/base-audio-demuxer.ts"),s=i("./src/demux/adts.ts"),o=i("./src/utils/logger.ts"),u=i("./src/demux/id3.ts");function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}const c=function(e){var t,i;function a(t,i){var a;return(a=e.call(this)||this).observer=void 0,a.config=void 0,a.observer=t,a.config=i,a}i=e,(t=a).prototype=Object.create(i.prototype),t.prototype.constructor=t,l(t,i);var c=a.prototype;return c.resetInitSegment=function(t,i,a,s){e.prototype.resetInitSegment.call(this,t,i,a,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:i,duration:s,inputTimeScale:9e4,dropped:0}},a.probe=function(e){if(!e)return!1;for(var t=(u.getID3Data(e,0)||[]).length,i=e.length;t<i;t++)if(s.probe(e,t))return o.logger.log("ADTS sync word found !"),!0;return!1},c.canParse=function(e,t){return s.canParse(e,t)},c.appendFrame=function(e,t,i){s.initTrackConfig(e,this.observer,t,i,e.manifestCodec);var a=s.appendFrame(e,t,i,this.basePTS,this.frameIndex);if(a&&0===a.missing)return a},a}(a.default)},"./src/demux/adts.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{appendFrame:()=>E,canGetFrameLength:()=>f,canParse:()=>p,getAudioConfig:()=>u,getFrameDuration:()=>m,getFullFrameLength:()=>d,getHeaderLength:()=>c,initTrackConfig:()=>g,isHeader:()=>h,isHeaderPattern:()=>l,parseFrameHeader:()=>y,probe:()=>v});var a=i("./src/utils/logger.ts"),s=i("./src/errors.ts"),o=i("./src/events.ts");function u(e,t,i,u){var l,c,d,f,h=navigator.userAgent.toLowerCase(),p=u,v=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];l=1+((192&t[i+2])>>>6);var g=(60&t[i+2])>>>2;if(!(g>v.length-1))return d=(1&t[i+2])<<2,d|=(192&t[i+3])>>>6,a.logger.log("manifest codec:"+u+", ADTS type:"+l+", samplingIndex:"+g),/firefox/i.test(h)?g>=6?(l=5,f=new Array(4),c=g-3):(l=2,f=new Array(2),c=g):-1!==h.indexOf("android")?(l=2,f=new Array(2),c=g):(l=5,f=new Array(4),u&&(-1!==u.indexOf("mp4a.40.29")||-1!==u.indexOf("mp4a.40.5"))||!u&&g>=6?c=g-3:((u&&-1!==u.indexOf("mp4a.40.2")&&(g>=6&&1===d||/vivaldi/i.test(h))||!u&&1===d)&&(l=2,f=new Array(2)),c=g)),f[0]=l<<3,f[0]|=(14&g)>>1,f[1]|=(1&g)<<7,f[1]|=d<<3,5===l&&(f[1]|=(14&c)>>1,f[2]=(1&c)<<7,f[2]|=8,f[3]=0),{config:f,samplerate:v[g],channelCount:d,codec:"mp4a.40."+l,manifestCodec:p};e.trigger(o.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+g})}function l(e,t){return 255===e[t]&&240==(246&e[t+1])}function c(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function f(e,t){return t+5<e.length}function h(e,t){return t+1<e.length&&l(e,t)}function p(e,t){return f(e,t)&&l(e,t)&&d(e,t)<=e.length-t}function v(e,t){if(h(e,t)){var i=c(e,t);if(t+i>=e.length)return!1;var a=d(e,t);if(a<=i)return!1;var s=t+a;return s===e.length||h(e,s)}return!1}function g(e,t,i,s,o){if(!e.samplerate){var l=u(t,i,s,o);if(!l)return;e.config=l.config,e.samplerate=l.samplerate,e.channelCount=l.channelCount,e.codec=l.codec,e.manifestCodec=l.manifestCodec,a.logger.log("parsed codec:"+e.codec+", rate:"+l.samplerate+", channels:"+l.channelCount)}}function m(e){return 9216e4/e}function y(e,t){var i=c(e,t);if(t+i<=e.length){var a=d(e,t)-i;if(a>0)return{headerLength:i,frameLength:a}}}function E(e,t,i,a,s){var o,u=a+s*m(e.samplerate),l=y(t,i);if(l){var c=l.frameLength,d=l.headerLength,f=d+c,h=Math.max(0,i+f-t.length);h?(o=new Uint8Array(f-d)).set(t.subarray(i+d,t.length),0):o=t.subarray(i+d,i+f);var p={unit:o,pts:u};return h||e.samples.push(p),{sample:p,length:f,missing:h}}var v=t.length-i;return(o=new Uint8Array(v)).set(t.subarray(i,t.length),0),{sample:{unit:o,pts:u},length:v,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h,initPTSFn:()=>f});var a=i("./src/polyfills/number.ts"),s=i("./src/demux/id3.ts"),o=i("./src/types/demuxer.ts"),u=i("./src/demux/dummy-demuxed-track.ts"),l=i("./src/utils/mp4-tools.ts"),c=i("./src/utils/typed-array.ts"),d=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var t=e.prototype;return t.resetInitSegment=function(e,t,i,a){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},t.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},t.canParse=function(e,t){return!1},t.appendFrame=function(e,t,i){},t.demux=function(e,t){this.cachedData&&(e=(0,l.appendUint8Array)(this.cachedData,e),this.cachedData=null);var i,d=s.getID3Data(e,0),h=d?d.length:0,p=this._audioTrack,v=this._id3Track,g=d?s.getTimeStamp(d):void 0,m=e.length;for((null===this.basePTS||0===this.frameIndex&&(0,a.isFiniteNumber)(g))&&(this.basePTS=f(g,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),d&&d.length>0&&v.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:d,type:o.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});h<m;){if(this.canParse(e,h)){var y=this.appendFrame(p,e,h);y?(this.frameIndex++,this.lastPTS=y.sample.pts,i=h+=y.length):h=m}else s.canParse(e,h)?(d=s.getID3Data(e,h),v.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:d,type:o.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),i=h+=d.length):h++;if(h===m&&i!==m){var E=(0,c.sliceUint8)(e,i);this.cachedData?this.cachedData=(0,l.appendUint8Array)(this.cachedData,E):this.cachedData=E}}return{audioTrack:p,videoTrack:(0,u.dummyTrack)(),id3Track:v,textTrack:(0,u.dummyTrack)()}},t.demuxSampleAes=function(e,t,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:(0,u.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,u.dummyTrack)()}},t.destroy=function(){},e}(),f=function(e,t,i){return(0,a.isFiniteNumber)(e)?90*e:9e4*t+(i||0)};const h=d},"./src/demux/chunk-cache.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var a=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function(){var e,t=this.chunks,i=this.dataLength;return t.length?(e=1===t.length?t[0]:function(e,t){for(var i=new Uint8Array(t),a=0,s=0;s<e.length;s++){var o=e[s];i.set(o,a),a+=o.length}return i}(t,i),this.reset(),e):new Uint8Array(0)},t.reset=function(){this.chunks.length=0,this.dataLength=0},e}()},"./src/demux/dummy-demuxed-track.ts":(e,t,i)=>{"use strict";function a(e,t){return void 0===e&&(e=""),void 0===t&&(t=9e4),{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}i.r(t),i.d(t,{dummyTrack:()=>a})},"./src/demux/exp-golomb.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var a=i("./src/utils/logger.ts"),s=function(){function e(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,a=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");a.set(e.subarray(i,i+s)),this.word=new DataView(a.buffer).getUint32(0),this.bitsAvailable=8*s,this.bytesAvailable-=s},t.skipBits=function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;if(e>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=e-t)>0&&this.bitsAvailable?i<<t|this.readBits(t):i},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t=8,i=8,a=0;a<e;a++)0!==i&&(i=(t+this.readEG()+256)%256),t=0===i?t:i},t.readSPS=function(){var e,t,i,a=0,s=0,o=0,u=0,l=this.readUByte.bind(this),c=this.readBits.bind(this),d=this.readUEG.bind(this),f=this.readBoolean.bind(this),h=this.skipBits.bind(this),p=this.skipEG.bind(this),v=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);l();var m=l();if(c(5),h(3),l(),v(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){var y=d();if(3===y&&h(1),v(),v(),h(1),f())for(t=3!==y?8:12,i=0;i<t;i++)f()&&g(i<6?16:64)}v();var E=d();if(0===E)d();else if(1===E)for(h(1),p(),p(),e=d(),i=0;i<e;i++)p();v(),h(1);var _=d(),T=d(),b=c(1);0===b&&h(1),h(1),f()&&(a=d(),s=d(),o=d(),u=d());var S=[1,1];if(f()&&f())switch(l()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[l()<<8|l(),l()<<8|l()]}return{width:Math.ceil(16*(_+1)-2*a-2*s),height:(2-b)*(T+1)*16-(b?2:4)*(o+u),pixelRatio:S}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();const o=s},"./src/demux/id3.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{canParse:()=>c,decodeFrame:()=>v,getID3Data:()=>u,getID3Frames:()=>p,getTimeStamp:()=>d,isFooter:()=>o,isHeader:()=>s,isTimeStampFrame:()=>f,testables:()=>T,utf8ArrayToStr:()=>_});var a,s=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},o=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},u=function(e,t){for(var i=t,a=0;s(e,t);)a+=10,a+=l(e,t+6),o(e,t+10)&&(a+=10),t+=a;if(a>0)return e.subarray(i,i+a)},l=function(e,t){var i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,i|=(127&e[t+2])<<7,i|=127&e[t+3]},c=function(e,t){return s(e,t)&&l(e,t+6)+10<=e.length-t},d=function(e){for(var t=p(e),i=0;i<t.length;i++){var a=t[i];if(f(a))return E(a)}},f=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},h=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),i=l(e,4);return{type:t,size:i,data:e.subarray(10,10+i)}},p=function(e){for(var t=0,i=[];s(e,t);){for(var a=l(e,t+6),u=(t+=10)+a;t+8<u;){var c=h(e.subarray(t)),d=v(c);d&&i.push(d),t+=c.size+10}o(e,t)&&(t+=10)}return i},v=function(e){return"PRIV"===e.type?g(e):"W"===e.type[0]?y(e):m(e)},g=function(e){if(!(e.size<2)){var t=_(e.data,!0),i=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:i.buffer}}},m=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,i=_(e.data.subarray(t),!0);t+=i.length+1;var a=_(e.data.subarray(t));return{key:e.type,info:i,data:a}}var s=_(e.data.subarray(1));return{key:e.type,data:s}}},y=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,i=_(e.data.subarray(t),!0);t+=i.length+1;var a=_(e.data.subarray(t));return{key:e.type,info:i,data:a}}var s=_(e.data);return{key:e.type,data:s}},E=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),i=1&t[3],a=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return a/=45,i&&(a+=47721858.84),Math.round(a)}},_=function(e,t){void 0===t&&(t=!1);var i=b();if(i){var a=i.decode(e);if(t){var s=a.indexOf("\0");return-1!==s?a.substring(0,s):a}return a.replace(/\0/g,"")}for(var o,u,l,c=e.length,d="",f=0;f<c;){if(0===(o=e[f++])&&t)return d;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(o);break;case 12:case 13:u=e[f++],d+=String.fromCharCode((31&o)<<6|63&u);break;case 14:u=e[f++],l=e[f++],d+=String.fromCharCode((15&o)<<12|(63&u)<<6|(63&l)<<0)}}return d},T={decodeTextFrame:m};function b(){return a||void 0===self.TextDecoder||(a=new self.TextDecoder("utf-8")),a}},"./src/demux/mp3demuxer.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var a=i("./src/demux/base-audio-demuxer.ts"),s=i("./src/demux/id3.ts"),o=i("./src/utils/logger.ts"),u=i("./src/demux/mpegaudio.ts");function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}var c=function(e){var t,i;function a(){return e.apply(this,arguments)||this}i=e,(t=a).prototype=Object.create(i.prototype),t.prototype.constructor=t,l(t,i);var c=a.prototype;return c.resetInitSegment=function(t,i,a,s){e.prototype.resetInitSegment.call(this,t,i,a,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:i,duration:s,inputTimeScale:9e4,dropped:0}},a.probe=function(e){if(!e)return!1;for(var t=(s.getID3Data(e,0)||[]).length,i=e.length;t<i;t++)if(u.probe(e,t))return o.logger.log("MPEG Audio sync word found !"),!0;return!1},c.canParse=function(e,t){return u.canParse(e,t)},c.appendFrame=function(e,t,i){if(null!==this.basePTS)return u.appendFrame(e,t,i,this.basePTS,this.frameIndex)},a}(a.default);const d=c},"./src/demux/mp4demuxer.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var a=i("./src/polyfills/number.ts"),s=i("./src/types/demuxer.ts"),o=i("./src/utils/mp4-tools.ts"),u=i("./src/demux/dummy-demuxed-track.ts"),l=/\/emsg[-/]ID3/i;const c=function(){function e(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var t=e.prototype;return t.resetTimeStamp=function(){},t.resetInitSegment=function(e,t,i,a){var s=this.videoTrack=(0,u.dummyTrack)("video",1),l=this.audioTrack=(0,u.dummyTrack)("audio",1),c=this.txtTrack=(0,u.dummyTrack)("text",1);if(this.id3Track=(0,u.dummyTrack)("id3",1),this.timeOffset=0,e&&e.byteLength){var d=(0,o.parseInitSegment)(e);if(d.video){var f=d.video,h=f.id,p=f.timescale,v=f.codec;s.id=h,s.timescale=c.timescale=p,s.codec=v}if(d.audio){var g=d.audio,m=g.id,y=g.timescale,E=g.codec;l.id=m,l.timescale=y,l.codec=E}c.id=o.RemuxerTrackIdConfig.text,s.sampleDuration=0,s.duration=l.duration=a}},t.resetContiguity=function(){},e.probe=function(e){return e=e.length>16384?e.subarray(0,16384):e,(0,o.findBox)(e,["moof"]).length>0},t.demux=function(e,t){this.timeOffset=t;var i=e,a=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=(0,o.appendUint8Array)(this.remainderData,e));var u=(0,o.segmentValidRange)(i);this.remainderData=u.remainder,a.samples=u.valid||new Uint8Array}else a.samples=i;var l=this.extractID3Track(a,t);return s.samples=(0,o.parseSamples)(t,a),{videoTrack:a,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},t.flush=function(){var e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var a=this.extractID3Track(t,this.timeOffset);return i.samples=(0,o.parseSamples)(e,t),{videoTrack:t,audioTrack:(0,u.dummyTrack)(),id3Track:a,textTrack:(0,u.dummyTrack)()}},t.extractID3Track=function(e,t){var i=this.id3Track;if(e.samples.length){var u=(0,o.findBox)(e.samples,["emsg"]);u&&u.forEach((function(e){var u=(0,o.parseEmsg)(e);if(l.test(u.schemeIdUri)){var c=(0,a.isFiniteNumber)(u.presentationTime)?u.presentationTime/u.timeScale:t+u.presentationTimeDelta/u.timeScale,d=4294967295===u.eventDuration?Number.POSITIVE_INFINITY:u.eventDuration/u.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);var f=u.payload;i.samples.push({data:f,len:f.byteLength,dts:c,pts:c,type:s.MetadataSchema.emsg,duration:d})}}))}return i},t.demuxSampleAes=function(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function(){},e}()},"./src/demux/mpegaudio.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{appendFrame:()=>c,canParse:()=>p,isHeader:()=>h,isHeaderPattern:()=>f,parseHeader:()=>d,probe:()=>v});var a=null,s=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],u=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],l=[0,1,1,4];function c(e,t,i,a,s){if(!(i+24>t.length)){var o=d(t,i);if(o&&i+o.frameLength<=t.length){var u=a+s*(9e4*o.samplesPerFrame/o.sampleRate),l={unit:t.subarray(i,i+o.frameLength),pts:u,dts:u};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(l),{sample:l,length:o.frameLength,missing:0}}}}function d(e,t){var i=e[t+1]>>3&3,c=e[t+1]>>1&3,d=e[t+2]>>4&15,f=e[t+2]>>2&3;if(1!==i&&0!==d&&15!==d&&3!==f){var h=e[t+2]>>1&1,p=e[t+3]>>6,v=1e3*s[14*(3===i?3-c:3===c?3:4)+d-1],g=o[3*(3===i?0:2===i?1:2)+f],m=3===p?1:2,y=u[i][c],E=l[c],_=8*y*E,T=Math.floor(y*v/g+h)*E;if(null===a){var b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);a=b?parseInt(b[1]):0}return!!a&&a<=87&&2===c&&v>=224e3&&0===p&&(e[t+3]=128|e[t+3]),{sampleRate:g,channelCount:m,frameLength:T,samplesPerFrame:_}}}function f(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function h(e,t){return t+1<e.length&&f(e,t)}function p(e,t){return f(e,t)&&4<=e.length-t}function v(e,t){if(t+1<e.length&&f(e,t)){var i=d(e,t),a=4;null!=i&&i.frameLength&&(a=i.frameLength);var s=t+a;return s===e.length||h(e,s)}return!1}},"./src/demux/sample-aes.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var a=i("./src/crypt/decrypter.ts"),s=i("./src/utils/mp4-tools.ts");const o=function(){function e(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new a.default(t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},t.decryptAacSample=function(e,t,i){var a=this,s=e[t].unit;if(!(s.length<=16)){var o=s.subarray(16,s.length-s.length%16),u=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(u).then((function(o){var u=new Uint8Array(o);s.set(u,16),a.decrypter.isSync()||a.decryptAacSamples(e,t+1,i)}))}},t.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,i),this.decrypter.isSync())))return}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t),a=0,s=32;s<e.length-16;s+=160,a+=16)i.set(e.subarray(s,s+16),a);return i},t.getAvcDecryptedUnit=function(e,t){for(var i=new Uint8Array(t),a=0,s=32;s<e.length-16;s+=160,a+=16)e.set(i.subarray(a,a+16),s);return e},t.decryptAvcSample=function(e,t,i,a,o){var u=this,l=(0,s.discardEPB)(o.data),c=this.getAvcEncryptedData(l);this.decryptBuffer(c.buffer).then((function(s){o.data=u.getAvcDecryptedUnit(l,s),u.decrypter.isSync()||u.decryptAvcSamples(e,t,i+1,a)}))},t.decryptAvcSamples=function(e,t,i,a){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length)return void a();for(var s=e[t].units;!(i>=s.length);i++){var o=s[i];if(!(o.data.length<=48||1!==o.type&&5!==o.type||(this.decryptAvcSample(e,t,i,a,o),this.decrypter.isSync())))return}}},e}()},"./src/demux/transmuxer-interface.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var a=i("./src/demux/webworkify-webpack.js"),s=i("./src/events.ts"),o=i("./src/demux/transmuxer.ts"),u=i("./src/utils/logger.ts"),l=i("./src/errors.ts"),c=i("./src/utils/mediasource-helper.ts"),d=i("./node_modules/eventemitter3/index.js"),f=(0,c.getMediaSource)()||{isTypeSupported:function(){return!1}},h=function(){function e(e,t,i,c){var h=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var p=e.config;this.hls=e,this.id=t,this.useWorker=!!p.enableWorker,this.onTransmuxComplete=i,this.onFlush=c;var v=function(e,t){(t=t||{}).frag=h.frag,t.id=h.id,h.hls.trigger(e,t)};this.observer=new d.EventEmitter,this.observer.on(s.Events.FRAG_DECRYPTED,v),this.observer.on(s.Events.ERROR,v);var g={mp4:f.isTypeSupported("video/mp4"),mpeg:f.isTypeSupported("audio/mpeg"),mp3:f.isTypeSupported('audio/mp4; codecs="mp3"')},m=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker){var y;u.logger.log("demuxing in webworker");try{y=this.worker=(0,a.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),y.addEventListener("message",this.onwmsg),y.onerror=function(e){h.useWorker=!1,u.logger.warn("Exception in webworker, fallback to inline"),h.hls.trigger(s.Events.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(e.message+"  ("+e.filename+":"+e.lineno+")")})},y.postMessage({cmd:"init",typeSupported:g,vendor:m,id:t,config:JSON.stringify(p)})}catch(e){u.logger.warn("Error in worker:",e),u.logger.error("Error while initializing DemuxerWorker, fallback to inline"),y&&self.URL.revokeObjectURL(y.objectURL),this.transmuxer=new o.default(this.observer,g,p,m,t),this.worker=null}}else this.transmuxer=new o.default(this.observer,g,p,m,t)}var t=e.prototype;return t.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},t.push=function(e,t,i,a,s,l,c,d,f,h){var p,v,g=this;f.transmuxing.start=self.performance.now();var m=this.transmuxer,y=this.worker,E=l?l.start:s.start,_=s.decryptdata,T=this.frag,b=!(T&&s.cc===T.cc),S=!(T&&f.level===T.level),R=T?f.sn-T.sn:-1,A=this.part?f.part-this.part.index:-1,w=0===R&&f.id>1&&f.id===(null==T?void 0:T.stats.chunkCount),I=!S&&(1===R||0===R&&(1===A||w&&A<=0)),D=self.performance.now();(S||R||0===s.stats.parsing.start)&&(s.stats.parsing.start=D),!l||!A&&I||(l.stats.parsing.start=D);var L=!(T&&(null===(p=s.initSegment)||void 0===p?void 0:p.url)===(null===(v=T.initSegment)||void 0===v?void 0:v.url)),k=new o.TransmuxState(b,I,d,S,E,L);if(!I||b||L){u.logger.log("[transmuxer-interface, "+s.type+"]: Starting new transmux session for sn: "+f.sn+" p: "+f.part+" level: "+f.level+" id: "+f.id+"\n        discontinuity: "+b+"\n        trackSwitch: "+S+"\n        contiguous: "+I+"\n        accurateTimeOffset: "+d+"\n        timeOffset: "+E+"\n        initSegmentChange: "+L);var C=new o.TransmuxConfig(i,a,t,c,h);this.configureTransmuxer(C)}if(this.frag=s,this.part=l,y)y.postMessage({cmd:"demux",data:e,decryptdata:_,chunkMeta:f,state:k},e instanceof ArrayBuffer?[e]:[]);else if(m){var O=m.push(e,_,f,k);(0,o.isPromise)(O)?(m.async=!0,O.then((function(e){g.handleTransmuxComplete(e)})).catch((function(e){g.transmuxerError(e,f,"transmuxer-interface push error")}))):(m.async=!1,this.handleTransmuxComplete(O))}},t.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var i=this.transmuxer,a=this.worker;if(a)a.postMessage({cmd:"flush",chunkMeta:e});else if(i){var s=i.flush(e);(0,o.isPromise)(s)||i.async?((0,o.isPromise)(s)||(s=Promise.resolve(s)),s.then((function(i){t.handleFlushResult(i,e)})).catch((function(i){t.transmuxerError(i,e,"transmuxer-interface flush error")}))):this.handleFlushResult(s,e)}},t.transmuxerError=function(e,t,i){this.hls&&this.hls.trigger(s.Events.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:i})},t.handleFlushResult=function(e,t){var i=this;e.forEach((function(e){i.handleTransmuxComplete(e)})),this.onFlush(t)},t.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":u.logger[t.data.logType]&&u.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data)}},t.configureTransmuxer=function(e){var t=this.worker,i=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):i&&i.configure(e)},t.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},e}()},"./src/demux/transmuxer-worker.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>c});var a=i("./src/demux/transmuxer.ts"),s=i("./src/events.ts"),o=i("./src/utils/logger.ts"),u=i("./node_modules/eventemitter3/index.js"),l=i("./src/errors.ts");function c(e){var t=new u.EventEmitter,i=function(t,i){e.postMessage({event:t,data:i})};t.on(s.Events.FRAG_DECRYPTED,i),t.on(s.Events.ERROR,i),e.addEventListener("message",(function(u){var c=u.data;switch(c.cmd){case"init":var f=JSON.parse(c.config);e.transmuxer=new a.default(t,c.typeSupported,f,c.vendor,c.id),(0,o.enableLogs)(f.debug,c.id),function(){var e=function(e){o.logger[e]=function(t){i("workerLog",{logType:e,message:t})}};for(var t in o.logger)e(t)}(),i("init",null);break;case"configure":e.transmuxer.configure(c.config);break;case"demux":var p=e.transmuxer.push(c.data,c.decryptdata,c.chunkMeta,c.state);(0,a.isPromise)(p)?(e.transmuxer.async=!0,p.then((function(t){d(e,t)})).catch((function(e){i(s.Events.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:c.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker push error"})}))):(e.transmuxer.async=!1,d(e,p));break;case"flush":var v=c.chunkMeta,g=e.transmuxer.flush(v);(0,a.isPromise)(g)||e.transmuxer.async?((0,a.isPromise)(g)||(g=Promise.resolve(g)),g.then((function(t){h(e,t,v)})).catch((function(e){i(s.Events.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:c.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker flush error"})}))):h(e,g,v)}}))}function d(e,t){if(!((i=t.remuxResult).audio||i.video||i.text||i.id3||i.initSegment))return!1;var i,a=[],s=t.remuxResult,o=s.audio,u=s.video;return o&&f(a,o),u&&f(a,u),e.postMessage({event:"transmuxComplete",data:t},a),!0}function f(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function h(e,t,i){t.reduce((function(t,i){return d(e,i)||t}),!1)||e.postMessage({event:"transmuxComplete",data:t[0]}),e.postMessage({event:"flush",data:i})}},"./src/demux/transmuxer.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{TransmuxConfig:()=>_,TransmuxState:()=>T,default:()=>m,isPromise:()=>E});var a,s=i("./src/events.ts"),o=i("./src/errors.ts"),u=i("./src/crypt/decrypter.ts"),l=i("./src/demux/aacdemuxer.ts"),c=i("./src/demux/mp4demuxer.ts"),d=i("./src/demux/tsdemuxer.ts"),f=i("./src/demux/mp3demuxer.ts"),h=i("./src/remux/mp4-remuxer.ts"),p=i("./src/remux/passthrough-remuxer.ts"),v=i("./src/utils/logger.ts");try{a=self.performance.now.bind(self.performance)}catch(e){v.logger.debug("Unable to use Performance API on this environment"),a=self.Date.now}var g=[{demux:c.default,remux:p.default},{demux:d.default,remux:h.default},{demux:l.default,remux:h.default},{demux:f.default,remux:h.default}],m=function(){function e(e,t,i,a,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=a,this.id=s}var t=e.prototype;return t.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},t.push=function(e,t,i,s){var o=this,u=i.transmuxing;u.executeStart=a();var l=new Uint8Array(e),c=this.currentTransmuxState,d=this.transmuxConfig;s&&(this.currentTransmuxState=s);var f=s||c,h=f.contiguous,p=f.discontinuity,v=f.trackSwitch,g=f.accurateTimeOffset,m=f.timeOffset,E=f.initSegmentChange,_=d.audioCodec,T=d.videoCodec,b=d.defaultInitPts,S=d.duration,R=d.initSegmentData,A=function(e,t){var i=null;return e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(i=t),i}(l,t);if(A&&"AES-128"===A.method){var w=this.getDecrypter();if(!w.isSync())return this.decryptionPromise=w.webCryptoDecrypt(l,A.key.buffer,A.iv.buffer).then((function(e){var t=o.push(e,null,i);return o.decryptionPromise=null,t})),this.decryptionPromise;var I=w.softwareDecrypt(l,A.key.buffer,A.iv.buffer);if(i.part>-1&&(I=w.flush()),!I)return u.executeEnd=a(),y(i);l=new Uint8Array(I)}var D=this.needsProbing(p,v);D&&this.configureTransmuxer(l),(p||v||E||D)&&this.resetInitSegment(R,_,T,S,t),(p||E||D)&&this.resetInitialTimestamp(b),h||this.resetContiguity();var L=this.transmux(l,A,m,g,i),k=this.currentTransmuxState;return k.contiguous=!0,k.discontinuity=!1,k.trackSwitch=!1,u.executeEnd=a(),L},t.flush=function(e){var t=this,i=e.transmuxing;i.executeStart=a();var u=this.decrypter,l=this.currentTransmuxState,c=this.decryptionPromise;if(c)return c.then((function(){return t.flush(e)}));var d=[],f=l.timeOffset;if(u){var h=u.flush();h&&d.push(this.push(h,null,e))}var p=this.demuxer,v=this.remuxer;if(!p||!v)return this.observer.emit(s.Events.ERROR,s.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),i.executeEnd=a(),[y(e)];var g=p.flush(f);return E(g)?g.then((function(i){return t.flushRemux(d,i,e),d})):(this.flushRemux(d,g,e),d)},t.flushRemux=function(e,t,i){var s=t.audioTrack,o=t.videoTrack,u=t.id3Track,l=t.textTrack,c=this.currentTransmuxState,d=c.accurateTimeOffset,f=c.timeOffset;v.logger.log("[transmuxer.ts]: Flushed fragment "+i.sn+(i.part>-1?" p: "+i.part:"")+" of level "+i.level);var h=this.remuxer.remux(s,o,u,l,f,d,!0,this.id);e.push({remuxResult:h,chunkMeta:i}),i.transmuxing.executeEnd=a()},t.resetInitialTimestamp=function(e){var t=this.demuxer,i=this.remuxer;t&&i&&(t.resetTimeStamp(e),i.resetTimeStamp(e))},t.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},t.resetInitSegment=function(e,t,i,a,s){var o=this.demuxer,u=this.remuxer;o&&u&&(o.resetInitSegment(e,t,i,a),u.resetInitSegment(e,t,i,s))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(e,t,i,a,s){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,i,a,s):this.transmuxUnencrypted(e,i,a,s)},t.transmuxUnencrypted=function(e,t,i,a){var s=this.demuxer.demux(e,t,!1,!this.config.progressive),o=s.audioTrack,u=s.videoTrack,l=s.id3Track,c=s.textTrack;return{remuxResult:this.remuxer.remux(o,u,l,c,t,i,!1,this.id),chunkMeta:a}},t.transmuxSampleAes=function(e,t,i,a,s){var o=this;return this.demuxer.demuxSampleAes(e,t,i).then((function(e){return{remuxResult:o.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,i,a,!1,o.id),chunkMeta:s}}))},t.configureTransmuxer=function(e){for(var t,i=this.config,a=this.observer,s=this.typeSupported,o=this.vendor,u=0,l=g.length;u<l;u++)if(g[u].demux.probe(e)){t=g[u];break}t||(v.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),t={demux:c.default,remux:p.default});var d=this.demuxer,f=this.remuxer,h=t.remux,m=t.demux;f&&f instanceof h||(this.remuxer=new h(a,i,s,o)),d&&d instanceof m||(this.demuxer=new m(a,i,s),this.probe=m.probe)},t.needsProbing=function(e,t){return!this.demuxer||!this.remuxer||e||t},t.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new u.default(this.config)),e},e}(),y=function(e){return{remuxResult:{},chunkMeta:e}};function E(e){return"then"in e&&e.then instanceof Function}var _=function(e,t,i,a,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=a,this.defaultInitPts=s},T=function(e,t,i,a,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=a,this.timeOffset=s,this.initSegmentChange=o}},"./src/demux/tsdemuxer.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>S});var a=i("./src/demux/adts.ts"),s=i("./src/demux/mpegaudio.ts"),o=i("./src/demux/exp-golomb.ts"),u=i("./src/demux/sample-aes.ts"),l=i("./src/events.ts"),c=i("./src/utils/mp4-tools.ts"),d=i("./src/utils/logger.ts"),f=i("./src/errors.ts"),h=i("./src/types/demuxer.ts");function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},p.apply(this,arguments)}var v=188,g=function(){function e(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=i}e.probe=function(t){var i=e.syncOffset(t);return i>0&&d.logger.warn("MPEG2-TS detected but first sync word found @ offset "+i),-1!==i},e.syncOffset=function(e){for(var t=e.length,i=Math.min(940,e.length-v)+1,a=0;a<i;){for(var s=!1,o=a;o<t&&71===e[o];o+=v)if(s||0!==y(e,o)||(s=!0),s&&o+v>i)return a;a++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:c.RemuxerTrackIdConfig[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var t=e.prototype;return t.resetInitSegment=function(t,i,a,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",s),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=i,this.videoCodec=a,this._duration=s},t.resetTimeStamp=function(){},t.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,i=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},t.demux=function(t,i,a,s){var o;void 0===a&&(a=!1),void 0===s&&(s=!1),a||(this.sampleAes=null);var u=this._avcTrack,h=this._audioTrack,p=this._id3Track,g=this._txtTrack,m=u.pid,b=u.pesData,S=h.pid,R=p.pid,A=h.pesData,w=p.pesData,I=null,D=this.pmtParsed,L=this._pmtId,k=t.length;if(this.remainderData&&(k=(t=(0,c.appendUint8Array)(this.remainderData,t)).length,this.remainderData=null),k<v&&!s)return this.remainderData=t,{audioTrack:h,videoTrack:u,id3Track:p,textTrack:g};var C=Math.max(0,e.syncOffset(t));(k-=(k-C)%v)<t.byteLength&&!s&&(this.remainderData=new Uint8Array(t.buffer,k,t.buffer.byteLength-k));for(var O=0,P=C;P<k;P+=v)if(71===t[P]){var x=!!(64&t[P+1]),M=y(t,P),N=void 0;if((48&t[P+3])>>4>1){if((N=P+5+t[P+4])===P+v)continue}else N=P+4;switch(M){case m:x&&(b&&(o=T(b))&&this.parseAVCPES(u,g,o,!1),b={data:[],size:0}),b&&(b.data.push(t.subarray(N,P+v)),b.size+=P+v-N);break;case S:if(x){if(A&&(o=T(A)))switch(h.segmentCodec){case"aac":this.parseAACPES(h,o);break;case"mp3":this.parseMPEGPES(h,o)}A={data:[],size:0}}A&&(A.data.push(t.subarray(N,P+v)),A.size+=P+v-N);break;case R:x&&(w&&(o=T(w))&&this.parseID3PES(p,o),w={data:[],size:0}),w&&(w.data.push(t.subarray(N,P+v)),w.size+=P+v-N);break;case 0:x&&(N+=t[N]+1),L=this._pmtId=E(t,N);break;case L:x&&(N+=t[N]+1);var F=_(t,N,this.typeSupported,a);(m=F.avc)>0&&(u.pid=m),(S=F.audio)>0&&(h.pid=S,h.segmentCodec=F.segmentCodec),(R=F.id3)>0&&(p.pid=R),null===I||D||(d.logger.warn("MPEG-TS PMT found at "+P+" after unknown PID '"+I+"'. Backtracking to sync byte @"+C+" to parse all TS packets."),I=null,P=C-188),D=this.pmtParsed=!0;break;case 17:case 8191:break;default:I=M}}else O++;O>0&&this.observer.emit(l.Events.ERROR,l.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+O+" TS packet/s that do not start with 0x47"}),u.pesData=b,h.pesData=A,p.pesData=w;var U={audioTrack:h,videoTrack:u,id3Track:p,textTrack:g};return s&&this.extractRemainingSamples(U),U},t.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},t.extractRemainingSamples=function(e){var t,i=e.audioTrack,a=e.videoTrack,s=e.id3Track,o=e.textTrack,u=a.pesData,l=i.pesData,c=s.pesData;if(u&&(t=T(u))?(this.parseAVCPES(a,o,t,!0),a.pesData=null):a.pesData=u,l&&(t=T(l))){switch(i.segmentCodec){case"aac":this.parseAACPES(i,t);break;case"mp3":this.parseMPEGPES(i,t)}i.pesData=null}else null!=l&&l.size&&d.logger.log("last AAC PES packet truncated,might overlap between fragments"),i.pesData=l;c&&(t=T(c))?(this.parseID3PES(s,t),s.pesData=null):s.pesData=c},t.demuxSampleAes=function(e,t,i){var a=this.demux(e,i,!0,!this.config.progressive),s=this.sampleAes=new u.default(this.observer,this.config,t);return this.decrypt(a,s)},t.decrypt=function(e,t){return new Promise((function(i){var a=e.audioTrack,s=e.videoTrack;a.samples&&"aac"===a.segmentCodec?t.decryptAacSamples(a.samples,0,(function(){s.samples?t.decryptAvcSamples(s.samples,0,0,(function(){i(e)})):i(e)})):s.samples&&t.decryptAvcSamples(s.samples,0,0,(function(){i(e)}))}))},t.destroy=function(){this._duration=0},t.parseAVCPES=function(e,t,i,a){var s,u=this,l=this.parseAVCNALu(e,i.data),d=this.avcSample,f=!1;i.data=null,d&&l.length&&!e.audFound&&(b(d,e),d=this.avcSample=m(!1,i.pts,i.dts,"")),l.forEach((function(a){switch(a.type){case 1:s=!0,d||(d=u.avcSample=m(!0,i.pts,i.dts,"")),d.frame=!0;var l=a.data;if(f&&l.length>4){var h=new o.default(l).readSliceType();2!==h&&4!==h&&7!==h&&9!==h||(d.key=!0)}break;case 5:s=!0,d||(d=u.avcSample=m(!0,i.pts,i.dts,"")),d.key=!0,d.frame=!0;break;case 6:s=!0,(0,c.parseSEIMessageFromNALu)(a.data,1,i.pts,t.samples);break;case 7:if(s=!0,f=!0,!e.sps){var p=new o.default(a.data).readSPS();e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[a.data],e.duration=u._duration;for(var v=a.data.subarray(1,4),g="avc1.",y=0;y<3;y++){var E=v[y].toString(16);E.length<2&&(E="0"+E),g+=E}e.codec=g}break;case 8:s=!0,e.pps||(e.pps=[a.data]);break;case 9:s=!1,e.audFound=!0,d&&b(d,e),d=u.avcSample=m(!1,i.pts,i.dts,"");break;case 12:s=!0;break;default:s=!1,d&&(d.debug+="unknown NAL "+a.type+" ")}d&&s&&d.units.push(a)})),a&&d&&(b(d,e),this.avcSample=null)},t.getLastNalUnit=function(e){var t,i,a=this.avcSample;if(a&&0!==a.units.length||(a=e[e.length-1]),null!==(t=a)&&void 0!==t&&t.units){var s=a.units;i=s[s.length-1]}return i},t.parseAVCNALu=function(e,t){var i,a,s=t.byteLength,o=e.naluState||0,u=o,l=[],c=0,d=-1,f=0;for(-1===o&&(d=0,f=31&t[0],o=0,c=1);c<s;)if(i=t[c++],o)if(1!==o)if(i)if(1===i){if(d>=0){var h={data:t.subarray(d,c-o-1),type:f};l.push(h)}else{var p=this.getLastNalUnit(e.samples);if(p&&(u&&c<=4-u&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-u)),(a=c-o-1)>0)){var v=new Uint8Array(p.data.byteLength+a);v.set(p.data,0),v.set(t.subarray(0,a),p.data.byteLength),p.data=v,p.state=0}}c<s?(d=c,f=31&t[c],o=0):o=-1}else o=0;else o=3;else o=i?0:2;else o=i?0:1;if(d>=0&&o>=0){var g={data:t.subarray(d,s),type:f,state:o};l.push(g)}if(0===l.length){var m=this.getLastNalUnit(e.samples);if(m){var y=new Uint8Array(m.data.byteLength+t.byteLength);y.set(m.data,0),y.set(t,m.data.byteLength),m.data=y}}return e.naluState=o,l},t.parseAACPES=function(e,t){var i,s,o,u,c,h=0,p=this.aacOverFlow,v=t.data;if(p){this.aacOverFlow=null;var g=p.missing,m=p.sample.unit.byteLength;if(-1===g){var y=new Uint8Array(m+v.byteLength);y.set(p.sample.unit,0),y.set(v,m),v=y}else{var E=m-g;p.sample.unit.set(v.subarray(0,g),E),e.samples.push(p.sample),h=p.missing}}for(i=h,s=v.length;i<s-1&&!a.isHeader(v,i);i++);if(i===h||(i<s-1?(o="AAC PES did not start with ADTS header,offset:"+i,u=!1):(o="no ADTS header found in AAC PES",u=!0),d.logger.warn("parsing error:"+o),this.observer.emit(l.Events.ERROR,l.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:u,reason:o}),!u)){if(a.initTrackConfig(e,this.observer,v,i,this.audioCodec),void 0!==t.pts)c=t.pts;else{if(!p)return void d.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var _=a.getFrameDuration(e.samplerate);c=p.sample.pts+_}for(var T,b=0;i<s;){if(i+=(T=a.appendFrame(e,v,i,c,b)).length,T.missing){this.aacOverFlow=T;break}for(b++;i<s-1&&!a.isHeader(v,i);i++);}}},t.parseMPEGPES=function(e,t){var i=t.data,a=i.length,o=0,u=0,l=t.pts;if(void 0!==l)for(;u<a;)if(s.isHeader(i,u)){var c=s.appendFrame(e,i,u,l,o);if(!c)break;u+=c.length,o++}else u++;else d.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(e,t){if(void 0!==t.pts){var i=p({},t,{type:this._avcTrack?h.MetadataSchema.emsg:h.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}else d.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function m(e,t,i,a){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:a,length:0}}function y(e,t){return((31&e[t+1])<<8)+e[t+2]}function E(e,t){return(31&e[t+10])<<8|e[t+11]}function _(e,t,i,a){var s={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){var u=y(e,t);switch(e[t]){case 207:if(!a){d.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===s.audio&&(s.audio=u);break;case 21:-1===s.id3&&(s.id3=u);break;case 219:if(!a){d.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===s.avc&&(s.avc=u);break;case 3:case 4:!0!==i.mpeg&&!0!==i.mp3?d.logger.log("MPEG audio found, not supported in this browser"):-1===s.audio&&(s.audio=u,s.segmentCodec="mp3");break;case 36:d.logger.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return s}function T(e){var t,i,a,s,o,u=0,l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;){var c=new Uint8Array(l[0].length+l[1].length);c.set(l[0]),c.set(l[1],l[0].length),l[0]=c,l.splice(1,1)}if(1===((t=l[0])[0]<<16)+(t[1]<<8)+t[2]){if((i=(t[4]<<8)+t[5])&&i>e.size-6)return null;var f=t[7];192&f&&(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&f?s-(o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(d.logger.warn(Math.round((s-o)/9e4)+"s delta between PTS and DTS, align them"),s=o):o=s);var h=(a=t[8])+9;if(e.size<=h)return null;e.size-=h;for(var p=new Uint8Array(e.size),v=0,g=l.length;v<g;v++){var m=(t=l[v]).byteLength;if(h){if(h>m){h-=m;continue}t=t.subarray(h),m-=h,h=0}p.set(t,u),u+=m}return i&&(i-=a+3),{data:p,pts:s,dts:o,len:i}}return null}function b(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var i=t.samples,a=i.length;if(!a)return void t.dropped++;var s=i[a-1];e.pts=s.pts,e.dts=s.dts}t.samples.push(e)}e.debug.length&&d.logger.log(e.pts+"/"+e.dts+":"+e.debug)}const S=g},"./src/demux/webworkify-webpack.js":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>f});var a=function(){var e=ENTRY_MODULE,t={},i=function i(a){var s=t[a];if(void 0!==s)return s.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,i),o.exports};i.m=e,i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a=i(ENTRY_MODULE);return a.default||a}.toString().split("ENTRY_MODULE"),s="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+s+").*?\\)";function u(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function l(e,t,a){var l={};l[a]=[];var c=t.toString().replace(/^"[^"]+"/,"function"),d=c.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||c.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!d)return l;for(var f,h=d[1],p=new RegExp("(\\\\n|\\W)"+u(h)+o,"g");f=p.exec(c);)"dll-reference"!==f[3]&&l[a].push(f[3]);for(p=new RegExp("\\("+u(h)+'\\("(dll-reference\\s('+s+'))"\\)\\)'+o,"g");f=p.exec(c);)e[f[2]]||(l[a].push(f[1]),e[f[2]]=i(f[1]).m),l[f[2]]=l[f[2]]||[],l[f[2]].push(f[4]);for(var v,g=Object.keys(l),m=0;m<g.length;m++)for(var y=0;y<l[g[m]].length;y++)v=l[g[m]][y],isNaN(1*v)||(l[g[m]][y]=1*l[g[m]][y]);return l}function c(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}function d(e,t,i,s){var o=e[s].map((function(e){return'"'+e+'": '+t[s][e].toString().replace(/^"[^"]+"/,"function")})).join(",");return a[0]+"{"+o+"}"+a[1]+'"'+i+'"'+a[2]}function f(e,t){t=t||{};var a={main:i.m},s=t.all?{main:Object.keys(a.main)}:function(e,t){for(var i={main:[t]},a={main:[]},s={main:{}};c(i);)for(var o=Object.keys(i),u=0;u<o.length;u++){var d=o[u],f=i[d].pop();if(s[d]=s[d]||{},!s[d][f]&&e[d][f]){s[d][f]=!0,a[d]=a[d]||[],a[d].push(f);for(var h=l(e,e[d][f],d),p=Object.keys(h),v=0;v<p.length;v++)i[p[v]]=i[p[v]]||[],i[p[v]]=i[p[v]].concat(h[p[v]])}}return a}(a,e),o="";Object.keys(s).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;s[e][t];)t++;s[e].push(t),a[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+e+" = ("+d(s,a,t,modules)+")();\n"})),o=o+"new (("+d(s,a,e,"main")+")())(self);";var u=new window.Blob([o],{type:"text/javascript"}),f=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),h=new window.Worker(f);return h.objectURL=f,h}},"./src/errors.ts":(e,t,i)=>{"use strict";var a,s;i.r(t),i.d(t,{ErrorDetails:()=>s,ErrorTypes:()=>a}),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError"}(a||(a={})),function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown"}(s||(s={}))},"./src/events.ts":(e,t,i)=>{"use strict";var a;i.r(t),i.d(t,{Events:()=>a}),function(e){e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached"}(a||(a={}))},"./src/hls.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>T});var a=i("./node_modules/url-toolkit/src/url-toolkit.js"),s=i("./src/loader/playlist-loader.ts"),o=i("./src/controller/id3-track-controller.ts"),u=i("./src/controller/latency-controller.ts"),l=i("./src/controller/level-controller.ts"),c=i("./src/controller/fragment-tracker.ts"),d=i("./src/loader/key-loader.ts"),f=i("./src/controller/stream-controller.ts"),h=i("./src/is-supported.ts"),p=i("./src/utils/logger.ts"),v=i("./src/config.ts"),g=i("./node_modules/eventemitter3/index.js"),m=i("./src/events.ts"),y=i("./src/errors.ts"),E=i("./src/types/level.ts");function _(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}var T=function(){function e(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new g.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var i=this.config=(0,v.mergeConfig)(e.DefaultConfig,t);this.userConfig=t,(0,p.enableLogs)(i.debug,"Hls instance"),this._autoLevelCapping=-1,i.progressive&&(0,v.enableStreamingMode)(i);var a=i.abrController,h=i.bufferController,m=i.capLevelController,y=i.fpsController,E=this.abrController=new a(this),_=this.bufferController=new h(this),T=this.capLevelController=new m(this),b=new y(this),S=new s.default(this),R=new o.default(this),A=this.levelController=new l.default(this),w=new c.FragmentTracker(this),I=new d.default(this.config),D=this.streamController=new f.default(this,w,I);T.setStreamController(D),b.setStreamController(D);var L=[S,A,D];this.networkControllers=L;var k=[E,_,T,b,R,w];this.audioTrackController=this.createController(i.audioTrackController,L);var C=i.audioStreamController;C&&L.push(new C(this,w,I)),this.subtitleTrackController=this.createController(i.subtitleTrackController,L);var O=i.subtitleStreamController;O&&L.push(new O(this,w,I)),this.createController(i.timelineController,k),I.emeController=this.emeController=this.createController(i.emeController,k),this.cmcdController=this.createController(i.cmcdController,k),this.latencyController=this.createController(u.default,k),this.coreComponents=k}e.isSupported=function(){return(0,h.isSupported)()};var t,i,T,b=e.prototype;return b.createController=function(e,t){if(e){var i=new e(this);return t&&t.push(i),i}return null},b.on=function(e,t,i){void 0===i&&(i=this),this._emitter.on(e,t,i)},b.once=function(e,t,i){void 0===i&&(i=this),this._emitter.once(e,t,i)},b.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},b.off=function(e,t,i,a){void 0===i&&(i=this),this._emitter.off(e,t,i,a)},b.listeners=function(e){return this._emitter.listeners(e)},b.emit=function(e,t,i){return this._emitter.emit(e,t,i)},b.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){p.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.trigger(m.Events.ERROR,{type:y.ErrorTypes.OTHER_ERROR,details:y.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,error:t})}return!1},b.listenerCount=function(e){return this._emitter.listenerCount(e)},b.destroy=function(){p.logger.log("destroy"),this.trigger(m.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0},b.attachMedia=function(e){p.logger.log("attachMedia"),this._media=e,this.trigger(m.Events.MEDIA_ATTACHING,{media:e})},b.detachMedia=function(){p.logger.log("detachMedia"),this.trigger(m.Events.MEDIA_DETACHING,void 0),this._media=null},b.loadSource=function(e){this.stopLoad();var t=this.media,i=this.url,s=this.url=a.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});p.logger.log("loadSource:"+s),t&&i&&i!==s&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(m.Events.MANIFEST_LOADING,{url:e})},b.startLoad=function(e){void 0===e&&(e=-1),p.logger.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},b.stopLoad=function(){p.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},b.swapAudioCodec=function(){p.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},b.recoverMediaError=function(){p.logger.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},b.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},t=e,i=[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){p.logger.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){p.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){p.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){p.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){p.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(p.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){E.HdcpLevels.indexOf(e)>-1&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var i=e.length,a=0;a<i;a++)if(e[a].maxBitrate>=t)return a;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,i=this.autoLevelCapping,a=this.maxHdcpLevel;if(e=-1===i&&t&&t.length?t.length-1:i,a)for(var s=e;s--;){var o=t[s].attrs["HDCP-LEVEL"];if(o&&o<=a)return s}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],T=[{key:"version",get:function(){return"$VER_NAME"}},{key:"Events",get:function(){return m.Events}},{key:"ErrorTypes",get:function(){return y.ErrorTypes}},{key:"ErrorDetails",get:function(){return y.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:v.hlsDefaultConfig},set:function(t){e.defaultConfig=t}}],i&&_(t.prototype,i),T&&_(t,T),Object.defineProperty(t,"prototype",{writable:!1}),e}();T.defaultConfig=void 0},"./src/is-supported.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{changeTypeSupported:()=>u,isSupported:()=>o});var a=i("./src/utils/mediasource-helper.ts");function s(){return self.SourceBuffer||self.WebKitSourceBuffer}function o(){var e=(0,a.getMediaSource)();if(!e)return!1;var t=s(),i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),o=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!i&&!!o}function u(){var e,t=s();return"function"==typeof(null==t||null===(e=t.prototype)||void 0===e?void 0:e.changeType)}},"./src/loader/date-range.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{DateRange:()=>d,DateRangeAttribute:()=>a});var a,s=i("./src/polyfills/number.ts"),o=i("./src/utils/attr-list.ts"),u=i("./src/utils/logger.ts");function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},l.apply(this,arguments)}function c(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}!function(e){e.ID="ID",e.CLASS="CLASS",e.START_DATE="START-DATE",e.DURATION="DURATION",e.END_DATE="END-DATE",e.END_ON_NEXT="END-ON-NEXT",e.PLANNED_DURATION="PLANNED-DURATION",e.SCTE35_OUT="SCTE35-OUT",e.SCTE35_IN="SCTE35-IN"}(a||(a={}));var d=function(){function e(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){var i=t.attr;for(var c in i)if(Object.prototype.hasOwnProperty.call(e,c)&&e[c]!==i[c]){u.logger.warn('DATERANGE tag attribute: "'+c+'" does not match for tags with ID: "'+e.ID+'"'),this._badValueForSameId=c;break}e=l(new o.AttrList({}),i,e)}if(this.attr=e,this._startDate=new Date(e[a.START_DATE]),a.END_DATE in this.attr){var d=new Date(this.attr[a.END_DATE]);(0,s.isFiniteNumber)(d.getTime())&&(this._endDate=d)}}var t,i,d;return t=e,(i=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}},{key:"duration",get:function(){if(a.DURATION in this.attr){var e=this.attr.decimalFloatingPoint(a.DURATION);if((0,s.isFiniteNumber)(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return a.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(a.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(a.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,s.isFiniteNumber)(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&c(t.prototype,i),d&&c(t,d),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./src/loader/fragment-loader.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{LoadError:()=>p,default:()=>f});var a=i("./src/polyfills/number.ts"),s=i("./src/errors.ts");function o(e){var t="function"==typeof Map?new Map:void 0;return o=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return u(e,arguments,c(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),l(a,e)},o(e)}function u(e,t,i){return u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,i){var a=[null];a.push.apply(a,t);var s=new(Function.bind.apply(e,a));return i&&l(s,i.prototype),s},u.apply(null,arguments)}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var d=Math.pow(2,17),f=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var t=e.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,t){var i=this,a=e.url;if(!a)return Promise.reject(new p({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(a?"part list":"url")));this.abort();var o=this.config,u=o.fLoader,l=o.loader;return new Promise((function(a,c){i.loader&&i.loader.destroy();var f=i.loader=e.loader=u?new u(o):new l(o),v=h(e),g={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:"initSegment"===e.sn?1/0:d};e.stats=f.stats,f.load(v,g,{onSuccess:function(t,s,o,u){i.resetLoader(e,f);var l=t.data;o.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(l.slice(0,16)),l=l.slice(16)),a({frag:e,part:null,payload:l,networkDetails:u})},onError:function(t,a,o){i.resetLoader(e,f),c(new p({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:t,networkDetails:o}))},onAbort:function(t,a,o){i.resetLoader(e,f),c(new p({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:o}))},onTimeout:function(t,a,o){i.resetLoader(e,f),c(new p({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:o}))},onProgress:function(i,a,s,o){t&&t({frag:e,part:null,payload:s,networkDetails:o})}})}))},t.loadPart=function(e,t,i){var a=this;this.abort();var o=this.config,u=o.fLoader,l=o.loader;return new Promise((function(c,f){a.loader&&a.loader.destroy();var v=a.loader=e.loader=u?new u(o):new l(o),g=h(e,t),m={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:d};t.stats=v.stats,v.load(g,m,{onSuccess:function(s,o,u,l){a.resetLoader(e,v),a.updateStatsFromPart(e,t);var d={frag:e,part:t,payload:s.data,networkDetails:l};i(d),c(d)},onError:function(i,o,u){a.resetLoader(e,v),f(new p({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:i,networkDetails:u}))},onAbort:function(i,o,u){e.stats.aborted=t.stats.aborted,a.resetLoader(e,v),f(new p({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:u}))},onTimeout:function(i,o,u){a.resetLoader(e,v),f(new p({type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:u}))}})}))},t.updateStatsFromPart=function(e,t){var i=e.stats,a=t.stats,s=a.total;if(i.loaded+=a.loaded,s){var o=Math.round(e.duration/t.duration),u=Math.min(Math.round(i.loaded/s),o),l=(o-u)*Math.round(i.loaded/u);i.total=i.loaded+l}else i.total=Math.max(i.loaded,i.total);var c=i.loading,d=a.loading;c.start?c.first+=d.first-d.start:(c.start=d.start,c.first=d.first),c.end=d.end},t.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},e}();function h(e,t){void 0===t&&(t=null);var i=t||e,s={frag:e,part:t,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},o=i.byteRangeStartOffset,u=i.byteRangeEndOffset;if((0,a.isFiniteNumber)(o)&&(0,a.isFiniteNumber)(u)){var l,c=o,d=u;if("initSegment"===e.sn&&"AES-128"===(null===(l=e.decryptdata)||void 0===l?void 0:l.method)){var f=u-o;f%16&&(d=u+(16-f%16)),0!==o&&(s.resetIV=!0,c=o-16)}s.rangeStart=c,s.rangeEnd=d}return s}var p=function(e){var t,i;function a(t){for(var i,a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];return(i=e.call.apply(e,[this].concat(s))||this).data=void 0,i.data=t,i}return i=e,(t=a).prototype=Object.create(i.prototype),t.prototype.constructor=t,l(t,i),a}(o(Error))},"./src/loader/fragment.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{BaseSegment:()=>h,ElementaryStreamTypes:()=>a,Fragment:()=>p,Part:()=>v});var a,s=i("./src/polyfills/number.ts"),o=i("./node_modules/url-toolkit/src/url-toolkit.js"),u=i("./src/loader/load-stats.ts");function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function d(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}function f(e,t,i){return t&&d(e.prototype,t),i&&d(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(e){e.AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo"}(a||(a={}));var h=function(){function e(e){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((t={})[a.AUDIO]=null,t[a.VIDEO]=null,t[a.AUDIOVIDEO]=null,t),this.baseurl=e}return e.prototype.setByteRange=function(e,t){var i=e.split("@",2),a=[];1===i.length?a[0]=t?t.byteRangeEndOffset:0:a[0]=parseInt(i[1]),a[1]=parseInt(i[0])+a[0],this._byteRange=a},f(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,o.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),p=function(e){function t(t,i){var a;return(a=e.call(this,i)||this)._decryptdata=null,a.rawProgramDateTime=null,a.programDateTime=null,a.tagList=[],a.duration=0,a.sn=0,a.levelkeys=void 0,a.type=void 0,a.loader=null,a.keyLoader=null,a.level=-1,a.cc=0,a.startPTS=void 0,a.endPTS=void 0,a.appendedPTS=void 0,a.startDTS=void 0,a.endDTS=void 0,a.start=0,a.deltaPTS=void 0,a.maxStartPTS=void 0,a.minEndPTS=void 0,a.stats=new u.LoadStats,a.urlId=0,a.data=void 0,a.bitrateTest=!1,a.title=null,a.initSegment=null,a.endList=void 0,a.type=t,a}l(t,e);var i=t.prototype;return i.setKeyFormat=function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}},i.abortRequests=function(){var e,t;null===(e=this.loader)||void 0===e||e.abort(),null===(t=this.keyLoader)||void 0===t||t.abort()},i.setElementaryStreamInfo=function(e,t,i,a,s,o){void 0===o&&(o=!1);var u=this.elementaryStreams,l=u[e];l?(l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,a),l.endDTS=Math.max(l.endDTS,s)):u[e]={startPTS:t,endPTS:i,startDTS:a,endDTS:s,partial:o}},i.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[a.AUDIO]=null,e[a.VIDEO]=null,e[a.AUDIOVIDEO]=null},f(t,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{var t=Object.keys(this.levelkeys);if(1===t.length)return this._decryptdata=this.levelkeys[t[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!(0,s.isFiniteNumber)(this.programDateTime))return null;var e=(0,s.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;if(null!==(e=this._decryptdata)&&void 0!==e&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),i=t.length;if(i>1||1===i&&this.levelkeys[t[0]].encrypted)return!0}return!1}}]),t}(h),v=function(e){function t(t,i,a,s,o){var l;(l=e.call(this,a)||this).fragOffset=0,l.duration=0,l.gap=!1,l.independent=!1,l.relurl=void 0,l.fragment=void 0,l.index=void 0,l.stats=new u.LoadStats,l.duration=t.decimalFloatingPoint("DURATION"),l.gap=t.bool("GAP"),l.independent=t.bool("INDEPENDENT"),l.relurl=t.enumeratedString("URI"),l.fragment=i,l.index=s;var c=t.enumeratedString("BYTERANGE");return c&&l.setByteRange(c,o),o&&(l.fragOffset=o.fragOffset+o.duration),l}return l(t,e),f(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(h)},"./src/loader/key-loader.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var a=i("./src/errors.ts"),s=i("./src/loader/fragment-loader.ts"),o=function(){function e(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var t=e.prototype;return t.abort=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.abort()}},t.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},t.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},t.createKeyLoadError=function(e,t,i,o){return void 0===t&&(t=a.ErrorDetails.KEY_LOAD_ERROR),new s.LoadError({type:a.ErrorTypes.NETWORK_ERROR,details:t,fatal:!1,frag:e,networkDetails:i})},t.loadClear=function(e,t){var i=this;if(this.emeController&&this.config.emeEnabled)for(var a=e.sn,s=e.cc,o=function(e){var o=t[e];if(s<=o.cc&&("initSegment"===a||a<o.sn))return i.emeController.selectKeySystemFormat(o).then((function(e){o.setKeyFormat(e)})),"break"},u=0;u<t.length&&"break"!==o(u);u++);},t.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((function(i){return t.loadInternal(e,i)})):this.loadInternal(e)},t.loadInternal=function(e,t){var i,s;t&&e.setKeyFormat(t);var o=e.decryptdata;if(!o){var u=t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(e,a.ErrorDetails.KEY_LOAD_ERROR,null,u))}var l=o.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,a.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+l+'"'));var c,d=this.keyUriToKeyInfo[l];if(null!==(i=d)&&void 0!==i&&i.decryptdata.key)return o.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if(null!==(s=d)&&void 0!==s&&s.keyLoadPromise)switch(null===(c=d.mediaKeySessionContext)||void 0===c?void 0:c.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return d.keyLoadPromise.then((function(t){return o.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:d}}))}switch(d=this.keyUriToKeyInfo[l]={decryptdata:o,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},o.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===o.keyFormat?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,a.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+o.method+'"'))}},t.loadKeyEME=function(e,t){var i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var a=this.emeController.loadKey(i);if(a)return(e.keyLoadPromise=a.then((function(t){return e.mediaKeySessionContext=t,i}))).catch((function(t){throw e.keyLoadPromise=null,t}))}return Promise.resolve(i)},t.loadKeyHTTP=function(e,t){var i=this,s=this.config,o=new(0,s.loader)(s);return t.keyLoader=e.loader=o,e.keyLoadPromise=new Promise((function(u,l){var c={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:0},f={onSuccess:function(e,t,s,o){var c=s.frag,d=s.keyInfo,f=s.url;if(!c.decryptdata||d!==i.keyUriToKeyInfo[f])return l(i.createKeyLoadError(c,a.ErrorDetails.KEY_LOAD_ERROR,o,"after key load, decryptdata unset or changed"));d.decryptdata.key=c.decryptdata.key=new Uint8Array(e.data),c.keyLoader=null,d.loader=null,u({frag:c,keyInfo:d})},onError:function(e,s,o){i.resetLoader(s),l(i.createKeyLoadError(t,a.ErrorDetails.KEY_LOAD_ERROR,o))},onTimeout:function(e,s,o){i.resetLoader(s),l(i.createKeyLoadError(t,a.ErrorDetails.KEY_LOAD_TIMEOUT,o))},onAbort:function(e,s,o){i.resetLoader(s),l(i.createKeyLoadError(t,a.ErrorDetails.INTERNAL_ABORTED,o))}};o.load(c,d,f)}))},t.resetLoader=function(e){var t=e.frag,i=e.keyInfo,a=e.url,s=i.loader;t.keyLoader===s&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[a],s&&s.destroy()},e}()},"./src/loader/level-details.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{LevelDetails:()=>o});var a=i("./src/polyfills/number.ts");function s(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}var o=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}var t,i,o;return e.prototype.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&i>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},t=e,(i=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,a.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!==(e=this.fragments)&&void 0!==e&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&s(t.prototype,i),o&&s(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./src/loader/level-key.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{LevelKey:()=>d});var a=i("./src/utils/keysystem-util.ts"),s=i("./src/utils/mediakeys-helper.ts"),o=i("./src/utils/mp4-tools.ts"),u=i("./src/utils/logger.ts"),l=i("./src/utils/numeric-encoding-utils.ts"),c={},d=function(){function e(e,t,i,a,s){void 0===a&&(a=[1]),void 0===s&&(s=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=a,this.iv=s,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}e.clearKeyUriToKeyIdMap=function(){c={}};var t=e.prototype;return t.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;switch(this.keyFormat){case"identity":return"SAMPLE-AES"===this.method;case s.KeySystemFormats.FAIRPLAY:case s.KeySystemFormats.WIDEVINE:case s.KeySystemFormats.PLAYREADY:case s.KeySystemFormats.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1},t.getDecryptData=function(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof t&&("AES-128"!==this.method||this.iv||u.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),t=0);var i=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}(t);return new e(this.method,this.uri,"identity",this.keyFormatVersions,i)}var d=(0,a.convertDataUriToArrayBytes)(this.uri);if(d)switch(this.keyFormat){case s.KeySystemFormats.WIDEVINE:this.pssh=d,d.length>=22&&(this.keyId=d.subarray(d.length-22,d.length-6));break;case s.KeySystemFormats.PLAYREADY:var f=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,o.mp4pssh)(f,null,d);var h=new Uint16Array(d.buffer,d.byteOffset,d.byteLength/2),p=String.fromCharCode.apply(null,Array.from(h)),v=p.substring(p.indexOf("<"),p.length),g=(new DOMParser).parseFromString(v,"text/xml").getElementsByTagName("KID")[0];if(g){var m=g.childNodes[0]?g.childNodes[0].nodeValue:g.getAttribute("VALUE");if(m){var y=(0,l.base64Decode)(m).subarray(0,16);(0,a.changeEndianness)(y),this.keyId=y}}break;default:var E=d.subarray(0,16);if(16!==E.length){var _=new Uint8Array(16);_.set(E,16-E.length),E=_}this.keyId=E}if(!this.keyId||16!==this.keyId.byteLength){var T=c[this.uri];if(!T){var b=Object.keys(c).length%Number.MAX_SAFE_INTEGER;T=new Uint8Array(16),new DataView(T.buffer,12,4).setUint32(0,b),c[this.uri]=T}this.keyId=T}return this},e}()},"./src/loader/load-stats.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{LoadStats:()=>a});var a=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>E});var a=i("./src/polyfills/number.ts"),s=i("./node_modules/url-toolkit/src/url-toolkit.js"),o=i("./src/loader/date-range.ts"),u=i("./src/loader/fragment.ts"),l=i("./src/loader/level-details.ts"),c=i("./src/loader/level-key.ts"),d=i("./src/utils/attr-list.ts"),f=i("./src/utils/logger.ts"),h=i("./src/utils/codecs.ts");function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},p.apply(this,arguments)}var v=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,g=/#EXT-X-MEDIA:(.*)/g,m=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),y=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),E=function(){function e(){}return e.findGroup=function(e,t){for(var i=0;i<e.length;i++){var a=e[i];if(a.id===t)return a}},e.convertAVC1ToAVCOTI=function(e){var t=e.split(".");if(t.length>2){var i=t.shift()+".";return i+=parseInt(t.shift()).toString(16),i+=("000"+parseInt(t.shift()).toString(16)).slice(-4)}return e},e.resolve=function(e,t){return(0,s.buildAbsoluteURL)(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,i){var a,s=[],o=[],u={},l=[],c=!1;for(v.lastIndex=0;null!=(a=v.exec(t));)if(a[1]){var h,p=new d.AttrList(a[1]),g={attrs:p,bitrate:p.decimalInteger("AVERAGE-BANDWIDTH")||p.decimalInteger("BANDWIDTH"),name:p.NAME,url:e.resolve(a[2],i)},m=p.decimalResolution("RESOLUTION");m&&(g.width=m.width,g.height=m.height),T((p.CODECS||"").split(/[ ,]+/).filter((function(e){return e})),g),g.videoCodec&&-1!==g.videoCodec.indexOf("avc1")&&(g.videoCodec=e.convertAVC1ToAVCOTI(g.videoCodec)),null!==(h=g.unknownCodecs)&&void 0!==h&&h.length||o.push(g),s.push(g)}else if(a[3]){var y=new d.AttrList(a[3]);y["DATA-ID"]&&(c=!0,u[y["DATA-ID"]]=y)}else if(a[4]){var E=a[4],b=_(E,i);b.encrypted&&b.isSupported()?l.push(b):f.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+E+'"')}return{levels:o.length>0&&o.length<s.length?o:s,sessionData:c?u:null,sessionKeys:l.length?l:null}},e.parseMasterPlaylistMedia=function(t,i,a,s){var o;void 0===s&&(s=[]);var u=[],l=0;for(g.lastIndex=0;null!==(o=g.exec(t));){var c=new d.AttrList(o[1]);if(c.TYPE===a){var f={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:a,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?e.resolve(c.URI,i):""};if(s.length){var h=e.findGroup(s,f.groupId)||s[0];b(f,h,"audioCodec"),b(f,h,"textCodec")}u.push(f)}}return u},e.parseLevelPlaylist=function(e,t,i,s,c){var h,v,g,E=new l.LevelDetails(t),T=E.fragments,b=null,w=0,I=0,D=0,L=0,k=null,C=new u.Fragment(s,t),O=-1,P=!1;for(m.lastIndex=0,E.m3u8=e;null!==(h=m.exec(e));){P&&(P=!1,(C=new u.Fragment(s,t)).start=D,C.sn=w,C.cc=L,C.level=i,b&&(C.initSegment=b,C.rawProgramDateTime=b.rawProgramDateTime,b.rawProgramDateTime=null));var x=h[1];if(x){C.duration=parseFloat(x);var M=(" "+h[2]).slice(1);C.title=M||null,C.tagList.push(M?["INF",x,M]:["INF",x])}else if(h[3])(0,a.isFiniteNumber)(C.duration)&&(C.start=D,g&&A(C,g,E),C.sn=w,C.level=i,C.cc=L,C.urlId=c,T.push(C),C.relurl=(" "+h[3]).slice(1),S(C,k),k=C,D+=C.duration,w++,I=0,P=!0);else if(h[4]){var N=(" "+h[4]).slice(1);k?C.setByteRange(N,k):C.setByteRange(N)}else if(h[5])C.rawProgramDateTime=(" "+h[5]).slice(1),C.tagList.push(["PROGRAM-DATE-TIME",C.rawProgramDateTime]),-1===O&&(O=T.length);else{if(!(h=h[0].match(y))){f.logger.warn("No matches on slow regex match for level playlist!");continue}for(v=1;v<h.length&&void 0===h[v];v++);var F=(" "+h[v]).slice(1),U=(" "+h[v+1]).slice(1),B=h[v+2]?(" "+h[v+2]).slice(1):"";switch(F){case"PLAYLIST-TYPE":E.type=U.toUpperCase();break;case"MEDIA-SEQUENCE":w=E.startSN=parseInt(U);break;case"SKIP":var j=new d.AttrList(U),H=j.decimalInteger("SKIPPED-SEGMENTS");if((0,a.isFiniteNumber)(H)){E.skippedSegments=H;for(var G=H;G--;)T.unshift(null);w+=H}var K=j.enumeratedString("RECENTLY-REMOVED-DATERANGES");K&&(E.recentlyRemovedDateranges=K.split("\t"));break;case"TARGETDURATION":E.targetduration=parseFloat(U);break;case"VERSION":E.version=parseInt(U);break;case"EXTM3U":break;case"ENDLIST":E.live=!1;break;case"#":(U||B)&&C.tagList.push(B?[U,B]:[U]);break;case"DISCONTINUITY":L++,C.tagList.push(["DIS"]);break;case"GAP":C.tagList.push([F]);break;case"BITRATE":C.tagList.push([F,U]);break;case"DATERANGE":var V=new d.AttrList(U),q=new o.DateRange(V,E.dateRanges[V.ID]);q.isValid||E.skippedSegments?E.dateRanges[q.id]=q:f.logger.warn('Ignoring invalid DATERANGE tag: "'+U+'"'),C.tagList.push(["EXT-X-DATERANGE",U]);break;case"DISCONTINUITY-SEQUENCE":L=parseInt(U);break;case"KEY":var W=_(U,t);if(W.isSupported()){if("NONE"===W.method){g=void 0;break}g||(g={}),g[W.keyFormat]&&(g=p({},g)),g[W.keyFormat]=W}else f.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+U+'"');break;case"START":var Y=new d.AttrList(U).decimalFloatingPoint("TIME-OFFSET");(0,a.isFiniteNumber)(Y)&&(E.startTimeOffset=Y);break;case"MAP":var z=new d.AttrList(U);if(C.duration){var X=new u.Fragment(s,t);R(X,z,i,g),b=X,C.initSegment=b,b.rawProgramDateTime&&!C.rawProgramDateTime&&(C.rawProgramDateTime=b.rawProgramDateTime)}else R(C,z,i,g),b=C,P=!0;break;case"SERVER-CONTROL":var Q=new d.AttrList(U);E.canBlockReload=Q.bool("CAN-BLOCK-RELOAD"),E.canSkipUntil=Q.optionalFloat("CAN-SKIP-UNTIL",0),E.canSkipDateRanges=E.canSkipUntil>0&&Q.bool("CAN-SKIP-DATERANGES"),E.partHoldBack=Q.optionalFloat("PART-HOLD-BACK",0),E.holdBack=Q.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var $=new d.AttrList(U);E.partTarget=$.decimalFloatingPoint("PART-TARGET");break;case"PART":var J=E.partList;J||(J=E.partList=[]);var Z=I>0?J[J.length-1]:void 0,ee=I++,te=new u.Part(new d.AttrList(U),C,t,ee,Z);J.push(te),C.duration+=te.duration;break;case"PRELOAD-HINT":var re=new d.AttrList(U);E.preloadHint=re;break;case"RENDITION-REPORT":var ne=new d.AttrList(U);E.renditionReports=E.renditionReports||[],E.renditionReports.push(ne);break;default:f.logger.warn("line parsed but not handled: "+h)}}}k&&!k.relurl?(T.pop(),D-=k.duration,E.partList&&(E.fragmentHint=k)):E.partList&&(S(C,k),C.cc=L,E.fragmentHint=C,g&&A(C,g,E));var ie=T.length,ae=T[0],se=T[ie-1];if((D+=E.skippedSegments*E.targetduration)>0&&ie&&se){E.averagetargetduration=D/ie;var oe=se.sn;E.endSN="initSegment"!==oe?oe:0,E.live||(se.endList=!0),ae&&(E.startCC=ae.cc)}else E.endSN=0,E.startCC=0;return E.fragmentHint&&(D+=E.fragmentHint.duration),E.totalduration=D,E.endCC=L,O>0&&function(e,t){for(var i=e[t],a=t;a--;){var s=e[a];if(!s)return;s.programDateTime=i.programDateTime-1e3*s.duration,i=s}}(T,O),E},e}();function _(e,t){var i,a,s=new d.AttrList(e),o=null!=(i=s.enumeratedString("METHOD"))?i:"",u=s.URI,l=s.hexadecimalInteger("IV"),h=s.enumeratedString("KEYFORMATVERSIONS"),p=null!=(a=s.enumeratedString("KEYFORMAT"))?a:"identity";u&&s.IV&&!l&&f.logger.error("Invalid IV: "+s.IV);var v=u?E.resolve(u,t):"",g=(h||"1").split("/").map(Number).filter(Number.isFinite);return new c.LevelKey(o,v,p,g,l)}function T(e,t){["video","audio","text"].forEach((function(i){var a=e.filter((function(e){return(0,h.isCodecType)(e,i)}));if(a.length){var s=a.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[i+"Codec"]=s.length>0?s[0]:a[0],e=e.filter((function(e){return-1===a.indexOf(e)}))}})),t.unknownCodecs=e}function b(e,t,i){var a=t[i];a&&(e[i]=a)}function S(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),(0,a.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function R(e,t,i,a){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=i,e.sn="initSegment",a&&(e.levelkeys=a),e.initSegment=null}function A(e,t,i){e.levelkeys=t;var a=i.encryptedFragments;a.length&&a[a.length-1].levelkeys===t||!Object.keys(t).some((function(e){return t[e].isCommonEncryption}))||a.push(e)}},"./src/loader/playlist-loader.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var a=i("./src/polyfills/number.ts"),s=i("./src/events.ts"),o=i("./src/errors.ts"),u=i("./src/utils/logger.ts"),l=i("./src/loader/m3u8-parser.ts"),c=i("./src/types/loader.ts"),d=i("./src/utils/attr-list.ts");function f(e,t){var i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i}const h=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var t=e.prototype;return t.startLoad=function(e){},t.stopLoad=function(){this.destroyInternalLoaders()},t.registerListeners=function(){var e=this.hls;e.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(s.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(s.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(s.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var e=this.hls;e.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(s.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(s.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(s.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,a=t.loader,s=new(i||a)(t);return e.loader=s,this.loaders[e.type]=s,s},t.getInternalLoader=function(e){return this.loaders[e.type]},t.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(e,t){var i=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:c.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},t.onLevelLoading=function(e,t){var i=t.id,a=t.level,s=t.url,o=t.deliveryDirectives;this.load({id:i,groupId:null,level:a,responseType:"text",type:c.PlaylistContextType.LEVEL,url:s,deliveryDirectives:o})},t.onAudioTrackLoading=function(e,t){var i=t.id,a=t.groupId,s=t.url,o=t.deliveryDirectives;this.load({id:i,groupId:a,level:null,responseType:"text",type:c.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:o})},t.onSubtitleTrackLoading=function(e,t){var i=t.id,a=t.groupId,s=t.url,o=t.deliveryDirectives;this.load({id:i,groupId:a,level:null,responseType:"text",type:c.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:o})},t.load=function(e){var t,i,a,s,o,l,d=this.hls.config,f=this.getInternalLoader(e);if(f){var h=f.context;if(h&&h.url===e.url)return void u.logger.trace("[playlist-loader]: playlist request ongoing");u.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),f.abort()}switch(e.type){case c.PlaylistContextType.MANIFEST:i=d.manifestLoadingMaxRetry,a=d.manifestLoadingTimeOut,s=d.manifestLoadingRetryDelay,o=d.manifestLoadingMaxRetryTimeout;break;case c.PlaylistContextType.LEVEL:case c.PlaylistContextType.AUDIO_TRACK:case c.PlaylistContextType.SUBTITLE_TRACK:i=0,a=d.levelLoadingTimeOut;break;default:i=d.levelLoadingMaxRetry,a=d.levelLoadingTimeOut,s=d.levelLoadingRetryDelay,o=d.levelLoadingMaxRetryTimeout}if(f=this.createInternalLoader(e),null!==(t=e.deliveryDirectives)&&void 0!==t&&t.part&&(e.type===c.PlaylistContextType.LEVEL&&null!==e.level?l=this.hls.levels[e.level].details:e.type===c.PlaylistContextType.AUDIO_TRACK&&null!==e.id?l=this.hls.audioTracks[e.id].details:e.type===c.PlaylistContextType.SUBTITLE_TRACK&&null!==e.id&&(l=this.hls.subtitleTracks[e.id].details),l)){var p=l.partTarget,v=l.targetduration;p&&v&&(a=Math.min(1e3*Math.max(3*p,.8*v),a))}var g={timeout:a,maxRetry:i,retryDelay:s,maxRetryDelay:o,highWaterMark:0},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(e,g,m)},t.loadsuccess=function(e,t,i,a){void 0===a&&(a=null),this.resetInternalLoader(i.type);var s=e.data;0===s.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,i,a):this.handleMasterPlaylist(e,t,i,a)):this.handleManifestParsingError(e,i,"no EXTM3U delimiter",a)},t.loaderror=function(e,t,i){void 0===i&&(i=null),this.handleNetworkError(t,i,!1,e)},t.loadtimeout=function(e,t,i){void 0===i&&(i=null),this.handleNetworkError(t,i,!0)},t.handleMasterPlaylist=function(e,t,i,a){var o=this.hls,c=e.data,h=f(e,i),p=l.default.parseMasterPlaylist(c,h),v=p.levels,g=p.sessionData,m=p.sessionKeys;if(v.length){var y=v.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),E=v.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),_=l.default.parseMasterPlaylistMedia(c,h,"AUDIO",y),T=l.default.parseMasterPlaylistMedia(c,h,"SUBTITLES",E),b=l.default.parseMasterPlaylistMedia(c,h,"CLOSED-CAPTIONS");_.length&&(_.some((function(e){return!e.url}))||!v[0].audioCodec||v[0].attrs.AUDIO||(u.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),_.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new d.AttrList({}),bitrate:0,url:""}))),o.trigger(s.Events.MANIFEST_LOADED,{levels:v,audioTracks:_,subtitles:T,captions:b,url:h,stats:t,networkDetails:a,sessionData:g,sessionKeys:m})}else this.handleManifestParsingError(e,i,"no level found in manifest",a)},t.handleTrackOrLevelPlaylist=function(e,t,i,u){var h=this.hls,p=i.id,v=i.level,g=i.type,m=f(e,i),y=(0,a.isFiniteNumber)(p)?p:0,E=(0,a.isFiniteNumber)(v)?v:y,_=function(e){switch(e.type){case c.PlaylistContextType.AUDIO_TRACK:return c.PlaylistLevelType.AUDIO;case c.PlaylistContextType.SUBTITLE_TRACK:return c.PlaylistLevelType.SUBTITLE;default:return c.PlaylistLevelType.MAIN}}(i),T=l.default.parseLevelPlaylist(e.data,m,E,_,y);if(T.fragments.length){if(g===c.PlaylistContextType.MANIFEST){var b={attrs:new d.AttrList({}),bitrate:0,details:T,name:"",url:m};h.trigger(s.Events.MANIFEST_LOADED,{levels:[b],audioTracks:[],url:m,stats:t,networkDetails:u,sessionData:null,sessionKeys:null})}t.parsing.end=performance.now(),i.levelDetails=T,this.handlePlaylistLoaded(e,t,i,u)}else h.trigger(s.Events.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:m,reason:"no fragments found in level",level:"number"==typeof i.level?i.level:void 0})},t.handleManifestParsingError=function(e,t,i,a){this.hls.trigger(s.Events.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===c.PlaylistContextType.MANIFEST,url:e.url,reason:i,response:e,context:t,networkDetails:a})},t.handleNetworkError=function(e,t,i,a){void 0===i&&(i=!1),u.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var l=o.ErrorDetails.UNKNOWN,d=!1,f=this.getInternalLoader(e);switch(e.type){case c.PlaylistContextType.MANIFEST:l=i?o.ErrorDetails.MANIFEST_LOAD_TIMEOUT:o.ErrorDetails.MANIFEST_LOAD_ERROR,d=!0;break;case c.PlaylistContextType.LEVEL:l=i?o.ErrorDetails.LEVEL_LOAD_TIMEOUT:o.ErrorDetails.LEVEL_LOAD_ERROR,d=!1;break;case c.PlaylistContextType.AUDIO_TRACK:l=i?o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case c.PlaylistContextType.SUBTITLE_TRACK:l=i?o.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:o.ErrorDetails.SUBTITLE_LOAD_ERROR,d=!1}f&&this.resetInternalLoader(e.type);var h={type:o.ErrorTypes.NETWORK_ERROR,details:l,fatal:d,url:e.url,loader:f,context:e,networkDetails:t};a&&(h.response=a),this.hls.trigger(s.Events.ERROR,h)},t.handlePlaylistLoaded=function(e,t,i,a){var o=i.type,u=i.level,l=i.id,d=i.groupId,f=i.loader,h=i.levelDetails,p=i.deliveryDirectives;if(null!=h&&h.targetduration){if(f)switch(h.live&&(f.getCacheAge&&(h.ageHeader=f.getCacheAge()||0),f.getCacheAge&&!isNaN(h.ageHeader)||(h.ageHeader=0)),o){case c.PlaylistContextType.MANIFEST:case c.PlaylistContextType.LEVEL:this.hls.trigger(s.Events.LEVEL_LOADED,{details:h,level:u||0,id:l||0,stats:t,networkDetails:a,deliveryDirectives:p});break;case c.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(s.Events.AUDIO_TRACK_LOADED,{details:h,id:l||0,groupId:d||"",stats:t,networkDetails:a,deliveryDirectives:p});break;case c.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(s.Events.SUBTITLE_TRACK_LOADED,{details:h,id:l||0,groupId:d||"",stats:t,networkDetails:a,deliveryDirectives:p})}}else this.handleManifestParsingError(e,i,"invalid target duration",a)},e}()},"./src/polyfills/number.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{MAX_SAFE_INTEGER:()=>s,isFiniteNumber:()=>a});var a=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},s=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});const a=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}()},"./src/remux/mp4-generator.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var a=Math.pow(2,32)-1,s=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:a};var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var u=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,u,c,u,l),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,s))},e.box=function(e){for(var t=8,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];for(var o=a.length,u=o;o--;)t+=a[o].byteLength;var l=new Uint8Array(t);for(l[0]=t>>24&255,l[1]=t>>16&255,l[2]=t>>8&255,l[3]=255&t,l.set(e,4),o=0,t=8;o<u;o++)l.set(a[o],t),t+=a[o].byteLength;return l},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,i){i*=t;var s=Math.floor(i/(a+1)),o=Math.floor(i%(a+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,a){return e.box(e.types.moof,e.mfhd(t),e.traf(a,i))},e.moov=function(t){for(var i=t.length,a=[];i--;)a[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(a).concat(e.mvex(t)))},e.mvex=function(t){for(var i=t.length,a=[];i--;)a[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(a))},e.mvhd=function(t,i){i*=t;var s=Math.floor(i/(a+1)),o=Math.floor(i%(a+1)),u=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,u)},e.sdtp=function(t){var i,a,s=t.samples||[],o=new Uint8Array(4+s.length);for(i=0;i<s.length;i++)a=s[i].flags,o[i+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return e.box(e.types.sdtp,o)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i,a,s,o=[],u=[];for(i=0;i<t.sps.length;i++)s=(a=t.sps[i]).byteLength,o.push(s>>>8&255),o.push(255&s),o=o.concat(Array.prototype.slice.call(a));for(i=0;i<t.pps.length;i++)s=(a=t.pps[i]).byteLength,u.push(s>>>8&255),u.push(255&s),u=u.concat(Array.prototype.slice.call(a));var l=e.box(e.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|t.sps.length].concat(o).concat([t.pps.length]).concat(u))),c=t.width,d=t.height,f=t.pixelRatio[0],h=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,255&f,h>>24,h>>16&255,h>>8&255,255&h])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var i=t.id,s=t.duration*t.timescale,o=t.width,u=t.height,l=Math.floor(s/(a+1)),c=Math.floor(s%(a+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,l>>24,l>>16&255,l>>8&255,255&l,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,u>>8&255,255&u,0,0]))},e.traf=function(t,i){var s=e.sdtp(t),o=t.id,u=Math.floor(i/(a+1)),l=Math.floor(i%(a+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,u>>24,u>>16&255,u>>8&255,255&u,l>>24,l>>16&255,l>>8&255,255&l])),e.trun(t,s.length+16+20+8+16+8+8),s)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var a,s,o,u,l,c,d=t.samples||[],f=d.length,h=12+16*f,p=new Uint8Array(h);for(i+=8+h,p.set(["video"===t.type?1:0,0,15,1,f>>>24&255,f>>>16&255,f>>>8&255,255&f,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),a=0;a<f;a++)o=(s=d[a]).duration,u=s.size,l=s.flags,c=s.cts,p.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,u>>>24&255,u>>>16&255,u>>>8&255,255&u,l.isLeading<<2|l.dependsOn,l.isDependedOn<<6|l.hasRedundancy<<4|l.paddingValue<<1|l.isNonSync,61440&l.degradPrio,15&l.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*a);return e.box(e.types.trun,p)},e.initSegment=function(t){e.types||e.init();var i=e.moov(t),a=new Uint8Array(e.FTYP.byteLength+i.byteLength);return a.set(e.FTYP),a.set(i,e.FTYP.byteLength),a},e}();s.types=void 0,s.HDLR_TYPES=void 0,s.STTS=void 0,s.STSC=void 0,s.STCO=void 0,s.STSZ=void 0,s.VMHD=void 0,s.SMHD=void 0,s.STSD=void 0,s.FTYP=void 0,s.DINF=void 0;const o=s},"./src/remux/mp4-remuxer.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>g,flushTextTrackMetadataCueSamples:()=>y,flushTextTrackUserdataCueSamples:()=>E,normalizePts:()=>m});var a=i("./src/polyfills/number.ts"),s=i("./src/remux/aac-helper.ts"),o=i("./src/remux/mp4-generator.ts"),u=i("./src/events.ts"),l=i("./src/errors.ts"),c=i("./src/utils/logger.ts"),d=i("./src/types/loader.ts"),f=i("./src/utils/timescale-conversion.ts");function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},h.apply(this,arguments)}var p=null,v=null,g=function(){function e(e,t,i,a){if(void 0===a&&(a=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,null===p){var s=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);p=s?parseInt(s[1]):0}if(null===v){var o=navigator.userAgent.match(/Safari\/(\d+)/i);v=o?parseInt(o[1]):0}}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){c.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function(){c.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){c.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,i=e.reduce((function(e,i){var a=i.pts-e;return a<-4294967296?(t=!0,m(e,i.pts)):a>0?e:i.pts}),e[0].pts);return t&&c.logger.debug("PTS rollover detected"),i},t.remux=function(e,t,i,a,s,o,u,l){var f,h,p,v,g,_,T=s,b=s,S=e.pid>-1,R=t.pid>-1,A=t.samples.length,w=e.samples.length>0,I=u&&A>0||A>1;if((!S||w)&&(!R||I)||this.ISGenerated||u){this.ISGenerated||(p=this.generateIS(e,t,s));var D,L=this.isVideoContiguous,k=-1;if(I&&(k=function(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!L&&this.config.forceKeyFrameOnDiscontinuity))if(_=!0,k>0){c.logger.warn("[mp4-remuxer]: Dropped "+k+" out of "+A+" video samples due to a missing keyframe");var C=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(k),t.dropped+=k,D=b+=(t.samples[0].pts-C)/t.inputTimeScale}else-1===k&&(c.logger.warn("[mp4-remuxer]: No keyframe found out of "+A+" video samples"),_=!1);if(this.ISGenerated){if(w&&I){var O=this.getVideoStartPts(t.samples),P=(m(e.samples[0].pts,O)-O)/t.inputTimeScale;T+=Math.max(0,P),b+=Math.max(0,-P)}if(w){if(e.samplerate||(c.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),p=this.generateIS(e,t,s)),h=this.remuxAudio(e,T,this.isAudioContiguous,o,R||I||l===d.PlaylistLevelType.AUDIO?b:void 0),I){var x=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(c.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),p=this.generateIS(e,t,s)),f=this.remuxVideo(t,b,L,x)}}else I&&(f=this.remuxVideo(t,b,L,0));f&&(f.firstKeyFrame=k,f.independent=-1!==k,f.firstKeyFramePTS=D)}}return this.ISGenerated&&(i.samples.length&&(g=y(i,s,this._initPTS,this._initDTS)),a.samples.length&&(v=E(a,s,this._initPTS))),{audio:h,video:f,initSegment:p,independent:_,text:v,id3:g}},t.generateIS=function(e,t,i){var s,u,l,c=e.samples,d=t.samples,f=this.typeSupported,h={},p=!(0,a.isFiniteNumber)(this._initPTS),v="audio/mp4";if(p&&(s=u=1/0),e.config&&c.length&&(e.timescale=e.samplerate,"mp3"===e.segmentCodec&&(f.mpeg?(v="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3")),h.audio={id:"audio",container:v,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&f.mpeg?new Uint8Array(0):o.default.initSegment([e]),metadata:{channelCount:e.channelCount}},p&&(l=e.inputTimeScale,s=u=c[0].pts-Math.round(l*i))),t.sps&&t.pps&&d.length&&(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:o.default.initSegment([t]),metadata:{width:t.width,height:t.height}},p)){l=t.inputTimeScale;var g=this.getVideoStartPts(d),y=Math.round(l*i);u=Math.min(u,m(d[0].dts,g)-y),s=Math.min(s,g-y)}if(Object.keys(h).length)return this.ISGenerated=!0,p&&(this._initPTS=s,this._initDTS=u),{tracks:h,initPTS:s,timescale:l}},t.remuxVideo=function(e,t,i,a){var s,d,g=e.inputTimeScale,y=e.samples,E=[],T=y.length,b=this._initPTS,S=this.nextAvcDts,R=8,A=this.videoSampleDuration,w=Number.POSITIVE_INFINITY,I=Number.NEGATIVE_INFINITY,D=!1;i&&null!==S||(S=t*g-(y[0].pts-m(y[0].dts,y[0].pts)));for(var L=0;L<T;L++){var k=y[L];k.pts=m(k.pts-b,S),k.dts=m(k.dts-b,S),k.dts<y[L>0?L-1:L].dts&&(D=!0)}D&&y.sort((function(e,t){var i=e.dts-t.dts,a=e.pts-t.pts;return i||a})),s=y[0].dts;var C=(d=y[y.length-1].dts)-s,O=C?Math.round(C/(T-1)):A||e.inputTimeScale/30;if(i){var P=s-S,x=P>O,M=P<-1;if((x||M)&&(x?c.logger.warn("AVC: "+(0,f.toMsFromMpegTsClock)(P,!0)+" ms ("+P+"dts) hole between fragments detected, filling it"):c.logger.warn("AVC: "+(0,f.toMsFromMpegTsClock)(-P,!0)+" ms ("+P+"dts) overlapping between fragments detected"),!M||S>y[0].pts)){s=S;var N=y[0].pts-P;y[0].dts=s,y[0].pts=N,c.logger.log("Video: First PTS/DTS adjusted: "+(0,f.toMsFromMpegTsClock)(N,!0)+"/"+(0,f.toMsFromMpegTsClock)(s,!0)+", delta: "+(0,f.toMsFromMpegTsClock)(P,!0)+" ms")}}s=Math.max(0,s);for(var F=0,U=0,B=0;B<T;B++){for(var j=y[B],H=j.units,G=H.length,K=0,V=0;V<G;V++)K+=H[V].data.length;U+=K,F+=G,j.length=K,j.dts=Math.max(j.dts,s),w=Math.min(j.pts,w),I=Math.max(j.pts,I)}d=y[T-1].dts;var q,W=U+4*F+8;try{q=new Uint8Array(W)}catch(e){return void this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:l.ErrorTypes.MUX_ERROR,details:l.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:W,reason:"fail allocating video mdat "+W})}var Y=new DataView(q.buffer);Y.setUint32(0,W),q.set(o.default.types.mdat,4);for(var z=!1,X=Number.POSITIVE_INFINITY,Q=Number.POSITIVE_INFINITY,$=Number.NEGATIVE_INFINITY,J=Number.NEGATIVE_INFINITY,Z=0;Z<T;Z++){for(var ee=y[Z],te=ee.units,re=0,ne=0,ie=te.length;ne<ie;ne++){var ae=te[ne],se=ae.data,oe=ae.data.byteLength;Y.setUint32(R,oe),R+=4,q.set(se,R),R+=oe,re+=4+oe}var ue=void 0;if(Z<T-1)A=y[Z+1].dts-ee.dts,ue=y[Z+1].pts-ee.pts;else{var le=this.config,ce=Z>0?ee.dts-y[Z-1].dts:O;if(ue=Z>0?ee.pts-y[Z-1].pts:O,le.stretchShortVideoTrack&&null!==this.nextAudioPts){var de=Math.floor(le.maxBufferHole*g),fe=(a?w+a*g:this.nextAudioPts)-ee.pts;fe>de?((A=fe-ce)<0?A=ce:z=!0,c.logger.log("[mp4-remuxer]: It is approximately "+fe/90+" ms to the next segment; using duration "+A/90+" ms for the last video frame.")):A=ce}else A=ce}var he=Math.round(ee.pts-ee.dts);X=Math.min(X,A),$=Math.max($,A),Q=Math.min(Q,ue),J=Math.max(J,ue),E.push(new _(ee.key,A,re,he))}if(E.length)if(p){if(p<70){var pe=E[0].flags;pe.dependsOn=2,pe.isNonSync=0}}else if(v&&J-Q<$-X&&O/$<.025&&0===E[0].cts){c.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ve=s,ge=0,me=E.length;ge<me;ge++){var ye=ve+E[ge].duration,Ee=ve+E[ge].cts;if(ge<me-1){var _e=ye+E[ge+1].cts;E[ge].duration=_e-Ee}else E[ge].duration=ge?E[ge-1].duration:O;E[ge].cts=0,ve=ye}}console.assert(null!==A,"mp4SampleDuration must be computed"),A=z||!A?O:A,this.nextAvcDts=S=d+A,this.videoSampleDuration=A,this.isVideoContiguous=!0;var Te={data1:o.default.moof(e.sequenceNumber++,s,h({},e,{samples:E})),data2:q,startPTS:w/g,endPTS:(I+A)/g,startDTS:s/g,endDTS:S/g,type:"video",hasAudio:!1,hasVideo:!0,nb:E.length,dropped:e.dropped};return e.samples=[],e.dropped=0,console.assert(q.length,"MDAT length must not be zero"),Te},t.remuxAudio=function(e,t,i,a,d){var f=e.inputTimeScale,p=f/(e.samplerate?e.samplerate:f),v="aac"===e.segmentCodec?1024:1152,g=v*p,y=this._initPTS,E="mp3"===e.segmentCodec&&this.typeSupported.mpeg,T=[],b=void 0!==d,S=e.samples,R=E?0:8,A=this.nextAudioPts||-1,w=t*f;if(this.isAudioContiguous=i=i||S.length&&A>0&&(a&&Math.abs(w-A)<9e3||Math.abs(m(S[0].pts-y,w)-A)<20*g),S.forEach((function(e){e.pts=m(e.pts-y,w)})),!i||A<0){if(S=S.filter((function(e){return e.pts>=0})),!S.length)return;A=0===d?0:a&&!b?Math.max(0,w):S[0].pts}if("aac"===e.segmentCodec)for(var I=this.config.maxAudioFramesDrift,D=0,L=A;D<S.length;D++){var k=S[D],C=k.pts,O=C-L,P=Math.abs(1e3*O/f);if(O<=-I*g&&b)0===D&&(c.logger.warn("Audio frame @ "+(C/f).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*O/f)+" ms."),this.nextAudioPts=A=L=C);else if(O>=I*g&&P<1e4&&b){var x=Math.round(O/g);(L=C-x*g)<0&&(x--,L+=g),0===D&&(this.nextAudioPts=A=L),c.logger.warn("[mp4-remuxer]: Injecting "+x+" audio frame @ "+(L/f).toFixed(3)+"s due to "+Math.round(1e3*O/f)+" ms gap.");for(var M=0;M<x;M++){var N=Math.max(L,0),F=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);F||(c.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),F=k.unit.subarray()),S.splice(D,0,{unit:F,pts:N}),L+=g,D++}}k.pts=L,L+=g}for(var U,B=null,j=null,H=0,G=S.length;G--;)H+=S[G].unit.byteLength;for(var K=0,V=S.length;K<V;K++){var q=S[K],W=q.unit,Y=q.pts;if(null!==j)T[K-1].duration=Math.round((Y-j)/p);else{if(i&&"aac"===e.segmentCodec&&(Y=A),B=Y,!(H>0))return;H+=R;try{U=new Uint8Array(H)}catch(e){return void this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:l.ErrorTypes.MUX_ERROR,details:l.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:"fail allocating audio mdat "+H})}E||(new DataView(U.buffer).setUint32(0,H),U.set(o.default.types.mdat,4))}U.set(W,R);var z=W.byteLength;R+=z,T.push(new _(!0,v,z,0)),j=Y}var X=T.length;if(X){var Q=T[T.length-1];this.nextAudioPts=A=j+p*Q.duration;var $=E?new Uint8Array(0):o.default.moof(e.sequenceNumber++,B/p,h({},e,{samples:T}));e.samples=[];var J=B/f,Z=A/f,ee={data1:$,data2:U,startPTS:J,endPTS:Z,startDTS:J,endDTS:Z,type:"audio",hasAudio:!0,hasVideo:!1,nb:X};return this.isAudioContiguous=!0,console.assert(U.length,"MDAT length must not be zero"),ee}},t.remuxEmptyAudio=function(e,t,i,a){var o=e.inputTimeScale,u=o/(e.samplerate?e.samplerate:o),l=this.nextAudioPts,d=(null!==l?l:a.startDTS*o)+this._initDTS,f=a.endDTS*o+this._initDTS,h=1024*u,p=Math.ceil((f-d)/h),v=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(c.logger.warn("[mp4-remuxer]: remux empty Audio"),v){for(var g=[],m=0;m<p;m++){var y=d+m*h;g.push({unit:v,pts:y,dts:y})}return e.samples=g,this.remuxAudio(e,t,i,!1)}c.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},e}();function m(e,t){var i;if(null===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}function y(e,t,i,a){var s=e.samples.length;if(s){for(var o=e.inputTimeScale,u=0;u<s;u++){var l=e.samples[u];l.pts=m(l.pts-i,t*o)/o,l.dts=m(l.dts-a,t*o)/o}var c=e.samples;return e.samples=[],{samples:c}}}function E(e,t,i){var a=e.samples.length;if(a){for(var s=e.inputTimeScale,o=0;o<a;o++){var u=e.samples[o];u.pts=m(u.pts-i,t*s)/s}e.samples.sort((function(e,t){return e.pts-t.pts}));var l=e.samples;return e.samples=[],{samples:l}}}var _=function(e,t,i,a){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=a,this.flags=new T(e)},T=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}},"./src/remux/passthrough-remuxer.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var a=i("./src/polyfills/number.ts"),s=i("./src/remux/mp4-remuxer.ts"),o=i("./src/utils/mp4-tools.ts"),u=i("./src/loader/fragment.ts"),l=i("./src/utils/logger.ts");function c(e,t){var i=null==e?void 0:e.codec;return i&&i.length>4?i:"hvc1"===i||"hev1"===i?"hvc1.1.c.L120.90":"av01"===i?"av01.0.04M.08":"avc1"===i||t===u.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const d=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},t.resetNextTimestamp=function(){this.lastEndTime=null},t.resetInitSegment=function(e,t,i,a){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment((0,o.patchEncyptionData)(e,a)),this.emitInitSegment=!0},t.generateInitSegment=function(e){var t=this.audioCodec,i=this.videoCodec;if(!e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var a=this.initData=(0,o.parseInitSegment)(e);t||(t=c(a.audio,u.ElementaryStreamTypes.AUDIO)),i||(i=c(a.video,u.ElementaryStreamTypes.VIDEO));var s={};a.audio&&a.video?s.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:a.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:a.video?s.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:l.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s},t.remux=function(e,t,i,u,c){var d,f=this.initPTS,h=this.lastEndTime,p={audio:void 0,video:void 0,text:u,id3:i,initSegment:void 0};(0,a.isFiniteNumber)(h)||(h=this.lastEndTime=c||0);var v=t.samples;if(!v||!v.length)return p;var g={initPTS:void 0,timescale:1},m=this.initData;if(m&&m.length||(this.generateInitSegment(v),m=this.initData),!m||!m.length)return l.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),p;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);var y=(0,o.getStartDTS)(m,v);(0,a.isFiniteNumber)(f)||(this.initPTS=g.initPTS=f=y-c);var E=(0,o.getDuration)(v,m),_=e?y-f:h,T=_+E;(0,o.offsetStartDTS)(m,v,f),E>0?this.lastEndTime=T:(l.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var b=!!m.audio,S=!!m.video,R="";b&&(R+="audio"),S&&(R+="video");var A={data1:v,startPTS:_,startDTS:_,endPTS:T,endDTS:T,type:R,hasAudio:b,hasVideo:S,nb:1,dropped:0};p.audio="audio"===A.type?A:void 0,p.video="audio"!==A.type?A:void 0,p.initSegment=g;var w=null!=(d=this.initPTS)?d:0;return p.id3=(0,s.flushTextTrackMetadataCueSamples)(i,c,w,w),u.samples.length&&(p.text=(0,s.flushTextTrackUserdataCueSamples)(u,c,w)),p},e}()},"./src/task-loop.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var a=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function(){},t.hasInterval=function(){return!!this._tickInterval},t.hasNextTick=function(){return!!this._tickTimer},t.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},t.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},t.doTick=function(){},e}()},"./src/types/cmcd.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{CMCDObjectType:()=>a,CMCDStreamType:()=>o,CMCDStreamingFormat:()=>s,CMCDVersion:()=>u});var a,s,o,u=1;!function(e){e.MANIFEST="m",e.AUDIO="a",e.VIDEO="v",e.MUXED="av",e.INIT="i",e.CAPTION="c",e.TIMED_TEXT="tt",e.KEY="k",e.OTHER="o"}(a||(a={})),function(e){e.DASH="d",e.HLS="h",e.SMOOTH="s",e.OTHER="o"}(s||(s={})),function(e){e.VOD="v",e.LIVE="l"}(o||(o={}))},"./src/types/demuxer.ts":(e,t,i)=>{"use strict";var a;i.r(t),i.d(t,{MetadataSchema:()=>a}),function(e){e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3"}(a||(a={}))},"./src/types/level.ts":(e,t,i)=>{"use strict";function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(s=a.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?o:String(o)),a)}var s,o}i.r(t),i.d(t,{HdcpLevels:()=>o,HlsSkip:()=>s,HlsUrlParameters:()=>l,Level:()=>c,getSkipValue:()=>u});var s,o=["NONE","TYPE-0","TYPE-1","TYPE-2",null];function u(e,t){var i=e.canSkipUntil,a=e.canSkipDateRanges,o=e.endSN;return i&&(void 0!==t?t-o:0)<i?a?s.v2:s.Yes:s.No}!function(e){e.No="",e.Yes="YES",e.v2="v2"}(s||(s={}));var l=function(){function e(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}return e.prototype.addDirectives=function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href},e}(),c=function(){function e(e){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this.attrs=e.attrs,this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((function(e){return e})).join(",").replace(/\.[^.,]+/g,"")}var t,i,s;return t=e,(i=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var t=e%this.url.length;this._urlId!==t&&(this.details=void 0,this._urlId=t)}}])&&a(t.prototype,i),s&&a(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}()},"./src/types/loader.ts":(e,t,i)=>{"use strict";var a,s;i.r(t),i.d(t,{PlaylistContextType:()=>a,PlaylistLevelType:()=>s}),function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(a||(a={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(s||(s={}))},"./src/types/transmuxer.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{ChunkMetadata:()=>a});var a=function(e,t,i,a,s,o){void 0===a&&(a=0),void 0===s&&(s=-1),void 0===o&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=i,this.size=a,this.part=s,this.partial=o}},"./src/utils/attr-list.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{AttrList:()=>o});var a=/^(\d+)x(\d+)$/,s=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,o=function(){function e(t){for(var i in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(i)&&(this[i]=t[i])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),a=0;a<t.length/2;a++)i[a]=parseInt(t.slice(2*a,2*a+2),16);return i}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var i=this[e];return i?parseFloat(i):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=a.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,i={};for(s.lastIndex=0;null!==(t=s.exec(e));){var a=t[2];0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1&&(a=a.slice(1,-1)),i[t[1]]=a}return i},e}()},"./src/utils/binary-search.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});const a={search:function(e,t){for(var i=0,a=e.length-1,s=null,o=null;i<=a;){var u=t(o=e[s=(i+a)/2|0]);if(u>0)i=s+1;else{if(!(u<0))return o;a=s-1}}return null}}},"./src/utils/buffer-helper.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{BufferHelper:()=>o});var a=i("./src/utils/logger.ts"),s={length:0,start:function(){return 0},end:function(){return 0}},o=function(){function e(){}return e.isBuffered=function(t,i){try{if(t)for(var a=e.getBuffered(t),s=0;s<a.length;s++)if(i>=a.start(s)&&i<=a.end(s))return!0}catch(e){}return!1},e.bufferInfo=function(t,i,a){try{if(t){var s,o=e.getBuffered(t),u=[];for(s=0;s<o.length;s++)u.push({start:o.start(s),end:o.end(s)});return this.bufferedInfo(u,i,a)}}catch(e){}return{len:0,start:i,end:i,nextStart:void 0}},e.bufferedInfo=function(e,t,i){t=Math.max(0,t),e.sort((function(e,t){var i=e.start-t.start;return i||t.end-e.end}));var a=[];if(i)for(var s=0;s<e.length;s++){var o=a.length;if(o){var u=a[o-1].end;e[s].start-u<i?e[s].end>u&&(a[o-1].end=e[s].end):a.push(e[s])}else a.push(e[s])}else a=e;for(var l,c=0,d=t,f=t,h=0;h<a.length;h++){var p=a[h].start,v=a[h].end;if(t+i>=p&&t<v)d=p,c=(f=v)-t;else if(t+i<p){l=p;break}}return{len:c,start:d||0,end:f||0,nextStart:l}},e.getBuffered=function(e){try{return e.buffered}catch(e){return a.logger.log("failed to get media.buffered",e),s}},e}()},"./src/utils/cea-608-parser.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{CaptionScreen:()=>T,Row:()=>_,default:()=>w});var a,s=i("./src/utils/logger.ts"),o={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},u=function(e){var t=e;return o.hasOwnProperty(e)&&(t=o[e]),String.fromCharCode(t)},l=15,c=100,d={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},f={17:2,18:4,21:6,22:8,23:10,19:13,20:15},h={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},p={25:2,26:4,29:6,30:8,31:10,27:13,28:15},v=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(e){e[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA"}(a||(a={}));var g=function(){function e(){this.time=null,this.verboseLevel=a.ERROR}return e.prototype.log=function(e,t){if(this.verboseLevel>=e){var i="function"==typeof t?t():t;s.logger.log(this.time+" ["+e+"] "+i)}},e}(),m=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].toString(16));return t},y=function(){function e(e,t,i,a,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=i||!1,this.background=a||"black",this.flash=s||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],i=0;i<t.length;i++){var a=t[i];e.hasOwnProperty(a)&&(this[a]=e[a])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),E=function(){function e(e,t,i,a,s,o){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new y(t,i,a,s,o)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),_=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<c;t++)this.chars.push(new E);this.logger=e,this.pos=0,this.currPenState=new y}var t=e.prototype;return t.equals=function(e){for(var t=!0,i=0;i<c;i++)if(!this.chars[i].equals(e.chars[i])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<c;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<c;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(a.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>c&&(this.logger.log(a.DEBUG,"Too large cursor position "+this.pos),this.pos=c)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){var t=this;e>=144&&this.backSpace();var i=u(e);this.pos>=c?this.logger.log(a.ERROR,(function(){return"Cannot insert "+e.toString(16)+" ("+i+") at position "+t.pos+". Skipping it!"})):(this.chars[this.pos].setChar(i,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<c;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,i=0;i<c;i++){var a=this.chars[i].uchar;" "!==a&&(t=!1),e.push(a)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),T=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<l;t++)this.rows.push(new _(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<l;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,i=0;i<l;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<l;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<l;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(a.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(a.INFO,(function(){return"pacData = "+JSON.stringify(e)}));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var i=0;i<l;i++)this.rows[i].clear();var s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){var u=o.rows[s].cueStartTime,c=this.logger.time;if(u&&null!==c&&u<c)for(var d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(o.rows[s+d])}}this.currRow=t;var f=this.rows[this.currRow];if(null!==e.indent){var h=e.indent,p=Math.max(h-1,0);f.setCursor(e.indent),e.color=f.chars[p].penState.foreground}var v={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(v)},t.setBkgData=function(e){this.logger.log(a.INFO,(function(){return"bkgData = "+JSON.stringify(e)})),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){var e=this;if(null!==this.nrRollUpRows){this.logger.log(a.TEXT,(function(){return e.getDisplayText()}));var t=this.currRow+1-this.nrRollUpRows,i=this.rows.splice(t,1)[0];i.clear(),this.rows.splice(this.currRow,0,i),this.logger.log(a.INFO,"Rolling up")}else this.logger.log(a.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],i="",a=-1,s=0;s<l;s++){var o=this.rows[s].getTextString();o&&(a=s+1,e?t.push("Row "+a+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(i=e?"["+t.join(" | ")+"]":t.join("\n")),i},t.getTextAndFormat=function(){return this.rows},e}(),b=function(){function e(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new T(i),this.nonDisplayedMemory=new T(i),this.lastOutputScreen=new T(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(a.INFO,(function(){return"MODE="+e})),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=this,i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);var s=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(a.INFO,(function(){return s+": "+t.writeScreen.getDisplayText(!0)})),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(a.TEXT,(function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)})),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(a.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(a.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(a.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(a.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(a.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(a.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(a.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(a.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(a.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(a.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(a.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){var e=this;if(this.logger.log(a.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(a.TEXT,(function(){return"DISP: "+e.displayedMemory.getDisplayText()}))}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(a.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var i=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}this.logger.log(a.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),S=function(){function e(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var a=new g;this.channels=[null,new b(e,t,a),new b(e+1,i,a)],this.cmdHistory={a:null,b:null},this.logger=a}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var i,s,o,u=!1;this.logger.time=e;for(var l=0;l<t.length;l+=2)if(s=127&t[l],o=127&t[l+1],0!==s||0!==o){if(this.logger.log(a.DATA,"["+m([t[l],t[l+1]])+"] -> ("+m([s,o])+")"),(i=this.parseCmd(s,o))||(i=this.parseMidrow(s,o)),i||(i=this.parsePAC(s,o)),i||(i=this.parseBackgroundAttributes(s,o)),!i&&(u=this.parseChars(s,o))){var c=this.currentChannel;c&&c>0?this.channels[c].insertChars(u):this.logger.log(a.WARNING,"No channel found yet. TEXT-MODE?")}i||u||this.logger.log(a.WARNING,"Couldn't parse cleaned data "+m([s,o])+" orig: "+m([t[l],t[l+1]]))}},t.parseCmd=function(e,t){var i=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(A(e,t,i))return R(null,null,i),this.logger.log(a.DEBUG,"Repeated command ("+m([e,t])+") is dropped"),!0;var s=20===e||21===e||23===e?1:2,o=this.channels[s];return 20===e||21===e||28===e||29===e?32===t?o.ccRCL():33===t?o.ccBS():34===t?o.ccAOF():35===t?o.ccAON():36===t?o.ccDER():37===t?o.ccRU(2):38===t?o.ccRU(3):39===t?o.ccRU(4):40===t?o.ccFON():41===t?o.ccRDC():42===t?o.ccTR():43===t?o.ccRTD():44===t?o.ccEDM():45===t?o.ccCR():46===t?o.ccENM():47===t&&o.ccEOC():o.ccTO(t-32),R(e,t,i),this.currentChannel=s,!0},t.parseMidrow=function(e,t){var i=0;if((17===e||25===e)&&t>=32&&t<=47){if((i=17===e?1:2)!==this.currentChannel)return this.logger.log(a.ERROR,"Mismatch channel in midrow parsing"),!1;var s=this.channels[i];return!!s&&(s.ccMIDROW(t),this.logger.log(a.DEBUG,"MIDROW ("+m([e,t])+")"),!0)}return!1},t.parsePAC=function(e,t){var i,a=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(A(e,t,a))return R(null,null,a),!0;var s=e<=23?1:2;i=t>=64&&t<=95?1===s?d[e]:h[e]:1===s?f[e]:p[e];var o=this.channels[s];return!!o&&(o.setPAC(this.interpretPAC(i,t)),R(e,t,a),this.currentChannel=s,!0)},t.interpretPAC=function(e,t){var i,a={color:null,italics:!1,indent:null,underline:!1,row:e};return i=t>95?t-96:t-64,a.underline=1==(1&i),i<=13?a.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(a.italics=!0,a.color="white"):a.indent=4*Math.floor((i-16)/2),a},t.parseChars=function(e,t){var i,s,o=null,l=null;if(e>=25?(i=2,l=e-8):(i=1,l=e),l>=17&&l<=19?(s=17===l?t+80:18===l?t+112:t+144,this.logger.log(a.INFO,"Special char '"+u(s)+"' in channel "+i),o=[s]):e>=32&&e<=127&&(o=0===t?[e]:[e,t]),o){var c=m(o);this.logger.log(a.DEBUG,"Char codes =  "+c.join(",")),R(e,t,this.cmdHistory)}return o},t.parseBackgroundAttributes=function(e,t){var i;if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;var a={};16===e||24===e?(i=Math.floor((t-32)/2),a.background=v[i],t%2==1&&(a.background=a.background+"_semi")):45===t?a.background="transparent":(a.foreground="black",47===t&&(a.underline=!0));var s=e<=23?1:2;return this.channels[s].setBkgData(a),R(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var i=this.channels[t];i&&i.cueSplitAtTime(e)}},e}();function R(e,t,i){i.a=e,i.b=t}function A(e,t,i){return i.a===e&&i.b===t}const w=S},"./src/utils/codecs.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{isCodecSupportedInMp4:()=>o,isCodecType:()=>s});var a={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function s(e,t){var i=a[t];return!!i&&!0===i[e.slice(0,4)]}function o(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/cues.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var a=i("./src/utils/vttparser.ts"),s=i("./src/utils/webvtt-parser.ts"),o=i("./src/utils/texttrack-utils.ts"),u=/\s/;const l={newCue:function(e,t,i,l){for(var c,d,f,h,p,v=[],g=self.VTTCue||self.TextTrackCue,m=0;m<l.rows.length;m++)if(f=!0,h=0,p="",!(c=l.rows[m]).isEmpty()){for(var y=0;y<c.chars.length;y++)u.test(c.chars[y].uchar)&&f?h++:(p+=c.chars[y].uchar,f=!1);c.cueStartTime=t,t===i&&(i+=1e-4),h>=16?h--:h++;var E=(0,a.fixLineBreaks)(p.trim()),_=(0,s.generateCueId)(t,i,E);e&&e.cues&&e.cues.getCueById(_)||((d=new g(t,i,E)).id=_,d.line=m+1,d.align="left",d.position=10+Math.min(80,10*Math.floor(8*h/32)),v.push(d))}return e&&v.length&&(v.sort((function(e,t){return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line})),v.forEach((function(t){return(0,o.addCueToTrack)(e,t)}))),v}}},"./src/utils/discontinuities.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{adjustSlidingStart:()=>f,alignMediaPlaylistByPDT:()=>v,alignPDT:()=>p,alignStream:()=>h,findDiscontinuousReferenceFrag:()=>c,findFirstFragWithCC:()=>u,shouldAlignOnDiscontinuities:()=>l});var a=i("./src/polyfills/number.ts"),s=i("./src/utils/logger.ts"),o=i("./src/controller/level-helper.ts");function u(e,t){for(var i=null,a=0,s=e.length;a<s;a++){var o=e[a];if(o&&o.cc===t){i=o;break}}return i}function l(e,t,i){return!(!t.details||!(i.endCC>i.startCC||e&&e.cc<i.startCC))}function c(e,t,i){void 0===i&&(i=0);var a=e.fragments,o=t.fragments;if(o.length&&a.length){var l=u(a,o[0].cc);if(l&&(!l||l.startPTS))return l;s.logger.log("No frag in previous level to align on")}else s.logger.log("No fragments to align")}function d(e,t){if(e){var i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function f(e,t){for(var i=t.fragments,a=0,s=i.length;a<s;a++)d(i[a],e);t.fragmentHint&&d(t.fragmentHint,e),t.alignedSliding=!0}function h(e,t,i){t&&(function(e,t,i){if(l(e,i,t)){var o=c(i.details,t);o&&(0,a.isFiniteNumber)(o.start)&&(s.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),f(o.start,t))}}(e,i,t),!i.alignedSliding&&t.details&&p(i,t.details),i.alignedSliding||!t.details||i.skippedSegments||(0,o.adjustSliding)(t.details,i))}function p(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var i=t.fragments[0].programDateTime,o=e.fragments[0].programDateTime,u=(o-i)/1e3+t.fragments[0].start;u&&(0,a.isFiniteNumber)(u)&&(s.logger.log("Adjusting PTS using programDateTime delta "+(o-i)+"ms, sliding:"+u.toFixed(3)+" "+e.url+" "),f(u,e))}}function v(e,t){if(e.hasProgramDateTime&&t.hasProgramDateTime){var i=e.fragments,a=t.fragments;if(i.length&&a.length){var s=a[Math.round(a.length/2)-1],o=u(i,s.cc)||i[Math.round(i.length/2)-1],l=s.programDateTime,c=o.programDateTime;null!==l&&null!==c&&f((c-l)/1e3-(o.start-s.start),e)}}}},"./src/utils/ewma-bandwidth-estimator.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var a=i("./src/utils/ewma.ts");const s=function(){function e(e,t,i){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=1,this.slow_=new a.default(e),this.fast_=new a.default(t)}var t=e.prototype;return t.update=function(e,t){var i=this.slow_,s=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new a.default(e,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new a.default(t,s.getEstimate(),s.getTotalWeight()))},t.sample=function(e,t){if(0!=t){var i=(e=Math.max(e,this.minDelayMs_))/1e3,a=8*t/i;this.fast_.sample(i,a),this.slow_.sample(i,a)}},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}()},"./src/utils/ewma.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});const a=function(){function e(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}var t=e.prototype;return t.sample=function(e,t){var i=this.estimate_/t,a=Math.min(Math.pow(this.alpha_,i),.9);this.estimate_=t*(1-a)+a*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},e}()},"./src/utils/fetch-loader.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m,fetchSupported:()=>h});var a=i("./src/polyfills/number.ts"),s=i("./src/loader/load-stats.ts"),o=i("./src/demux/chunk-cache.ts");function u(e){var t="function"==typeof Map?new Map:void 0;return u=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return l(e,arguments,d(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),c(a,e)},u(e)}function l(e,t,i){return l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,i){var a=[null];a.push.apply(a,t);var s=new(Function.bind.apply(e,a));return i&&c(s,i.prototype),s},l.apply(null,arguments)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},f.apply(this,arguments)}function h(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}var p=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||v,this.controller=new self.AbortController,this.stats=new s.LoadStats}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var e=this.response;e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(e,t,i){var s=this,o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();var u=function(e,t){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(f({},e.headers))};return e.rangeEnd&&i.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),i}(e,this.controller.signal),l=i.onProgress,c="arraybuffer"===e.responseType,d=c?"byteLength":"length";this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,u),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){s.abortInternal(),i.onTimeout(o,e,s.response)}),t.timeout),self.fetch(this.request).then((function(i){if(s.response=s.loader=i,!i.ok){var u=i.status,d=i.statusText;throw new g(d||"fetch, bad network response",u,i)}return o.loading.first=Math.max(self.performance.now(),o.loading.start),o.total=parseInt(i.headers.get("Content-Length")||"0"),l&&(0,a.isFiniteNumber)(t.highWaterMark)?s.loadProgressively(i,o,e,t.highWaterMark,l):c?i.arrayBuffer():i.text()})).then((function(u){var c=s.response;self.clearTimeout(s.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first);var f=u[d];f&&(o.loaded=o.total=f);var h={url:c.url,data:u};l&&!(0,a.isFiniteNumber)(t.highWaterMark)&&l(o,e,u,c),i.onSuccess(h,o,e,c)})).catch((function(t){if(self.clearTimeout(s.requestTimeout),!o.aborted){var a=t&&t.code||0,u=t?t.message:null;i.onError({code:a,text:u},e,t?t.details:null)}}))},t.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},t.loadProgressively=function(e,t,i,a,s){void 0===a&&(a=0);var u=new o.default,l=e.body.getReader();return function o(){return l.read().then((function(l){if(l.done)return u.dataLength&&s(t,i,u.flush(),e),Promise.resolve(new ArrayBuffer(0));var c=l.value,d=c.length;return t.loaded+=d,d<a||u.dataLength?(u.push(c),u.dataLength>=a&&s(t,i,u.flush(),e)):s(t,i,c,e),o()})).catch((function(){return Promise.reject()}))}()},e}();function v(e,t){return new self.Request(e.url,t)}var g=function(e){var t,i;function a(t,i,a){var s;return(s=e.call(this,t)||this).code=void 0,s.details=void 0,s.code=i,s.details=a,s}return i=e,(t=a).prototype=Object.create(i.prototype),t.prototype.constructor=t,c(t,i),a}(u(Error));const m=p},"./src/utils/hex.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});const a={hexDump:function(e){for(var t="",i=0;i<e.length;i++){var a=e[i].toString(16);a.length<2&&(a="0"+a),t+=a}return t}}},"./src/utils/imsc1-ttml-parser.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{IMSC1_CODEC:()=>f,parseIMSC1:()=>g});var a=i("./src/utils/mp4-tools.ts"),s=i("./src/utils/vttparser.ts"),o=i("./src/utils/vttcue.ts"),u=i("./src/demux/id3.ts"),l=i("./src/utils/timescale-conversion.ts"),c=i("./src/utils/webvtt-parser.ts");function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},d.apply(this,arguments)}var f="stpp.ttml.im1t",h=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,p=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,v={left:"start",center:"center",right:"end",start:"start",end:"end"};function g(e,t,i,s,f){var h=(0,a.findBox)(new Uint8Array(e),["mdat"]);if(0!==h.length){var p=h.map((function(e){return(0,u.utf8ArrayToStr)(e)})),g=(0,l.toTimescaleFromScale)(t,1,i);try{p.forEach((function(e){return s(function(e,t){var i=(new DOMParser).parseFromString(e,"text/xml"),a=i.getElementsByTagName("tt")[0];if(!a)throw new Error("Invalid ttml");var s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},u=Object.keys(s).reduce((function(e,t){return e[t]=a.getAttribute("ttp:"+t)||s[t],e}),{}),l="preserve"!==a.getAttribute("xml:space"),f=y(m(a,"styling","style")),h=y(m(a,"layout","region")),p=m(a,"body","[begin]");return[].map.call(p,(function(e){var i=E(e,l);if(!i||!e.hasAttribute("begin"))return null;var a=b(e.getAttribute("begin"),u),s=b(e.getAttribute("dur"),u),p=b(e.getAttribute("end"),u);if(null===a)throw T(e);if(null===p){if(null===s)throw T(e);p=a+s}var g=new o.default(a-t,p-t,i);g.id=(0,c.generateCueId)(g.startTime,g.endTime,g.text);var m=function(e,t,i){var a="http://www.w3.org/ns/ttml#styling",s=null,o=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],u=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return u&&i.hasOwnProperty(u)&&(s=i[u]),o.reduce((function(i,o){var u=_(t,a,o)||_(e,a,o)||_(s,a,o);return u&&(i[o]=u),i}),{})}(h[e.getAttribute("region")],f[e.getAttribute("style")],f),y=m.textAlign;if(y){var S=v[y];S&&(g.lineAlign=S),g.align=y}return d(g,m),g})).filter((function(e){return null!==e}))}(e,g))}))}catch(e){f(e)}}else f(new Error("Could not parse IMSC1 mdat"))}function m(e,t,i){var a=e.getElementsByTagName(t)[0];return a?[].slice.call(a.querySelectorAll(i)):[]}function y(e){return e.reduce((function(e,t){var i=t.getAttribute("xml:id");return i&&(e[i]=t),e}),{})}function E(e,t){return[].slice.call(e.childNodes).reduce((function(e,i,a){var s;return"br"===i.nodeName&&a?e+"\n":null!==(s=i.childNodes)&&void 0!==s&&s.length?E(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent}),"")}function _(e,t,i){return e&&e.hasAttributeNS(t,i)?e.getAttributeNS(t,i):null}function T(e){return new Error("Could not parse ttml timestamp "+e)}function b(e,t){if(!e)return null;var i=(0,s.parseTimeStamp)(e);return null===i&&(h.test(e)?i=function(e,t){var i=h.exec(e),a=(0|i[4])+(0|i[5])/t.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+a/t.frameRate}(e,t):p.test(e)&&(i=function(e,t){var i=p.exec(e),a=Number(i[1]);switch(i[2]){case"h":return 3600*a;case"m":return 60*a;case"ms":return 1e3*a;case"f":return a/t.frameRate;case"t":return a/t.tickRate}return a}(e,t))),i}},"./src/utils/keysystem-util.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{changeEndianness:()=>s,convertDataUriToArrayBytes:()=>o,strToUtf8array:()=>u});var a=i("./src/utils/numeric-encoding-utils.ts");function s(e){var t=function(e,t,i){var a=e[t];e[t]=e[i],e[i]=a};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function o(e){var t,i,s=e.split(":"),o=null;if("data"===s[0]&&2===s.length){var l=s[1].split(";"),c=l[l.length-1].split(",");if(2===c.length){var d="base64"===c[0],f=c[1];d?(l.splice(-1,1),o=(0,a.base64Decode)(f)):(t=u(f).subarray(0,16),(i=new Uint8Array(16)).set(t,16-t.length),o=i)}}return o}function u(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(function(e){return e.charCodeAt(0)}))}},"./src/utils/logger.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{enableLogs:()=>l,logger:()=>c});var a=function(){},s={trace:a,debug:a,log:a,warn:a,info:a,error:a},o=s;function u(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];i.forEach((function(t){o[t]=e[t]?e[t].bind(e):function(e){var t=self.console[e];return t?t.bind(self.console,"["+e+"] >"):a}(t)}))}function l(e,t){if(self.console&&!0===e||"object"==typeof e){u(e,"debug","log","info","warn","error");try{o.log('Debug logs enabled for "'+t+'"')}catch(e){o=s}}else o=s}var c=s},"./src/utils/mediakeys-helper.ts":(e,t,i)=>{"use strict";var a,s,o;function u(e){switch(e){case s.FAIRPLAY:return a.FAIRPLAY;case s.PLAYREADY:return a.PLAYREADY;case s.WIDEVINE:return a.WIDEVINE;case s.CLEARKEY:return a.CLEARKEY}}function l(e){if(e===o.WIDEVINE)return a.WIDEVINE}function c(e){switch(e){case a.FAIRPLAY:return s.FAIRPLAY;case a.PLAYREADY:return s.PLAYREADY;case a.WIDEVINE:return s.WIDEVINE;case a.CLEARKEY:return s.CLEARKEY}}function d(e){var t=e.drmSystems,i=e.widevineLicenseUrl,s=t?[a.FAIRPLAY,a.WIDEVINE,a.PLAYREADY,a.CLEARKEY].filter((function(e){return!!t[e]})):[];return!s[a.WIDEVINE]&&i&&s.push(a.WIDEVINE),s}i.r(t),i.d(t,{KeySystemFormats:()=>s,KeySystemIds:()=>o,KeySystems:()=>a,getKeySystemsForConfig:()=>d,getSupportedMediaKeySystemConfigurations:()=>h,keySystemDomainToKeySystemFormat:()=>c,keySystemFormatToKeySystemDomain:()=>u,keySystemIdToKeySystemDomain:()=>l,requestMediaKeySystemAccess:()=>f}),function(e){e.CLEARKEY="org.w3.clearkey",e.FAIRPLAY="com.apple.fps",e.PLAYREADY="com.microsoft.playready",e.WIDEVINE="com.widevine.alpha"}(a||(a={})),function(e){e.CLEARKEY="org.w3.clearkey",e.FAIRPLAY="com.apple.streamingkeydelivery",e.PLAYREADY="com.microsoft.playready",e.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"}(s||(s={})),function(e){e.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"}(o||(o={}));var f="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function h(e,t,i,s){var o;switch(e){case a.FAIRPLAY:o=["cenc","sinf"];break;case a.WIDEVINE:case a.PLAYREADY:o=["cenc"];break;case a.CLEARKEY:o=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+e)}return function(e,t,i,a){var s={initDataTypes:e,persistentState:a.persistentState||"not-allowed",distinctiveIdentifier:a.distinctiveIdentifier||"not-allowed",sessionTypes:a.sessionTypes||[a.sessionType||"temporary"],audioCapabilities:t.map((function(e){return{contentType:'audio/mp4; codecs="'+e+'"',robustness:a.audioRobustness||"",encryptionScheme:a.audioEncryptionScheme||null}})),videoCapabilities:i.map((function(e){return{contentType:'video/mp4; codecs="'+e+'"',robustness:a.videoRobustness||"",encryptionScheme:a.videoEncryptionScheme||null}}))};return[s]}(o,t,i,s)}},"./src/utils/mediasource-helper.ts":(e,t,i)=>{"use strict";function a(){return self.MediaSource||self.WebKitMediaSource}i.r(t),i.d(t,{getMediaSource:()=>a})},"./src/utils/mp4-tools.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{RemuxerTrackIdConfig:()=>f,appendUint8Array:()=>D,bin2str:()=>h,computeRawDurationFromSamples:()=>A,discardEPB:()=>O,findBox:()=>y,getDuration:()=>R,getStartDTS:()=>S,mp4Box:()=>x,mp4pssh:()=>M,offsetStartDTS:()=>w,parseEmsg:()=>P,parseInitSegment:()=>_,parsePssh:()=>N,parseSEIMessageFromNALu:()=>C,parseSamples:()=>L,parseSegmentIndex:()=>E,parseSinf:()=>b,patchEncyptionData:()=>T,readSint32:()=>g,readUint16:()=>p,readUint32:()=>v,segmentValidRange:()=>I,writeUint32:()=>m});var a=i("./src/loader/fragment.ts"),s=i("./src/utils/typed-array.ts"),o=i("./src/demux/id3.ts"),u=i("./src/utils/logger.ts"),l=i("./src/utils/hex.ts"),c=Math.pow(2,32)-1,d=[].push,f={video:1,audio:2,id3:3,text:4};function h(e){return String.fromCharCode.apply(null,e)}function p(e,t){var i=e[t]<<8|e[t+1];return i<0?65536+i:i}function v(e,t){var i=g(e,t);return i<0?4294967296+i:i}function g(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function m(e,t,i){e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i}function y(e,t){var i=[];if(!t.length)return i;for(var a=e.byteLength,s=0;s<a;){var o=v(e,s),u=o>1?s+o:a;if(h(e.subarray(s+4,s+8))===t[0])if(1===t.length)i.push(e.subarray(s+8,u));else{var l=y(e.subarray(s+8,u),t.slice(1));l.length&&d.apply(i,l)}s=u}return i}function E(e){var t=[],i=e[0],a=8,s=v(e,a);a+=4,a+=0===i?8:16,a+=2;var o=e.length+0,u=p(e,a);a+=2;for(var l=0;l<u;l++){var c=a,d=v(e,c);c+=4;var f=2147483647&d;if(1==(2147483648&d)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var h=v(e,c);c+=4,t.push({referenceSize:f,subsegmentDuration:h,info:{duration:h/s,start:o,end:o+f-1}}),o+=f,a=c+=4}return{earliestPresentationTime:0,timescale:s,version:i,referencesCount:u,references:t}}function _(e){for(var t=[],i=y(e,["moov","trak"]),s=0;s<i.length;s++){var o=i[s],u=y(o,["tkhd"])[0];if(u){var l=u[0],c=0===l?12:20,d=v(u,c),f=y(o,["mdia","mdhd"])[0];if(f){var p=v(f,c=0===(l=f[0])?12:20),g=y(o,["mdia","hdlr"])[0];if(g){var m=h(g.subarray(8,12)),E={soun:a.ElementaryStreamTypes.AUDIO,vide:a.ElementaryStreamTypes.VIDEO}[m];if(E){var _=y(o,["mdia","minf","stbl","stsd"])[0],T=void 0;_&&(T=h(_.subarray(12,16))),t[d]={timescale:p,type:E},t[E]={timescale:p,id:d,codec:T}}}}}}return y(e,["moov","mvex","trex"]).forEach((function(e){var i=v(e,4),a=t[i];a&&(a.default={duration:v(e,12),flags:v(e,20)})})),t}function T(e,t){if(!e||!t)return e;var i=t.keyId;return i&&t.isCommonEncryption&&y(e,["moov","trak"]).forEach((function(e){var t=y(e,["mdia","minf","stbl","stsd"])[0].subarray(8),a=y(t,["enca"]),s=a.length>0;s||(a=y(t,["encv"])),a.forEach((function(e){y(s?e.subarray(28):e.subarray(78),["sinf"]).forEach((function(e){var t=b(e);if(t){var a=t.subarray(8,24);a.some((function(e){return 0!==e}))||(u.logger.log("[eme] Patching keyId in 'enc"+(s?"a":"v")+">sinf>>tenc' box: "+l.default.hexDump(a)+" -> "+l.default.hexDump(i)),t.set(i,8))}}))}))})),e}function b(e){var t=y(e,["schm"])[0];if(t){var i=h(t.subarray(4,8));if("cbcs"===i||"cenc"===i)return y(e,["schi","tenc"])[0]}return u.logger.error("[eme] missing 'schm' box"),null}function S(e,t){return y(t,["moof","traf"]).reduce((function(t,i){var a=y(i,["tfdt"])[0],s=a[0],o=y(i,["tfhd"]).reduce((function(t,i){var o=v(i,4),u=e[o];if(u){var l=v(a,4);1===s&&(l*=Math.pow(2,32),l+=v(a,8));var c=l/(u.timescale||9e4);if(isFinite(c)&&(null===t||c<t))return c}return t}),null);return null!==o&&isFinite(o)&&(null===t||o<t)?o:t}),null)||0}function R(e,t){for(var i=0,s=0,o=0,u=y(e,["moof","traf"]),l=0;l<u.length;l++){var c=u[l],d=y(c,["tfhd"])[0],f=t[v(d,4)];if(f){var h=f.default,p=v(d,0)|(null==h?void 0:h.flags),g=null==h?void 0:h.duration;8&p&&(g=v(d,2&p?12:8));for(var m=f.timescale||9e4,_=y(c,["trun"]),T=0;T<_.length;T++)!(i=A(_[T]))&&g&&(i=g*v(_[T],4)),f.type===a.ElementaryStreamTypes.VIDEO?s+=i/m:f.type===a.ElementaryStreamTypes.AUDIO&&(o+=i/m)}}if(0===s&&0===o){for(var b=0,S=y(e,["sidx"]),R=0;R<S.length;R++){var w=E(S[R]);null!=w&&w.references&&(b+=w.references.reduce((function(e,t){return e+t.info.duration||0}),0))}return b}return s||o}function A(e){var t=v(e,0),i=8;1&t&&(i+=4),4&t&&(i+=4);for(var a=0,s=v(e,4),o=0;o<s;o++)256&t&&(a+=v(e,i),i+=4),512&t&&(i+=4),1024&t&&(i+=4),2048&t&&(i+=4);return a}function w(e,t,i){y(t,["moof","traf"]).forEach((function(t){y(t,["tfhd"]).forEach((function(a){var s=v(a,4),o=e[s];if(o){var u=o.timescale||9e4;y(t,["tfdt"]).forEach((function(e){var t=e[0],a=v(e,4);if(0===t)a-=i*u,m(e,4,a=Math.max(a,0));else{a*=Math.pow(2,32),a+=v(e,8),a-=i*u,a=Math.max(a,0);var s=Math.floor(a/(c+1)),o=Math.floor(a%(c+1));m(e,4,s),m(e,8,o)}}))}}))}))}function I(e){var t={valid:null,remainder:null},i=y(e,["moof"]);if(!i)return t;if(i.length<2)return t.remainder=e,t;var a=i[i.length-1];return t.valid=(0,s.sliceUint8)(e,0,a.byteOffset-8),t.remainder=(0,s.sliceUint8)(e,a.byteOffset-8),t}function D(e,t){var i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function L(e,t){var i=[],s=t.samples,o=t.timescale,u=t.id,l=!1;return y(s,["moof"]).map((function(c){var d=c.byteOffset-8;y(c,["traf"]).map((function(c){var f=y(c,["tfdt"]).map((function(e){var t=e[0],i=v(e,4);return 1===t&&(i*=Math.pow(2,32),i+=v(e,8)),i/o}))[0];return void 0!==f&&(e=f),y(c,["tfhd"]).map((function(f){var h=v(f,4),p=16777215&v(f,0),m=0,E=0!=(16&p),_=0,T=0!=(32&p),b=8;h===u&&(0!=(1&p)&&(b+=8),0!=(2&p)&&(b+=4),0!=(8&p)&&(m=v(f,b),b+=4),E&&(_=v(f,b),b+=4),T&&(b+=4),"video"===t.type&&(l=function(e){if(!e)return!1;var t=e.indexOf("."),i=t<0?e:e.substring(0,t);return"hvc1"===i||"hev1"===i||"dvh1"===i||"dvhe"===i}(t.codec)),y(c,["trun"]).map((function(u){var c=u[0],f=16777215&v(u,0),h=0!=(1&f),p=0,y=0!=(4&f),E=0!=(256&f),T=0,b=0!=(512&f),S=0,R=0!=(1024&f),A=0!=(2048&f),w=0,I=v(u,4),D=8;h&&(p=v(u,D),D+=4),y&&(D+=4);for(var L=p+d,O=0;O<I;O++){if(E?(T=v(u,D),D+=4):T=m,b?(S=v(u,D),D+=4):S=_,R&&(D+=4),A&&(w=0===c?v(u,D):g(u,D),D+=4),t.type===a.ElementaryStreamTypes.VIDEO)for(var P=0;P<S;){var x=v(s,L);k(l,s[L+=4])&&C(s.subarray(L,L+x),l?2:1,e+w/o,i),L+=x,P+=x+4}e+=T/o}})))}))}))})),i}function k(e,t){if(e){var i=t>>1&63;return 39===i||40===i}return 6==(31&t)}function C(e,t,i,a){var s=O(e),u=0;u+=t;for(var l=0,c=0,d=!1,f=0;u<s.length;){l=0;do{if(u>=s.length)break;l+=f=s[u++]}while(255===f);c=0;do{if(u>=s.length)break;c+=f=s[u++]}while(255===f);var h=s.length-u;if(!d&&4===l&&u<s.length){if(d=!0,181===s[u++]){var g=p(s,u);if(u+=2,49===g){var m=v(s,u);if(u+=4,1195456820===m){var y=s[u++];if(3===y){var E=s[u++],_=64&E,T=_?2+3*(31&E):0,b=new Uint8Array(T);if(_){b[0]=E;for(var S=1;S<T;S++)b[S]=s[u++]}a.push({type:y,payloadType:l,pts:i,bytes:b})}}}}}else if(5===l&&c<h){if(d=!0,c>16){for(var R=[],A=0;A<16;A++){var w=s[u++].toString(16);R.push(1==w.length?"0"+w:w),3!==A&&5!==A&&7!==A&&9!==A||R.push("-")}for(var I=c-16,D=new Uint8Array(I),L=0;L<I;L++)D[L]=s[u++];a.push({payloadType:l,pts:i,uuid:R.join(""),userData:(0,o.utf8ArrayToStr)(D),userDataBytes:D})}}else if(c<h)u+=c;else if(c>h)break}}function O(e){for(var t=e.byteLength,i=[],a=1;a<t-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return e;var s=t-i.length,o=new Uint8Array(s),u=0;for(a=0;a<s;u++,a++)u===i[0]&&(u++,i.shift()),o[a]=e[u];return o}function P(e){var t=e[0],i="",a="",s=0,o=0,u=0,l=0,c=0,d=0;if(0===t){for(;"\0"!==h(e.subarray(d,d+1));)i+=h(e.subarray(d,d+1)),d+=1;for(i+=h(e.subarray(d,d+1)),d+=1;"\0"!==h(e.subarray(d,d+1));)a+=h(e.subarray(d,d+1)),d+=1;a+=h(e.subarray(d,d+1)),d+=1,s=v(e,12),o=v(e,16),l=v(e,20),c=v(e,24),d=28}else if(1===t){s=v(e,d+=4);var f=v(e,d+=4),p=v(e,d+=4);for(d+=4,u=Math.pow(2,32)*f+p,Number.isSafeInteger(u)||(u=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=v(e,d),c=v(e,d+=4),d+=4;"\0"!==h(e.subarray(d,d+1));)i+=h(e.subarray(d,d+1)),d+=1;for(i+=h(e.subarray(d,d+1)),d+=1;"\0"!==h(e.subarray(d,d+1));)a+=h(e.subarray(d,d+1)),d+=1;a+=h(e.subarray(d,d+1)),d+=1}return{schemeIdUri:i,value:a,timeScale:s,presentationTime:u,presentationTimeDelta:o,eventDuration:l,id:c,payload:e.subarray(d,e.byteLength)}}function x(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];for(var s=i.length,o=8,u=s;u--;)o+=i[u].byteLength;var l=new Uint8Array(o);for(l[0]=o>>24&255,l[1]=o>>16&255,l[2]=o>>8&255,l[3]=255&o,l.set(e,4),u=0,o=8;u<s;u++)l.set(i[u],o),o+=i[u].byteLength;return l}function M(e,t,i){if(16!==e.byteLength)throw new RangeError("Invalid system id");var a,s,o;if(t){a=1,s=new Uint8Array(16*t.length);for(var u=0;u<t.length;u++){var l=t[u];if(16!==l.byteLength)throw new RangeError("Invalid key");s.set(l,16*u)}}else a=0,s=new Uint8Array;a>0?(o=new Uint8Array(4),t.length>0&&new DataView(o.buffer).setUint32(0,t.length,!1)):o=new Uint8Array;var c=new Uint8Array(4);return i&&i.byteLength>0&&new DataView(c.buffer).setUint32(0,i.byteLength,!1),x([112,115,115,104],new Uint8Array([a,0,0,0]),e,o,s,c,i||new Uint8Array)}function N(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;var t={version:0,systemId:"",kids:null,data:null},i=new DataView(e),a=i.getUint32(0);if(e.byteLength!==a&&a>44)return null;if(1886614376!==i.getUint32(4))return null;if(t.version=i.getUint32(8)>>>24,t.version>1)return null;t.systemId=l.default.hexDump(new Uint8Array(e,12,16));var s=i.getUint32(28);if(0===t.version){if(a-32<s)return null;t.data=new Uint8Array(e,32,s)}else if(1===t.version){t.kids=[];for(var o=0;o<s;o++)t.kids.push(new Uint8Array(e,32+16*o,16))}return t}},"./src/utils/numeric-encoding-utils.ts":(e,t,i)=>{"use strict";function a(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function s(e){return btoa(e)}function o(e){return atob(e)}function u(e){return btoa(String.fromCharCode.apply(String,e))}function l(e){return a(u(e))}function c(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)}))}i.r(t),i.d(t,{base64Decode:()=>c,base64DecodeToStr:()=>o,base64Encode:()=>u,base64ToBase64Url:()=>a,base64UrlEncode:()=>l,strToBase64Encode:()=>s})},"./src/utils/output-filter.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var a=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,i){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[],this.startTime=null},e}()},"./src/utils/texttrack-utils.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{addCueToTrack:()=>o,clearCurrentCues:()=>u,getCuesInRange:()=>c,removeCuesInRange:()=>l,sendAddTrackEvent:()=>s});var a=i("./src/utils/logger.ts");function s(e,t){var i;try{i=new Event("addtrack")}catch(e){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function o(e,t){var i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(i){a.logger.debug("[texttrack-utils]: "+i);var s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,e.addCue(s)}"disabled"===i&&(e.mode=i)}function u(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var i=e.cues.length;i--;)e.removeCue(e.cues[i]);"disabled"===t&&(e.mode=t)}function l(e,t,i,a){var s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var o=c(e.cues,t,i),u=0;u<o.length;u++)a&&!a(o[u])||e.removeCue(o[u]);"disabled"===s&&(e.mode=s)}function c(e,t,i){var a=[],s=function(e,t){if(t<e[0].startTime)return 0;var i=e.length-1;if(t>e[i].endTime)return-1;for(var a=0,s=i;a<=s;){var o=Math.floor((s+a)/2);if(t<e[o].startTime)s=o-1;else{if(!(t>e[o].startTime&&a<i))return o;a=o+1}}return e[a].startTime-t<t-e[s].startTime?a:s}(e,t);if(s>-1)for(var o=s,u=e.length;o<u;o++){var l=e[o];if(l.startTime>=t&&l.endTime<=i)a.push(l);else if(l.startTime>i)return a}return a}},"./src/utils/time-ranges.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});const a={toString:function(e){for(var t="",i=e.length,a=0;a<i;a++)t+="["+e.start(a).toFixed(3)+"-"+e.end(a).toFixed(3)+"]";return t}}},"./src/utils/timescale-conversion.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{toMpegTsClockFromTimescale:()=>l,toMsFromMpegTsClock:()=>u,toTimescaleFromBase:()=>s,toTimescaleFromScale:()=>o});var a=9e4;function s(e,t,i,a){void 0===i&&(i=1),void 0===a&&(a=!1);var s=e*t*i;return a?Math.round(s):s}function o(e,t,i,a){return void 0===i&&(i=1),void 0===a&&(a=!1),s(e,t,1/i,a)}function u(e,t){return void 0===t&&(t=!1),s(e,1e3,1/a,t)}function l(e,t){return void 0===t&&(t=1),s(e,a,1/t)}},"./src/utils/typed-array.ts":(e,t,i)=>{"use strict";function a(e,t,i){return Uint8Array.prototype.slice?e.slice(t,i):new Uint8Array(Array.prototype.slice.call(e,t,i))}i.r(t),i.d(t,{sliceUint8:()=>a})},"./src/utils/vttcue.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});const a=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function i(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;var i=t.toLowerCase();return!!~e.indexOf(i)&&i}function a(e){return i(t,e)}function s(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];for(var s=1;s<arguments.length;s++){var o=arguments[s];for(var u in o)e[u]=o[u]}return e}function o(t,o,u){var l=this,c={enumerable:!0};l.hasBeenReset=!1;var d="",f=!1,h=t,p=o,v=u,g=null,m="",y=!0,E="auto",_="start",T=50,b="middle",S=50,R="middle";Object.defineProperty(l,"id",s({},c,{get:function(){return d},set:function(e){d=""+e}})),Object.defineProperty(l,"pauseOnExit",s({},c,{get:function(){return f},set:function(e){f=!!e}})),Object.defineProperty(l,"startTime",s({},c,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(l,"endTime",s({},c,{get:function(){return p},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(l,"text",s({},c,{get:function(){return v},set:function(e){v=""+e,this.hasBeenReset=!0}})),Object.defineProperty(l,"region",s({},c,{get:function(){return g},set:function(e){g=e,this.hasBeenReset=!0}})),Object.defineProperty(l,"vertical",s({},c,{get:function(){return m},set:function(t){var a=function(t){return i(e,t)}(t);if(!1===a)throw new SyntaxError("An invalid or illegal string was specified.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(l,"snapToLines",s({},c,{get:function(){return y},set:function(e){y=!!e,this.hasBeenReset=!0}})),Object.defineProperty(l,"line",s({},c,{get:function(){return E},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(l,"lineAlign",s({},c,{get:function(){return _},set:function(e){var t=a(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(l,"position",s({},c,{get:function(){return T},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(l,"positionAlign",s({},c,{get:function(){return b},set:function(e){var t=a(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(l,"size",s({},c,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(l,"align",s({},c,{get:function(){return R},set:function(e){var t=a(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");R=t,this.hasBeenReset=!0}})),l.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}()},"./src/utils/vttparser.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{VTTParser:()=>p,fixLineBreaks:()=>h,parseTimeStamp:()=>o});var a=i("./src/utils/vttcue.ts"),s=function(){function e(){}return e.prototype.decode=function(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},e}();function o(e){function t(e,t,i,a){return 3600*(0|e)+60*(0|t)+(0|i)+parseFloat(a||0)}var i=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?t(i[2],i[3],0,i[4]):t(i[1],i[2],i[3],i[4]):null}var u=function(){function e(){this.values=Object.create(null)}var t=e.prototype;return t.set=function(e,t){this.get(e)||""===t||(this.values[e]=t)},t.get=function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},t.has=function(e){return e in this.values},t.alt=function(e,t,i){for(var a=0;a<i.length;++a)if(t===i[a]){this.set(e,t);break}},t.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},t.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1},e}();function l(e,t,i,a){var s=a?e.split(a):[e];for(var o in s)if("string"==typeof s[o]){var u=s[o].split(i);2===u.length&&t(u[0],u[1])}}var c=new a.default(0,0,""),d="middle"===c.align?"middle":"center";function f(e,t,i){var a=e;function s(){var t=o(e);if(null===t)throw new Error("Malformed timestamp: "+a);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function f(){e=e.replace(/^\s+/,"")}if(f(),t.startTime=s(),f(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+a);e=e.slice(3),f(),t.endTime=s(),f(),function(e,t){var a=new u;l(e,(function(e,t){var s;switch(e){case"region":for(var o=i.length-1;o>=0;o--)if(i[o].id===t){a.set(e,i[o].region);break}break;case"vertical":a.alt(e,t,["rl","lr"]);break;case"line":s=t.split(","),a.integer(e,s[0]),a.percent(e,s[0])&&a.set("snapToLines",!1),a.alt(e,s[0],["auto"]),2===s.length&&a.alt("lineAlign",s[1],["start",d,"end"]);break;case"position":s=t.split(","),a.percent(e,s[0]),2===s.length&&a.alt("positionAlign",s[1],["start",d,"end","line-left","line-right","auto"]);break;case"size":a.percent(e,t);break;case"align":a.alt(e,t,["start",d,"end","left","right"])}}),/:/,/\s/),t.region=a.get("region",null),t.vertical=a.get("vertical","");var s=a.get("line","auto");"auto"===s&&-1===c.line&&(s=-1),t.line=s,t.lineAlign=a.get("lineAlign","start"),t.snapToLines=a.get("snapToLines",!0),t.size=a.get("size",100),t.align=a.get("align",d);var o=a.get("position","auto");"auto"===o&&50===c.position&&(o="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=o}(e,t)}function h(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var p=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new s,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var t=e.prototype;return t.parse=function(e){var t=this;function i(){var e=t.buffer,i=0;for(e=h(e);i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;var a=e.slice(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.slice(i),a}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var s="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var o=(s=i()).match(/^(Ã¯Â»Â¿)?WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var u=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(u?u=!1:s=i(),t.state){case"HEADER":/:/.test(s)?l(s,(function(e,t){}),/:/):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new a.default(0,0,""),t.state="CUE",-1===s.indexOf("--\x3e")){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{f(s,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var c=-1!==s.indexOf("--\x3e");if(!s||c&&(u=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=s;continue;case"BADCUE":s||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},t.flush=function(){var e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},e}()},"./src/utils/webvtt-parser.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{generateCueId:()=>p,parseWebVTT:()=>g});var a=i("./src/polyfills/number.ts"),s=i("./src/utils/vttparser.ts"),o=i("./src/demux/id3.ts"),u=i("./src/utils/timescale-conversion.ts"),l=i("./src/remux/mp4-remuxer.ts"),c=/\r\n|\n\r|\n|\r/g,d=function(e,t,i){return void 0===i&&(i=0),e.slice(i,i+t.length)===t},f=function(e){var t=parseInt(e.slice(-3)),i=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),o=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!((0,a.isFiniteNumber)(t)&&(0,a.isFiniteNumber)(i)&&(0,a.isFiniteNumber)(s)&&(0,a.isFiniteNumber)(o)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*i,t+=6e4*s,t+=36e5*o},h=function(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()};function p(e,t,i){return h(e.toString())+h(t.toString())+h(i)}var v=function(e,t,i){var a=e[t],s=e[a.prevCC];if(!s||!s.new&&a.new)return e.ccOffset=e.presentationOffset=a.start,void(a.new=!1);for(;null!==(o=s)&&void 0!==o&&o.new;){var o;e.ccOffset+=a.start-s.start,a.new=!1,s=e[(a=s).prevCC]}e.presentationOffset=i};function g(e,t,i,a,h,g,m,y){var E,_=new s.VTTParser,T=(0,o.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(c,"\n").split("\n"),b=[],S=(0,u.toMpegTsClockFromTimescale)(t,i),R="00:00.000",A=0,w=0,I=!0;_.oncue=function(e){var t=a[h],i=a.ccOffset,s=(A-S)/9e4;null!=t&&t.new&&(void 0!==w?i=a.ccOffset=t.start:v(a,h,s)),s&&(i=s-a.presentationOffset);var o=e.endTime-e.startTime,u=(0,l.normalizePts)(9e4*(e.startTime+i-w),9e4*g)/9e4;e.startTime=Math.max(u,0),e.endTime=Math.max(u+o,0);var c=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(c)),e.id||(e.id=p(e.startTime,e.endTime,c)),e.endTime>0&&b.push(e)},_.onparsingerror=function(e){E=e},_.onflush=function(){E?y(E):m(b)},T.forEach((function(e){if(I){if(d(e,"X-TIMESTAMP-MAP=")){I=!1,e.slice(16).split(",").forEach((function(e){d(e,"LOCAL:")?R=e.slice(6):d(e,"MPEGTS:")&&(A=parseInt(e.slice(7)))}));try{w=f(R)/1e3}catch(e){E=e}return}""===e&&(I=!1)}_.parse(e+"\n")})),_.flush()}},"./src/utils/xhr-loader.ts":(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var a=i("./src/utils/logger.ts"),s=i("./src/loader/load-stats.ts"),o=/^age:\s*[\d.]+\s*$/m;const u=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new s.LoadStats,this.retryDelay=0}var t=e.prototype;return t.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},t.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e=this.config,t=this.context;if(e){var i=this.loader=new self.XMLHttpRequest,a=this.stats;a.loading.first=0,a.loaded=0;var s=this.xhrSetup;try{if(s)try{s(i,t.url)}catch(e){i.open("GET",t.url,!0),s(i,t.url)}i.readyState||i.open("GET",t.url,!0);var o=this.context.headers;if(o)for(var u in o)i.setRequestHeader(u,o[u])}catch(e){return void this.callbacks.onError({code:i.status,text:e.message},t,i)}t.rangeEnd&&i.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),i.send()}},t.readystatechange=function(){var e=this.context,t=this.loader,i=this.stats;if(e&&t){var s=t.readyState,o=this.config;if(!i.aborted&&s>=2)if(self.clearTimeout(this.requestTimeout),0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start)),4===s){t.onreadystatechange=null,t.onprogress=null;var u=t.status,l="arraybuffer"===t.responseType;if(u>=200&&u<300&&(l&&t.response||null!==t.responseText)){var c,d;if(i.loading.end=Math.max(self.performance.now(),i.loading.first),d=l?(c=t.response).byteLength:(c=t.responseText).length,i.loaded=i.total=d,!this.callbacks)return;var f=this.callbacks.onProgress;if(f&&f(i,e,c,t),!this.callbacks)return;var h={url:t.responseURL,data:c};this.callbacks.onSuccess(h,i,e,t)}else i.retry>=o.maxRetry||u>=400&&u<499?(a.logger.error(u+" while loading "+e.url),this.callbacks.onError({code:u,text:t.statusText},e,t)):(a.logger.warn(u+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),i.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout)}},t.loadtimeout=function(){a.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},t.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},t.getCacheAge=function(){var e=null;if(this.loader&&o.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},e}()},"./node_modules/eventemitter3/index.js":e=>{"use strict";var t=Object.prototype.hasOwnProperty,i="~";function a(){}function s(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,a,o,u){if("function"!=typeof a)throw new TypeError("The listener must be a function");var l=new s(a,o||e,u),c=i?i+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],l]:e._events[c].push(l):(e._events[c]=l,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function l(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(i=!1)),l.prototype.eventNames=function(){var e,a,s=[];if(0===this._eventsCount)return s;for(a in e=this._events)t.call(e,a)&&s.push(i?a.slice(1):a);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},l.prototype.listeners=function(e){var t=i?i+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var s=0,o=a.length,u=new Array(o);s<o;s++)u[s]=a[s].fn;return u},l.prototype.listenerCount=function(e){var t=i?i+e:e,a=this._events[t];return a?a.fn?1:a.length:0},l.prototype.emit=function(e,t,a,s,o,u){var l=i?i+e:e;if(!this._events[l])return!1;var c,d,f=this._events[l],h=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),h){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,a),!0;case 4:return f.fn.call(f.context,t,a,s),!0;case 5:return f.fn.call(f.context,t,a,s,o),!0;case 6:return f.fn.call(f.context,t,a,s,o,u),!0}for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];f.fn.apply(f.context,c)}else{var p,v=f.length;for(d=0;d<v;d++)switch(f[d].once&&this.removeListener(e,f[d].fn,void 0,!0),h){case 1:f[d].fn.call(f[d].context);break;case 2:f[d].fn.call(f[d].context,t);break;case 3:f[d].fn.call(f[d].context,t,a);break;case 4:f[d].fn.call(f[d].context,t,a,s);break;default:if(!c)for(p=1,c=new Array(h-1);p<h;p++)c[p-1]=arguments[p];f[d].fn.apply(f[d].context,c)}}return!0},l.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},l.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},l.prototype.removeListener=function(e,t,a,s){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return u(this,o),this;var l=this._events[o];if(l.fn)l.fn!==t||s&&!l.once||a&&l.context!==a||u(this,o);else{for(var c=0,d=[],f=l.length;c<f;c++)(l[c].fn!==t||s&&!l[c].once||a&&l[c].context!==a)&&d.push(l[c]);d.length?this._events[o]=1===d.length?d[0]:d:u(this,o)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&u(this,t)):(this._events=new a,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=i,l.EventEmitter=l,e.exports=l},"./node_modules/url-toolkit/src/url-toolkit.js":function(e){var t,i,a,s,o;t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,a){if(a=a||{},e=e.trim(),!(t=t.trim())){if(!a.alwaysNormalize)return e;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");return s.path=o.normalizePath(s.path),o.buildURLFromParts(s)}var u=o.parseURL(t);if(!u)throw new Error("Error trying to parse relative URL.");if(u.scheme)return a.alwaysNormalize?(u.path=o.normalizePath(u.path),o.buildURLFromParts(u)):t;var l=o.parseURL(e);if(!l)throw new Error("Error trying to parse base URL.");if(!l.netLoc&&l.path&&"/"!==l.path[0]){var c=i.exec(l.path);l.netLoc=c[1],l.path=c[2]}l.netLoc&&!l.path&&(l.path="/");var d={scheme:l.scheme,netLoc:u.netLoc,path:null,params:u.params,query:u.query,fragment:u.fragment};if(!u.netLoc&&(d.netLoc=l.netLoc,"/"!==u.path[0]))if(u.path){var f=l.path,h=f.substring(0,f.lastIndexOf("/")+1)+u.path;d.path=o.normalizePath(h)}else d.path=l.path,u.params||(d.params=l.params,u.query||(d.query=l.query));return null===d.path&&(d.path=a.alwaysNormalize?o.normalizePath(u.path):u.path),o.buildURLFromParts(d)},parseURL:function(e){var i=t.exec(e);return i?{scheme:i[1]||"",netLoc:i[2]||"",path:i[3]||"",params:i[4]||"",query:i[5]||"",fragment:i[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o}},t={};function i(a){var s=t[a];if(void 0!==s)return s.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,i),o.exports}i.m=e,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a=i("./src/hls.ts");return a=a.default})(),e.exports=t())},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),i=t[0],a=t[1];return 3*(i+a)/4-a},t.toByteArray=function(e){var t,i,o=l(e),u=o[0],c=o[1],d=new s(function(e,t,i){return 3*(t+i)/4-i}(0,u,c)),f=0,h=c>0?u-4:u;for(i=0;i<h;i+=4)t=a[e.charCodeAt(i)]<<18|a[e.charCodeAt(i+1)]<<12|a[e.charCodeAt(i+2)]<<6|a[e.charCodeAt(i+3)],d[f++]=t>>16&255,d[f++]=t>>8&255,d[f++]=255&t;2===c&&(t=a[e.charCodeAt(i)]<<2|a[e.charCodeAt(i+1)]>>4,d[f++]=255&t);1===c&&(t=a[e.charCodeAt(i)]<<10|a[e.charCodeAt(i+1)]<<4|a[e.charCodeAt(i+2)]>>2,d[f++]=t>>8&255,d[f++]=255&t);return d},t.fromByteArray=function(e){for(var t,a=e.length,s=a%3,o=[],u=16383,l=0,d=a-s;l<d;l+=u)o.push(c(e,l,l+u>d?d:l+u));1===s?(t=e[a-1],o.push(i[t>>2]+i[t<<4&63]+"==")):2===s&&(t=(e[a-2]<<8)+e[a-1],o.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return o.join("")};for(var i=[],a=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0;u<64;++u)i[u]=o[u],a[o.charCodeAt(u)]=u;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function c(e,t,a){for(var s,o,u=[],l=t;l<a;l+=3)s=(e[l]<<16&16711680)+(e[l+1]<<8&65280)+(255&e[l+2]),u.push(i[(o=s)>>18&63]+i[o>>12&63]+i[o>>6&63]+i[63&o]);return u.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},8764:(e,t,i)=>{"use strict";const a=i(9742),s=i(645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50;const u=2147483647;function l(e){if(e>u)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,i){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return d(e,t,i)}function d(e,t,i){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const i=0|m(e,t);let a=l(i);const s=a.write(e,t);s!==i&&(a=a.slice(0,s));return a}(e,t);if(ArrayBuffer.isView(e))return function(e){if($(e,Uint8Array)){const t=new Uint8Array(e);return v(t.buffer,t.byteOffset,t.byteLength)}return p(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if($(e,ArrayBuffer)||e&&$(e.buffer,ArrayBuffer))return v(e,t,i);if("undefined"!=typeof SharedArrayBuffer&&($(e,SharedArrayBuffer)||e&&$(e.buffer,SharedArrayBuffer)))return v(e,t,i);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const a=e.valueOf&&e.valueOf();if(null!=a&&a!==e)return c.from(a,t,i);const s=function(e){if(c.isBuffer(e)){const t=0|g(e.length),i=l(t);return 0===i.length||e.copy(i,0,0,t),i}if(void 0!==e.length)return"number"!=typeof e.length||J(e.length)?l(0):p(e);if("Buffer"===e.type&&Array.isArray(e.data))return p(e.data)}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function f(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return f(e),l(e<0?0:0|g(e))}function p(e){const t=e.length<0?0:0|g(e.length),i=l(t);for(let a=0;a<t;a+=1)i[a]=255&e[a];return i}function v(e,t,i){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(i||0))throw new RangeError('"length" is outside of buffer bounds');let a;return a=void 0===t&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,t):new Uint8Array(e,t,i),Object.setPrototypeOf(a,c.prototype),a}function g(e){if(e>=u)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+u.toString(16)+" bytes");return 0|e}function m(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||$(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const i=e.length,a=arguments.length>2&&!0===arguments[2];if(!a&&0===i)return 0;let s=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return X(e).length;default:if(s)return a?-1:z(e).length;t=(""+t).toLowerCase(),s=!0}}function y(e,t,i){let a=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,i);case"utf8":case"utf-8":return D(this,t,i);case"ascii":return k(this,t,i);case"latin1":case"binary":return C(this,t,i);case"base64":return I(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,i);default:if(a)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function E(e,t,i){const a=e[t];e[t]=e[i],e[i]=a}function _(e,t,i,a,s){if(0===e.length)return-1;if("string"==typeof i?(a=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),J(i=+i)&&(i=s?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(s)return-1;i=e.length-1}else if(i<0){if(!s)return-1;i=0}if("string"==typeof t&&(t=c.from(t,a)),c.isBuffer(t))return 0===t.length?-1:T(e,t,i,a,s);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):T(e,[t],i,a,s);throw new TypeError("val must be string, number or Buffer")}function T(e,t,i,a,s){let o,u=1,l=e.length,c=t.length;if(void 0!==a&&("ucs2"===(a=String(a).toLowerCase())||"ucs-2"===a||"utf16le"===a||"utf-16le"===a)){if(e.length<2||t.length<2)return-1;u=2,l/=2,c/=2,i/=2}function d(e,t){return 1===u?e[t]:e.readUInt16BE(t*u)}if(s){let a=-1;for(o=i;o<l;o++)if(d(e,o)===d(t,-1===a?0:o-a)){if(-1===a&&(a=o),o-a+1===c)return a*u}else-1!==a&&(o-=o-a),a=-1}else for(i+c>l&&(i=l-c),o=i;o>=0;o--){let i=!0;for(let a=0;a<c;a++)if(d(e,o+a)!==d(t,a)){i=!1;break}if(i)return o}return-1}function b(e,t,i,a){i=Number(i)||0;const s=e.length-i;a?(a=Number(a))>s&&(a=s):a=s;const o=t.length;let u;for(a>o/2&&(a=o/2),u=0;u<a;++u){const a=parseInt(t.substr(2*u,2),16);if(J(a))return u;e[i+u]=a}return u}function S(e,t,i,a){return Q(z(t,e.length-i),e,i,a)}function R(e,t,i,a){return Q(function(e){const t=[];for(let i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,a)}function A(e,t,i,a){return Q(X(t),e,i,a)}function w(e,t,i,a){return Q(function(e,t){let i,a,s;const o=[];for(let u=0;u<e.length&&!((t-=2)<0);++u)i=e.charCodeAt(u),a=i>>8,s=i%256,o.push(s),o.push(a);return o}(t,e.length-i),e,i,a)}function I(e,t,i){return 0===t&&i===e.length?a.fromByteArray(e):a.fromByteArray(e.slice(t,i))}function D(e,t,i){i=Math.min(e.length,i);const a=[];let s=t;for(;s<i;){const t=e[s];let o=null,u=t>239?4:t>223?3:t>191?2:1;if(s+u<=i){let i,a,l,c;switch(u){case 1:t<128&&(o=t);break;case 2:i=e[s+1],128==(192&i)&&(c=(31&t)<<6|63&i,c>127&&(o=c));break;case 3:i=e[s+1],a=e[s+2],128==(192&i)&&128==(192&a)&&(c=(15&t)<<12|(63&i)<<6|63&a,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:i=e[s+1],a=e[s+2],l=e[s+3],128==(192&i)&&128==(192&a)&&128==(192&l)&&(c=(15&t)<<18|(63&i)<<12|(63&a)<<6|63&l,c>65535&&c<1114112&&(o=c))}}null===o?(o=65533,u=1):o>65535&&(o-=65536,a.push(o>>>10&1023|55296),o=56320|1023&o),a.push(o),s+=u}return function(e){const t=e.length;if(t<=L)return String.fromCharCode.apply(String,e);let i="",a=0;for(;a<t;)i+=String.fromCharCode.apply(String,e.slice(a,a+=L));return i}(a)}t.kMaxLength=u,c.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,i){return d(e,t,i)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,i){return function(e,t,i){return f(e),e<=0?l(e):void 0!==t?"string"==typeof i?l(e).fill(t,i):l(e).fill(t):l(e)}(e,t,i)},c.allocUnsafe=function(e){return h(e)},c.allocUnsafeSlow=function(e){return h(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if($(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),$(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let i=e.length,a=t.length;for(let s=0,o=Math.min(i,a);s<o;++s)if(e[s]!==t[s]){i=e[s],a=t[s];break}return i<a?-1:a<i?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);let i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;const a=c.allocUnsafe(t);let s=0;for(i=0;i<e.length;++i){let t=e[i];if($(t,Uint8Array))s+t.length>a.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(a,s)):Uint8Array.prototype.set.call(a,t,s);else{if(!c.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(a,s)}s+=t.length}return a},c.byteLength=m,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)E(this,t,t+1);return this},c.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)E(this,t,t+3),E(this,t+1,t+2);return this},c.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)E(this,t,t+7),E(this,t+1,t+6),E(this,t+2,t+5),E(this,t+3,t+4);return this},c.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?D(this,0,e):y.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="";const i=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(e+=" ... "),"<Buffer "+e+">"},o&&(c.prototype[o]=c.prototype.inspect),c.prototype.compare=function(e,t,i,a,s){if($(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===a&&(a=0),void 0===s&&(s=this.length),t<0||i>e.length||a<0||s>this.length)throw new RangeError("out of range index");if(a>=s&&t>=i)return 0;if(a>=s)return-1;if(t>=i)return 1;if(this===e)return 0;let o=(s>>>=0)-(a>>>=0),u=(i>>>=0)-(t>>>=0);const l=Math.min(o,u),d=this.slice(a,s),f=e.slice(t,i);for(let e=0;e<l;++e)if(d[e]!==f[e]){o=d[e],u=f[e];break}return o<u?-1:u<o?1:0},c.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},c.prototype.indexOf=function(e,t,i){return _(this,e,t,i,!0)},c.prototype.lastIndexOf=function(e,t,i){return _(this,e,t,i,!1)},c.prototype.write=function(e,t,i,a){if(void 0===t)a="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)a=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(i)?(i>>>=0,void 0===a&&(a="utf8")):(a=i,i=void 0)}const s=this.length-t;if((void 0===i||i>s)&&(i=s),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");a||(a="utf8");let o=!1;for(;;)switch(a){case"hex":return b(this,e,t,i);case"utf8":case"utf-8":return S(this,e,t,i);case"ascii":case"latin1":case"binary":return R(this,e,t,i);case"base64":return A(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,i);default:if(o)throw new TypeError("Unknown encoding: "+a);a=(""+a).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const L=4096;function k(e,t,i){let a="";i=Math.min(e.length,i);for(let s=t;s<i;++s)a+=String.fromCharCode(127&e[s]);return a}function C(e,t,i){let a="";i=Math.min(e.length,i);for(let s=t;s<i;++s)a+=String.fromCharCode(e[s]);return a}function O(e,t,i){const a=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>a)&&(i=a);let s="";for(let a=t;a<i;++a)s+=Z[e[a]];return s}function P(e,t,i){const a=e.slice(t,i);let s="";for(let e=0;e<a.length-1;e+=2)s+=String.fromCharCode(a[e]+256*a[e+1]);return s}function x(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,i,a,s,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<o)throw new RangeError('"value" argument is out of bounds');if(i+a>e.length)throw new RangeError("Index out of range")}function N(e,t,i,a,s){V(t,a,s,e,i,7);let o=Number(t&BigInt(4294967295));e[i++]=o,o>>=8,e[i++]=o,o>>=8,e[i++]=o,o>>=8,e[i++]=o;let u=Number(t>>BigInt(32)&BigInt(4294967295));return e[i++]=u,u>>=8,e[i++]=u,u>>=8,e[i++]=u,u>>=8,e[i++]=u,i}function F(e,t,i,a,s){V(t,a,s,e,i,7);let o=Number(t&BigInt(4294967295));e[i+7]=o,o>>=8,e[i+6]=o,o>>=8,e[i+5]=o,o>>=8,e[i+4]=o;let u=Number(t>>BigInt(32)&BigInt(4294967295));return e[i+3]=u,u>>=8,e[i+2]=u,u>>=8,e[i+1]=u,u>>=8,e[i]=u,i+8}function U(e,t,i,a,s,o){if(i+a>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function B(e,t,i,a,o){return t=+t,i>>>=0,o||U(e,0,i,4),s.write(e,t,i,a,23,4),i+4}function j(e,t,i,a,o){return t=+t,i>>>=0,o||U(e,0,i,8),s.write(e,t,i,a,52,8),i+8}c.prototype.slice=function(e,t){const i=this.length;(e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e);const a=this.subarray(e,t);return Object.setPrototypeOf(a,c.prototype),a},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||x(e,t,this.length);let a=this[e],s=1,o=0;for(;++o<t&&(s*=256);)a+=this[e+o]*s;return a},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||x(e,t,this.length);let a=this[e+--t],s=1;for(;t>0&&(s*=256);)a+=this[e+--t]*s;return a},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||x(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||x(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||x(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||x(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=ee((function(e){q(e>>>=0,"offset");const t=this[e],i=this[e+7];void 0!==t&&void 0!==i||W(e,this.length-8);const a=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,s=this[++e]+256*this[++e]+65536*this[++e]+i*2**24;return BigInt(a)+(BigInt(s)<<BigInt(32))})),c.prototype.readBigUInt64BE=ee((function(e){q(e>>>=0,"offset");const t=this[e],i=this[e+7];void 0!==t&&void 0!==i||W(e,this.length-8);const a=t*2**24+65536*this[++e]+256*this[++e]+this[++e],s=this[++e]*2**24+65536*this[++e]+256*this[++e]+i;return(BigInt(a)<<BigInt(32))+BigInt(s)})),c.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||x(e,t,this.length);let a=this[e],s=1,o=0;for(;++o<t&&(s*=256);)a+=this[e+o]*s;return s*=128,a>=s&&(a-=Math.pow(2,8*t)),a},c.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||x(e,t,this.length);let a=t,s=1,o=this[e+--a];for(;a>0&&(s*=256);)o+=this[e+--a]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return e>>>=0,t||x(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||x(e,2,this.length);const i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt16BE=function(e,t){e>>>=0,t||x(e,2,this.length);const i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=ee((function(e){q(e>>>=0,"offset");const t=this[e],i=this[e+7];void 0!==t&&void 0!==i||W(e,this.length-8);const a=this[e+4]+256*this[e+5]+65536*this[e+6]+(i<<24);return(BigInt(a)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),c.prototype.readBigInt64BE=ee((function(e){q(e>>>=0,"offset");const t=this[e],i=this[e+7];void 0!==t&&void 0!==i||W(e,this.length-8);const a=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(a)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+i)})),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||x(e,4,this.length),s.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||x(e,4,this.length),s.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||x(e,8,this.length),s.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||x(e,8,this.length),s.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,i,a){if(e=+e,t>>>=0,i>>>=0,!a){M(this,e,t,i,Math.pow(2,8*i)-1,0)}let s=1,o=0;for(this[t]=255&e;++o<i&&(s*=256);)this[t+o]=e/s&255;return t+i},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,i,a){if(e=+e,t>>>=0,i>>>=0,!a){M(this,e,t,i,Math.pow(2,8*i)-1,0)}let s=i-1,o=1;for(this[t+s]=255&e;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+i},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||M(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||M(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||M(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||M(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||M(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=ee((function(e,t=0){return N(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=ee((function(e,t=0){return F(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(e,t,i,a){if(e=+e,t>>>=0,!a){const a=Math.pow(2,8*i-1);M(this,e,t,i,a-1,-a)}let s=0,o=1,u=0;for(this[t]=255&e;++s<i&&(o*=256);)e<0&&0===u&&0!==this[t+s-1]&&(u=1),this[t+s]=(e/o>>0)-u&255;return t+i},c.prototype.writeIntBE=function(e,t,i,a){if(e=+e,t>>>=0,!a){const a=Math.pow(2,8*i-1);M(this,e,t,i,a-1,-a)}let s=i-1,o=1,u=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===u&&0!==this[t+s+1]&&(u=1),this[t+s]=(e/o>>0)-u&255;return t+i},c.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||M(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||M(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||M(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||M(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=ee((function(e,t=0){return N(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=ee((function(e,t=0){return F(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(e,t,i){return B(this,e,t,!0,i)},c.prototype.writeFloatBE=function(e,t,i){return B(this,e,t,!1,i)},c.prototype.writeDoubleLE=function(e,t,i){return j(this,e,t,!0,i)},c.prototype.writeDoubleBE=function(e,t,i){return j(this,e,t,!1,i)},c.prototype.copy=function(e,t,i,a){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i||(i=0),a||0===a||(a=this.length),t>=e.length&&(t=e.length),t||(t=0),a>0&&a<i&&(a=i),a===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(a<0)throw new RangeError("sourceEnd out of bounds");a>this.length&&(a=this.length),e.length-t<a-i&&(a=e.length-t+i);const s=a-i;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,i,a):Uint8Array.prototype.set.call(e,this.subarray(i,a),t),s},c.prototype.fill=function(e,t,i,a){if("string"==typeof e){if("string"==typeof t?(a=t,t=0,i=this.length):"string"==typeof i&&(a=i,i=this.length),void 0!==a&&"string"!=typeof a)throw new TypeError("encoding must be a string");if("string"==typeof a&&!c.isEncoding(a))throw new TypeError("Unknown encoding: "+a);if(1===e.length){const t=e.charCodeAt(0);("utf8"===a&&t<128||"latin1"===a)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;let s;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(s=t;s<i;++s)this[s]=e;else{const o=c.isBuffer(e)?e:c.from(e,a),u=o.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<i-t;++s)this[s+t]=o[s%u]}return this};const H={};function G(e,t,i){H[e]=class NodeError extends i{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function K(e){let t="",i=e.length;const a="-"===e[0]?1:0;for(;i>=a+4;i-=3)t=`_${e.slice(i-3,i)}${t}`;return`${e.slice(0,i)}${t}`}function V(e,t,i,a,s,o){if(e>i||e<t){const a="bigint"==typeof t?"n":"";let s;throw s=o>3?0===t||t===BigInt(0)?`>= 0${a} and < 2${a} ** ${8*(o+1)}${a}`:`>= -(2${a} ** ${8*(o+1)-1}${a}) and < 2 ** ${8*(o+1)-1}${a}`:`>= ${t}${a} and <= ${i}${a}`,new H.ERR_OUT_OF_RANGE("value",s,e)}!function(e,t,i){q(t,"offset"),void 0!==e[t]&&void 0!==e[t+i]||W(t,e.length-(i+1))}(a,s,o)}function q(e,t){if("number"!=typeof e)throw new H.ERR_INVALID_ARG_TYPE(t,"number",e)}function W(e,t,i){if(Math.floor(e)!==e)throw q(e,i),new H.ERR_OUT_OF_RANGE(i||"offset","an integer",e);if(t<0)throw new H.ERR_BUFFER_OUT_OF_BOUNDS;throw new H.ERR_OUT_OF_RANGE(i||"offset",`>= ${i?1:0} and <= ${t}`,e)}G("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),G("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),G("ERR_OUT_OF_RANGE",(function(e,t,i){let a=`The value of "${e}" is out of range.`,s=i;return Number.isInteger(i)&&Math.abs(i)>2**32?s=K(String(i)):"bigint"==typeof i&&(s=String(i),(i>BigInt(2)**BigInt(32)||i<-(BigInt(2)**BigInt(32)))&&(s=K(s)),s+="n"),a+=` It must be ${t}. Received ${s}`,a}),RangeError);const Y=/[^+/0-9A-Za-z-_]/g;function z(e,t){let i;t=t||1/0;const a=e.length;let s=null;const o=[];for(let u=0;u<a;++u){if(i=e.charCodeAt(u),i>55295&&i<57344){if(!s){if(i>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(u+1===a){(t-=3)>-1&&o.push(239,191,189);continue}s=i;continue}if(i<56320){(t-=3)>-1&&o.push(239,191,189),s=i;continue}i=65536+(s-55296<<10|i-56320)}else s&&(t-=3)>-1&&o.push(239,191,189);if(s=null,i<128){if((t-=1)<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function X(e){return a.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(Y,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Q(e,t,i,a){let s;for(s=0;s<a&&!(s+i>=t.length||s>=e.length);++s)t[s+i]=e[s];return s}function $(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function J(e){return e!=e}const Z=function(){const e="0123456789abcdef",t=new Array(256);for(let i=0;i<16;++i){const a=16*i;for(let s=0;s<16;++s)t[a+s]=e[i]+e[s]}return t}();function ee(e){return"undefined"==typeof BigInt?te:e}function te(){throw new Error("BigInt not supported")}},452:function(e,t,i){var a;e.exports=(a=i(8249),i(8269),i(8214),i(888),i(5109),function(){var e=a,t=e.lib.BlockCipher,i=e.algo,s=[],o=[],u=[],l=[],c=[],d=[],f=[],h=[],p=[],v=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var i=0,a=0;for(t=0;t<256;t++){var g=a^a<<1^a<<2^a<<3^a<<4;g=g>>>8^255&g^99,s[i]=g,o[g]=i;var m=e[i],y=e[m],E=e[y],_=257*e[g]^16843008*g;u[i]=_<<24|_>>>8,l[i]=_<<16|_>>>16,c[i]=_<<8|_>>>24,d[i]=_,_=16843009*E^65537*y^257*m^16843008*i,f[g]=_<<24|_>>>8,h[g]=_<<16|_>>>16,p[g]=_<<8|_>>>24,v[g]=_,i?(i=m^e[e[e[E^m]]],a^=e[e[a]]):i=a=1}}();var g=[0,1,2,4,8,16,32,64,128,27,54],m=i.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,i=e.sigBytes/4,a=4*((this._nRounds=i+6)+1),o=this._keySchedule=[],u=0;u<a;u++)u<i?o[u]=t[u]:(d=o[u-1],u%i?i>6&&u%i==4&&(d=s[d>>>24]<<24|s[d>>>16&255]<<16|s[d>>>8&255]<<8|s[255&d]):(d=s[(d=d<<8|d>>>24)>>>24]<<24|s[d>>>16&255]<<16|s[d>>>8&255]<<8|s[255&d],d^=g[u/i|0]<<24),o[u]=o[u-i]^d);for(var l=this._invKeySchedule=[],c=0;c<a;c++){if(u=a-c,c%4)var d=o[u];else d=o[u-4];l[c]=c<4||u<=4?d:f[s[d>>>24]]^h[s[d>>>16&255]]^p[s[d>>>8&255]]^v[s[255&d]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,u,l,c,d,s)},decryptBlock:function(e,t){var i=e[t+1];e[t+1]=e[t+3],e[t+3]=i,this._doCryptBlock(e,t,this._invKeySchedule,f,h,p,v,o),i=e[t+1],e[t+1]=e[t+3],e[t+3]=i},_doCryptBlock:function(e,t,i,a,s,o,u,l){for(var c=this._nRounds,d=e[t]^i[0],f=e[t+1]^i[1],h=e[t+2]^i[2],p=e[t+3]^i[3],v=4,g=1;g<c;g++){var m=a[d>>>24]^s[f>>>16&255]^o[h>>>8&255]^u[255&p]^i[v++],y=a[f>>>24]^s[h>>>16&255]^o[p>>>8&255]^u[255&d]^i[v++],E=a[h>>>24]^s[p>>>16&255]^o[d>>>8&255]^u[255&f]^i[v++],_=a[p>>>24]^s[d>>>16&255]^o[f>>>8&255]^u[255&h]^i[v++];d=m,f=y,h=E,p=_}m=(l[d>>>24]<<24|l[f>>>16&255]<<16|l[h>>>8&255]<<8|l[255&p])^i[v++],y=(l[f>>>24]<<24|l[h>>>16&255]<<16|l[p>>>8&255]<<8|l[255&d])^i[v++],E=(l[h>>>24]<<24|l[p>>>16&255]<<16|l[d>>>8&255]<<8|l[255&f])^i[v++],_=(l[p>>>24]<<24|l[d>>>16&255]<<16|l[f>>>8&255]<<8|l[255&h])^i[v++],e[t]=m,e[t+1]=y,e[t+2]=E,e[t+3]=_},keySize:8});e.AES=t._createHelper(m)}(),a.AES)},5109:function(e,t,i){var a;e.exports=(a=i(8249),i(888),void(a.lib.Cipher||function(e){var t=a,i=t.lib,s=i.Base,o=i.WordArray,u=i.BufferedBlockAlgorithm,l=t.enc,c=(l.Utf8,l.Base64),d=t.algo.EvpKDF,f=i.Cipher=u.extend({cfg:s.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,i){this.cfg=this.cfg.extend(i),this._xformMode=e,this._key=t,this.reset()},reset:function(){u.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?T:E}return function(t){return{encrypt:function(i,a,s){return e(a).encrypt(t,i,a,s)},decrypt:function(i,a,s){return e(a).decrypt(t,i,a,s)}}}}()}),h=(i.StreamCipher=f.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),t.mode={}),p=i.BlockCipherMode=s.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),v=h.CBC=function(){var t=p.extend();function i(t,i,a){var s,o=this._iv;o?(s=o,this._iv=e):s=this._prevBlock;for(var u=0;u<a;u++)t[i+u]^=s[u]}return t.Encryptor=t.extend({processBlock:function(e,t){var a=this._cipher,s=a.blockSize;i.call(this,e,t,s),a.encryptBlock(e,t),this._prevBlock=e.slice(t,t+s)}}),t.Decryptor=t.extend({processBlock:function(e,t){var a=this._cipher,s=a.blockSize,o=e.slice(t,t+s);a.decryptBlock(e,t),i.call(this,e,t,s),this._prevBlock=o}}),t}(),g=(t.pad={}).Pkcs7={pad:function(e,t){for(var i=4*t,a=i-e.sigBytes%i,s=a<<24|a<<16|a<<8|a,u=[],l=0;l<a;l+=4)u.push(s);var c=o.create(u,a);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},m=(i.BlockCipher=f.extend({cfg:f.cfg.extend({mode:v,padding:g}),reset:function(){var e;f.reset.call(this);var t=this.cfg,i=t.iv,a=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=a.createEncryptor:(e=a.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,i&&i.words):(this._mode=e.call(a,this,i&&i.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),i.CipherParams=s.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),y=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,i=e.salt;return(i?o.create([1398893684,1701076831]).concat(i).concat(t):t).toString(c)},parse:function(e){var t,i=c.parse(e),a=i.words;return 1398893684==a[0]&&1701076831==a[1]&&(t=o.create(a.slice(2,4)),a.splice(0,4),i.sigBytes-=16),m.create({ciphertext:i,salt:t})}},E=i.SerializableCipher=s.extend({cfg:s.extend({format:y}),encrypt:function(e,t,i,a){a=this.cfg.extend(a);var s=e.createEncryptor(i,a),o=s.finalize(t),u=s.cfg;return m.create({ciphertext:o,key:i,iv:u.iv,algorithm:e,mode:u.mode,padding:u.padding,blockSize:e.blockSize,formatter:a.format})},decrypt:function(e,t,i,a){return a=this.cfg.extend(a),t=this._parse(t,a.format),e.createDecryptor(i,a).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),_=(t.kdf={}).OpenSSL={execute:function(e,t,i,a){a||(a=o.random(8));var s=d.create({keySize:t+i}).compute(e,a),u=o.create(s.words.slice(t),4*i);return s.sigBytes=4*t,m.create({key:s,iv:u,salt:a})}},T=i.PasswordBasedCipher=E.extend({cfg:E.cfg.extend({kdf:_}),encrypt:function(e,t,i,a){var s=(a=this.cfg.extend(a)).kdf.execute(i,e.keySize,e.ivSize);a.iv=s.iv;var o=E.encrypt.call(this,e,t,s.key,a);return o.mixIn(s),o},decrypt:function(e,t,i,a){a=this.cfg.extend(a),t=this._parse(t,a.format);var s=a.kdf.execute(i,e.keySize,e.ivSize,t.salt);return a.iv=s.iv,E.decrypt.call(this,e,t,s.key,a)}})}()))},8249:function(e,t,i){var a;e.exports=(a=a||function(e,t){var a;if("undefined"!=typeof window&&window.crypto&&(a=window.crypto),"undefined"!=typeof self&&self.crypto&&(a=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(a=globalThis.crypto),!a&&"undefined"!=typeof window&&window.msCrypto&&(a=window.msCrypto),!a&&void 0!==i.g&&i.g.crypto&&(a=i.g.crypto),!a)try{a=i(2480)}catch(e){}var s=function(){if(a){if("function"==typeof a.getRandomValues)try{return a.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof a.randomBytes)try{return a.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var i;return e.prototype=t,i=new e,e.prototype=null,i}}(),u={},l=u.lib={},c=l.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},d=l.WordArray=c.extend({init:function(e,i){e=this.words=e||[],this.sigBytes=i!=t?i:4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var t=this.words,i=e.words,a=this.sigBytes,s=e.sigBytes;if(this.clamp(),a%4)for(var o=0;o<s;o++){var u=i[o>>>2]>>>24-o%4*8&255;t[a+o>>>2]|=u<<24-(a+o)%4*8}else for(var l=0;l<s;l+=4)t[a+l>>>2]=i[l>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],i=0;i<e;i+=4)t.push(s());return new d.init(t,e)}}),f=u.enc={},h=f.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,a=[],s=0;s<i;s++){var o=t[s>>>2]>>>24-s%4*8&255;a.push((o>>>4).toString(16)),a.push((15&o).toString(16))}return a.join("")},parse:function(e){for(var t=e.length,i=[],a=0;a<t;a+=2)i[a>>>3]|=parseInt(e.substr(a,2),16)<<24-a%8*4;return new d.init(i,t/2)}},p=f.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,a=[],s=0;s<i;s++){var o=t[s>>>2]>>>24-s%4*8&255;a.push(String.fromCharCode(o))}return a.join("")},parse:function(e){for(var t=e.length,i=[],a=0;a<t;a++)i[a>>>2]|=(255&e.charCodeAt(a))<<24-a%4*8;return new d.init(i,t)}},v=f.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},g=l.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=v.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i,a=this._data,s=a.words,o=a.sigBytes,u=this.blockSize,l=o/(4*u),c=(l=t?e.ceil(l):e.max((0|l)-this._minBufferSize,0))*u,f=e.min(4*c,o);if(c){for(var h=0;h<c;h+=u)this._doProcessBlock(s,h);i=s.splice(0,c),a.sigBytes-=f}return new d.init(i,f)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(l.Hasher=g.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new m.HMAC.init(e,i).finalize(t)}}}),u.algo={});return u}(Math),a)},8269:function(e,t,i){var a;e.exports=(a=i(8249),function(){var e=a,t=e.lib.WordArray;function i(e,i,a){for(var s=[],o=0,u=0;u<i;u++)if(u%4){var l=a[e.charCodeAt(u-1)]<<u%4*2|a[e.charCodeAt(u)]>>>6-u%4*2;s[o>>>2]|=l<<24-o%4*8,o++}return t.create(s,o)}e.enc.Base64={stringify:function(e){var t=e.words,i=e.sigBytes,a=this._map;e.clamp();for(var s=[],o=0;o<i;o+=3)for(var u=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,l=0;l<4&&o+.75*l<i;l++)s.push(a.charAt(u>>>6*(3-l)&63));var c=a.charAt(64);if(c)for(;s.length%4;)s.push(c);return s.join("")},parse:function(e){var t=e.length,a=this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var o=0;o<a.length;o++)s[a.charCodeAt(o)]=o}var u=a.charAt(64);if(u){var l=e.indexOf(u);-1!==l&&(t=l)}return i(e,t,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),a.enc.Base64)},3786:function(e,t,i){var a;e.exports=(a=i(8249),function(){var e=a,t=e.lib.WordArray;function i(e,i,a){for(var s=[],o=0,u=0;u<i;u++)if(u%4){var l=a[e.charCodeAt(u-1)]<<u%4*2|a[e.charCodeAt(u)]>>>6-u%4*2;s[o>>>2]|=l<<24-o%4*8,o++}return t.create(s,o)}e.enc.Base64url={stringify:function(e,t=!0){var i=e.words,a=e.sigBytes,s=t?this._safe_map:this._map;e.clamp();for(var o=[],u=0;u<a;u+=3)for(var l=(i[u>>>2]>>>24-u%4*8&255)<<16|(i[u+1>>>2]>>>24-(u+1)%4*8&255)<<8|i[u+2>>>2]>>>24-(u+2)%4*8&255,c=0;c<4&&u+.75*c<a;c++)o.push(s.charAt(l>>>6*(3-c)&63));var d=s.charAt(64);if(d)for(;o.length%4;)o.push(d);return o.join("")},parse:function(e,t=!0){var a=e.length,s=t?this._safe_map:this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var u=0;u<s.length;u++)o[s.charCodeAt(u)]=u}var l=s.charAt(64);if(l){var c=e.indexOf(l);-1!==c&&(a=c)}return i(e,a,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),a.enc.Base64url)},298:function(e,t,i){var a;e.exports=(a=i(8249),function(){var e=a,t=e.lib.WordArray,i=e.enc;function s(e){return e<<8&4278255360|e>>>8&16711935}i.Utf16=i.Utf16BE={stringify:function(e){for(var t=e.words,i=e.sigBytes,a=[],s=0;s<i;s+=2){var o=t[s>>>2]>>>16-s%4*8&65535;a.push(String.fromCharCode(o))}return a.join("")},parse:function(e){for(var i=e.length,a=[],s=0;s<i;s++)a[s>>>1]|=e.charCodeAt(s)<<16-s%2*16;return t.create(a,2*i)}},i.Utf16LE={stringify:function(e){for(var t=e.words,i=e.sigBytes,a=[],o=0;o<i;o+=2){var u=s(t[o>>>2]>>>16-o%4*8&65535);a.push(String.fromCharCode(u))}return a.join("")},parse:function(e){for(var i=e.length,a=[],o=0;o<i;o++)a[o>>>1]|=s(e.charCodeAt(o)<<16-o%2*16);return t.create(a,2*i)}}}(),a.enc.Utf16)},888:function(e,t,i){var a,s,o,u,l,c,d,f;e.exports=(f=i(8249),i(2783),i(9824),s=(a=f).lib,o=s.Base,u=s.WordArray,l=a.algo,c=l.MD5,d=l.EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var i,a=this.cfg,s=a.hasher.create(),o=u.create(),l=o.words,c=a.keySize,d=a.iterations;l.length<c;){i&&s.update(i),i=s.update(e).finalize(t),s.reset();for(var f=1;f<d;f++)i=s.finalize(i),s.reset();o.concat(i)}return o.sigBytes=4*c,o}}),a.EvpKDF=function(e,t,i){return d.create(i).compute(e,t)},f.EvpKDF)},2209:function(e,t,i){var a,s,o,u;e.exports=(u=i(8249),i(5109),s=(a=u).lib.CipherParams,o=a.enc.Hex,a.format.Hex={stringify:function(e){return e.ciphertext.toString(o)},parse:function(e){var t=o.parse(e);return s.create({ciphertext:t})}},u.format.Hex)},9824:function(e,t,i){var a,s,o,u;e.exports=(a=i(8249),o=(s=a).lib.Base,u=s.enc.Utf8,void(s.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=u.parse(t));var i=e.blockSize,a=4*i;t.sigBytes>a&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),o=this._iKey=t.clone(),l=s.words,c=o.words,d=0;d<i;d++)l[d]^=1549556828,c[d]^=909522486;s.sigBytes=o.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,i=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(i))}})))},1354:function(e,t,i){var a;e.exports=(a=i(8249),i(4938),i(4433),i(298),i(8269),i(3786),i(8214),i(2783),i(2153),i(7792),i(34),i(7460),i(3327),i(706),i(9824),i(2112),i(888),i(5109),i(8568),i(4242),i(9968),i(7660),i(1148),i(3615),i(2807),i(1077),i(6475),i(6991),i(2209),i(452),i(4253),i(1857),i(4454),i(3974),a)},4433:function(e,t,i){var a;e.exports=(a=i(8249),function(){if("function"==typeof ArrayBuffer){var e=a.lib.WordArray,t=e.init,i=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var i=e.byteLength,a=[],s=0;s<i;s++)a[s>>>2]|=e[s]<<24-s%4*8;t.call(this,a,i)}else t.apply(this,arguments)};i.prototype=e}}(),a.lib.WordArray)},8214:function(e,t,i){var a;e.exports=(a=i(8249),function(e){var t=a,i=t.lib,s=i.WordArray,o=i.Hasher,u=t.algo,l=[];!function(){for(var t=0;t<64;t++)l[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=u.MD5=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var i=0;i<16;i++){var a=t+i,s=e[a];e[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var o=this._hash.words,u=e[t+0],c=e[t+1],v=e[t+2],g=e[t+3],m=e[t+4],y=e[t+5],E=e[t+6],_=e[t+7],T=e[t+8],b=e[t+9],S=e[t+10],R=e[t+11],A=e[t+12],w=e[t+13],I=e[t+14],D=e[t+15],L=o[0],k=o[1],C=o[2],O=o[3];L=d(L,k,C,O,u,7,l[0]),O=d(O,L,k,C,c,12,l[1]),C=d(C,O,L,k,v,17,l[2]),k=d(k,C,O,L,g,22,l[3]),L=d(L,k,C,O,m,7,l[4]),O=d(O,L,k,C,y,12,l[5]),C=d(C,O,L,k,E,17,l[6]),k=d(k,C,O,L,_,22,l[7]),L=d(L,k,C,O,T,7,l[8]),O=d(O,L,k,C,b,12,l[9]),C=d(C,O,L,k,S,17,l[10]),k=d(k,C,O,L,R,22,l[11]),L=d(L,k,C,O,A,7,l[12]),O=d(O,L,k,C,w,12,l[13]),C=d(C,O,L,k,I,17,l[14]),L=f(L,k=d(k,C,O,L,D,22,l[15]),C,O,c,5,l[16]),O=f(O,L,k,C,E,9,l[17]),C=f(C,O,L,k,R,14,l[18]),k=f(k,C,O,L,u,20,l[19]),L=f(L,k,C,O,y,5,l[20]),O=f(O,L,k,C,S,9,l[21]),C=f(C,O,L,k,D,14,l[22]),k=f(k,C,O,L,m,20,l[23]),L=f(L,k,C,O,b,5,l[24]),O=f(O,L,k,C,I,9,l[25]),C=f(C,O,L,k,g,14,l[26]),k=f(k,C,O,L,T,20,l[27]),L=f(L,k,C,O,w,5,l[28]),O=f(O,L,k,C,v,9,l[29]),C=f(C,O,L,k,_,14,l[30]),L=h(L,k=f(k,C,O,L,A,20,l[31]),C,O,y,4,l[32]),O=h(O,L,k,C,T,11,l[33]),C=h(C,O,L,k,R,16,l[34]),k=h(k,C,O,L,I,23,l[35]),L=h(L,k,C,O,c,4,l[36]),O=h(O,L,k,C,m,11,l[37]),C=h(C,O,L,k,_,16,l[38]),k=h(k,C,O,L,S,23,l[39]),L=h(L,k,C,O,w,4,l[40]),O=h(O,L,k,C,u,11,l[41]),C=h(C,O,L,k,g,16,l[42]),k=h(k,C,O,L,E,23,l[43]),L=h(L,k,C,O,b,4,l[44]),O=h(O,L,k,C,A,11,l[45]),C=h(C,O,L,k,D,16,l[46]),L=p(L,k=h(k,C,O,L,v,23,l[47]),C,O,u,6,l[48]),O=p(O,L,k,C,_,10,l[49]),C=p(C,O,L,k,I,15,l[50]),k=p(k,C,O,L,y,21,l[51]),L=p(L,k,C,O,A,6,l[52]),O=p(O,L,k,C,g,10,l[53]),C=p(C,O,L,k,S,15,l[54]),k=p(k,C,O,L,c,21,l[55]),L=p(L,k,C,O,T,6,l[56]),O=p(O,L,k,C,D,10,l[57]),C=p(C,O,L,k,E,15,l[58]),k=p(k,C,O,L,w,21,l[59]),L=p(L,k,C,O,m,6,l[60]),O=p(O,L,k,C,R,10,l[61]),C=p(C,O,L,k,v,15,l[62]),k=p(k,C,O,L,b,21,l[63]),o[0]=o[0]+L|0,o[1]=o[1]+k|0,o[2]=o[2]+C|0,o[3]=o[3]+O|0},_doFinalize:function(){var t=this._data,i=t.words,a=8*this._nDataBytes,s=8*t.sigBytes;i[s>>>5]|=128<<24-s%32;var o=e.floor(a/4294967296),u=a;i[15+(s+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),i[14+(s+64>>>9<<4)]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),t.sigBytes=4*(i.length+1),this._process();for(var l=this._hash,c=l.words,d=0;d<4;d++){var f=c[d];c[d]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8)}return l},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function d(e,t,i,a,s,o,u){var l=e+(t&i|~t&a)+s+u;return(l<<o|l>>>32-o)+t}function f(e,t,i,a,s,o,u){var l=e+(t&a|i&~a)+s+u;return(l<<o|l>>>32-o)+t}function h(e,t,i,a,s,o,u){var l=e+(t^i^a)+s+u;return(l<<o|l>>>32-o)+t}function p(e,t,i,a,s,o,u){var l=e+(i^(t|~a))+s+u;return(l<<o|l>>>32-o)+t}t.MD5=o._createHelper(c),t.HmacMD5=o._createHmacHelper(c)}(Math),a.MD5)},8568:function(e,t,i){var a;e.exports=(a=i(8249),i(5109),a.mode.CFB=function(){var e=a.lib.BlockCipherMode.extend();function t(e,t,i,a){var s,o=this._iv;o?(s=o.slice(0),this._iv=void 0):s=this._prevBlock,a.encryptBlock(s,0);for(var u=0;u<i;u++)e[t+u]^=s[u]}return e.Encryptor=e.extend({processBlock:function(e,i){var a=this._cipher,s=a.blockSize;t.call(this,e,i,s,a),this._prevBlock=e.slice(i,i+s)}}),e.Decryptor=e.extend({processBlock:function(e,i){var a=this._cipher,s=a.blockSize,o=e.slice(i,i+s);t.call(this,e,i,s,a),this._prevBlock=o}}),e}(),a.mode.CFB)},9968:function(e,t,i){var a;e.exports=(a=i(8249),i(5109),a.mode.CTRGladman=function(){var e=a.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,i=e>>8&255,a=255&e;255===t?(t=0,255===i?(i=0,255===a?a=0:++a):++i):++t,e=0,e+=t<<16,e+=i<<8,e+=a}else e+=1<<24;return e}function i(e){return 0===(e[0]=t(e[0]))&&(e[1]=t(e[1])),e}var s=e.Encryptor=e.extend({processBlock:function(e,t){var a=this._cipher,s=a.blockSize,o=this._iv,u=this._counter;o&&(u=this._counter=o.slice(0),this._iv=void 0),i(u);var l=u.slice(0);a.encryptBlock(l,0);for(var c=0;c<s;c++)e[t+c]^=l[c]}});return e.Decryptor=s,e}(),a.mode.CTRGladman)},4242:function(e,t,i){var a,s,o;e.exports=(o=i(8249),i(5109),o.mode.CTR=(a=o.lib.BlockCipherMode.extend(),s=a.Encryptor=a.extend({processBlock:function(e,t){var i=this._cipher,a=i.blockSize,s=this._iv,o=this._counter;s&&(o=this._counter=s.slice(0),this._iv=void 0);var u=o.slice(0);i.encryptBlock(u,0),o[a-1]=o[a-1]+1|0;for(var l=0;l<a;l++)e[t+l]^=u[l]}}),a.Decryptor=s,a),o.mode.CTR)},1148:function(e,t,i){var a,s;e.exports=(s=i(8249),i(5109),s.mode.ECB=((a=s.lib.BlockCipherMode.extend()).Encryptor=a.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),a.Decryptor=a.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),a),s.mode.ECB)},7660:function(e,t,i){var a,s,o;e.exports=(o=i(8249),i(5109),o.mode.OFB=(a=o.lib.BlockCipherMode.extend(),s=a.Encryptor=a.extend({processBlock:function(e,t){var i=this._cipher,a=i.blockSize,s=this._iv,o=this._keystream;s&&(o=this._keystream=s.slice(0),this._iv=void 0),i.encryptBlock(o,0);for(var u=0;u<a;u++)e[t+u]^=o[u]}}),a.Decryptor=s,a),o.mode.OFB)},3615:function(e,t,i){var a;e.exports=(a=i(8249),i(5109),a.pad.AnsiX923={pad:function(e,t){var i=e.sigBytes,a=4*t,s=a-i%a,o=i+s-1;e.clamp(),e.words[o>>>2]|=s<<24-o%4*8,e.sigBytes+=s},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},a.pad.Ansix923)},2807:function(e,t,i){var a;e.exports=(a=i(8249),i(5109),a.pad.Iso10126={pad:function(e,t){var i=4*t,s=i-e.sigBytes%i;e.concat(a.lib.WordArray.random(s-1)).concat(a.lib.WordArray.create([s<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},a.pad.Iso10126)},1077:function(e,t,i){var a;e.exports=(a=i(8249),i(5109),a.pad.Iso97971={pad:function(e,t){e.concat(a.lib.WordArray.create([2147483648],1)),a.pad.ZeroPadding.pad(e,t)},unpad:function(e){a.pad.ZeroPadding.unpad(e),e.sigBytes--}},a.pad.Iso97971)},6991:function(e,t,i){var a;e.exports=(a=i(8249),i(5109),a.pad.NoPadding={pad:function(){},unpad:function(){}},a.pad.NoPadding)},6475:function(e,t,i){var a;e.exports=(a=i(8249),i(5109),a.pad.ZeroPadding={pad:function(e,t){var i=4*t;e.clamp(),e.sigBytes+=i-(e.sigBytes%i||i)},unpad:function(e){var t=e.words,i=e.sigBytes-1;for(i=e.sigBytes-1;i>=0;i--)if(t[i>>>2]>>>24-i%4*8&255){e.sigBytes=i+1;break}}},a.pad.ZeroPadding)},2112:function(e,t,i){var a,s,o,u,l,c,d,f,h;e.exports=(h=i(8249),i(2783),i(9824),s=(a=h).lib,o=s.Base,u=s.WordArray,l=a.algo,c=l.SHA1,d=l.HMAC,f=l.PBKDF2=o.extend({cfg:o.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var i=this.cfg,a=d.create(i.hasher,e),s=u.create(),o=u.create([1]),l=s.words,c=o.words,f=i.keySize,h=i.iterations;l.length<f;){var p=a.update(t).finalize(o);a.reset();for(var v=p.words,g=v.length,m=p,y=1;y<h;y++){m=a.finalize(m),a.reset();for(var E=m.words,_=0;_<g;_++)v[_]^=E[_]}s.concat(p),c[0]++}return s.sigBytes=4*f,s}}),a.PBKDF2=function(e,t,i){return f.create(i).compute(e,t)},h.PBKDF2)},3974:function(e,t,i){var a;e.exports=(a=i(8249),i(8269),i(8214),i(888),i(5109),function(){var e=a,t=e.lib.StreamCipher,i=e.algo,s=[],o=[],u=[],l=i.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,i=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],a=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var s=0;s<4;s++)c.call(this);for(s=0;s<8;s++)a[s]^=i[s+4&7];if(t){var o=t.words,u=o[0],l=o[1],d=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),f=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),h=d>>>16|4294901760&f,p=f<<16|65535&d;for(a[0]^=d,a[1]^=h,a[2]^=f,a[3]^=p,a[4]^=d,a[5]^=h,a[6]^=f,a[7]^=p,s=0;s<4;s++)c.call(this)}},_doProcessBlock:function(e,t){var i=this._X;c.call(this),s[0]=i[0]^i[5]>>>16^i[3]<<16,s[1]=i[2]^i[7]>>>16^i[5]<<16,s[2]=i[4]^i[1]>>>16^i[7]<<16,s[3]=i[6]^i[3]>>>16^i[1]<<16;for(var a=0;a<4;a++)s[a]=16711935&(s[a]<<8|s[a]>>>24)|4278255360&(s[a]<<24|s[a]>>>8),e[t+a]^=s[a]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,i=0;i<8;i++)o[i]=t[i];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<o[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<o[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<o[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<o[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<o[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<o[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<o[6]>>>0?1:0)|0,this._b=t[7]>>>0<o[7]>>>0?1:0,i=0;i<8;i++){var a=e[i]+t[i],s=65535&a,l=a>>>16,c=((s*s>>>17)+s*l>>>15)+l*l,d=((4294901760&a)*a|0)+((65535&a)*a|0);u[i]=c^d}e[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,e[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,e[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,e[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,e[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,e[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,e[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,e[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}e.RabbitLegacy=t._createHelper(l)}(),a.RabbitLegacy)},4454:function(e,t,i){var a;e.exports=(a=i(8249),i(8269),i(8214),i(888),i(5109),function(){var e=a,t=e.lib.StreamCipher,i=e.algo,s=[],o=[],u=[],l=i.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,i=0;i<4;i++)e[i]=16711935&(e[i]<<8|e[i]>>>24)|4278255360&(e[i]<<24|e[i]>>>8);var a=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],s=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,i=0;i<4;i++)c.call(this);for(i=0;i<8;i++)s[i]^=a[i+4&7];if(t){var o=t.words,u=o[0],l=o[1],d=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),f=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),h=d>>>16|4294901760&f,p=f<<16|65535&d;for(s[0]^=d,s[1]^=h,s[2]^=f,s[3]^=p,s[4]^=d,s[5]^=h,s[6]^=f,s[7]^=p,i=0;i<4;i++)c.call(this)}},_doProcessBlock:function(e,t){var i=this._X;c.call(this),s[0]=i[0]^i[5]>>>16^i[3]<<16,s[1]=i[2]^i[7]>>>16^i[5]<<16,s[2]=i[4]^i[1]>>>16^i[7]<<16,s[3]=i[6]^i[3]>>>16^i[1]<<16;for(var a=0;a<4;a++)s[a]=16711935&(s[a]<<8|s[a]>>>24)|4278255360&(s[a]<<24|s[a]>>>8),e[t+a]^=s[a]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,i=0;i<8;i++)o[i]=t[i];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<o[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<o[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<o[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<o[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<o[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<o[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<o[6]>>>0?1:0)|0,this._b=t[7]>>>0<o[7]>>>0?1:0,i=0;i<8;i++){var a=e[i]+t[i],s=65535&a,l=a>>>16,c=((s*s>>>17)+s*l>>>15)+l*l,d=((4294901760&a)*a|0)+((65535&a)*a|0);u[i]=c^d}e[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,e[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,e[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,e[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,e[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,e[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,e[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,e[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}e.Rabbit=t._createHelper(l)}(),a.Rabbit)},1857:function(e,t,i){var a;e.exports=(a=i(8249),i(8269),i(8214),i(888),i(5109),function(){var e=a,t=e.lib.StreamCipher,i=e.algo,s=i.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,i=e.sigBytes,a=this._S=[],s=0;s<256;s++)a[s]=s;s=0;for(var o=0;s<256;s++){var u=s%i,l=t[u>>>2]>>>24-u%4*8&255;o=(o+a[s]+l)%256;var c=a[s];a[s]=a[o],a[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=o.call(this)},keySize:8,ivSize:0});function o(){for(var e=this._S,t=this._i,i=this._j,a=0,s=0;s<4;s++){i=(i+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[i],e[i]=o,a|=e[(e[t]+e[i])%256]<<24-8*s}return this._i=t,this._j=i,a}e.RC4=t._createHelper(s);var u=i.RC4Drop=s.extend({cfg:s.cfg.extend({drop:192}),_doReset:function(){s._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)o.call(this)}});e.RC4Drop=t._createHelper(u)}(),a.RC4)},706:function(e,t,i){var a;e.exports=(a=i(8249),function(e){var t=a,i=t.lib,s=i.WordArray,o=i.Hasher,u=t.algo,l=s.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=s.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),d=s.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),f=s.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),h=s.create([0,1518500249,1859775393,2400959708,2840853838]),p=s.create([1352829926,1548603684,1836072691,2053994217,0]),v=u.RIPEMD160=o.extend({_doReset:function(){this._hash=s.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=0;i<16;i++){var a=t+i,s=e[a];e[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var o,u,v,b,S,R,A,w,I,D,L,k=this._hash.words,C=h.words,O=p.words,P=l.words,x=c.words,M=d.words,N=f.words;for(R=o=k[0],A=u=k[1],w=v=k[2],I=b=k[3],D=S=k[4],i=0;i<80;i+=1)L=o+e[t+P[i]]|0,L+=i<16?g(u,v,b)+C[0]:i<32?m(u,v,b)+C[1]:i<48?y(u,v,b)+C[2]:i<64?E(u,v,b)+C[3]:_(u,v,b)+C[4],L=(L=T(L|=0,M[i]))+S|0,o=S,S=b,b=T(v,10),v=u,u=L,L=R+e[t+x[i]]|0,L+=i<16?_(A,w,I)+O[0]:i<32?E(A,w,I)+O[1]:i<48?y(A,w,I)+O[2]:i<64?m(A,w,I)+O[3]:g(A,w,I)+O[4],L=(L=T(L|=0,N[i]))+D|0,R=D,D=I,I=T(w,10),w=A,A=L;L=k[1]+v+I|0,k[1]=k[2]+b+D|0,k[2]=k[3]+S+R|0,k[3]=k[4]+o+A|0,k[4]=k[0]+u+w|0,k[0]=L},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,a=8*e.sigBytes;t[a>>>5]|=128<<24-a%32,t[14+(a+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(t.length+1),this._process();for(var s=this._hash,o=s.words,u=0;u<5;u++){var l=o[u];o[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function g(e,t,i){return e^t^i}function m(e,t,i){return e&t|~e&i}function y(e,t,i){return(e|~t)^i}function E(e,t,i){return e&i|t&~i}function _(e,t,i){return e^(t|~i)}function T(e,t){return e<<t|e>>>32-t}t.RIPEMD160=o._createHelper(v),t.HmacRIPEMD160=o._createHmacHelper(v)}(Math),a.RIPEMD160)},2783:function(e,t,i){var a,s,o,u,l,c,d,f;e.exports=(f=i(8249),s=(a=f).lib,o=s.WordArray,u=s.Hasher,l=a.algo,c=[],d=l.SHA1=u.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=this._hash.words,a=i[0],s=i[1],o=i[2],u=i[3],l=i[4],d=0;d<80;d++){if(d<16)c[d]=0|e[t+d];else{var f=c[d-3]^c[d-8]^c[d-14]^c[d-16];c[d]=f<<1|f>>>31}var h=(a<<5|a>>>27)+l+c[d];h+=d<20?1518500249+(s&o|~s&u):d<40?1859775393+(s^o^u):d<60?(s&o|s&u|o&u)-1894007588:(s^o^u)-899497514,l=u,u=o,o=s<<30|s>>>2,s=a,a=h}i[0]=i[0]+a|0,i[1]=i[1]+s|0,i[2]=i[2]+o|0,i[3]=i[3]+u|0,i[4]=i[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[14+(a+64>>>9<<4)]=Math.floor(i/4294967296),t[15+(a+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}}),a.SHA1=u._createHelper(d),a.HmacSHA1=u._createHmacHelper(d),f.SHA1)},7792:function(e,t,i){var a,s,o,u,l,c;e.exports=(c=i(8249),i(2153),s=(a=c).lib.WordArray,o=a.algo,u=o.SHA256,l=o.SHA224=u.extend({_doReset:function(){this._hash=new s.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=u._doFinalize.call(this);return e.sigBytes-=4,e}}),a.SHA224=u._createHelper(l),a.HmacSHA224=u._createHmacHelper(l),c.SHA224)},2153:function(e,t,i){var a;e.exports=(a=i(8249),function(e){var t=a,i=t.lib,s=i.WordArray,o=i.Hasher,u=t.algo,l=[],c=[];!function(){function t(t){for(var i=e.sqrt(t),a=2;a<=i;a++)if(!(t%a))return!1;return!0}function i(e){return 4294967296*(e-(0|e))|0}for(var a=2,s=0;s<64;)t(a)&&(s<8&&(l[s]=i(e.pow(a,.5))),c[s]=i(e.pow(a,1/3)),s++),a++}();var d=[],f=u.SHA256=o.extend({_doReset:function(){this._hash=new s.init(l.slice(0))},_doProcessBlock:function(e,t){for(var i=this._hash.words,a=i[0],s=i[1],o=i[2],u=i[3],l=i[4],f=i[5],h=i[6],p=i[7],v=0;v<64;v++){if(v<16)d[v]=0|e[t+v];else{var g=d[v-15],m=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,y=d[v-2],E=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;d[v]=m+d[v-7]+E+d[v-16]}var _=a&s^a&o^s&o,T=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),b=p+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&f^~l&h)+c[v]+d[v];p=h,h=f,f=l,l=u+b|0,u=o,o=s,s=a,a=b+(T+_)|0}i[0]=i[0]+a|0,i[1]=i[1]+s|0,i[2]=i[2]+o|0,i[3]=i[3]+u|0,i[4]=i[4]+l|0,i[5]=i[5]+f|0,i[6]=i[6]+h|0,i[7]=i[7]+p|0},_doFinalize:function(){var t=this._data,i=t.words,a=8*this._nDataBytes,s=8*t.sigBytes;return i[s>>>5]|=128<<24-s%32,i[14+(s+64>>>9<<4)]=e.floor(a/4294967296),i[15+(s+64>>>9<<4)]=a,t.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(f),t.HmacSHA256=o._createHmacHelper(f)}(Math),a.SHA256)},3327:function(e,t,i){var a;e.exports=(a=i(8249),i(4938),function(e){var t=a,i=t.lib,s=i.WordArray,o=i.Hasher,u=t.x64.Word,l=t.algo,c=[],d=[],f=[];!function(){for(var e=1,t=0,i=0;i<24;i++){c[e+5*t]=(i+1)*(i+2)/2%64;var a=(2*e+3*t)%5;e=t%5,t=a}for(e=0;e<5;e++)for(t=0;t<5;t++)d[e+5*t]=t+(2*e+3*t)%5*5;for(var s=1,o=0;o<24;o++){for(var l=0,h=0,p=0;p<7;p++){if(1&s){var v=(1<<p)-1;v<32?h^=1<<v:l^=1<<v-32}128&s?s=s<<1^113:s<<=1}f[o]=u.create(l,h)}}();var h=[];!function(){for(var e=0;e<25;e++)h[e]=u.create()}();var p=l.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new u.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var i=this._state,a=this.blockSize/2,s=0;s<a;s++){var o=e[t+2*s],u=e[t+2*s+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),u=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),(k=i[s]).high^=u,k.low^=o}for(var l=0;l<24;l++){for(var p=0;p<5;p++){for(var v=0,g=0,m=0;m<5;m++)v^=(k=i[p+5*m]).high,g^=k.low;var y=h[p];y.high=v,y.low=g}for(p=0;p<5;p++){var E=h[(p+4)%5],_=h[(p+1)%5],T=_.high,b=_.low;for(v=E.high^(T<<1|b>>>31),g=E.low^(b<<1|T>>>31),m=0;m<5;m++)(k=i[p+5*m]).high^=v,k.low^=g}for(var S=1;S<25;S++){var R=(k=i[S]).high,A=k.low,w=c[S];w<32?(v=R<<w|A>>>32-w,g=A<<w|R>>>32-w):(v=A<<w-32|R>>>64-w,g=R<<w-32|A>>>64-w);var I=h[d[S]];I.high=v,I.low=g}var D=h[0],L=i[0];for(D.high=L.high,D.low=L.low,p=0;p<5;p++)for(m=0;m<5;m++){var k=i[S=p+5*m],C=h[S],O=h[(p+1)%5+5*m],P=h[(p+2)%5+5*m];k.high=C.high^~O.high&P.high,k.low=C.low^~O.low&P.low}k=i[0];var x=f[l];k.high^=x.high,k.low^=x.low}},_doFinalize:function(){var t=this._data,i=t.words,a=(this._nDataBytes,8*t.sigBytes),o=32*this.blockSize;i[a>>>5]|=1<<24-a%32,i[(e.ceil((a+1)/o)*o>>>5)-1]|=128,t.sigBytes=4*i.length,this._process();for(var u=this._state,l=this.cfg.outputLength/8,c=l/8,d=[],f=0;f<c;f++){var h=u[f],p=h.high,v=h.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),v=16711935&(v<<8|v>>>24)|4278255360&(v<<24|v>>>8),d.push(v),d.push(p)}return new s.init(d,l)},clone:function(){for(var e=o.clone.call(this),t=e._state=this._state.slice(0),i=0;i<25;i++)t[i]=t[i].clone();return e}});t.SHA3=o._createHelper(p),t.HmacSHA3=o._createHmacHelper(p)}(Math),a.SHA3)},7460:function(e,t,i){var a,s,o,u,l,c,d,f;e.exports=(f=i(8249),i(4938),i(34),s=(a=f).x64,o=s.Word,u=s.WordArray,l=a.algo,c=l.SHA512,d=l.SHA384=c.extend({_doReset:function(){this._hash=new u.init([new o.init(3418070365,3238371032),new o.init(1654270250,914150663),new o.init(2438529370,812702999),new o.init(355462360,4144912697),new o.init(1731405415,4290775857),new o.init(2394180231,1750603025),new o.init(3675008525,1694076839),new o.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),a.SHA384=c._createHelper(d),a.HmacSHA384=c._createHmacHelper(d),f.SHA384)},34:function(e,t,i){var a;e.exports=(a=i(8249),i(4938),function(){var e=a,t=e.lib.Hasher,i=e.x64,s=i.Word,o=i.WordArray,u=e.algo;function l(){return s.create.apply(s,arguments)}var c=[l(1116352408,3609767458),l(1899447441,602891725),l(3049323471,3964484399),l(3921009573,2173295548),l(961987163,4081628472),l(1508970993,3053834265),l(2453635748,2937671579),l(2870763221,3664609560),l(3624381080,2734883394),l(310598401,1164996542),l(607225278,1323610764),l(1426881987,3590304994),l(1925078388,4068182383),l(2162078206,991336113),l(2614888103,633803317),l(3248222580,3479774868),l(3835390401,2666613458),l(4022224774,944711139),l(264347078,2341262773),l(604807628,2007800933),l(770255983,1495990901),l(1249150122,1856431235),l(1555081692,3175218132),l(1996064986,2198950837),l(2554220882,3999719339),l(2821834349,766784016),l(2952996808,2566594879),l(3210313671,3203337956),l(3336571891,1034457026),l(3584528711,2466948901),l(113926993,3758326383),l(338241895,168717936),l(666307205,1188179964),l(773529912,1546045734),l(1294757372,1522805485),l(1396182291,2643833823),l(1695183700,2343527390),l(1986661051,1014477480),l(2177026350,1206759142),l(2456956037,344077627),l(2730485921,1290863460),l(2820302411,3158454273),l(3259730800,3505952657),l(3345764771,106217008),l(3516065817,3606008344),l(3600352804,1432725776),l(4094571909,1467031594),l(275423344,851169720),l(430227734,3100823752),l(506948616,1363258195),l(659060556,3750685593),l(883997877,3785050280),l(958139571,3318307427),l(1322822218,3812723403),l(1537002063,2003034995),l(1747873779,3602036899),l(1955562222,1575990012),l(2024104815,1125592928),l(2227730452,2716904306),l(2361852424,442776044),l(2428436474,593698344),l(2756734187,3733110249),l(3204031479,2999351573),l(3329325298,3815920427),l(3391569614,3928383900),l(3515267271,566280711),l(3940187606,3454069534),l(4118630271,4000239992),l(116418474,1914138554),l(174292421,2731055270),l(289380356,3203993006),l(460393269,320620315),l(685471733,587496836),l(852142971,1086792851),l(1017036298,365543100),l(1126000580,2618297676),l(1288033470,3409855158),l(1501505948,4234509866),l(1607167915,987167468),l(1816402316,1246189591)],d=[];!function(){for(var e=0;e<80;e++)d[e]=l()}();var f=u.SHA512=t.extend({_doReset:function(){this._hash=new o.init([new s.init(1779033703,4089235720),new s.init(3144134277,2227873595),new s.init(1013904242,4271175723),new s.init(2773480762,1595750129),new s.init(1359893119,2917565137),new s.init(2600822924,725511199),new s.init(528734635,4215389547),new s.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var i=this._hash.words,a=i[0],s=i[1],o=i[2],u=i[3],l=i[4],f=i[5],h=i[6],p=i[7],v=a.high,g=a.low,m=s.high,y=s.low,E=o.high,_=o.low,T=u.high,b=u.low,S=l.high,R=l.low,A=f.high,w=f.low,I=h.high,D=h.low,L=p.high,k=p.low,C=v,O=g,P=m,x=y,M=E,N=_,F=T,U=b,B=S,j=R,H=A,G=w,K=I,V=D,q=L,W=k,Y=0;Y<80;Y++){var z,X,Q=d[Y];if(Y<16)X=Q.high=0|e[t+2*Y],z=Q.low=0|e[t+2*Y+1];else{var $=d[Y-15],J=$.high,Z=$.low,ee=(J>>>1|Z<<31)^(J>>>8|Z<<24)^J>>>7,te=(Z>>>1|J<<31)^(Z>>>8|J<<24)^(Z>>>7|J<<25),re=d[Y-2],ne=re.high,ie=re.low,ae=(ne>>>19|ie<<13)^(ne<<3|ie>>>29)^ne>>>6,se=(ie>>>19|ne<<13)^(ie<<3|ne>>>29)^(ie>>>6|ne<<26),oe=d[Y-7],ue=oe.high,le=oe.low,ce=d[Y-16],de=ce.high,fe=ce.low;X=(X=(X=ee+ue+((z=te+le)>>>0<te>>>0?1:0))+ae+((z+=se)>>>0<se>>>0?1:0))+de+((z+=fe)>>>0<fe>>>0?1:0),Q.high=X,Q.low=z}var he,pe=B&H^~B&K,ve=j&G^~j&V,ge=C&P^C&M^P&M,me=O&x^O&N^x&N,ye=(C>>>28|O<<4)^(C<<30|O>>>2)^(C<<25|O>>>7),Ee=(O>>>28|C<<4)^(O<<30|C>>>2)^(O<<25|C>>>7),_e=(B>>>14|j<<18)^(B>>>18|j<<14)^(B<<23|j>>>9),Te=(j>>>14|B<<18)^(j>>>18|B<<14)^(j<<23|B>>>9),be=c[Y],Se=be.high,Re=be.low,Ae=q+_e+((he=W+Te)>>>0<W>>>0?1:0),we=Ee+me;q=K,W=V,K=H,V=G,H=B,G=j,B=F+(Ae=(Ae=(Ae=Ae+pe+((he+=ve)>>>0<ve>>>0?1:0))+Se+((he+=Re)>>>0<Re>>>0?1:0))+X+((he+=z)>>>0<z>>>0?1:0))+((j=U+he|0)>>>0<U>>>0?1:0)|0,F=M,U=N,M=P,N=x,P=C,x=O,C=Ae+(ye+ge+(we>>>0<Ee>>>0?1:0))+((O=he+we|0)>>>0<he>>>0?1:0)|0}g=a.low=g+O,a.high=v+C+(g>>>0<O>>>0?1:0),y=s.low=y+x,s.high=m+P+(y>>>0<x>>>0?1:0),_=o.low=_+N,o.high=E+M+(_>>>0<N>>>0?1:0),b=u.low=b+U,u.high=T+F+(b>>>0<U>>>0?1:0),R=l.low=R+j,l.high=S+B+(R>>>0<j>>>0?1:0),w=f.low=w+G,f.high=A+H+(w>>>0<G>>>0?1:0),D=h.low=D+V,h.high=I+K+(D>>>0<V>>>0?1:0),k=p.low=k+W,p.high=L+q+(k>>>0<W>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[30+(a+128>>>10<<5)]=Math.floor(i/4294967296),t[31+(a+128>>>10<<5)]=i,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(f),e.HmacSHA512=t._createHmacHelper(f)}(),a.SHA512)},4253:function(e,t,i){var a;e.exports=(a=i(8249),i(8269),i(8214),i(888),i(5109),function(){var e=a,t=e.lib,i=t.WordArray,s=t.BlockCipher,o=e.algo,u=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],l=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],d=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],f=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=o.DES=s.extend({_doReset:function(){for(var e=this._key.words,t=[],i=0;i<56;i++){var a=u[i]-1;t[i]=e[a>>>5]>>>31-a%32&1}for(var s=this._subKeys=[],o=0;o<16;o++){var d=s[o]=[],f=c[o];for(i=0;i<24;i++)d[i/6|0]|=t[(l[i]-1+f)%28]<<31-i%6,d[4+(i/6|0)]|=t[28+(l[i+24]-1+f)%28]<<31-i%6;for(d[0]=d[0]<<1|d[0]>>>31,i=1;i<7;i++)d[i]=d[i]>>>4*(i-1)+3;d[7]=d[7]<<5|d[7]>>>27}var h=this._invSubKeys=[];for(i=0;i<16;i++)h[i]=s[15-i]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,i){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),v.call(this,2,858993459),v.call(this,8,16711935),p.call(this,1,1431655765);for(var a=0;a<16;a++){for(var s=i[a],o=this._lBlock,u=this._rBlock,l=0,c=0;c<8;c++)l|=d[c][((u^s[c])&f[c])>>>0];this._lBlock=u,this._rBlock=o^l}var h=this._lBlock;this._lBlock=this._rBlock,this._rBlock=h,p.call(this,1,1431655765),v.call(this,8,16711935),v.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var i=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=i,this._lBlock^=i<<e}function v(e,t){var i=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=i,this._rBlock^=i<<e}e.DES=s._createHelper(h);var g=o.TripleDES=s.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),a=e.length<4?e.slice(0,2):e.slice(2,4),s=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=h.createEncryptor(i.create(t)),this._des2=h.createEncryptor(i.create(a)),this._des3=h.createEncryptor(i.create(s))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=s._createHelper(g)}(),a.TripleDES)},4938:function(e,t,i){var a;e.exports=(a=i(8249),function(e){var t=a,i=t.lib,s=i.Base,o=i.WordArray,u=t.x64={};u.Word=s.extend({init:function(e,t){this.high=e,this.low=t}}),u.WordArray=s.extend({init:function(t,i){t=this.words=t||[],this.sigBytes=i!=e?i:8*t.length},toX32:function(){for(var e=this.words,t=e.length,i=[],a=0;a<t;a++){var s=e[a];i.push(s.high),i.push(s.low)}return o.create(i,this.sigBytes)},clone:function(){for(var e=s.clone.call(this),t=e.words=this.words.slice(0),i=t.length,a=0;a<i;a++)t[a]=t[a].clone();return e}})}(),a)},5519:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ACCEPTED:()=>a,BAD_GATEWAY:()=>s,BAD_REQUEST:()=>o,CONFLICT:()=>u,CONTINUE:()=>l,CREATED:()=>c,EXPECTATION_FAILED:()=>d,FAILED_DEPENDENCY:()=>f,FORBIDDEN:()=>h,GATEWAY_TIMEOUT:()=>p,GONE:()=>v,HTTP_VERSION_NOT_SUPPORTED:()=>g,IM_A_TEAPOT:()=>m,INSUFFICIENT_SPACE_ON_RESOURCE:()=>y,INSUFFICIENT_STORAGE:()=>E,INTERNAL_SERVER_ERROR:()=>_,LENGTH_REQUIRED:()=>T,LOCKED:()=>b,METHOD_FAILURE:()=>S,METHOD_NOT_ALLOWED:()=>R,MOVED_PERMANENTLY:()=>A,MOVED_TEMPORARILY:()=>w,MULTIPLE_CHOICES:()=>D,MULTI_STATUS:()=>I,NETWORK_AUTHENTICATION_REQUIRED:()=>L,NON_AUTHORITATIVE_INFORMATION:()=>C,NOT_ACCEPTABLE:()=>O,NOT_FOUND:()=>P,NOT_IMPLEMENTED:()=>x,NOT_MODIFIED:()=>M,NO_CONTENT:()=>k,OK:()=>N,PARTIAL_CONTENT:()=>F,PAYMENT_REQUIRED:()=>U,PERMANENT_REDIRECT:()=>B,PRECONDITION_FAILED:()=>j,PRECONDITION_REQUIRED:()=>H,PROCESSING:()=>G,PROXY_AUTHENTICATION_REQUIRED:()=>K,REQUESTED_RANGE_NOT_SATISFIABLE:()=>z,REQUEST_HEADER_FIELDS_TOO_LARGE:()=>V,REQUEST_TIMEOUT:()=>q,REQUEST_TOO_LONG:()=>W,REQUEST_URI_TOO_LONG:()=>Y,RESET_CONTENT:()=>X,ReasonPhrases:()=>de,SEE_OTHER:()=>Q,SERVICE_UNAVAILABLE:()=>$,SWITCHING_PROTOCOLS:()=>J,StatusCodes:()=>ce,TEMPORARY_REDIRECT:()=>Z,TOO_MANY_REQUESTS:()=>ee,UNAUTHORIZED:()=>te,UNPROCESSABLE_ENTITY:()=>re,UNSUPPORTED_MEDIA_TYPE:()=>ne,USE_PROXY:()=>ie,default:()=>pe,getReasonPhrase:()=>ue,getStatusCode:()=>le,getStatusText:()=>fe});var a=202,s=502,o=400,u=409,l=100,c=201,d=417,f=424,h=403,p=504,v=410,g=505,m=418,y=419,E=507,_=500,T=411,b=423,S=420,R=405,A=301,w=302,I=207,D=300,L=511,k=204,C=203,O=406,P=404,x=501,M=304,N=200,F=206,U=402,B=308,j=412,H=428,G=102,K=407,V=431,q=408,W=413,Y=414,z=416,X=205,Q=303,$=503,J=101,Z=307,ee=429,te=401,re=422,ne=415,ie=305;const ae={ACCEPTED:a,BAD_GATEWAY:s,BAD_REQUEST:o,CONFLICT:u,CONTINUE:l,CREATED:c,EXPECTATION_FAILED:d,FORBIDDEN:h,GATEWAY_TIMEOUT:p,GONE:v,HTTP_VERSION_NOT_SUPPORTED:g,IM_A_TEAPOT:m,INSUFFICIENT_SPACE_ON_RESOURCE:y,INSUFFICIENT_STORAGE:E,INTERNAL_SERVER_ERROR:_,LENGTH_REQUIRED:T,LOCKED:b,METHOD_FAILURE:S,METHOD_NOT_ALLOWED:R,MOVED_PERMANENTLY:A,MOVED_TEMPORARILY:w,MULTI_STATUS:I,MULTIPLE_CHOICES:D,NETWORK_AUTHENTICATION_REQUIRED:L,NO_CONTENT:k,NON_AUTHORITATIVE_INFORMATION:C,NOT_ACCEPTABLE:O,NOT_FOUND:P,NOT_IMPLEMENTED:x,NOT_MODIFIED:M,OK:N,PARTIAL_CONTENT:F,PAYMENT_REQUIRED:U,PERMANENT_REDIRECT:B,PRECONDITION_FAILED:j,PRECONDITION_REQUIRED:H,PROCESSING:G,PROXY_AUTHENTICATION_REQUIRED:K,REQUEST_HEADER_FIELDS_TOO_LARGE:V,REQUEST_TIMEOUT:q,REQUEST_TOO_LONG:W,REQUEST_URI_TOO_LONG:Y,REQUESTED_RANGE_NOT_SATISFIABLE:z,RESET_CONTENT:X,SEE_OTHER:Q,SERVICE_UNAVAILABLE:$,SWITCHING_PROTOCOLS:J,TEMPORARY_REDIRECT:Z,TOO_MANY_REQUESTS:ee,UNAUTHORIZED:te,UNPROCESSABLE_ENTITY:re,UNSUPPORTED_MEDIA_TYPE:ne,USE_PROXY:ie};var se={202:"Accepted",502:"Bad Gateway",400:"Bad Request",409:"Conflict",100:"Continue",201:"Created",417:"Expectation Failed",424:"Failed Dependency",403:"Forbidden",504:"Gateway Timeout",410:"Gone",505:"HTTP Version Not Supported",418:"I'm a teapot",419:"Insufficient Space on Resource",507:"Insufficient Storage",500:"Internal Server Error",411:"Length Required",423:"Locked",420:"Method Failure",405:"Method Not Allowed",301:"Moved Permanently",302:"Moved Temporarily",207:"Multi-Status",300:"Multiple Choices",511:"Network Authentication Required",204:"No Content",203:"Non Authoritative Information",406:"Not Acceptable",404:"Not Found",501:"Not Implemented",304:"Not Modified",200:"OK",206:"Partial Content",402:"Payment Required",308:"Permanent Redirect",412:"Precondition Failed",428:"Precondition Required",102:"Processing",407:"Proxy Authentication Required",431:"Request Header Fields Too Large",408:"Request Timeout",413:"Request Entity Too Large",414:"Request-URI Too Long",416:"Requested Range Not Satisfiable",205:"Reset Content",303:"See Other",503:"Service Unavailable",101:"Switching Protocols",307:"Temporary Redirect",429:"Too Many Requests",401:"Unauthorized",451:"Unavailable For Legal Reasons",422:"Unprocessable Entity",415:"Unsupported Media Type",305:"Use Proxy",421:"Misdirected Request"},oe={Accepted:202,"Bad Gateway":502,"Bad Request":400,Conflict:409,Continue:100,Created:201,"Expectation Failed":417,"Failed Dependency":424,Forbidden:403,"Gateway Timeout":504,Gone:410,"HTTP Version Not Supported":505,"I'm a teapot":418,"Insufficient Space on Resource":419,"Insufficient Storage":507,"Internal Server Error":500,"Length Required":411,Locked:423,"Method Failure":420,"Method Not Allowed":405,"Moved Permanently":301,"Moved Temporarily":302,"Multi-Status":207,"Multiple Choices":300,"Network Authentication Required":511,"No Content":204,"Non Authoritative Information":203,"Not Acceptable":406,"Not Found":404,"Not Implemented":501,"Not Modified":304,OK:200,"Partial Content":206,"Payment Required":402,"Permanent Redirect":308,"Precondition Failed":412,"Precondition Required":428,Processing:102,"Proxy Authentication Required":407,"Request Header Fields Too Large":431,"Request Timeout":408,"Request Entity Too Large":413,"Request-URI Too Long":414,"Requested Range Not Satisfiable":416,"Reset Content":205,"See Other":303,"Service Unavailable":503,"Switching Protocols":101,"Temporary Redirect":307,"Too Many Requests":429,Unauthorized:401,"Unavailable For Legal Reasons":451,"Unprocessable Entity":422,"Unsupported Media Type":415,"Use Proxy":305,"Misdirected Request":421};function ue(e){var t=se[e.toString()];if(!t)throw new Error("Status code does not exist: "+e);return t}function le(e){var t=oe[e];if(!t)throw new Error("Reason phrase does not exist: "+e);return t}var ce,de,fe=ue;!function(e){e[e.ACCEPTED=202]="ACCEPTED",e[e.BAD_GATEWAY=502]="BAD_GATEWAY",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.CONFLICT=409]="CONFLICT",e[e.CONTINUE=100]="CONTINUE",e[e.CREATED=201]="CREATED",e[e.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",e[e.FAILED_DEPENDENCY=424]="FAILED_DEPENDENCY",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",e[e.GONE=410]="GONE",e[e.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED",e[e.IM_A_TEAPOT=418]="IM_A_TEAPOT",e[e.INSUFFICIENT_SPACE_ON_RESOURCE=419]="INSUFFICIENT_SPACE_ON_RESOURCE",e[e.INSUFFICIENT_STORAGE=507]="INSUFFICIENT_STORAGE",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",e[e.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",e[e.LOCKED=423]="LOCKED",e[e.METHOD_FAILURE=420]="METHOD_FAILURE",e[e.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",e[e.MOVED_PERMANENTLY=301]="MOVED_PERMANENTLY",e[e.MOVED_TEMPORARILY=302]="MOVED_TEMPORARILY",e[e.MULTI_STATUS=207]="MULTI_STATUS",e[e.MULTIPLE_CHOICES=300]="MULTIPLE_CHOICES",e[e.NETWORK_AUTHENTICATION_REQUIRED=511]="NETWORK_AUTHENTICATION_REQUIRED",e[e.NO_CONTENT=204]="NO_CONTENT",e[e.NON_AUTHORITATIVE_INFORMATION=203]="NON_AUTHORITATIVE_INFORMATION",e[e.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",e[e.NOT_MODIFIED=304]="NOT_MODIFIED",e[e.OK=200]="OK",e[e.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",e[e.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",e[e.PERMANENT_REDIRECT=308]="PERMANENT_REDIRECT",e[e.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",e[e.PRECONDITION_REQUIRED=428]="PRECONDITION_REQUIRED",e[e.PROCESSING=102]="PROCESSING",e[e.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",e[e.REQUEST_HEADER_FIELDS_TOO_LARGE=431]="REQUEST_HEADER_FIELDS_TOO_LARGE",e[e.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",e[e.REQUEST_TOO_LONG=413]="REQUEST_TOO_LONG",e[e.REQUEST_URI_TOO_LONG=414]="REQUEST_URI_TOO_LONG",e[e.REQUESTED_RANGE_NOT_SATISFIABLE=416]="REQUESTED_RANGE_NOT_SATISFIABLE",e[e.RESET_CONTENT=205]="RESET_CONTENT",e[e.SEE_OTHER=303]="SEE_OTHER",e[e.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",e[e.SWITCHING_PROTOCOLS=101]="SWITCHING_PROTOCOLS",e[e.TEMPORARY_REDIRECT=307]="TEMPORARY_REDIRECT",e[e.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.UNAVAILABLE_FOR_LEGAL_REASONS=451]="UNAVAILABLE_FOR_LEGAL_REASONS",e[e.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",e[e.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",e[e.USE_PROXY=305]="USE_PROXY",e[e.MISDIRECTED_REQUEST=421]="MISDIRECTED_REQUEST"}(ce||(ce={})),function(e){e.ACCEPTED="Accepted",e.BAD_GATEWAY="Bad Gateway",e.BAD_REQUEST="Bad Request",e.CONFLICT="Conflict",e.CONTINUE="Continue",e.CREATED="Created",e.EXPECTATION_FAILED="Expectation Failed",e.FAILED_DEPENDENCY="Failed Dependency",e.FORBIDDEN="Forbidden",e.GATEWAY_TIMEOUT="Gateway Timeout",e.GONE="Gone",e.HTTP_VERSION_NOT_SUPPORTED="HTTP Version Not Supported",e.IM_A_TEAPOT="I'm a teapot",e.INSUFFICIENT_SPACE_ON_RESOURCE="Insufficient Space on Resource",e.INSUFFICIENT_STORAGE="Insufficient Storage",e.INTERNAL_SERVER_ERROR="Internal Server Error",e.LENGTH_REQUIRED="Length Required",e.LOCKED="Locked",e.METHOD_FAILURE="Method Failure",e.METHOD_NOT_ALLOWED="Method Not Allowed",e.MOVED_PERMANENTLY="Moved Permanently",e.MOVED_TEMPORARILY="Moved Temporarily",e.MULTI_STATUS="Multi-Status",e.MULTIPLE_CHOICES="Multiple Choices",e.NETWORK_AUTHENTICATION_REQUIRED="Network Authentication Required",e.NO_CONTENT="No Content",e.NON_AUTHORITATIVE_INFORMATION="Non Authoritative Information",e.NOT_ACCEPTABLE="Not Acceptable",e.NOT_FOUND="Not Found",e.NOT_IMPLEMENTED="Not Implemented",e.NOT_MODIFIED="Not Modified",e.OK="OK",e.PARTIAL_CONTENT="Partial Content",e.PAYMENT_REQUIRED="Payment Required",e.PERMANENT_REDIRECT="Permanent Redirect",e.PRECONDITION_FAILED="Precondition Failed",e.PRECONDITION_REQUIRED="Precondition Required",e.PROCESSING="Processing",e.PROXY_AUTHENTICATION_REQUIRED="Proxy Authentication Required",e.REQUEST_HEADER_FIELDS_TOO_LARGE="Request Header Fields Too Large",e.REQUEST_TIMEOUT="Request Timeout",e.REQUEST_TOO_LONG="Request Entity Too Large",e.REQUEST_URI_TOO_LONG="Request-URI Too Long",e.REQUESTED_RANGE_NOT_SATISFIABLE="Requested Range Not Satisfiable",e.RESET_CONTENT="Reset Content",e.SEE_OTHER="See Other",e.SERVICE_UNAVAILABLE="Service Unavailable",e.SWITCHING_PROTOCOLS="Switching Protocols",e.TEMPORARY_REDIRECT="Temporary Redirect",e.TOO_MANY_REQUESTS="Too Many Requests",e.UNAUTHORIZED="Unauthorized",e.UNAVAILABLE_FOR_LEGAL_REASONS="Unavailable For Legal Reasons",e.UNPROCESSABLE_ENTITY="Unprocessable Entity",e.UNSUPPORTED_MEDIA_TYPE="Unsupported Media Type",e.USE_PROXY="Use Proxy",e.MISDIRECTED_REQUEST="Misdirected Request"}(de||(de={}));var he=function(){return he=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},he.apply(this,arguments)};const pe=he(he({},ae),{getStatusCode:le,getStatusText:fe})},645:(e,t)=>{t.read=function(e,t,i,a,s){var o,u,l=8*s-a-1,c=(1<<l)-1,d=c>>1,f=-7,h=i?s-1:0,p=i?-1:1,v=e[t+h];for(h+=p,o=v&(1<<-f)-1,v>>=-f,f+=l;f>0;o=256*o+e[t+h],h+=p,f-=8);for(u=o&(1<<-f)-1,o>>=-f,f+=a;f>0;u=256*u+e[t+h],h+=p,f-=8);if(0===o)o=1-d;else{if(o===c)return u?NaN:1/0*(v?-1:1);u+=Math.pow(2,a),o-=d}return(v?-1:1)*u*Math.pow(2,o-a)},t.write=function(e,t,i,a,s,o){var u,l,c,d=8*o-s-1,f=(1<<d)-1,h=f>>1,p=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,v=a?0:o-1,g=a?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,u=f):(u=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-u))<1&&(u--,c*=2),(t+=u+h>=1?p/c:p*Math.pow(2,1-h))*c>=2&&(u++,c/=2),u+h>=f?(l=0,u=f):u+h>=1?(l=(t*c-1)*Math.pow(2,s),u+=h):(l=t*Math.pow(2,h-1)*Math.pow(2,s),u=0));s>=8;e[i+v]=255&l,v+=g,l/=256,s-=8);for(u=u<<s|l,d+=s;d>0;e[i+v]=255&u,v+=g,u/=256,d-=8);e[i+v-g]|=128*m}},6486:function(e,t,i){var a;e=i.nmd(e),function(){var s,o="Expected a function",u="__lodash_hash_undefined__",l="__lodash_placeholder__",c=16,d=32,f=64,h=128,p=256,v=1/0,g=9007199254740991,m=NaN,y=4294967295,E=[["ary",h],["bind",1],["bindKey",2],["curry",8],["curryRight",c],["flip",512],["partial",d],["partialRight",f],["rearg",p]],_="[object Arguments]",T="[object Array]",b="[object Boolean]",S="[object Date]",R="[object Error]",A="[object Function]",w="[object GeneratorFunction]",I="[object Map]",D="[object Number]",L="[object Object]",k="[object Promise]",C="[object RegExp]",O="[object Set]",P="[object String]",x="[object Symbol]",M="[object WeakMap]",N="[object ArrayBuffer]",F="[object DataView]",U="[object Float32Array]",B="[object Float64Array]",j="[object Int8Array]",H="[object Int16Array]",G="[object Int32Array]",K="[object Uint8Array]",V="[object Uint8ClampedArray]",q="[object Uint16Array]",W="[object Uint32Array]",Y=/\b__p \+= '';/g,z=/\b(__p \+=) '' \+/g,X=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Q=/&(?:amp|lt|gt|quot|#39);/g,$=/[&<>"']/g,J=RegExp(Q.source),Z=RegExp($.source),ee=/<%-([\s\S]+?)%>/g,te=/<%([\s\S]+?)%>/g,re=/<%=([\s\S]+?)%>/g,ne=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ie=/^\w*$/,ae=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,se=/[\\^$.*+?()[\]{}|]/g,oe=RegExp(se.source),ue=/^\s+/,le=/\s/,ce=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,de=/\{\n\/\* \[wrapped with (.+)\] \*/,fe=/,? & /,he=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pe=/[()=,{}\[\]\/\s]/,ve=/\\(\\)?/g,ge=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,me=/\w*$/,ye=/^[-+]0x[0-9a-f]+$/i,Ee=/^0b[01]+$/i,_e=/^\[object .+?Constructor\]$/,Te=/^0o[0-7]+$/i,be=/^(?:0|[1-9]\d*)$/,Se=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Re=/($^)/,Ae=/['\n\r\u2028\u2029\\]/g,we="\\ud800-\\udfff",Ie="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",De="\\u2700-\\u27bf",Le="a-z\\xdf-\\xf6\\xf8-\\xff",ke="A-Z\\xc0-\\xd6\\xd8-\\xde",Ce="\\ufe0e\\ufe0f",Oe="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Pe="['â€™]",xe="["+we+"]",Me="["+Oe+"]",Ne="["+Ie+"]",Fe="\\d+",Ue="["+De+"]",Be="["+Le+"]",je="[^"+we+Oe+Fe+De+Le+ke+"]",He="\\ud83c[\\udffb-\\udfff]",Ge="[^"+we+"]",Ke="(?:\\ud83c[\\udde6-\\uddff]){2}",Ve="[\\ud800-\\udbff][\\udc00-\\udfff]",qe="["+ke+"]",We="\\u200d",Ye="(?:"+Be+"|"+je+")",ze="(?:"+qe+"|"+je+")",Xe="(?:['â€™](?:d|ll|m|re|s|t|ve))?",Qe="(?:['â€™](?:D|LL|M|RE|S|T|VE))?",$e="(?:"+Ne+"|"+He+")"+"?",Je="["+Ce+"]?",Ze=Je+$e+("(?:"+We+"(?:"+[Ge,Ke,Ve].join("|")+")"+Je+$e+")*"),et="(?:"+[Ue,Ke,Ve].join("|")+")"+Ze,tt="(?:"+[Ge+Ne+"?",Ne,Ke,Ve,xe].join("|")+")",rt=RegExp(Pe,"g"),nt=RegExp(Ne,"g"),it=RegExp(He+"(?="+He+")|"+tt+Ze,"g"),at=RegExp([qe+"?"+Be+"+"+Xe+"(?="+[Me,qe,"$"].join("|")+")",ze+"+"+Qe+"(?="+[Me,qe+Ye,"$"].join("|")+")",qe+"?"+Ye+"+"+Xe,qe+"+"+Qe,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Fe,et].join("|"),"g"),st=RegExp("["+We+we+Ie+Ce+"]"),ot=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ut=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],lt=-1,ct={};ct[U]=ct[B]=ct[j]=ct[H]=ct[G]=ct[K]=ct[V]=ct[q]=ct[W]=!0,ct[_]=ct[T]=ct[N]=ct[b]=ct[F]=ct[S]=ct[R]=ct[A]=ct[I]=ct[D]=ct[L]=ct[C]=ct[O]=ct[P]=ct[M]=!1;var dt={};dt[_]=dt[T]=dt[N]=dt[F]=dt[b]=dt[S]=dt[U]=dt[B]=dt[j]=dt[H]=dt[G]=dt[I]=dt[D]=dt[L]=dt[C]=dt[O]=dt[P]=dt[x]=dt[K]=dt[V]=dt[q]=dt[W]=!0,dt[R]=dt[A]=dt[M]=!1;var ft={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ht=parseFloat,pt=parseInt,vt="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,gt="object"==typeof self&&self&&self.Object===Object&&self,mt=vt||gt||Function("return this")(),yt=t&&!t.nodeType&&t,Et=yt&&e&&!e.nodeType&&e,_t=Et&&Et.exports===yt,Tt=_t&&vt.process,bt=function(){try{var e=Et&&Et.require&&Et.require("util").types;return e||Tt&&Tt.binding&&Tt.binding("util")}catch(e){}}(),St=bt&&bt.isArrayBuffer,Rt=bt&&bt.isDate,At=bt&&bt.isMap,wt=bt&&bt.isRegExp,It=bt&&bt.isSet,Dt=bt&&bt.isTypedArray;function Lt(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function kt(e,t,i,a){for(var s=-1,o=null==e?0:e.length;++s<o;){var u=e[s];t(a,u,i(u),e)}return a}function Ct(e,t){for(var i=-1,a=null==e?0:e.length;++i<a&&!1!==t(e[i],i,e););return e}function Ot(e,t){for(var i=null==e?0:e.length;i--&&!1!==t(e[i],i,e););return e}function Pt(e,t){for(var i=-1,a=null==e?0:e.length;++i<a;)if(!t(e[i],i,e))return!1;return!0}function xt(e,t){for(var i=-1,a=null==e?0:e.length,s=0,o=[];++i<a;){var u=e[i];t(u,i,e)&&(o[s++]=u)}return o}function Mt(e,t){return!!(null==e?0:e.length)&&qt(e,t,0)>-1}function Nt(e,t,i){for(var a=-1,s=null==e?0:e.length;++a<s;)if(i(t,e[a]))return!0;return!1}function Ft(e,t){for(var i=-1,a=null==e?0:e.length,s=Array(a);++i<a;)s[i]=t(e[i],i,e);return s}function Ut(e,t){for(var i=-1,a=t.length,s=e.length;++i<a;)e[s+i]=t[i];return e}function Bt(e,t,i,a){var s=-1,o=null==e?0:e.length;for(a&&o&&(i=e[++s]);++s<o;)i=t(i,e[s],s,e);return i}function jt(e,t,i,a){var s=null==e?0:e.length;for(a&&s&&(i=e[--s]);s--;)i=t(i,e[s],s,e);return i}function Ht(e,t){for(var i=-1,a=null==e?0:e.length;++i<a;)if(t(e[i],i,e))return!0;return!1}var Gt=Xt("length");function Kt(e,t,i){var a;return i(e,(function(e,i,s){if(t(e,i,s))return a=i,!1})),a}function Vt(e,t,i,a){for(var s=e.length,o=i+(a?1:-1);a?o--:++o<s;)if(t(e[o],o,e))return o;return-1}function qt(e,t,i){return t==t?function(e,t,i){var a=i-1,s=e.length;for(;++a<s;)if(e[a]===t)return a;return-1}(e,t,i):Vt(e,Yt,i)}function Wt(e,t,i,a){for(var s=i-1,o=e.length;++s<o;)if(a(e[s],t))return s;return-1}function Yt(e){return e!=e}function zt(e,t){var i=null==e?0:e.length;return i?Jt(e,t)/i:m}function Xt(e){return function(t){return null==t?s:t[e]}}function Qt(e){return function(t){return null==e?s:e[t]}}function $t(e,t,i,a,s){return s(e,(function(e,s,o){i=a?(a=!1,e):t(i,e,s,o)})),i}function Jt(e,t){for(var i,a=-1,o=e.length;++a<o;){var u=t(e[a]);u!==s&&(i=i===s?u:i+u)}return i}function Zt(e,t){for(var i=-1,a=Array(e);++i<e;)a[i]=t(i);return a}function er(e){return e?e.slice(0,mr(e)+1).replace(ue,""):e}function tr(e){return function(t){return e(t)}}function rr(e,t){return Ft(t,(function(t){return e[t]}))}function nr(e,t){return e.has(t)}function ir(e,t){for(var i=-1,a=e.length;++i<a&&qt(t,e[i],0)>-1;);return i}function ar(e,t){for(var i=e.length;i--&&qt(t,e[i],0)>-1;);return i}var sr=Qt({Ã€:"A",Ã:"A",Ã‚:"A",Ãƒ:"A",Ã„:"A",Ã…:"A",Ã :"a",Ã¡:"a",Ã¢:"a",Ã£:"a",Ã¤:"a",Ã¥:"a",Ã‡:"C",Ã§:"c",Ã:"D",Ã°:"d",Ãˆ:"E",Ã‰:"E",ÃŠ:"E",Ã‹:"E",Ã¨:"e",Ã©:"e",Ãª:"e",Ã«:"e",ÃŒ:"I",Ã:"I",ÃŽ:"I",Ã:"I",Ã¬:"i",Ã­:"i",Ã®:"i",Ã¯:"i",Ã‘:"N",Ã±:"n",Ã’:"O",Ã“:"O",Ã”:"O",Ã•:"O",Ã–:"O",Ã˜:"O",Ã²:"o",Ã³:"o",Ã´:"o",Ãµ:"o",Ã¶:"o",Ã¸:"o",Ã™:"U",Ãš:"U",Ã›:"U",Ãœ:"U",Ã¹:"u",Ãº:"u",Ã»:"u",Ã¼:"u",Ã:"Y",Ã½:"y",Ã¿:"y",Ã†:"Ae",Ã¦:"ae",Ãž:"Th",Ã¾:"th",ÃŸ:"ss",Ä€:"A",Ä‚:"A",Ä„:"A",Ä:"a",Äƒ:"a",Ä…:"a",Ä†:"C",Äˆ:"C",ÄŠ:"C",ÄŒ:"C",Ä‡:"c",Ä‰:"c",Ä‹:"c",Ä:"c",ÄŽ:"D",Ä:"D",Ä:"d",Ä‘:"d",Ä’:"E",Ä”:"E",Ä–:"E",Ä˜:"E",Äš:"E",Ä“:"e",Ä•:"e",Ä—:"e",Ä™:"e",Ä›:"e",Äœ:"G",Äž:"G",Ä :"G",Ä¢:"G",Ä:"g",ÄŸ:"g",Ä¡:"g",Ä£:"g",Ä¤:"H",Ä¦:"H",Ä¥:"h",Ä§:"h",Ä¨:"I",Äª:"I",Ä¬:"I",Ä®:"I",Ä°:"I",Ä©:"i",Ä«:"i",Ä­:"i",Ä¯:"i",Ä±:"i",Ä´:"J",Äµ:"j",Ä¶:"K",Ä·:"k",Ä¸:"k",Ä¹:"L",Ä»:"L",Ä½:"L",Ä¿:"L",Å:"L",Äº:"l",Ä¼:"l",Ä¾:"l",Å€:"l",Å‚:"l",Åƒ:"N",Å…:"N",Å‡:"N",ÅŠ:"N",Å„:"n",Å†:"n",Åˆ:"n",Å‹:"n",ÅŒ:"O",ÅŽ:"O",Å:"O",Å:"o",Å:"o",Å‘:"o",Å”:"R",Å–:"R",Å˜:"R",Å•:"r",Å—:"r",Å™:"r",Åš:"S",Åœ:"S",Åž:"S",Å :"S",Å›:"s",Å:"s",ÅŸ:"s",Å¡:"s",Å¢:"T",Å¤:"T",Å¦:"T",Å£:"t",Å¥:"t",Å§:"t",Å¨:"U",Åª:"U",Å¬:"U",Å®:"U",Å°:"U",Å²:"U",Å©:"u",Å«:"u",Å­:"u",Å¯:"u",Å±:"u",Å³:"u",Å´:"W",Åµ:"w",Å¶:"Y",Å·:"y",Å¸:"Y",Å¹:"Z",Å»:"Z",Å½:"Z",Åº:"z",Å¼:"z",Å¾:"z",Ä²:"IJ",Ä³:"ij",Å’:"Oe",Å“:"oe",Å‰:"'n",Å¿:"s"}),or=Qt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ur(e){return"\\"+ft[e]}function lr(e){return st.test(e)}function cr(e){var t=-1,i=Array(e.size);return e.forEach((function(e,a){i[++t]=[a,e]})),i}function dr(e,t){return function(i){return e(t(i))}}function fr(e,t){for(var i=-1,a=e.length,s=0,o=[];++i<a;){var u=e[i];u!==t&&u!==l||(e[i]=l,o[s++]=i)}return o}function hr(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}function pr(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=[e,e]})),i}function vr(e){return lr(e)?function(e){var t=it.lastIndex=0;for(;it.test(e);)++t;return t}(e):Gt(e)}function gr(e){return lr(e)?function(e){return e.match(it)||[]}(e):function(e){return e.split("")}(e)}function mr(e){for(var t=e.length;t--&&le.test(e.charAt(t)););return t}var yr=Qt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Er=function e(t){var i,a=(t=null==t?mt:Er.defaults(mt.Object(),t,Er.pick(mt,ut))).Array,le=t.Date,we=t.Error,Ie=t.Function,De=t.Math,Le=t.Object,ke=t.RegExp,Ce=t.String,Oe=t.TypeError,Pe=a.prototype,xe=Ie.prototype,Me=Le.prototype,Ne=t["__core-js_shared__"],Fe=xe.toString,Ue=Me.hasOwnProperty,Be=0,je=(i=/[^.]+$/.exec(Ne&&Ne.keys&&Ne.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",He=Me.toString,Ge=Fe.call(Le),Ke=mt._,Ve=ke("^"+Fe.call(Ue).replace(se,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qe=_t?t.Buffer:s,We=t.Symbol,Ye=t.Uint8Array,ze=qe?qe.allocUnsafe:s,Xe=dr(Le.getPrototypeOf,Le),Qe=Le.create,$e=Me.propertyIsEnumerable,Je=Pe.splice,Ze=We?We.isConcatSpreadable:s,et=We?We.iterator:s,tt=We?We.toStringTag:s,it=function(){try{var e=pa(Le,"defineProperty");return e({},"",{}),e}catch(e){}}(),st=t.clearTimeout!==mt.clearTimeout&&t.clearTimeout,ft=le&&le.now!==mt.Date.now&&le.now,vt=t.setTimeout!==mt.setTimeout&&t.setTimeout,gt=De.ceil,yt=De.floor,Et=Le.getOwnPropertySymbols,Tt=qe?qe.isBuffer:s,bt=t.isFinite,Gt=Pe.join,Qt=dr(Le.keys,Le),_r=De.max,Tr=De.min,br=le.now,Sr=t.parseInt,Rr=De.random,Ar=Pe.reverse,wr=pa(t,"DataView"),Ir=pa(t,"Map"),Dr=pa(t,"Promise"),Lr=pa(t,"Set"),kr=pa(t,"WeakMap"),Cr=pa(Le,"create"),Or=kr&&new kr,Pr={},xr=ja(wr),Mr=ja(Ir),Nr=ja(Dr),Fr=ja(Lr),Ur=ja(kr),Br=We?We.prototype:s,jr=Br?Br.valueOf:s,Hr=Br?Br.toString:s;function Gr(e){if(no(e)&&!Ws(e)&&!(e instanceof Wr)){if(e instanceof qr)return e;if(Ue.call(e,"__wrapped__"))return Ha(e)}return new qr(e)}var Kr=function(){function e(){}return function(t){if(!ro(t))return{};if(Qe)return Qe(t);e.prototype=t;var i=new e;return e.prototype=s,i}}();function Vr(){}function qr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=s}function Wr(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=y,this.__views__=[]}function Yr(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var a=e[t];this.set(a[0],a[1])}}function zr(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var a=e[t];this.set(a[0],a[1])}}function Xr(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var a=e[t];this.set(a[0],a[1])}}function Qr(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new Xr;++t<i;)this.add(e[t])}function $r(e){var t=this.__data__=new zr(e);this.size=t.size}function Jr(e,t){var i=Ws(e),a=!i&&qs(e),s=!i&&!a&&Qs(e),o=!i&&!a&&!s&&fo(e),u=i||a||s||o,l=u?Zt(e.length,Ce):[],c=l.length;for(var d in e)!t&&!Ue.call(e,d)||u&&("length"==d||s&&("offset"==d||"parent"==d)||o&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||Ta(d,c))||l.push(d);return l}function Zr(e){var t=e.length;return t?e[$n(0,t-1)]:s}function en(e,t){return Fa(Oi(e),cn(t,0,e.length))}function tn(e){return Fa(Oi(e))}function rn(e,t,i){(i!==s&&!Gs(e[t],i)||i===s&&!(t in e))&&un(e,t,i)}function nn(e,t,i){var a=e[t];Ue.call(e,t)&&Gs(a,i)&&(i!==s||t in e)||un(e,t,i)}function an(e,t){for(var i=e.length;i--;)if(Gs(e[i][0],t))return i;return-1}function sn(e,t,i,a){return vn(e,(function(e,s,o){t(a,e,i(e),o)})),a}function on(e,t){return e&&Pi(t,xo(t),e)}function un(e,t,i){"__proto__"==t&&it?it(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function ln(e,t){for(var i=-1,o=t.length,u=a(o),l=null==e;++i<o;)u[i]=l?s:Lo(e,t[i]);return u}function cn(e,t,i){return e==e&&(i!==s&&(e=e<=i?e:i),t!==s&&(e=e>=t?e:t)),e}function dn(e,t,i,a,o,u){var l,c=1&t,d=2&t,f=4&t;if(i&&(l=o?i(e,a,o,u):i(e)),l!==s)return l;if(!ro(e))return e;var h=Ws(e);if(h){if(l=function(e){var t=e.length,i=new e.constructor(t);t&&"string"==typeof e[0]&&Ue.call(e,"index")&&(i.index=e.index,i.input=e.input);return i}(e),!c)return Oi(e,l)}else{var p=ma(e),v=p==A||p==w;if(Qs(e))return wi(e,c);if(p==L||p==_||v&&!o){if(l=d||v?{}:Ea(e),!c)return d?function(e,t){return Pi(e,ga(e),t)}(e,function(e,t){return e&&Pi(t,Mo(t),e)}(l,e)):function(e,t){return Pi(e,va(e),t)}(e,on(l,e))}else{if(!dt[p])return o?e:{};l=function(e,t,i){var a=e.constructor;switch(t){case N:return Ii(e);case b:case S:return new a(+e);case F:return function(e,t){var i=t?Ii(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case U:case B:case j:case H:case G:case K:case V:case q:case W:return Di(e,i);case I:return new a;case D:case P:return new a(e);case C:return function(e){var t=new e.constructor(e.source,me.exec(e));return t.lastIndex=e.lastIndex,t}(e);case O:return new a;case x:return s=e,jr?Le(jr.call(s)):{}}var s}(e,p,c)}}u||(u=new $r);var g=u.get(e);if(g)return g;u.set(e,l),uo(e)?e.forEach((function(a){l.add(dn(a,t,i,a,e,u))})):io(e)&&e.forEach((function(a,s){l.set(s,dn(a,t,i,s,e,u))}));var m=h?s:(f?d?oa:sa:d?Mo:xo)(e);return Ct(m||e,(function(a,s){m&&(a=e[s=a]),nn(l,s,dn(a,t,i,s,e,u))})),l}function fn(e,t,i){var a=i.length;if(null==e)return!a;for(e=Le(e);a--;){var o=i[a],u=t[o],l=e[o];if(l===s&&!(o in e)||!u(l))return!1}return!0}function hn(e,t,i){if("function"!=typeof e)throw new Oe(o);return Pa((function(){e.apply(s,i)}),t)}function pn(e,t,i,a){var s=-1,o=Mt,u=!0,l=e.length,c=[],d=t.length;if(!l)return c;i&&(t=Ft(t,tr(i))),a?(o=Nt,u=!1):t.length>=200&&(o=nr,u=!1,t=new Qr(t));e:for(;++s<l;){var f=e[s],h=null==i?f:i(f);if(f=a||0!==f?f:0,u&&h==h){for(var p=d;p--;)if(t[p]===h)continue e;c.push(f)}else o(t,h,a)||c.push(f)}return c}Gr.templateSettings={escape:ee,evaluate:te,interpolate:re,variable:"",imports:{_:Gr}},Gr.prototype=Vr.prototype,Gr.prototype.constructor=Gr,qr.prototype=Kr(Vr.prototype),qr.prototype.constructor=qr,Wr.prototype=Kr(Vr.prototype),Wr.prototype.constructor=Wr,Yr.prototype.clear=function(){this.__data__=Cr?Cr(null):{},this.size=0},Yr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Yr.prototype.get=function(e){var t=this.__data__;if(Cr){var i=t[e];return i===u?s:i}return Ue.call(t,e)?t[e]:s},Yr.prototype.has=function(e){var t=this.__data__;return Cr?t[e]!==s:Ue.call(t,e)},Yr.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Cr&&t===s?u:t,this},zr.prototype.clear=function(){this.__data__=[],this.size=0},zr.prototype.delete=function(e){var t=this.__data__,i=an(t,e);return!(i<0)&&(i==t.length-1?t.pop():Je.call(t,i,1),--this.size,!0)},zr.prototype.get=function(e){var t=this.__data__,i=an(t,e);return i<0?s:t[i][1]},zr.prototype.has=function(e){return an(this.__data__,e)>-1},zr.prototype.set=function(e,t){var i=this.__data__,a=an(i,e);return a<0?(++this.size,i.push([e,t])):i[a][1]=t,this},Xr.prototype.clear=function(){this.size=0,this.__data__={hash:new Yr,map:new(Ir||zr),string:new Yr}},Xr.prototype.delete=function(e){var t=fa(this,e).delete(e);return this.size-=t?1:0,t},Xr.prototype.get=function(e){return fa(this,e).get(e)},Xr.prototype.has=function(e){return fa(this,e).has(e)},Xr.prototype.set=function(e,t){var i=fa(this,e),a=i.size;return i.set(e,t),this.size+=i.size==a?0:1,this},Qr.prototype.add=Qr.prototype.push=function(e){return this.__data__.set(e,u),this},Qr.prototype.has=function(e){return this.__data__.has(e)},$r.prototype.clear=function(){this.__data__=new zr,this.size=0},$r.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},$r.prototype.get=function(e){return this.__data__.get(e)},$r.prototype.has=function(e){return this.__data__.has(e)},$r.prototype.set=function(e,t){var i=this.__data__;if(i instanceof zr){var a=i.__data__;if(!Ir||a.length<199)return a.push([e,t]),this.size=++i.size,this;i=this.__data__=new Xr(a)}return i.set(e,t),this.size=i.size,this};var vn=Ni(Sn),gn=Ni(Rn,!0);function mn(e,t){var i=!0;return vn(e,(function(e,a,s){return i=!!t(e,a,s)})),i}function yn(e,t,i){for(var a=-1,o=e.length;++a<o;){var u=e[a],l=t(u);if(null!=l&&(c===s?l==l&&!co(l):i(l,c)))var c=l,d=u}return d}function En(e,t){var i=[];return vn(e,(function(e,a,s){t(e,a,s)&&i.push(e)})),i}function _n(e,t,i,a,s){var o=-1,u=e.length;for(i||(i=_a),s||(s=[]);++o<u;){var l=e[o];t>0&&i(l)?t>1?_n(l,t-1,i,a,s):Ut(s,l):a||(s[s.length]=l)}return s}var Tn=Fi(),bn=Fi(!0);function Sn(e,t){return e&&Tn(e,t,xo)}function Rn(e,t){return e&&bn(e,t,xo)}function An(e,t){return xt(t,(function(t){return Zs(e[t])}))}function wn(e,t){for(var i=0,a=(t=bi(t,e)).length;null!=e&&i<a;)e=e[Ba(t[i++])];return i&&i==a?e:s}function In(e,t,i){var a=t(e);return Ws(e)?a:Ut(a,i(e))}function Dn(e){return null==e?e===s?"[object Undefined]":"[object Null]":tt&&tt in Le(e)?function(e){var t=Ue.call(e,tt),i=e[tt];try{e[tt]=s;var a=!0}catch(e){}var o=He.call(e);a&&(t?e[tt]=i:delete e[tt]);return o}(e):function(e){return He.call(e)}(e)}function Ln(e,t){return e>t}function kn(e,t){return null!=e&&Ue.call(e,t)}function Cn(e,t){return null!=e&&t in Le(e)}function On(e,t,i){for(var o=i?Nt:Mt,u=e[0].length,l=e.length,c=l,d=a(l),f=1/0,h=[];c--;){var p=e[c];c&&t&&(p=Ft(p,tr(t))),f=Tr(p.length,f),d[c]=!i&&(t||u>=120&&p.length>=120)?new Qr(c&&p):s}p=e[0];var v=-1,g=d[0];e:for(;++v<u&&h.length<f;){var m=p[v],y=t?t(m):m;if(m=i||0!==m?m:0,!(g?nr(g,y):o(h,y,i))){for(c=l;--c;){var E=d[c];if(!(E?nr(E,y):o(e[c],y,i)))continue e}g&&g.push(y),h.push(m)}}return h}function Pn(e,t,i){var a=null==(e=ka(e,t=bi(t,e)))?e:e[Ba(Ja(t))];return null==a?s:Lt(a,e,i)}function xn(e){return no(e)&&Dn(e)==_}function Mn(e,t,i,a,o){return e===t||(null==e||null==t||!no(e)&&!no(t)?e!=e&&t!=t:function(e,t,i,a,o,u){var l=Ws(e),c=Ws(t),d=l?T:ma(e),f=c?T:ma(t),h=(d=d==_?L:d)==L,p=(f=f==_?L:f)==L,v=d==f;if(v&&Qs(e)){if(!Qs(t))return!1;l=!0,h=!1}if(v&&!h)return u||(u=new $r),l||fo(e)?ia(e,t,i,a,o,u):function(e,t,i,a,s,o,u){switch(i){case F:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case N:return!(e.byteLength!=t.byteLength||!o(new Ye(e),new Ye(t)));case b:case S:case D:return Gs(+e,+t);case R:return e.name==t.name&&e.message==t.message;case C:case P:return e==t+"";case I:var l=cr;case O:var c=1&a;if(l||(l=hr),e.size!=t.size&&!c)return!1;var d=u.get(e);if(d)return d==t;a|=2,u.set(e,t);var f=ia(l(e),l(t),a,s,o,u);return u.delete(e),f;case x:if(jr)return jr.call(e)==jr.call(t)}return!1}(e,t,d,i,a,o,u);if(!(1&i)){var g=h&&Ue.call(e,"__wrapped__"),m=p&&Ue.call(t,"__wrapped__");if(g||m){var y=g?e.value():e,E=m?t.value():t;return u||(u=new $r),o(y,E,i,a,u)}}if(!v)return!1;return u||(u=new $r),function(e,t,i,a,o,u){var l=1&i,c=sa(e),d=c.length,f=sa(t),h=f.length;if(d!=h&&!l)return!1;var p=d;for(;p--;){var v=c[p];if(!(l?v in t:Ue.call(t,v)))return!1}var g=u.get(e),m=u.get(t);if(g&&m)return g==t&&m==e;var y=!0;u.set(e,t),u.set(t,e);var E=l;for(;++p<d;){var _=e[v=c[p]],T=t[v];if(a)var b=l?a(T,_,v,t,e,u):a(_,T,v,e,t,u);if(!(b===s?_===T||o(_,T,i,a,u):b)){y=!1;break}E||(E="constructor"==v)}if(y&&!E){var S=e.constructor,R=t.constructor;S==R||!("constructor"in e)||!("constructor"in t)||"function"==typeof S&&S instanceof S&&"function"==typeof R&&R instanceof R||(y=!1)}return u.delete(e),u.delete(t),y}(e,t,i,a,o,u)}(e,t,i,a,Mn,o))}function Nn(e,t,i,a){var o=i.length,u=o,l=!a;if(null==e)return!u;for(e=Le(e);o--;){var c=i[o];if(l&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++o<u;){var d=(c=i[o])[0],f=e[d],h=c[1];if(l&&c[2]){if(f===s&&!(d in e))return!1}else{var p=new $r;if(a)var v=a(f,h,d,e,t,p);if(!(v===s?Mn(h,f,3,a,p):v))return!1}}return!0}function Fn(e){return!(!ro(e)||(t=e,je&&je in t))&&(Zs(e)?Ve:_e).test(ja(e));var t}function Un(e){return"function"==typeof e?e:null==e?su:"object"==typeof e?Ws(e)?Vn(e[0],e[1]):Kn(e):vu(e)}function Bn(e){if(!wa(e))return Qt(e);var t=[];for(var i in Le(e))Ue.call(e,i)&&"constructor"!=i&&t.push(i);return t}function jn(e){if(!ro(e))return function(e){var t=[];if(null!=e)for(var i in Le(e))t.push(i);return t}(e);var t=wa(e),i=[];for(var a in e)("constructor"!=a||!t&&Ue.call(e,a))&&i.push(a);return i}function Hn(e,t){return e<t}function Gn(e,t){var i=-1,s=zs(e)?a(e.length):[];return vn(e,(function(e,a,o){s[++i]=t(e,a,o)})),s}function Kn(e){var t=ha(e);return 1==t.length&&t[0][2]?Da(t[0][0],t[0][1]):function(i){return i===e||Nn(i,e,t)}}function Vn(e,t){return Sa(e)&&Ia(t)?Da(Ba(e),t):function(i){var a=Lo(i,e);return a===s&&a===t?ko(i,e):Mn(t,a,3)}}function qn(e,t,i,a,o){e!==t&&Tn(t,(function(u,l){if(o||(o=new $r),ro(u))!function(e,t,i,a,o,u,l){var c=Ca(e,i),d=Ca(t,i),f=l.get(d);if(f)return void rn(e,i,f);var h=u?u(c,d,i+"",e,t,l):s,p=h===s;if(p){var v=Ws(d),g=!v&&Qs(d),m=!v&&!g&&fo(d);h=d,v||g||m?Ws(c)?h=c:Xs(c)?h=Oi(c):g?(p=!1,h=wi(d,!0)):m?(p=!1,h=Di(d,!0)):h=[]:so(d)||qs(d)?(h=c,qs(c)?h=_o(c):ro(c)&&!Zs(c)||(h=Ea(d))):p=!1}p&&(l.set(d,h),o(h,d,a,u,l),l.delete(d));rn(e,i,h)}(e,t,l,i,qn,a,o);else{var c=a?a(Ca(e,l),u,l+"",e,t,o):s;c===s&&(c=u),rn(e,l,c)}}),Mo)}function Wn(e,t){var i=e.length;if(i)return Ta(t+=t<0?i:0,i)?e[t]:s}function Yn(e,t,i){t=t.length?Ft(t,(function(e){return Ws(e)?function(t){return wn(t,1===e.length?e[0]:e)}:e})):[su];var a=-1;t=Ft(t,tr(da()));var s=Gn(e,(function(e,i,s){var o=Ft(t,(function(t){return t(e)}));return{criteria:o,index:++a,value:e}}));return function(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}(s,(function(e,t){return function(e,t,i){var a=-1,s=e.criteria,o=t.criteria,u=s.length,l=i.length;for(;++a<u;){var c=Li(s[a],o[a]);if(c)return a>=l?c:c*("desc"==i[a]?-1:1)}return e.index-t.index}(e,t,i)}))}function zn(e,t,i){for(var a=-1,s=t.length,o={};++a<s;){var u=t[a],l=wn(e,u);i(l,u)&&ri(o,bi(u,e),l)}return o}function Xn(e,t,i,a){var s=a?Wt:qt,o=-1,u=t.length,l=e;for(e===t&&(t=Oi(t)),i&&(l=Ft(e,tr(i)));++o<u;)for(var c=0,d=t[o],f=i?i(d):d;(c=s(l,f,c,a))>-1;)l!==e&&Je.call(l,c,1),Je.call(e,c,1);return e}function Qn(e,t){for(var i=e?t.length:0,a=i-1;i--;){var s=t[i];if(i==a||s!==o){var o=s;Ta(s)?Je.call(e,s,1):pi(e,s)}}return e}function $n(e,t){return e+yt(Rr()*(t-e+1))}function Jn(e,t){var i="";if(!e||t<1||t>g)return i;do{t%2&&(i+=e),(t=yt(t/2))&&(e+=e)}while(t);return i}function Zn(e,t){return xa(La(e,t,su),e+"")}function ei(e){return Zr(Ko(e))}function ti(e,t){var i=Ko(e);return Fa(i,cn(t,0,i.length))}function ri(e,t,i,a){if(!ro(e))return e;for(var o=-1,u=(t=bi(t,e)).length,l=u-1,c=e;null!=c&&++o<u;){var d=Ba(t[o]),f=i;if("__proto__"===d||"constructor"===d||"prototype"===d)return e;if(o!=l){var h=c[d];(f=a?a(h,d,c):s)===s&&(f=ro(h)?h:Ta(t[o+1])?[]:{})}nn(c,d,f),c=c[d]}return e}var ni=Or?function(e,t){return Or.set(e,t),e}:su,ii=it?function(e,t){return it(e,"toString",{configurable:!0,enumerable:!1,value:nu(t),writable:!0})}:su;function ai(e){return Fa(Ko(e))}function si(e,t,i){var s=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(i=i>o?o:i)<0&&(i+=o),o=t>i?0:i-t>>>0,t>>>=0;for(var u=a(o);++s<o;)u[s]=e[s+t];return u}function oi(e,t){var i;return vn(e,(function(e,a,s){return!(i=t(e,a,s))})),!!i}function ui(e,t,i){var a=0,s=null==e?a:e.length;if("number"==typeof t&&t==t&&s<=2147483647){for(;a<s;){var o=a+s>>>1,u=e[o];null!==u&&!co(u)&&(i?u<=t:u<t)?a=o+1:s=o}return s}return li(e,t,su,i)}function li(e,t,i,a){var o=0,u=null==e?0:e.length;if(0===u)return 0;for(var l=(t=i(t))!=t,c=null===t,d=co(t),f=t===s;o<u;){var h=yt((o+u)/2),p=i(e[h]),v=p!==s,g=null===p,m=p==p,y=co(p);if(l)var E=a||m;else E=f?m&&(a||v):c?m&&v&&(a||!g):d?m&&v&&!g&&(a||!y):!g&&!y&&(a?p<=t:p<t);E?o=h+1:u=h}return Tr(u,4294967294)}function ci(e,t){for(var i=-1,a=e.length,s=0,o=[];++i<a;){var u=e[i],l=t?t(u):u;if(!i||!Gs(l,c)){var c=l;o[s++]=0===u?0:u}}return o}function di(e){return"number"==typeof e?e:co(e)?m:+e}function fi(e){if("string"==typeof e)return e;if(Ws(e))return Ft(e,fi)+"";if(co(e))return Hr?Hr.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function hi(e,t,i){var a=-1,s=Mt,o=e.length,u=!0,l=[],c=l;if(i)u=!1,s=Nt;else if(o>=200){var d=t?null:Ji(e);if(d)return hr(d);u=!1,s=nr,c=new Qr}else c=t?[]:l;e:for(;++a<o;){var f=e[a],h=t?t(f):f;if(f=i||0!==f?f:0,u&&h==h){for(var p=c.length;p--;)if(c[p]===h)continue e;t&&c.push(h),l.push(f)}else s(c,h,i)||(c!==l&&c.push(h),l.push(f))}return l}function pi(e,t){return null==(e=ka(e,t=bi(t,e)))||delete e[Ba(Ja(t))]}function vi(e,t,i,a){return ri(e,t,i(wn(e,t)),a)}function gi(e,t,i,a){for(var s=e.length,o=a?s:-1;(a?o--:++o<s)&&t(e[o],o,e););return i?si(e,a?0:o,a?o+1:s):si(e,a?o+1:0,a?s:o)}function mi(e,t){var i=e;return i instanceof Wr&&(i=i.value()),Bt(t,(function(e,t){return t.func.apply(t.thisArg,Ut([e],t.args))}),i)}function yi(e,t,i){var s=e.length;if(s<2)return s?hi(e[0]):[];for(var o=-1,u=a(s);++o<s;)for(var l=e[o],c=-1;++c<s;)c!=o&&(u[o]=pn(u[o]||l,e[c],t,i));return hi(_n(u,1),t,i)}function Ei(e,t,i){for(var a=-1,o=e.length,u=t.length,l={};++a<o;){var c=a<u?t[a]:s;i(l,e[a],c)}return l}function _i(e){return Xs(e)?e:[]}function Ti(e){return"function"==typeof e?e:su}function bi(e,t){return Ws(e)?e:Sa(e,t)?[e]:Ua(To(e))}var Si=Zn;function Ri(e,t,i){var a=e.length;return i=i===s?a:i,!t&&i>=a?e:si(e,t,i)}var Ai=st||function(e){return mt.clearTimeout(e)};function wi(e,t){if(t)return e.slice();var i=e.length,a=ze?ze(i):new e.constructor(i);return e.copy(a),a}function Ii(e){var t=new e.constructor(e.byteLength);return new Ye(t).set(new Ye(e)),t}function Di(e,t){var i=t?Ii(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function Li(e,t){if(e!==t){var i=e!==s,a=null===e,o=e==e,u=co(e),l=t!==s,c=null===t,d=t==t,f=co(t);if(!c&&!f&&!u&&e>t||u&&l&&d&&!c&&!f||a&&l&&d||!i&&d||!o)return 1;if(!a&&!u&&!f&&e<t||f&&i&&o&&!a&&!u||c&&i&&o||!l&&o||!d)return-1}return 0}function ki(e,t,i,s){for(var o=-1,u=e.length,l=i.length,c=-1,d=t.length,f=_r(u-l,0),h=a(d+f),p=!s;++c<d;)h[c]=t[c];for(;++o<l;)(p||o<u)&&(h[i[o]]=e[o]);for(;f--;)h[c++]=e[o++];return h}function Ci(e,t,i,s){for(var o=-1,u=e.length,l=-1,c=i.length,d=-1,f=t.length,h=_r(u-c,0),p=a(h+f),v=!s;++o<h;)p[o]=e[o];for(var g=o;++d<f;)p[g+d]=t[d];for(;++l<c;)(v||o<u)&&(p[g+i[l]]=e[o++]);return p}function Oi(e,t){var i=-1,s=e.length;for(t||(t=a(s));++i<s;)t[i]=e[i];return t}function Pi(e,t,i,a){var o=!i;i||(i={});for(var u=-1,l=t.length;++u<l;){var c=t[u],d=a?a(i[c],e[c],c,i,e):s;d===s&&(d=e[c]),o?un(i,c,d):nn(i,c,d)}return i}function xi(e,t){return function(i,a){var s=Ws(i)?kt:sn,o=t?t():{};return s(i,e,da(a,2),o)}}function Mi(e){return Zn((function(t,i){var a=-1,o=i.length,u=o>1?i[o-1]:s,l=o>2?i[2]:s;for(u=e.length>3&&"function"==typeof u?(o--,u):s,l&&ba(i[0],i[1],l)&&(u=o<3?s:u,o=1),t=Le(t);++a<o;){var c=i[a];c&&e(t,c,a,u)}return t}))}function Ni(e,t){return function(i,a){if(null==i)return i;if(!zs(i))return e(i,a);for(var s=i.length,o=t?s:-1,u=Le(i);(t?o--:++o<s)&&!1!==a(u[o],o,u););return i}}function Fi(e){return function(t,i,a){for(var s=-1,o=Le(t),u=a(t),l=u.length;l--;){var c=u[e?l:++s];if(!1===i(o[c],c,o))break}return t}}function Ui(e){return function(t){var i=lr(t=To(t))?gr(t):s,a=i?i[0]:t.charAt(0),o=i?Ri(i,1).join(""):t.slice(1);return a[e]()+o}}function Bi(e){return function(t){return Bt(eu(Wo(t).replace(rt,"")),e,"")}}function ji(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=Kr(e.prototype),a=e.apply(i,t);return ro(a)?a:i}}function Hi(e){return function(t,i,a){var o=Le(t);if(!zs(t)){var u=da(i,3);t=xo(t),i=function(e){return u(o[e],e,o)}}var l=e(t,i,a);return l>-1?o[u?t[l]:l]:s}}function Gi(e){return aa((function(t){var i=t.length,a=i,u=qr.prototype.thru;for(e&&t.reverse();a--;){var l=t[a];if("function"!=typeof l)throw new Oe(o);if(u&&!c&&"wrapper"==la(l))var c=new qr([],!0)}for(a=c?a:i;++a<i;){var d=la(l=t[a]),f="wrapper"==d?ua(l):s;c=f&&Ra(f[0])&&424==f[1]&&!f[4].length&&1==f[9]?c[la(f[0])].apply(c,f[3]):1==l.length&&Ra(l)?c[d]():c.thru(l)}return function(){var e=arguments,a=e[0];if(c&&1==e.length&&Ws(a))return c.plant(a).value();for(var s=0,o=i?t[s].apply(this,e):a;++s<i;)o=t[s].call(this,o);return o}}))}function Ki(e,t,i,o,u,l,c,d,f,p){var v=t&h,g=1&t,m=2&t,y=24&t,E=512&t,_=m?s:ji(e);return function h(){for(var T=arguments.length,b=a(T),S=T;S--;)b[S]=arguments[S];if(y)var R=ca(h),A=function(e,t){for(var i=e.length,a=0;i--;)e[i]===t&&++a;return a}(b,R);if(o&&(b=ki(b,o,u,y)),l&&(b=Ci(b,l,c,y)),T-=A,y&&T<p){var w=fr(b,R);return Qi(e,t,Ki,h.placeholder,i,b,w,d,f,p-T)}var I=g?i:this,D=m?I[e]:e;return T=b.length,d?b=function(e,t){var i=e.length,a=Tr(t.length,i),o=Oi(e);for(;a--;){var u=t[a];e[a]=Ta(u,i)?o[u]:s}return e}(b,d):E&&T>1&&b.reverse(),v&&f<T&&(b.length=f),this&&this!==mt&&this instanceof h&&(D=_||ji(D)),D.apply(I,b)}}function Vi(e,t){return function(i,a){return function(e,t,i,a){return Sn(e,(function(e,s,o){t(a,i(e),s,o)})),a}(i,e,t(a),{})}}function qi(e,t){return function(i,a){var o;if(i===s&&a===s)return t;if(i!==s&&(o=i),a!==s){if(o===s)return a;"string"==typeof i||"string"==typeof a?(i=fi(i),a=fi(a)):(i=di(i),a=di(a)),o=e(i,a)}return o}}function Wi(e){return aa((function(t){return t=Ft(t,tr(da())),Zn((function(i){var a=this;return e(t,(function(e){return Lt(e,a,i)}))}))}))}function Yi(e,t){var i=(t=t===s?" ":fi(t)).length;if(i<2)return i?Jn(t,e):t;var a=Jn(t,gt(e/vr(t)));return lr(t)?Ri(gr(a),0,e).join(""):a.slice(0,e)}function zi(e){return function(t,i,o){return o&&"number"!=typeof o&&ba(t,i,o)&&(i=o=s),t=go(t),i===s?(i=t,t=0):i=go(i),function(e,t,i,s){for(var o=-1,u=_r(gt((t-e)/(i||1)),0),l=a(u);u--;)l[s?u:++o]=e,e+=i;return l}(t,i,o=o===s?t<i?1:-1:go(o),e)}}function Xi(e){return function(t,i){return"string"==typeof t&&"string"==typeof i||(t=Eo(t),i=Eo(i)),e(t,i)}}function Qi(e,t,i,a,o,u,l,c,h,p){var v=8&t;t|=v?d:f,4&(t&=~(v?f:d))||(t&=-4);var g=[e,t,o,v?u:s,v?l:s,v?s:u,v?s:l,c,h,p],m=i.apply(s,g);return Ra(e)&&Oa(m,g),m.placeholder=a,Ma(m,e,t)}function $i(e){var t=De[e];return function(e,i){if(e=Eo(e),(i=null==i?0:Tr(mo(i),292))&&bt(e)){var a=(To(e)+"e").split("e");return+((a=(To(t(a[0]+"e"+(+a[1]+i)))+"e").split("e"))[0]+"e"+(+a[1]-i))}return t(e)}}var Ji=Lr&&1/hr(new Lr([,-0]))[1]==v?function(e){return new Lr(e)}:du;function Zi(e){return function(t){var i=ma(t);return i==I?cr(t):i==O?pr(t):function(e,t){return Ft(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function ea(e,t,i,u,v,g,m,y){var E=2&t;if(!E&&"function"!=typeof e)throw new Oe(o);var _=u?u.length:0;if(_||(t&=-97,u=v=s),m=m===s?m:_r(mo(m),0),y=y===s?y:mo(y),_-=v?v.length:0,t&f){var T=u,b=v;u=v=s}var S=E?s:ua(e),R=[e,t,i,u,v,T,b,g,m,y];if(S&&function(e,t){var i=e[1],a=t[1],s=i|a,o=s<131,u=a==h&&8==i||a==h&&i==p&&e[7].length<=t[8]||384==a&&t[7].length<=t[8]&&8==i;if(!o&&!u)return e;1&a&&(e[2]=t[2],s|=1&i?0:4);var c=t[3];if(c){var d=e[3];e[3]=d?ki(d,c,t[4]):c,e[4]=d?fr(e[3],l):t[4]}(c=t[5])&&(d=e[5],e[5]=d?Ci(d,c,t[6]):c,e[6]=d?fr(e[5],l):t[6]);(c=t[7])&&(e[7]=c);a&h&&(e[8]=null==e[8]?t[8]:Tr(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0],e[1]=s}(R,S),e=R[0],t=R[1],i=R[2],u=R[3],v=R[4],!(y=R[9]=R[9]===s?E?0:e.length:_r(R[9]-_,0))&&24&t&&(t&=-25),t&&1!=t)A=8==t||t==c?function(e,t,i){var o=ji(e);return function u(){for(var l=arguments.length,c=a(l),d=l,f=ca(u);d--;)c[d]=arguments[d];var h=l<3&&c[0]!==f&&c[l-1]!==f?[]:fr(c,f);return(l-=h.length)<i?Qi(e,t,Ki,u.placeholder,s,c,h,s,s,i-l):Lt(this&&this!==mt&&this instanceof u?o:e,this,c)}}(e,t,y):t!=d&&33!=t||v.length?Ki.apply(s,R):function(e,t,i,s){var o=1&t,u=ji(e);return function t(){for(var l=-1,c=arguments.length,d=-1,f=s.length,h=a(f+c),p=this&&this!==mt&&this instanceof t?u:e;++d<f;)h[d]=s[d];for(;c--;)h[d++]=arguments[++l];return Lt(p,o?i:this,h)}}(e,t,i,u);else var A=function(e,t,i){var a=1&t,s=ji(e);return function t(){return(this&&this!==mt&&this instanceof t?s:e).apply(a?i:this,arguments)}}(e,t,i);return Ma((S?ni:Oa)(A,R),e,t)}function ta(e,t,i,a){return e===s||Gs(e,Me[i])&&!Ue.call(a,i)?t:e}function ra(e,t,i,a,o,u){return ro(e)&&ro(t)&&(u.set(t,e),qn(e,t,s,ra,u),u.delete(t)),e}function na(e){return so(e)?s:e}function ia(e,t,i,a,o,u){var l=1&i,c=e.length,d=t.length;if(c!=d&&!(l&&d>c))return!1;var f=u.get(e),h=u.get(t);if(f&&h)return f==t&&h==e;var p=-1,v=!0,g=2&i?new Qr:s;for(u.set(e,t),u.set(t,e);++p<c;){var m=e[p],y=t[p];if(a)var E=l?a(y,m,p,t,e,u):a(m,y,p,e,t,u);if(E!==s){if(E)continue;v=!1;break}if(g){if(!Ht(t,(function(e,t){if(!nr(g,t)&&(m===e||o(m,e,i,a,u)))return g.push(t)}))){v=!1;break}}else if(m!==y&&!o(m,y,i,a,u)){v=!1;break}}return u.delete(e),u.delete(t),v}function aa(e){return xa(La(e,s,Ya),e+"")}function sa(e){return In(e,xo,va)}function oa(e){return In(e,Mo,ga)}var ua=Or?function(e){return Or.get(e)}:du;function la(e){for(var t=e.name+"",i=Pr[t],a=Ue.call(Pr,t)?i.length:0;a--;){var s=i[a],o=s.func;if(null==o||o==e)return s.name}return t}function ca(e){return(Ue.call(Gr,"placeholder")?Gr:e).placeholder}function da(){var e=Gr.iteratee||ou;return e=e===ou?Un:e,arguments.length?e(arguments[0],arguments[1]):e}function fa(e,t){var i,a,s=e.__data__;return("string"==(a=typeof(i=t))||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==i:null===i)?s["string"==typeof t?"string":"hash"]:s.map}function ha(e){for(var t=xo(e),i=t.length;i--;){var a=t[i],s=e[a];t[i]=[a,s,Ia(s)]}return t}function pa(e,t){var i=function(e,t){return null==e?s:e[t]}(e,t);return Fn(i)?i:s}var va=Et?function(e){return null==e?[]:(e=Le(e),xt(Et(e),(function(t){return $e.call(e,t)})))}:yu,ga=Et?function(e){for(var t=[];e;)Ut(t,va(e)),e=Xe(e);return t}:yu,ma=Dn;function ya(e,t,i){for(var a=-1,s=(t=bi(t,e)).length,o=!1;++a<s;){var u=Ba(t[a]);if(!(o=null!=e&&i(e,u)))break;e=e[u]}return o||++a!=s?o:!!(s=null==e?0:e.length)&&to(s)&&Ta(u,s)&&(Ws(e)||qs(e))}function Ea(e){return"function"!=typeof e.constructor||wa(e)?{}:Kr(Xe(e))}function _a(e){return Ws(e)||qs(e)||!!(Ze&&e&&e[Ze])}function Ta(e,t){var i=typeof e;return!!(t=null==t?g:t)&&("number"==i||"symbol"!=i&&be.test(e))&&e>-1&&e%1==0&&e<t}function ba(e,t,i){if(!ro(i))return!1;var a=typeof t;return!!("number"==a?zs(i)&&Ta(t,i.length):"string"==a&&t in i)&&Gs(i[t],e)}function Sa(e,t){if(Ws(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!co(e))||(ie.test(e)||!ne.test(e)||null!=t&&e in Le(t))}function Ra(e){var t=la(e),i=Gr[t];if("function"!=typeof i||!(t in Wr.prototype))return!1;if(e===i)return!0;var a=ua(i);return!!a&&e===a[0]}(wr&&ma(new wr(new ArrayBuffer(1)))!=F||Ir&&ma(new Ir)!=I||Dr&&ma(Dr.resolve())!=k||Lr&&ma(new Lr)!=O||kr&&ma(new kr)!=M)&&(ma=function(e){var t=Dn(e),i=t==L?e.constructor:s,a=i?ja(i):"";if(a)switch(a){case xr:return F;case Mr:return I;case Nr:return k;case Fr:return O;case Ur:return M}return t});var Aa=Ne?Zs:Eu;function wa(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Me)}function Ia(e){return e==e&&!ro(e)}function Da(e,t){return function(i){return null!=i&&(i[e]===t&&(t!==s||e in Le(i)))}}function La(e,t,i){return t=_r(t===s?e.length-1:t,0),function(){for(var s=arguments,o=-1,u=_r(s.length-t,0),l=a(u);++o<u;)l[o]=s[t+o];o=-1;for(var c=a(t+1);++o<t;)c[o]=s[o];return c[t]=i(l),Lt(e,this,c)}}function ka(e,t){return t.length<2?e:wn(e,si(t,0,-1))}function Ca(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Oa=Na(ni),Pa=vt||function(e,t){return mt.setTimeout(e,t)},xa=Na(ii);function Ma(e,t,i){var a=t+"";return xa(e,function(e,t){var i=t.length;if(!i)return e;var a=i-1;return t[a]=(i>1?"& ":"")+t[a],t=t.join(i>2?", ":" "),e.replace(ce,"{\n/* [wrapped with "+t+"] */\n")}(a,function(e,t){return Ct(E,(function(i){var a="_."+i[0];t&i[1]&&!Mt(e,a)&&e.push(a)})),e.sort()}(function(e){var t=e.match(de);return t?t[1].split(fe):[]}(a),i)))}function Na(e){var t=0,i=0;return function(){var a=br(),o=16-(a-i);if(i=a,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(s,arguments)}}function Fa(e,t){var i=-1,a=e.length,o=a-1;for(t=t===s?a:t;++i<t;){var u=$n(i,o),l=e[u];e[u]=e[i],e[i]=l}return e.length=t,e}var Ua=function(e){var t=Ns(e,(function(e){return 500===i.size&&i.clear(),e})),i=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ae,(function(e,i,a,s){t.push(a?s.replace(ve,"$1"):i||e)})),t}));function Ba(e){if("string"==typeof e||co(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ja(e){if(null!=e){try{return Fe.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ha(e){if(e instanceof Wr)return e.clone();var t=new qr(e.__wrapped__,e.__chain__);return t.__actions__=Oi(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Ga=Zn((function(e,t){return Xs(e)?pn(e,_n(t,1,Xs,!0)):[]})),Ka=Zn((function(e,t){var i=Ja(t);return Xs(i)&&(i=s),Xs(e)?pn(e,_n(t,1,Xs,!0),da(i,2)):[]})),Va=Zn((function(e,t){var i=Ja(t);return Xs(i)&&(i=s),Xs(e)?pn(e,_n(t,1,Xs,!0),s,i):[]}));function qa(e,t,i){var a=null==e?0:e.length;if(!a)return-1;var s=null==i?0:mo(i);return s<0&&(s=_r(a+s,0)),Vt(e,da(t,3),s)}function Wa(e,t,i){var a=null==e?0:e.length;if(!a)return-1;var o=a-1;return i!==s&&(o=mo(i),o=i<0?_r(a+o,0):Tr(o,a-1)),Vt(e,da(t,3),o,!0)}function Ya(e){return(null==e?0:e.length)?_n(e,1):[]}function za(e){return e&&e.length?e[0]:s}var Xa=Zn((function(e){var t=Ft(e,_i);return t.length&&t[0]===e[0]?On(t):[]})),Qa=Zn((function(e){var t=Ja(e),i=Ft(e,_i);return t===Ja(i)?t=s:i.pop(),i.length&&i[0]===e[0]?On(i,da(t,2)):[]})),$a=Zn((function(e){var t=Ja(e),i=Ft(e,_i);return(t="function"==typeof t?t:s)&&i.pop(),i.length&&i[0]===e[0]?On(i,s,t):[]}));function Ja(e){var t=null==e?0:e.length;return t?e[t-1]:s}var Za=Zn(es);function es(e,t){return e&&e.length&&t&&t.length?Xn(e,t):e}var ts=aa((function(e,t){var i=null==e?0:e.length,a=ln(e,t);return Qn(e,Ft(t,(function(e){return Ta(e,i)?+e:e})).sort(Li)),a}));function rs(e){return null==e?e:Ar.call(e)}var ns=Zn((function(e){return hi(_n(e,1,Xs,!0))})),is=Zn((function(e){var t=Ja(e);return Xs(t)&&(t=s),hi(_n(e,1,Xs,!0),da(t,2))})),as=Zn((function(e){var t=Ja(e);return t="function"==typeof t?t:s,hi(_n(e,1,Xs,!0),s,t)}));function ss(e){if(!e||!e.length)return[];var t=0;return e=xt(e,(function(e){if(Xs(e))return t=_r(e.length,t),!0})),Zt(t,(function(t){return Ft(e,Xt(t))}))}function os(e,t){if(!e||!e.length)return[];var i=ss(e);return null==t?i:Ft(i,(function(e){return Lt(t,s,e)}))}var us=Zn((function(e,t){return Xs(e)?pn(e,t):[]})),ls=Zn((function(e){return yi(xt(e,Xs))})),cs=Zn((function(e){var t=Ja(e);return Xs(t)&&(t=s),yi(xt(e,Xs),da(t,2))})),ds=Zn((function(e){var t=Ja(e);return t="function"==typeof t?t:s,yi(xt(e,Xs),s,t)})),fs=Zn(ss);var hs=Zn((function(e){var t=e.length,i=t>1?e[t-1]:s;return i="function"==typeof i?(e.pop(),i):s,os(e,i)}));function ps(e){var t=Gr(e);return t.__chain__=!0,t}function vs(e,t){return t(e)}var gs=aa((function(e){var t=e.length,i=t?e[0]:0,a=this.__wrapped__,o=function(t){return ln(t,e)};return!(t>1||this.__actions__.length)&&a instanceof Wr&&Ta(i)?((a=a.slice(i,+i+(t?1:0))).__actions__.push({func:vs,args:[o],thisArg:s}),new qr(a,this.__chain__).thru((function(e){return t&&!e.length&&e.push(s),e}))):this.thru(o)}));var ms=xi((function(e,t,i){Ue.call(e,i)?++e[i]:un(e,i,1)}));var ys=Hi(qa),Es=Hi(Wa);function _s(e,t){return(Ws(e)?Ct:vn)(e,da(t,3))}function Ts(e,t){return(Ws(e)?Ot:gn)(e,da(t,3))}var bs=xi((function(e,t,i){Ue.call(e,i)?e[i].push(t):un(e,i,[t])}));var Ss=Zn((function(e,t,i){var s=-1,o="function"==typeof t,u=zs(e)?a(e.length):[];return vn(e,(function(e){u[++s]=o?Lt(t,e,i):Pn(e,t,i)})),u})),Rs=xi((function(e,t,i){un(e,i,t)}));function As(e,t){return(Ws(e)?Ft:Gn)(e,da(t,3))}var ws=xi((function(e,t,i){e[i?0:1].push(t)}),(function(){return[[],[]]}));var Is=Zn((function(e,t){if(null==e)return[];var i=t.length;return i>1&&ba(e,t[0],t[1])?t=[]:i>2&&ba(t[0],t[1],t[2])&&(t=[t[0]]),Yn(e,_n(t,1),[])})),Ds=ft||function(){return mt.Date.now()};function Ls(e,t,i){return t=i?s:t,t=e&&null==t?e.length:t,ea(e,h,s,s,s,s,t)}function ks(e,t){var i;if("function"!=typeof t)throw new Oe(o);return e=mo(e),function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=s),i}}var Cs=Zn((function(e,t,i){var a=1;if(i.length){var s=fr(i,ca(Cs));a|=d}return ea(e,a,t,i,s)})),Os=Zn((function(e,t,i){var a=3;if(i.length){var s=fr(i,ca(Os));a|=d}return ea(t,a,e,i,s)}));function Ps(e,t,i){var a,u,l,c,d,f,h=0,p=!1,v=!1,g=!0;if("function"!=typeof e)throw new Oe(o);function m(t){var i=a,o=u;return a=u=s,h=t,c=e.apply(o,i)}function y(e){var i=e-f;return f===s||i>=t||i<0||v&&e-h>=l}function E(){var e=Ds();if(y(e))return _(e);d=Pa(E,function(e){var i=t-(e-f);return v?Tr(i,l-(e-h)):i}(e))}function _(e){return d=s,g&&a?m(e):(a=u=s,c)}function T(){var e=Ds(),i=y(e);if(a=arguments,u=this,f=e,i){if(d===s)return function(e){return h=e,d=Pa(E,t),p?m(e):c}(f);if(v)return Ai(d),d=Pa(E,t),m(f)}return d===s&&(d=Pa(E,t)),c}return t=Eo(t)||0,ro(i)&&(p=!!i.leading,l=(v="maxWait"in i)?_r(Eo(i.maxWait)||0,t):l,g="trailing"in i?!!i.trailing:g),T.cancel=function(){d!==s&&Ai(d),h=0,a=f=u=d=s},T.flush=function(){return d===s?c:_(Ds())},T}var xs=Zn((function(e,t){return hn(e,1,t)})),Ms=Zn((function(e,t,i){return hn(e,Eo(t)||0,i)}));function Ns(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Oe(o);var i=function(){var a=arguments,s=t?t.apply(this,a):a[0],o=i.cache;if(o.has(s))return o.get(s);var u=e.apply(this,a);return i.cache=o.set(s,u)||o,u};return i.cache=new(Ns.Cache||Xr),i}function Fs(e){if("function"!=typeof e)throw new Oe(o);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Ns.Cache=Xr;var Us=Si((function(e,t){var i=(t=1==t.length&&Ws(t[0])?Ft(t[0],tr(da())):Ft(_n(t,1),tr(da()))).length;return Zn((function(a){for(var s=-1,o=Tr(a.length,i);++s<o;)a[s]=t[s].call(this,a[s]);return Lt(e,this,a)}))})),Bs=Zn((function(e,t){var i=fr(t,ca(Bs));return ea(e,d,s,t,i)})),js=Zn((function(e,t){var i=fr(t,ca(js));return ea(e,f,s,t,i)})),Hs=aa((function(e,t){return ea(e,p,s,s,s,t)}));function Gs(e,t){return e===t||e!=e&&t!=t}var Ks=Xi(Ln),Vs=Xi((function(e,t){return e>=t})),qs=xn(function(){return arguments}())?xn:function(e){return no(e)&&Ue.call(e,"callee")&&!$e.call(e,"callee")},Ws=a.isArray,Ys=St?tr(St):function(e){return no(e)&&Dn(e)==N};function zs(e){return null!=e&&to(e.length)&&!Zs(e)}function Xs(e){return no(e)&&zs(e)}var Qs=Tt||Eu,$s=Rt?tr(Rt):function(e){return no(e)&&Dn(e)==S};function Js(e){if(!no(e))return!1;var t=Dn(e);return t==R||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!so(e)}function Zs(e){if(!ro(e))return!1;var t=Dn(e);return t==A||t==w||"[object AsyncFunction]"==t||"[object Proxy]"==t}function eo(e){return"number"==typeof e&&e==mo(e)}function to(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=g}function ro(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function no(e){return null!=e&&"object"==typeof e}var io=At?tr(At):function(e){return no(e)&&ma(e)==I};function ao(e){return"number"==typeof e||no(e)&&Dn(e)==D}function so(e){if(!no(e)||Dn(e)!=L)return!1;var t=Xe(e);if(null===t)return!0;var i=Ue.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&Fe.call(i)==Ge}var oo=wt?tr(wt):function(e){return no(e)&&Dn(e)==C};var uo=It?tr(It):function(e){return no(e)&&ma(e)==O};function lo(e){return"string"==typeof e||!Ws(e)&&no(e)&&Dn(e)==P}function co(e){return"symbol"==typeof e||no(e)&&Dn(e)==x}var fo=Dt?tr(Dt):function(e){return no(e)&&to(e.length)&&!!ct[Dn(e)]};var ho=Xi(Hn),po=Xi((function(e,t){return e<=t}));function vo(e){if(!e)return[];if(zs(e))return lo(e)?gr(e):Oi(e);if(et&&e[et])return function(e){for(var t,i=[];!(t=e.next()).done;)i.push(t.value);return i}(e[et]());var t=ma(e);return(t==I?cr:t==O?hr:Ko)(e)}function go(e){return e?(e=Eo(e))===v||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function mo(e){var t=go(e),i=t%1;return t==t?i?t-i:t:0}function yo(e){return e?cn(mo(e),0,y):0}function Eo(e){if("number"==typeof e)return e;if(co(e))return m;if(ro(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ro(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=er(e);var i=Ee.test(e);return i||Te.test(e)?pt(e.slice(2),i?2:8):ye.test(e)?m:+e}function _o(e){return Pi(e,Mo(e))}function To(e){return null==e?"":fi(e)}var bo=Mi((function(e,t){if(wa(t)||zs(t))Pi(t,xo(t),e);else for(var i in t)Ue.call(t,i)&&nn(e,i,t[i])})),So=Mi((function(e,t){Pi(t,Mo(t),e)})),Ro=Mi((function(e,t,i,a){Pi(t,Mo(t),e,a)})),Ao=Mi((function(e,t,i,a){Pi(t,xo(t),e,a)})),wo=aa(ln);var Io=Zn((function(e,t){e=Le(e);var i=-1,a=t.length,o=a>2?t[2]:s;for(o&&ba(t[0],t[1],o)&&(a=1);++i<a;)for(var u=t[i],l=Mo(u),c=-1,d=l.length;++c<d;){var f=l[c],h=e[f];(h===s||Gs(h,Me[f])&&!Ue.call(e,f))&&(e[f]=u[f])}return e})),Do=Zn((function(e){return e.push(s,ra),Lt(Fo,s,e)}));function Lo(e,t,i){var a=null==e?s:wn(e,t);return a===s?i:a}function ko(e,t){return null!=e&&ya(e,t,Cn)}var Co=Vi((function(e,t,i){null!=t&&"function"!=typeof t.toString&&(t=He.call(t)),e[t]=i}),nu(su)),Oo=Vi((function(e,t,i){null!=t&&"function"!=typeof t.toString&&(t=He.call(t)),Ue.call(e,t)?e[t].push(i):e[t]=[i]}),da),Po=Zn(Pn);function xo(e){return zs(e)?Jr(e):Bn(e)}function Mo(e){return zs(e)?Jr(e,!0):jn(e)}var No=Mi((function(e,t,i){qn(e,t,i)})),Fo=Mi((function(e,t,i,a){qn(e,t,i,a)})),Uo=aa((function(e,t){var i={};if(null==e)return i;var a=!1;t=Ft(t,(function(t){return t=bi(t,e),a||(a=t.length>1),t})),Pi(e,oa(e),i),a&&(i=dn(i,7,na));for(var s=t.length;s--;)pi(i,t[s]);return i}));var Bo=aa((function(e,t){return null==e?{}:function(e,t){return zn(e,t,(function(t,i){return ko(e,i)}))}(e,t)}));function jo(e,t){if(null==e)return{};var i=Ft(oa(e),(function(e){return[e]}));return t=da(t),zn(e,i,(function(e,i){return t(e,i[0])}))}var Ho=Zi(xo),Go=Zi(Mo);function Ko(e){return null==e?[]:rr(e,xo(e))}var Vo=Bi((function(e,t,i){return t=t.toLowerCase(),e+(i?qo(t):t)}));function qo(e){return Zo(To(e).toLowerCase())}function Wo(e){return(e=To(e))&&e.replace(Se,sr).replace(nt,"")}var Yo=Bi((function(e,t,i){return e+(i?"-":"")+t.toLowerCase()})),zo=Bi((function(e,t,i){return e+(i?" ":"")+t.toLowerCase()})),Xo=Ui("toLowerCase");var Qo=Bi((function(e,t,i){return e+(i?"_":"")+t.toLowerCase()}));var $o=Bi((function(e,t,i){return e+(i?" ":"")+Zo(t)}));var Jo=Bi((function(e,t,i){return e+(i?" ":"")+t.toUpperCase()})),Zo=Ui("toUpperCase");function eu(e,t,i){return e=To(e),(t=i?s:t)===s?function(e){return ot.test(e)}(e)?function(e){return e.match(at)||[]}(e):function(e){return e.match(he)||[]}(e):e.match(t)||[]}var tu=Zn((function(e,t){try{return Lt(e,s,t)}catch(e){return Js(e)?e:new we(e)}})),ru=aa((function(e,t){return Ct(t,(function(t){t=Ba(t),un(e,t,Cs(e[t],e))})),e}));function nu(e){return function(){return e}}var iu=Gi(),au=Gi(!0);function su(e){return e}function ou(e){return Un("function"==typeof e?e:dn(e,1))}var uu=Zn((function(e,t){return function(i){return Pn(i,e,t)}})),lu=Zn((function(e,t){return function(i){return Pn(e,i,t)}}));function cu(e,t,i){var a=xo(t),s=An(t,a);null!=i||ro(t)&&(s.length||!a.length)||(i=t,t=e,e=this,s=An(t,xo(t)));var o=!(ro(i)&&"chain"in i&&!i.chain),u=Zs(e);return Ct(s,(function(i){var a=t[i];e[i]=a,u&&(e.prototype[i]=function(){var t=this.__chain__;if(o||t){var i=e(this.__wrapped__);return(i.__actions__=Oi(this.__actions__)).push({func:a,args:arguments,thisArg:e}),i.__chain__=t,i}return a.apply(e,Ut([this.value()],arguments))})})),e}function du(){}var fu=Wi(Ft),hu=Wi(Pt),pu=Wi(Ht);function vu(e){return Sa(e)?Xt(Ba(e)):function(e){return function(t){return wn(t,e)}}(e)}var gu=zi(),mu=zi(!0);function yu(){return[]}function Eu(){return!1}var _u=qi((function(e,t){return e+t}),0),Tu=$i("ceil"),bu=qi((function(e,t){return e/t}),1),Su=$i("floor");var Ru,Au=qi((function(e,t){return e*t}),1),wu=$i("round"),Iu=qi((function(e,t){return e-t}),0);return Gr.after=function(e,t){if("function"!=typeof t)throw new Oe(o);return e=mo(e),function(){if(--e<1)return t.apply(this,arguments)}},Gr.ary=Ls,Gr.assign=bo,Gr.assignIn=So,Gr.assignInWith=Ro,Gr.assignWith=Ao,Gr.at=wo,Gr.before=ks,Gr.bind=Cs,Gr.bindAll=ru,Gr.bindKey=Os,Gr.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Ws(e)?e:[e]},Gr.chain=ps,Gr.chunk=function(e,t,i){t=(i?ba(e,t,i):t===s)?1:_r(mo(t),0);var o=null==e?0:e.length;if(!o||t<1)return[];for(var u=0,l=0,c=a(gt(o/t));u<o;)c[l++]=si(e,u,u+=t);return c},Gr.compact=function(e){for(var t=-1,i=null==e?0:e.length,a=0,s=[];++t<i;){var o=e[t];o&&(s[a++]=o)}return s},Gr.concat=function(){var e=arguments.length;if(!e)return[];for(var t=a(e-1),i=arguments[0],s=e;s--;)t[s-1]=arguments[s];return Ut(Ws(i)?Oi(i):[i],_n(t,1))},Gr.cond=function(e){var t=null==e?0:e.length,i=da();return e=t?Ft(e,(function(e){if("function"!=typeof e[1])throw new Oe(o);return[i(e[0]),e[1]]})):[],Zn((function(i){for(var a=-1;++a<t;){var s=e[a];if(Lt(s[0],this,i))return Lt(s[1],this,i)}}))},Gr.conforms=function(e){return function(e){var t=xo(e);return function(i){return fn(i,e,t)}}(dn(e,1))},Gr.constant=nu,Gr.countBy=ms,Gr.create=function(e,t){var i=Kr(e);return null==t?i:on(i,t)},Gr.curry=function e(t,i,a){var o=ea(t,8,s,s,s,s,s,i=a?s:i);return o.placeholder=e.placeholder,o},Gr.curryRight=function e(t,i,a){var o=ea(t,c,s,s,s,s,s,i=a?s:i);return o.placeholder=e.placeholder,o},Gr.debounce=Ps,Gr.defaults=Io,Gr.defaultsDeep=Do,Gr.defer=xs,Gr.delay=Ms,Gr.difference=Ga,Gr.differenceBy=Ka,Gr.differenceWith=Va,Gr.drop=function(e,t,i){var a=null==e?0:e.length;return a?si(e,(t=i||t===s?1:mo(t))<0?0:t,a):[]},Gr.dropRight=function(e,t,i){var a=null==e?0:e.length;return a?si(e,0,(t=a-(t=i||t===s?1:mo(t)))<0?0:t):[]},Gr.dropRightWhile=function(e,t){return e&&e.length?gi(e,da(t,3),!0,!0):[]},Gr.dropWhile=function(e,t){return e&&e.length?gi(e,da(t,3),!0):[]},Gr.fill=function(e,t,i,a){var o=null==e?0:e.length;return o?(i&&"number"!=typeof i&&ba(e,t,i)&&(i=0,a=o),function(e,t,i,a){var o=e.length;for((i=mo(i))<0&&(i=-i>o?0:o+i),(a=a===s||a>o?o:mo(a))<0&&(a+=o),a=i>a?0:yo(a);i<a;)e[i++]=t;return e}(e,t,i,a)):[]},Gr.filter=function(e,t){return(Ws(e)?xt:En)(e,da(t,3))},Gr.flatMap=function(e,t){return _n(As(e,t),1)},Gr.flatMapDeep=function(e,t){return _n(As(e,t),v)},Gr.flatMapDepth=function(e,t,i){return i=i===s?1:mo(i),_n(As(e,t),i)},Gr.flatten=Ya,Gr.flattenDeep=function(e){return(null==e?0:e.length)?_n(e,v):[]},Gr.flattenDepth=function(e,t){return(null==e?0:e.length)?_n(e,t=t===s?1:mo(t)):[]},Gr.flip=function(e){return ea(e,512)},Gr.flow=iu,Gr.flowRight=au,Gr.fromPairs=function(e){for(var t=-1,i=null==e?0:e.length,a={};++t<i;){var s=e[t];a[s[0]]=s[1]}return a},Gr.functions=function(e){return null==e?[]:An(e,xo(e))},Gr.functionsIn=function(e){return null==e?[]:An(e,Mo(e))},Gr.groupBy=bs,Gr.initial=function(e){return(null==e?0:e.length)?si(e,0,-1):[]},Gr.intersection=Xa,Gr.intersectionBy=Qa,Gr.intersectionWith=$a,Gr.invert=Co,Gr.invertBy=Oo,Gr.invokeMap=Ss,Gr.iteratee=ou,Gr.keyBy=Rs,Gr.keys=xo,Gr.keysIn=Mo,Gr.map=As,Gr.mapKeys=function(e,t){var i={};return t=da(t,3),Sn(e,(function(e,a,s){un(i,t(e,a,s),e)})),i},Gr.mapValues=function(e,t){var i={};return t=da(t,3),Sn(e,(function(e,a,s){un(i,a,t(e,a,s))})),i},Gr.matches=function(e){return Kn(dn(e,1))},Gr.matchesProperty=function(e,t){return Vn(e,dn(t,1))},Gr.memoize=Ns,Gr.merge=No,Gr.mergeWith=Fo,Gr.method=uu,Gr.methodOf=lu,Gr.mixin=cu,Gr.negate=Fs,Gr.nthArg=function(e){return e=mo(e),Zn((function(t){return Wn(t,e)}))},Gr.omit=Uo,Gr.omitBy=function(e,t){return jo(e,Fs(da(t)))},Gr.once=function(e){return ks(2,e)},Gr.orderBy=function(e,t,i,a){return null==e?[]:(Ws(t)||(t=null==t?[]:[t]),Ws(i=a?s:i)||(i=null==i?[]:[i]),Yn(e,t,i))},Gr.over=fu,Gr.overArgs=Us,Gr.overEvery=hu,Gr.overSome=pu,Gr.partial=Bs,Gr.partialRight=js,Gr.partition=ws,Gr.pick=Bo,Gr.pickBy=jo,Gr.property=vu,Gr.propertyOf=function(e){return function(t){return null==e?s:wn(e,t)}},Gr.pull=Za,Gr.pullAll=es,Gr.pullAllBy=function(e,t,i){return e&&e.length&&t&&t.length?Xn(e,t,da(i,2)):e},Gr.pullAllWith=function(e,t,i){return e&&e.length&&t&&t.length?Xn(e,t,s,i):e},Gr.pullAt=ts,Gr.range=gu,Gr.rangeRight=mu,Gr.rearg=Hs,Gr.reject=function(e,t){return(Ws(e)?xt:En)(e,Fs(da(t,3)))},Gr.remove=function(e,t){var i=[];if(!e||!e.length)return i;var a=-1,s=[],o=e.length;for(t=da(t,3);++a<o;){var u=e[a];t(u,a,e)&&(i.push(u),s.push(a))}return Qn(e,s),i},Gr.rest=function(e,t){if("function"!=typeof e)throw new Oe(o);return Zn(e,t=t===s?t:mo(t))},Gr.reverse=rs,Gr.sampleSize=function(e,t,i){return t=(i?ba(e,t,i):t===s)?1:mo(t),(Ws(e)?en:ti)(e,t)},Gr.set=function(e,t,i){return null==e?e:ri(e,t,i)},Gr.setWith=function(e,t,i,a){return a="function"==typeof a?a:s,null==e?e:ri(e,t,i,a)},Gr.shuffle=function(e){return(Ws(e)?tn:ai)(e)},Gr.slice=function(e,t,i){var a=null==e?0:e.length;return a?(i&&"number"!=typeof i&&ba(e,t,i)?(t=0,i=a):(t=null==t?0:mo(t),i=i===s?a:mo(i)),si(e,t,i)):[]},Gr.sortBy=Is,Gr.sortedUniq=function(e){return e&&e.length?ci(e):[]},Gr.sortedUniqBy=function(e,t){return e&&e.length?ci(e,da(t,2)):[]},Gr.split=function(e,t,i){return i&&"number"!=typeof i&&ba(e,t,i)&&(t=i=s),(i=i===s?y:i>>>0)?(e=To(e))&&("string"==typeof t||null!=t&&!oo(t))&&!(t=fi(t))&&lr(e)?Ri(gr(e),0,i):e.split(t,i):[]},Gr.spread=function(e,t){if("function"!=typeof e)throw new Oe(o);return t=null==t?0:_r(mo(t),0),Zn((function(i){var a=i[t],s=Ri(i,0,t);return a&&Ut(s,a),Lt(e,this,s)}))},Gr.tail=function(e){var t=null==e?0:e.length;return t?si(e,1,t):[]},Gr.take=function(e,t,i){return e&&e.length?si(e,0,(t=i||t===s?1:mo(t))<0?0:t):[]},Gr.takeRight=function(e,t,i){var a=null==e?0:e.length;return a?si(e,(t=a-(t=i||t===s?1:mo(t)))<0?0:t,a):[]},Gr.takeRightWhile=function(e,t){return e&&e.length?gi(e,da(t,3),!1,!0):[]},Gr.takeWhile=function(e,t){return e&&e.length?gi(e,da(t,3)):[]},Gr.tap=function(e,t){return t(e),e},Gr.throttle=function(e,t,i){var a=!0,s=!0;if("function"!=typeof e)throw new Oe(o);return ro(i)&&(a="leading"in i?!!i.leading:a,s="trailing"in i?!!i.trailing:s),Ps(e,t,{leading:a,maxWait:t,trailing:s})},Gr.thru=vs,Gr.toArray=vo,Gr.toPairs=Ho,Gr.toPairsIn=Go,Gr.toPath=function(e){return Ws(e)?Ft(e,Ba):co(e)?[e]:Oi(Ua(To(e)))},Gr.toPlainObject=_o,Gr.transform=function(e,t,i){var a=Ws(e),s=a||Qs(e)||fo(e);if(t=da(t,4),null==i){var o=e&&e.constructor;i=s?a?new o:[]:ro(e)&&Zs(o)?Kr(Xe(e)):{}}return(s?Ct:Sn)(e,(function(e,a,s){return t(i,e,a,s)})),i},Gr.unary=function(e){return Ls(e,1)},Gr.union=ns,Gr.unionBy=is,Gr.unionWith=as,Gr.uniq=function(e){return e&&e.length?hi(e):[]},Gr.uniqBy=function(e,t){return e&&e.length?hi(e,da(t,2)):[]},Gr.uniqWith=function(e,t){return t="function"==typeof t?t:s,e&&e.length?hi(e,s,t):[]},Gr.unset=function(e,t){return null==e||pi(e,t)},Gr.unzip=ss,Gr.unzipWith=os,Gr.update=function(e,t,i){return null==e?e:vi(e,t,Ti(i))},Gr.updateWith=function(e,t,i,a){return a="function"==typeof a?a:s,null==e?e:vi(e,t,Ti(i),a)},Gr.values=Ko,Gr.valuesIn=function(e){return null==e?[]:rr(e,Mo(e))},Gr.without=us,Gr.words=eu,Gr.wrap=function(e,t){return Bs(Ti(t),e)},Gr.xor=ls,Gr.xorBy=cs,Gr.xorWith=ds,Gr.zip=fs,Gr.zipObject=function(e,t){return Ei(e||[],t||[],nn)},Gr.zipObjectDeep=function(e,t){return Ei(e||[],t||[],ri)},Gr.zipWith=hs,Gr.entries=Ho,Gr.entriesIn=Go,Gr.extend=So,Gr.extendWith=Ro,cu(Gr,Gr),Gr.add=_u,Gr.attempt=tu,Gr.camelCase=Vo,Gr.capitalize=qo,Gr.ceil=Tu,Gr.clamp=function(e,t,i){return i===s&&(i=t,t=s),i!==s&&(i=(i=Eo(i))==i?i:0),t!==s&&(t=(t=Eo(t))==t?t:0),cn(Eo(e),t,i)},Gr.clone=function(e){return dn(e,4)},Gr.cloneDeep=function(e){return dn(e,5)},Gr.cloneDeepWith=function(e,t){return dn(e,5,t="function"==typeof t?t:s)},Gr.cloneWith=function(e,t){return dn(e,4,t="function"==typeof t?t:s)},Gr.conformsTo=function(e,t){return null==t||fn(e,t,xo(t))},Gr.deburr=Wo,Gr.defaultTo=function(e,t){return null==e||e!=e?t:e},Gr.divide=bu,Gr.endsWith=function(e,t,i){e=To(e),t=fi(t);var a=e.length,o=i=i===s?a:cn(mo(i),0,a);return(i-=t.length)>=0&&e.slice(i,o)==t},Gr.eq=Gs,Gr.escape=function(e){return(e=To(e))&&Z.test(e)?e.replace($,or):e},Gr.escapeRegExp=function(e){return(e=To(e))&&oe.test(e)?e.replace(se,"\\$&"):e},Gr.every=function(e,t,i){var a=Ws(e)?Pt:mn;return i&&ba(e,t,i)&&(t=s),a(e,da(t,3))},Gr.find=ys,Gr.findIndex=qa,Gr.findKey=function(e,t){return Kt(e,da(t,3),Sn)},Gr.findLast=Es,Gr.findLastIndex=Wa,Gr.findLastKey=function(e,t){return Kt(e,da(t,3),Rn)},Gr.floor=Su,Gr.forEach=_s,Gr.forEachRight=Ts,Gr.forIn=function(e,t){return null==e?e:Tn(e,da(t,3),Mo)},Gr.forInRight=function(e,t){return null==e?e:bn(e,da(t,3),Mo)},Gr.forOwn=function(e,t){return e&&Sn(e,da(t,3))},Gr.forOwnRight=function(e,t){return e&&Rn(e,da(t,3))},Gr.get=Lo,Gr.gt=Ks,Gr.gte=Vs,Gr.has=function(e,t){return null!=e&&ya(e,t,kn)},Gr.hasIn=ko,Gr.head=za,Gr.identity=su,Gr.includes=function(e,t,i,a){e=zs(e)?e:Ko(e),i=i&&!a?mo(i):0;var s=e.length;return i<0&&(i=_r(s+i,0)),lo(e)?i<=s&&e.indexOf(t,i)>-1:!!s&&qt(e,t,i)>-1},Gr.indexOf=function(e,t,i){var a=null==e?0:e.length;if(!a)return-1;var s=null==i?0:mo(i);return s<0&&(s=_r(a+s,0)),qt(e,t,s)},Gr.inRange=function(e,t,i){return t=go(t),i===s?(i=t,t=0):i=go(i),function(e,t,i){return e>=Tr(t,i)&&e<_r(t,i)}(e=Eo(e),t,i)},Gr.invoke=Po,Gr.isArguments=qs,Gr.isArray=Ws,Gr.isArrayBuffer=Ys,Gr.isArrayLike=zs,Gr.isArrayLikeObject=Xs,Gr.isBoolean=function(e){return!0===e||!1===e||no(e)&&Dn(e)==b},Gr.isBuffer=Qs,Gr.isDate=$s,Gr.isElement=function(e){return no(e)&&1===e.nodeType&&!so(e)},Gr.isEmpty=function(e){if(null==e)return!0;if(zs(e)&&(Ws(e)||"string"==typeof e||"function"==typeof e.splice||Qs(e)||fo(e)||qs(e)))return!e.length;var t=ma(e);if(t==I||t==O)return!e.size;if(wa(e))return!Bn(e).length;for(var i in e)if(Ue.call(e,i))return!1;return!0},Gr.isEqual=function(e,t){return Mn(e,t)},Gr.isEqualWith=function(e,t,i){var a=(i="function"==typeof i?i:s)?i(e,t):s;return a===s?Mn(e,t,s,i):!!a},Gr.isError=Js,Gr.isFinite=function(e){return"number"==typeof e&&bt(e)},Gr.isFunction=Zs,Gr.isInteger=eo,Gr.isLength=to,Gr.isMap=io,Gr.isMatch=function(e,t){return e===t||Nn(e,t,ha(t))},Gr.isMatchWith=function(e,t,i){return i="function"==typeof i?i:s,Nn(e,t,ha(t),i)},Gr.isNaN=function(e){return ao(e)&&e!=+e},Gr.isNative=function(e){if(Aa(e))throw new we("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Fn(e)},Gr.isNil=function(e){return null==e},Gr.isNull=function(e){return null===e},Gr.isNumber=ao,Gr.isObject=ro,Gr.isObjectLike=no,Gr.isPlainObject=so,Gr.isRegExp=oo,Gr.isSafeInteger=function(e){return eo(e)&&e>=-9007199254740991&&e<=g},Gr.isSet=uo,Gr.isString=lo,Gr.isSymbol=co,Gr.isTypedArray=fo,Gr.isUndefined=function(e){return e===s},Gr.isWeakMap=function(e){return no(e)&&ma(e)==M},Gr.isWeakSet=function(e){return no(e)&&"[object WeakSet]"==Dn(e)},Gr.join=function(e,t){return null==e?"":Gt.call(e,t)},Gr.kebabCase=Yo,Gr.last=Ja,Gr.lastIndexOf=function(e,t,i){var a=null==e?0:e.length;if(!a)return-1;var o=a;return i!==s&&(o=(o=mo(i))<0?_r(a+o,0):Tr(o,a-1)),t==t?function(e,t,i){for(var a=i+1;a--;)if(e[a]===t)return a;return a}(e,t,o):Vt(e,Yt,o,!0)},Gr.lowerCase=zo,Gr.lowerFirst=Xo,Gr.lt=ho,Gr.lte=po,Gr.max=function(e){return e&&e.length?yn(e,su,Ln):s},Gr.maxBy=function(e,t){return e&&e.length?yn(e,da(t,2),Ln):s},Gr.mean=function(e){return zt(e,su)},Gr.meanBy=function(e,t){return zt(e,da(t,2))},Gr.min=function(e){return e&&e.length?yn(e,su,Hn):s},Gr.minBy=function(e,t){return e&&e.length?yn(e,da(t,2),Hn):s},Gr.stubArray=yu,Gr.stubFalse=Eu,Gr.stubObject=function(){return{}},Gr.stubString=function(){return""},Gr.stubTrue=function(){return!0},Gr.multiply=Au,Gr.nth=function(e,t){return e&&e.length?Wn(e,mo(t)):s},Gr.noConflict=function(){return mt._===this&&(mt._=Ke),this},Gr.noop=du,Gr.now=Ds,Gr.pad=function(e,t,i){e=To(e);var a=(t=mo(t))?vr(e):0;if(!t||a>=t)return e;var s=(t-a)/2;return Yi(yt(s),i)+e+Yi(gt(s),i)},Gr.padEnd=function(e,t,i){e=To(e);var a=(t=mo(t))?vr(e):0;return t&&a<t?e+Yi(t-a,i):e},Gr.padStart=function(e,t,i){e=To(e);var a=(t=mo(t))?vr(e):0;return t&&a<t?Yi(t-a,i)+e:e},Gr.parseInt=function(e,t,i){return i||null==t?t=0:t&&(t=+t),Sr(To(e).replace(ue,""),t||0)},Gr.random=function(e,t,i){if(i&&"boolean"!=typeof i&&ba(e,t,i)&&(t=i=s),i===s&&("boolean"==typeof t?(i=t,t=s):"boolean"==typeof e&&(i=e,e=s)),e===s&&t===s?(e=0,t=1):(e=go(e),t===s?(t=e,e=0):t=go(t)),e>t){var a=e;e=t,t=a}if(i||e%1||t%1){var o=Rr();return Tr(e+o*(t-e+ht("1e-"+((o+"").length-1))),t)}return $n(e,t)},Gr.reduce=function(e,t,i){var a=Ws(e)?Bt:$t,s=arguments.length<3;return a(e,da(t,4),i,s,vn)},Gr.reduceRight=function(e,t,i){var a=Ws(e)?jt:$t,s=arguments.length<3;return a(e,da(t,4),i,s,gn)},Gr.repeat=function(e,t,i){return t=(i?ba(e,t,i):t===s)?1:mo(t),Jn(To(e),t)},Gr.replace=function(){var e=arguments,t=To(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Gr.result=function(e,t,i){var a=-1,o=(t=bi(t,e)).length;for(o||(o=1,e=s);++a<o;){var u=null==e?s:e[Ba(t[a])];u===s&&(a=o,u=i),e=Zs(u)?u.call(e):u}return e},Gr.round=wu,Gr.runInContext=e,Gr.sample=function(e){return(Ws(e)?Zr:ei)(e)},Gr.size=function(e){if(null==e)return 0;if(zs(e))return lo(e)?vr(e):e.length;var t=ma(e);return t==I||t==O?e.size:Bn(e).length},Gr.snakeCase=Qo,Gr.some=function(e,t,i){var a=Ws(e)?Ht:oi;return i&&ba(e,t,i)&&(t=s),a(e,da(t,3))},Gr.sortedIndex=function(e,t){return ui(e,t)},Gr.sortedIndexBy=function(e,t,i){return li(e,t,da(i,2))},Gr.sortedIndexOf=function(e,t){var i=null==e?0:e.length;if(i){var a=ui(e,t);if(a<i&&Gs(e[a],t))return a}return-1},Gr.sortedLastIndex=function(e,t){return ui(e,t,!0)},Gr.sortedLastIndexBy=function(e,t,i){return li(e,t,da(i,2),!0)},Gr.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var i=ui(e,t,!0)-1;if(Gs(e[i],t))return i}return-1},Gr.startCase=$o,Gr.startsWith=function(e,t,i){return e=To(e),i=null==i?0:cn(mo(i),0,e.length),t=fi(t),e.slice(i,i+t.length)==t},Gr.subtract=Iu,Gr.sum=function(e){return e&&e.length?Jt(e,su):0},Gr.sumBy=function(e,t){return e&&e.length?Jt(e,da(t,2)):0},Gr.template=function(e,t,i){var a=Gr.templateSettings;i&&ba(e,t,i)&&(t=s),e=To(e),t=Ro({},t,a,ta);var o,u,l=Ro({},t.imports,a.imports,ta),c=xo(l),d=rr(l,c),f=0,h=t.interpolate||Re,p="__p += '",v=ke((t.escape||Re).source+"|"+h.source+"|"+(h===re?ge:Re).source+"|"+(t.evaluate||Re).source+"|$","g"),g="//# sourceURL="+(Ue.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++lt+"]")+"\n";e.replace(v,(function(t,i,a,s,l,c){return a||(a=s),p+=e.slice(f,c).replace(Ae,ur),i&&(o=!0,p+="' +\n__e("+i+") +\n'"),l&&(u=!0,p+="';\n"+l+";\n__p += '"),a&&(p+="' +\n((__t = ("+a+")) == null ? '' : __t) +\n'"),f=c+t.length,t})),p+="';\n";var m=Ue.call(t,"variable")&&t.variable;if(m){if(pe.test(m))throw new we("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(u?p.replace(Y,""):p).replace(z,"$1").replace(X,"$1;"),p="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(u?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var y=tu((function(){return Ie(c,g+"return "+p).apply(s,d)}));if(y.source=p,Js(y))throw y;return y},Gr.times=function(e,t){if((e=mo(e))<1||e>g)return[];var i=y,a=Tr(e,y);t=da(t),e-=y;for(var s=Zt(a,t);++i<e;)t(i);return s},Gr.toFinite=go,Gr.toInteger=mo,Gr.toLength=yo,Gr.toLower=function(e){return To(e).toLowerCase()},Gr.toNumber=Eo,Gr.toSafeInteger=function(e){return e?cn(mo(e),-9007199254740991,g):0===e?e:0},Gr.toString=To,Gr.toUpper=function(e){return To(e).toUpperCase()},Gr.trim=function(e,t,i){if((e=To(e))&&(i||t===s))return er(e);if(!e||!(t=fi(t)))return e;var a=gr(e),o=gr(t);return Ri(a,ir(a,o),ar(a,o)+1).join("")},Gr.trimEnd=function(e,t,i){if((e=To(e))&&(i||t===s))return e.slice(0,mr(e)+1);if(!e||!(t=fi(t)))return e;var a=gr(e);return Ri(a,0,ar(a,gr(t))+1).join("")},Gr.trimStart=function(e,t,i){if((e=To(e))&&(i||t===s))return e.replace(ue,"");if(!e||!(t=fi(t)))return e;var a=gr(e);return Ri(a,ir(a,gr(t))).join("")},Gr.truncate=function(e,t){var i=30,a="...";if(ro(t)){var o="separator"in t?t.separator:o;i="length"in t?mo(t.length):i,a="omission"in t?fi(t.omission):a}var u=(e=To(e)).length;if(lr(e)){var l=gr(e);u=l.length}if(i>=u)return e;var c=i-vr(a);if(c<1)return a;var d=l?Ri(l,0,c).join(""):e.slice(0,c);if(o===s)return d+a;if(l&&(c+=d.length-c),oo(o)){if(e.slice(c).search(o)){var f,h=d;for(o.global||(o=ke(o.source,To(me.exec(o))+"g")),o.lastIndex=0;f=o.exec(h);)var p=f.index;d=d.slice(0,p===s?c:p)}}else if(e.indexOf(fi(o),c)!=c){var v=d.lastIndexOf(o);v>-1&&(d=d.slice(0,v))}return d+a},Gr.unescape=function(e){return(e=To(e))&&J.test(e)?e.replace(Q,yr):e},Gr.uniqueId=function(e){var t=++Be;return To(e)+t},Gr.upperCase=Jo,Gr.upperFirst=Zo,Gr.each=_s,Gr.eachRight=Ts,Gr.first=za,cu(Gr,(Ru={},Sn(Gr,(function(e,t){Ue.call(Gr.prototype,t)||(Ru[t]=e)})),Ru),{chain:!1}),Gr.VERSION="4.17.21",Ct(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Gr[e].placeholder=Gr})),Ct(["drop","take"],(function(e,t){Wr.prototype[e]=function(i){i=i===s?1:_r(mo(i),0);var a=this.__filtered__&&!t?new Wr(this):this.clone();return a.__filtered__?a.__takeCount__=Tr(i,a.__takeCount__):a.__views__.push({size:Tr(i,y),type:e+(a.__dir__<0?"Right":"")}),a},Wr.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),Ct(["filter","map","takeWhile"],(function(e,t){var i=t+1,a=1==i||3==i;Wr.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:da(e,3),type:i}),t.__filtered__=t.__filtered__||a,t}})),Ct(["head","last"],(function(e,t){var i="take"+(t?"Right":"");Wr.prototype[e]=function(){return this[i](1).value()[0]}})),Ct(["initial","tail"],(function(e,t){var i="drop"+(t?"":"Right");Wr.prototype[e]=function(){return this.__filtered__?new Wr(this):this[i](1)}})),Wr.prototype.compact=function(){return this.filter(su)},Wr.prototype.find=function(e){return this.filter(e).head()},Wr.prototype.findLast=function(e){return this.reverse().find(e)},Wr.prototype.invokeMap=Zn((function(e,t){return"function"==typeof e?new Wr(this):this.map((function(i){return Pn(i,e,t)}))})),Wr.prototype.reject=function(e){return this.filter(Fs(da(e)))},Wr.prototype.slice=function(e,t){e=mo(e);var i=this;return i.__filtered__&&(e>0||t<0)?new Wr(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),t!==s&&(i=(t=mo(t))<0?i.dropRight(-t):i.take(t-e)),i)},Wr.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Wr.prototype.toArray=function(){return this.take(y)},Sn(Wr.prototype,(function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),a=/^(?:head|last)$/.test(t),o=Gr[a?"take"+("last"==t?"Right":""):t],u=a||/^find/.test(t);o&&(Gr.prototype[t]=function(){var t=this.__wrapped__,l=a?[1]:arguments,c=t instanceof Wr,d=l[0],f=c||Ws(t),h=function(e){var t=o.apply(Gr,Ut([e],l));return a&&p?t[0]:t};f&&i&&"function"==typeof d&&1!=d.length&&(c=f=!1);var p=this.__chain__,v=!!this.__actions__.length,g=u&&!p,m=c&&!v;if(!u&&f){t=m?t:new Wr(this);var y=e.apply(t,l);return y.__actions__.push({func:vs,args:[h],thisArg:s}),new qr(y,p)}return g&&m?e.apply(this,l):(y=this.thru(h),g?a?y.value()[0]:y.value():y)})})),Ct(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Pe[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);Gr.prototype[e]=function(){var e=arguments;if(a&&!this.__chain__){var s=this.value();return t.apply(Ws(s)?s:[],e)}return this[i]((function(i){return t.apply(Ws(i)?i:[],e)}))}})),Sn(Wr.prototype,(function(e,t){var i=Gr[t];if(i){var a=i.name+"";Ue.call(Pr,a)||(Pr[a]=[]),Pr[a].push({name:t,func:i})}})),Pr[Ki(s,2).name]=[{name:"wrapper",func:s}],Wr.prototype.clone=function(){var e=new Wr(this.__wrapped__);return e.__actions__=Oi(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Oi(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Oi(this.__views__),e},Wr.prototype.reverse=function(){if(this.__filtered__){var e=new Wr(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Wr.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,i=Ws(e),a=t<0,s=i?e.length:0,o=function(e,t,i){var a=-1,s=i.length;for(;++a<s;){var o=i[a],u=o.size;switch(o.type){case"drop":e+=u;break;case"dropRight":t-=u;break;case"take":t=Tr(t,e+u);break;case"takeRight":e=_r(e,t-u)}}return{start:e,end:t}}(0,s,this.__views__),u=o.start,l=o.end,c=l-u,d=a?l:u-1,f=this.__iteratees__,h=f.length,p=0,v=Tr(c,this.__takeCount__);if(!i||!a&&s==c&&v==c)return mi(e,this.__actions__);var g=[];e:for(;c--&&p<v;){for(var m=-1,y=e[d+=t];++m<h;){var E=f[m],_=E.iteratee,T=E.type,b=_(y);if(2==T)y=b;else if(!b){if(1==T)continue e;break e}}g[p++]=y}return g},Gr.prototype.at=gs,Gr.prototype.chain=function(){return ps(this)},Gr.prototype.commit=function(){return new qr(this.value(),this.__chain__)},Gr.prototype.next=function(){this.__values__===s&&(this.__values__=vo(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?s:this.__values__[this.__index__++]}},Gr.prototype.plant=function(e){for(var t,i=this;i instanceof Vr;){var a=Ha(i);a.__index__=0,a.__values__=s,t?o.__wrapped__=a:t=a;var o=a;i=i.__wrapped__}return o.__wrapped__=e,t},Gr.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Wr){var t=e;return this.__actions__.length&&(t=new Wr(this)),(t=t.reverse()).__actions__.push({func:vs,args:[rs],thisArg:s}),new qr(t,this.__chain__)}return this.thru(rs)},Gr.prototype.toJSON=Gr.prototype.valueOf=Gr.prototype.value=function(){return mi(this.__wrapped__,this.__actions__)},Gr.prototype.first=Gr.prototype.head,et&&(Gr.prototype[et]=function(){return this}),Gr}();mt._=Er,(a=function(){return Er}.call(t,i,t,e))===s||(e.exports=a)}.call(this)},4125:e=>{var t;t=function(){return function(){var e={80:function(e,t,i){e.exports=i(728).default},728:function(e,t,i){"use strict";i.d(t,{default:function(){return xt}});var a=i(48),s=i.n(a),o=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},u=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)},l=function(e){return e&&void 0!==e.nodeName?(e.muxId||(e.muxId=e.id||u()),e.muxId):e},c=function(e){var t;e&&void 0!==e.nodeName?e=l(t=e):t=document.querySelector(e);var i=t&&t.nodeName?t.nodeName.toLowerCase():"";return[t,e,i]},d=i(640),f=i.n(d),h=f().methodFactory;f().methodFactory=function(e,t,i){var a=h(e,t,i);return function(){for(var e=["[mux]"],t=0;t<arguments.length;t++)e.push(arguments[t]);a.apply(void 0,e)}},f().setLevel(f().getLevel());var p=f();function v(){return"1"===(s().doNotTrack||s().navigator&&s().navigator.doNotTrack)}var g={now:function(){var e=s().performance,t=e&&e.timing,i=t&&t.navigationStart,a="number"==typeof i&&"function"==typeof e.now?i+e.now():Date.now();return Math.round(a)}},m=function(e){return y(e)[0]},y=function(e){if("string"!=typeof e||""===e)return["localhost"];var t,i=(e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4];return i&&(t=(i.match(/[^\.]+\.[^\.]+$/)||[])[0]),[i,t]},E=function(){var e=s().performance;return void 0!==(e&&e.timing)},_=function(){var e=s().performance,t=e&&e.timing;return t&&t.domContentLoadedEventEnd},T=function(){var e=s().performance,t=e&&e.timing;return t&&t.navigationStart};function b(e,t,i){i=void 0===i?1:i,e[t]=e[t]||0,e[t]+=i}var S=["x-request-id","cf-ray","x-amz-cf-id","x-akamai-request-id"],R=["x-cdn","content-type"].concat(S);function A(e){var t={};return(e=e||"").trim().split(/[\r\n]+/).forEach((function(e){if(e){var i=e.split(": "),a=i.shift();a&&(R.indexOf(a.toLowerCase())>=0||0===a.toLowerCase().indexOf("x-litix-"))&&(t[a]=i.join(": "))}})),t}function w(e){if(e){var t=S.find((function(t){return void 0!==e[t]}));return t?e[t]:void 0}}var I=function(e){var t={};for(var i in e){var a=e[i];-1!==a["DATA-ID"].search("io.litix.data.")&&(t[a["DATA-ID"].replace("io.litix.data.","")]=a.VALUE)}return t};function D(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function L(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?D(Object(i),!0).forEach((function(t){k(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):D(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function k(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var C=function(e){if(!e)return{};var t=T(),i=e.loading,a=i?i.start:e.trequest,s=i?i.first:e.tfirst,o=i?i.end:e.tload;return{bytesLoaded:e.total,requestStart:Math.round(t+a),responseStart:Math.round(t+s),responseEnd:Math.round(t+o)}},O=function(e){if(e&&"function"==typeof e.getAllResponseHeaders)return A(e.getAllResponseHeaders())};function P(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function x(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?P(Object(i),!0).forEach((function(t){M(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):P(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function M(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var N=function(e,t){if(!e||"function"!=typeof e.getRequests)return{};var i=e.getRequests({state:"executed"});if(0===i.length)return{};var a,s=i[i.length-1],o=m(s.url),u=s.url,l=s.bytesLoaded,c=new Date(s.requestStartDate).getTime(),d=new Date(s.firstByteDate).getTime(),f=new Date(s.requestEndDate).getTime(),h=isNaN(s.duration)?0:s.duration,p="function"==typeof t.getMetricsFor?t.getMetricsFor(s.mediaType).HttpList:t.getDashMetrics().getHttpRequests(s.mediaType);return p.length>0&&(a=A(p[p.length-1]._responseHeaders||"")),{requestStart:c,requestResponseStart:d,requestResponseEnd:f,requestBytesLoaded:l,requestResponseHeaders:a,requestMediaDuration:h,requestHostname:o,requestUrl:u,requestId:a?w(a):void 0}},F=function(e){var t;return null===(t=e.match(/.*codecs\*?="(.*)"/))||void 0===t?void 0:t[1]};function U(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var B=0,j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i;return t=e,i=[{key:"on",value:function(e,t,i){return t._eventEmitterGuid=t._eventEmitterGuid||++B,this._listeners=this._listeners||{},this._listeners[e]=this._listeners[e]||[],i&&(t=t.bind(i)),this._listeners[e].push(t),t}},{key:"off",value:function(e,t){var i=this._listeners&&this._listeners[e];i&&i.forEach((function(e,a){e._eventEmitterGuid===t._eventEmitterGuid&&i.splice(a,1)}))}},{key:"one",value:function(e,t,i){var a=this;t._eventEmitterGuid=t._eventEmitterGuid||++B;var s=function s(){a.off(e,s),t.apply(i||this,arguments)};s._eventEmitterGuid=t._eventEmitterGuid,this.on(e,s)}},{key:"emit",value:function(e,t){var i=this;if(this._listeners){t=t||{};var a=this._listeners["before*"]||[],s=this._listeners[e]||[],o=this._listeners["after"+e]||[],u=function(t,a){(t=t.slice()).forEach((function(t){t.call(i,{type:e},a)}))};u(a,t),u(s,t),u(o,t)}}}],i&&U(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}(),H=j;function G(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var K=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pm=t,this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,t.on("playing",(function(){i._playheadShouldBeProgressing=!0})),t.on("play",this._startPlaybackHeartbeatInterval.bind(this)),t.on("playing",this._startPlaybackHeartbeatInterval.bind(this)),t.on("adbreakstart",this._startPlaybackHeartbeatInterval.bind(this)),t.on("adplay",this._startPlaybackHeartbeatInterval.bind(this)),t.on("adplaying",this._startPlaybackHeartbeatInterval.bind(this)),t.on("seeking",this._startPlaybackHeartbeatInterval.bind(this)),t.on("devicewake",this._startPlaybackHeartbeatInterval.bind(this)),t.on("viewstart",this._startPlaybackHeartbeatInterval.bind(this)),t.on("rebufferstart",this._startPlaybackHeartbeatInterval.bind(this)),t.on("pause",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("ended",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("viewend",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("error",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("aderror",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("adpause",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("adended",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("adbreakend",this._stopPlaybackHeartbeatInterval.bind(this)),t.on("seeked",(function(){t.data.player_is_paused?i._stopPlaybackHeartbeatInterval():i._startPlaybackHeartbeatInterval()})),t.on("timeupdate",(function(){null!==i._playbackHeartbeatInterval&&t.emit("playbackheartbeat")})),t.on("devicesleep",(function(e,a){null!==i._playbackHeartbeatInterval&&(s().clearInterval(i._playbackHeartbeatInterval),t.emit("playbackheartbeatend",{viewer_time:a.viewer_time}),i._playbackHeartbeatInterval=null)}))}var t,i;return t=e,(i=[{key:"_startPlaybackHeartbeatInterval",value:function(){var e=this;null===this._playbackHeartbeatInterval&&(this.pm.emit("playbackheartbeat"),this._playbackHeartbeatInterval=s().setInterval((function(){e.pm.emit("playbackheartbeat")}),this.pm.playbackHeartbeatTime))}},{key:"_stopPlaybackHeartbeatInterval",value:function(){this._playheadShouldBeProgressing=!1,null!==this._playbackHeartbeatInterval&&(s().clearInterval(this._playbackHeartbeatInterval),this.pm.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)}}])&&G(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function V(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var q=function(e,t,i){return t&&V(e.prototype,t),i&&V(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}((function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.on("viewinit",(function(){i.viewErrored=!1})),t.on("error",(function(e,a){try{var s=t.errorTranslator({player_error_code:a.player_error_code,player_error_message:a.player_error_message,player_error_context:a.player_error_context});s?(t.data.player_error_code=s.player_error_code||a.player_error_code,t.data.player_error_message=s.player_error_message||a.player_error_message,t.data.player_error_context=s.player_error_context||a.player_error_context,i.viewErrored=!0):(delete t.data.player_error_code,delete t.data.player_error_message,delete t.data.player_error_context)}catch(e){t.mux.log.warn("Exception in error translator callback.",e),i.viewErrored=!0}}))}));function W(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pm=t,this._watchTimeTrackerLastCheckedTime=null,t.on("playbackheartbeat",this._updateWatchTime.bind(this)),t.on("playbackheartbeatend",this._clearWatchTimeState.bind(this))}var t,i;return t=e,(i=[{key:"_updateWatchTime",value:function(e,t){var i=t.viewer_time;null===this._watchTimeTrackerLastCheckedTime&&(this._watchTimeTrackerLastCheckedTime=i),b(this.pm.data,"view_watch_time",i-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=i}},{key:"_clearWatchTimeState",value:function(e,t){this._updateWatchTime(e,t),this._watchTimeTrackerLastCheckedTime=null}}])&&W(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function z(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var X=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pm=t,this._playbackTimeTrackerLastPlayheadPosition=-1,this._lastTime=g.now(),this._isAdPlaying=!1,t.on("playbackheartbeat",this._updatePlaybackTime.bind(this)),t.on("playbackheartbeatend",this._clearPlaybackTimeState.bind(this)),t.on("seeking",this._clearPlaybackTimeState.bind(this)),t.on("adplaying",(function(){i._isAdPlaying=!0})),t.on("adended",(function(){i._isAdPlaying=!1})),t.on("adpause",(function(){i._isAdPlaying=!1})),t.on("adbreakstart",(function(){i._isAdPlaying=!1})),t.on("adbreakend",(function(){i._isAdPlaying=!1})),t.on("adplay",(function(){i._isAdPlaying=!1}))}var t,i;return t=e,(i=[{key:"_updatePlaybackTime",value:function(){var e=this.pm.data.player_playhead_time,t=g.now(),i=-1;this._playbackTimeTrackerLastPlayheadPosition>=0&&e>this._playbackTimeTrackerLastPlayheadPosition?i=e-this._playbackTimeTrackerLastPlayheadPosition:this._isAdPlaying&&(i=t-this._lastTime),i>0&&i<=1e3&&b(this.pm.data,"view_content_playback_time",i),this._playbackTimeTrackerLastPlayheadPosition=e,this._lastTime=t}},{key:"_clearPlaybackTimeState",value:function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1}}])&&z(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Q(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var $=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pm=t;var i=this._updatePlayheadTime.bind(this);t.on("playbackheartbeat",i),t.on("playbackheartbeatend",i),t.on("timeupdate",i),t.on("destroy",(function(){t.off("timeupdate",i)}))}var t,i;return t=e,(i=[{key:"_updateMaxPlayheadPosition",value:function(){this.pm.data.view_max_playhead_position=void 0===this.pm.data.view_max_playhead_position?this.pm.data.player_playhead_time:Math.max(this.pm.data.view_max_playhead_position,this.pm.data.player_playhead_time)}},{key:"_updatePlayheadTime",value:function(e,t){var i=this,a=function(){i.pm.currentFragmentPDT&&i.pm.currentFragmentStart&&(i.pm.data.player_program_time=i.pm.currentFragmentPDT+i.pm.data.player_playhead_time-i.pm.currentFragmentStart)};if(t&&t.player_playhead_time)this.pm.data.player_playhead_time=t.player_playhead_time,a(),this._updateMaxPlayheadPosition();else if(this.pm.getPlayheadTime){var s=this.pm.getPlayheadTime();void 0!==s&&(this.pm.data.player_playhead_time=s,a(),this._updateMaxPlayheadPosition())}}}])&&Q(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function J(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Z=3e5,ee=function(e,t,i){return t&&J(e.prototype,t),i&&J(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}((function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t.disableRebufferTracking){var i,a=function(e,t){s(t),i=void 0},s=function(e){if(i){var a=e.viewer_time-i;b(t.data,"view_rebuffer_duration",a),i=e.viewer_time,t.data.view_rebuffer_duration>Z&&(t.emit("viewend"),t.send("viewend"),t.mux.log.warn("Ending view after rebuffering for longer than ".concat(Z,"ms, future events will be ignored unless a programchange or videochange occurs.")))}t.data.view_watch_time>=0&&t.data.view_rebuffer_count>0&&(t.data.view_rebuffer_frequency=t.data.view_rebuffer_count/t.data.view_watch_time,t.data.view_rebuffer_percentage=t.data.view_rebuffer_duration/t.data.view_watch_time)};t.on("playbackheartbeat",(function(e,t){return s(t)})),t.on("rebufferstart",(function(e,s){i||(b(t.data,"view_rebuffer_count",1),i=s.viewer_time,t.one("rebufferend",a))})),t.on("viewinit",(function(){i=void 0,t.off("rebufferend",a)}))}}));function te(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var re=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pm=t,t.disableRebufferTracking||t.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,t.on("playbackheartbeat",this._checkIfRebuffering.bind(this)),t.on("playbackheartbeatend",this._cleanupRebufferTracker.bind(this)),t.on("seeking",(function(){i._cleanupRebufferTracker(null,{viewer_time:g.now()})})))}var t,i;return t=e,i=[{key:"_checkIfRebuffering",value:function(e,t){if(this.pm.seekingTracker.isSeeking||this.pm.adTracker.isAdBreak||!this.pm.playbackHeartbeat._playheadShouldBeProgressing)this._cleanupRebufferTracker(e,t);else if(null!==this._lastCheckedTime)if(this._lastPlayheadTime===this.pm.data.player_playhead_time){var i=t.viewer_time-this._lastPlayheadTimeUpdatedTime;"number"==typeof this.pm.sustainedRebufferThreshold&&i>=this.pm.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),this._lastCheckedTime=t.viewer_time}else this._cleanupRebufferTracker(e,t,!0);else this._prepareRebufferTrackerState(t.viewer_time)}},{key:"_clearRebufferTrackerState",value:function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null}},{key:"_prepareRebufferTrackerState",value:function(e){this._lastCheckedTime=e,this._lastPlayheadTime=this.pm.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=e}},{key:"_cleanupRebufferTracker",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.pm.emit("rebufferend",{viewer_time:t.viewer_time});else{if(null===this._lastCheckedTime)return;var a=this.pm.data.player_playhead_time-this._lastPlayheadTime,s=t.viewer_time-this._lastPlayheadTimeUpdatedTime;"number"==typeof this.pm.minimumRebufferDuration&&a>0&&s-a>this.pm.minimumRebufferDuration&&(this._lastCheckedTime=null,this.pm.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.pm.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+s-a}))}i?this._prepareRebufferTrackerState(t.viewer_time):this._clearRebufferTrackerState()}}],i&&te(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}(),ne=re;function ie(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var ae=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pm=t,t.on("viewinit",(function(){var e=t.data,a=e.view_id;if(!e.view_program_changed){var s=function(e,s){var o=s.viewer_time;"playing"===e.type&&void 0===t.data.view_time_to_first_frame?i.calculateTimeToFirstFrame(o||g.now(),a):"adplaying"!==e.type||void 0!==t.data.view_time_to_first_frame&&!i._inPrerollPosition()||i.calculateTimeToFirstFrame(o||g.now(),a)};t.one("playing",s),t.one("adplaying",s),t.one("viewend",(function(){t.off("playing",s),t.off("adplaying",s)}))}}))}var t,i;return t=e,(i=[{key:"_inPrerollPosition",value:function(){return void 0===this.pm.data.view_content_playback_time||this.pm.data.view_content_playback_time<=1e3}},{key:"calculateTimeToFirstFrame",value:function(e,t){t===this.pm.data.view_id&&(this.pm.watchTimeTracker._updateWatchTime(null,{viewer_time:e}),this.pm.data.view_time_to_first_frame=this.pm.data.view_watch_time,(this.pm.data.player_autoplay_on||this.pm.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.pm.data.view_aggregate_startup_time=this.pm.data.view_start+this.pm.data.view_watch_time-this.NAVIGATION_START))}}])&&ie(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function se(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var oe=function(e,t,i){return t&&se(e.prototype,t),i&&se(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}((function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.on("viewinit",(function(){i._lastPlayheadPosition=-1})),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach((function(e){t.on(e,(function(){if(i._lastPlayheadPosition>=0&&t.data.player_playhead_time>=0&&i._lastPlayerWidth>=0&&i._lastSourceWidth>0&&i._lastPlayerHeight>=0&&i._lastSourceHeight>0){var e=t.data.player_playhead_time-i._lastPlayheadPosition;if(e<0)return void(i._lastPlayheadPosition=-1);var a=Math.min(i._lastPlayerWidth/i._lastSourceWidth,i._lastPlayerHeight/i._lastSourceHeight),s=Math.max(0,a-1),o=Math.max(0,1-a);t.data.view_max_upscale_percentage=Math.max(t.data.view_max_upscale_percentage||0,s),t.data.view_max_downscale_percentage=Math.max(t.data.view_max_downscale_percentage||0,o),b(t.data,"view_total_content_playback_time",e),b(t.data,"view_total_upscaling",s*e),b(t.data,"view_total_downscaling",o*e)}i._lastPlayheadPosition=-1}))})),["playing","hb"].forEach((function(e){t.on(e,(function(){i._lastPlayheadPosition=t.data.player_playhead_time,i._lastPlayerWidth=t.data.player_width,i._lastPlayerHeight=t.data.player_height,i._lastSourceWidth=t.data.video_source_width,i._lastSourceHeight=t.data.video_source_height}))}))}));function ue(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var le=function(e,t,i){return t&&ue(e.prototype,t),i&&ue(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}((function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isSeeking=!1,t.on("seeking",(function(e,a){Object.assign(t.data,a),i._lastSeekingTime=g.now(),!1===i.isSeeking&&(i.isSeeking=!0,t.send("seeking"))})),t.on("seeked",(function(){i.isSeeking=!1;var e=i._lastSeekingTime||g.now(),a=g.now()-e;b(t.data,"view_seek_count",1),b(t.data,"view_seek_duration",a);var s=t.data.view_max_seek_time||0;t.data.view_max_seek_time=Math.max(s,a)})),t.on("viewend",(function(){i.isSeeking=!1}))}));function ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a,s,o=[],u=!0,l=!1;try{for(i=i.call(e);!(u=(a=i.next()).done)&&(o.push(a.value),!t||o.length!==t);u=!0);}catch(e){l=!0,s=e}finally{try{u||null==i.return||i.return()}finally{if(l)throw s}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return de(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?de(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function de(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function fe(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var he=function(e,t){e.push(t),e.sort((function(e,t){return e.viewer_time-t.viewer_time}))},pe=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],ve=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pm=t,t.on("viewinit",(function(){i.isAdBreak=!1,i._currentAdRequestNumber=0,i._currentAdResponseNumber=0,i._adRequests=[],i._adResponses=[],i._adHasPlayed=!1,i._wouldBeNewAdPlay=!0,i._prerollPlayTime=void 0})),pe.forEach((function(e){return t.on(e,i._updateAdData.bind(i))}));var a=function(){i.isAdBreak=!1};t.on("adbreakstart",(function(){i.isAdBreak=!0})),t.on("play",a),t.on("playing",a),t.on("viewend",a),t.on("adrequest",(function(e,a){a=Object.assign({ad_request_id:"generatedAdRequestId"+i._currentAdRequestNumber++},a),he(i._adRequests,a),b(t.data,"view_ad_request_count"),i.inPrerollPosition()&&(t.data.view_preroll_requested=!0,i._adHasPlayed||b(t.data,"view_preroll_request_count"))})),t.on("adresponse",(function(e,a){a=Object.assign({ad_request_id:"generatedAdRequestId"+i._currentAdResponseNumber++},a),he(i._adResponses,a);var s=i.findAdRequest(a.ad_request_id);s&&b(t.data,"view_ad_request_time",Math.max(0,a.viewer_time-s.viewer_time))})),t.on("adplay",(function(e,a){i._adHasPlayed=!0,i._wouldBeNewAdPlay&&(i._wouldBeNewAdPlay=!1,b(t.data,"view_ad_played_count")),i.inPrerollPosition()&&!t.data.view_preroll_played&&(t.data.view_preroll_played=!0,i._adRequests.length>0&&(t.data.view_preroll_request_time=Math.max(0,a.viewer_time-i._adRequests[0].viewer_time)),t.data.view_start&&(t.data.view_startup_preroll_request_time=Math.max(0,a.viewer_time-t.data.view_start)),i._prerollPlayTime=a.viewer_time)})),t.on("adplaying",(function(e,a){i.inPrerollPosition()&&void 0===t.data.view_preroll_load_time&&void 0!==i._prerollPlayTime&&(t.data.view_preroll_load_time=a.viewer_time-i._prerollPlayTime,t.data.view_startup_preroll_load_time=a.viewer_time-i._prerollPlayTime)})),t.on("adended",(function(){i._wouldBeNewAdPlay=!0})),t.on("aderror",(function(){i._wouldBeNewAdPlay=!0}))}var t,i;return t=e,(i=[{key:"inPrerollPosition",value:function(){return void 0===this.pm.data.view_content_playback_time||this.pm.data.view_content_playback_time<=1e3}},{key:"findAdRequest",value:function(e){for(var t=0;t<this._adRequests.length;t++)if(this._adRequests[t].ad_request_id===e)return this._adRequests[t]}},{key:"_updateAdData",value:function(e,t){if(this.inPrerollPosition()){if(!this.pm.data.view_preroll_ad_tag_hostname&&t.ad_tag_url){var i=ce(y(t.ad_tag_url),2),a=i[0],s=i[1];this.pm.data.view_preroll_ad_tag_domain=s,this.pm.data.view_preroll_ad_tag_hostname=a}if(!this.pm.data.view_preroll_ad_asset_hostname&&t.ad_asset_url){var o=ce(y(t.ad_asset_url),2),u=o[0],l=o[1];this.pm.data.view_preroll_ad_asset_domain=l,this.pm.data.view_preroll_ad_asset_hostname=u}}this.pm.data.ad_asset_url=null==t?void 0:t.ad_asset_url,this.pm.data.ad_tag_url=null==t?void 0:t.ad_tag_url,this.pm.data.ad_creative_id=null==t?void 0:t.ad_creative_id,this.pm.data.ad_id=null==t?void 0:t.ad_id,this.pm.data.ad_universal_id=null==t?void 0:t.ad_universal_id}}])&&fe(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ge(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var me=function(e,t,i){return t&&ge(e.prototype,t),i&&ge(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}((function e(t){var i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(){t.disableRebufferTracking||i&&(b(t.data,"view_waiting_rebuffer_duration",g.now()-i),i=!1,s().clearInterval(a))},u=!1,l=function(){u=!1,o()};t.on("waiting",(function(){u&&(t.disableRebufferTracking||(b(t.data,"view_waiting_rebuffer_count",1),i=g.now(),a=s().setInterval((function(){if(i){var e=g.now();b(t.data,"view_waiting_rebuffer_duration",e-i),i=e}}),250)))})),t.on("playing",(function(){o(),u=!0})),t.on("pause",l),t.on("seeking",l)}));function ye(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Ee=function(e,t,i){return t&&ye(e.prototype,t),i&&ye(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}((function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var a=function(){i.lastWallClockTime=g.now(),t.on("before*",s)},s=function(e){var a=g.now(),s=i.lastWallClockTime;i.lastWallClockTime=a,a-s>3e4&&(t.emit("devicesleep",{viewer_time:s}),Object.assign(t.data,{viewer_time:s}),t.send("devicesleep"),t.emit("devicewake",{viewer_time:a}),Object.assign(t.data,{viewer_time:a}),t.send("devicewake"))};t.one("playbackheartbeat",a),t.on("playbackheartbeatend",(function(){t.off("before*",s),t.one("playbackheartbeat",a)}))})),_e=i(375),Te=i(655),be=i.n(Te),Se="muxData",Re=function(){var e;try{e=_e.parse(be().get(Se)||"")}catch(t){e={}}return e},Ae=function(e){try{be().set(Se,_e.stringify(e),{expires:365})}catch(e){}},we=function(){var e=Re();return e.mux_viewer_id=e.mux_viewer_id||o(),e.msn=e.msn||Math.random(),Ae(e),{mux_viewer_id:e.mux_viewer_id,mux_sample_number:e.msn}},Ie=function(){var e;switch(De()){case"cellular":e="cellular";break;case"ethernet":e="wired";break;case"wifi":e="wifi";break;case void 0:break;default:e="other"}return e},De=function(){var e=s().navigator,t=e&&(e.connection||e.mozConnection||e.webkitConnection);return t&&t.type};Ie.getConnectionFromAPI=De;var Le=Ie,ke=Oe({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),Ce=Oe({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cc:"codec",cd:"code",cg:"category",ch:"changed",cl:"canceled",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",cz:"context",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",dr:"drm",dp:"dropped",du:"duration",dv:"device",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ep:"experiments",fa:"failed",fi:"first",fm:"family",ft:"format",fp:"fps",fq:"frequency",fr:"frame",fs:"fullscreen",ha:"has",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",un:"universal",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"});function Oe(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}function Pe(e){var t={},i={};return Object.keys(e).forEach((function(a){var s=!1;if(e.hasOwnProperty(a)&&void 0!==e[a]){var o=a.split("_"),u=o[0],l=ke[u];l||(p.info("Data key word `"+o[0]+"` not expected in "+a),l=u+"_"),o.splice(1).forEach((function(e){"url"===e&&(s=!0),Ce[e]?l+=Ce[e]:Number(e)&&Math.floor(Number(e))===Number(e)?l+=e:(p.info("Data key word `"+e+"` not expected in "+a),l+="_"+e+"_")})),s?i[l]=e[a]:t[l]=e[a]}})),Object.assign(t,i)}var xe={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},Me=["hb","requestcompleted","requestfailed","requestcanceled"],Ne=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._beaconUrl=e||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=Object.assign({},xe,t)};Ne.prototype.queueEvent=function(e,t){var i=Object.assign({},t);return(this._eventQueue.length<=this._options.maxQueueLength||"eventrateexceeded"===e)&&(this._eventQueue.push(i),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength)},Ne.prototype.flushEvents=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&1===this._eventQueue.length?this._eventQueue.pop():(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},Ne.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.destroyed=!0,e?this._clearBeaconQueue():this.flushEvents(),s().clearTimeout(this._sendTimeout)},Ne.prototype._clearBeaconQueue=function(){var e=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,t=this._eventQueue.slice(e);e>0&&Object.assign(t[t.length-1],Pe({mux_view_message:"event queue truncated"}));var i=this._createPayload(t);Ue(this._beaconUrl,i,!0,(function(){}))},Ne.prototype._sendBeaconQueue=function(){var e=this;if(!this._postInFlight){var t=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0;var i=this._createPayload(t),a=g.now();Ue(this._beaconUrl,i,!1,(function(i,s){s?(e._eventQueue=t.concat(e._eventQueue),e._failureCount+=1,p.info("Error sending beacon: "+s)):e._failureCount=0,e._roundTripTime=g.now()-a,e._postInFlight=!1}))}},Ne.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var e=Math.pow(2,this._failureCount-1);return(1+(e*=Math.random()))*this._options.baseTimeBetweenBeacons},Ne.prototype._startBeaconSending=function(){var e=this;s().clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=s().setTimeout((function(){e._eventQueue.length&&e._sendBeaconQueue(),e._startBeaconSending()}),this._getNextBeaconTime()))},Ne.prototype._createPayload=function(e){var t,i,a,s=this,o={transmission_timestamp:Math.round(g.now())};this._roundTripTime&&(o.rtt_ms=Math.round(this._roundTripTime));var u=function(){t=JSON.stringify({metadata:o,events:i||e}),a=t.length/1024},l=function(){return a<=s._options.maxPayloadKBSize};return u(),l()||(p.info("Payload size is too big ("+a+" kb). Removing unnecessary events."),i=e.filter((function(e){return-1===Me.indexOf(e.e)})),u()),l()||(p.info("Payload size still too big ("+a+" kb). Cropping fields.."),i.forEach((function(e){for(var t in e){var i=e[t];"string"==typeof i&&i.length>51200&&(e[t]=i.substring(0,51200))}})),u()),t};var Fe=function(e){return e.length<=57344},Ue=function(e,t,i,a){if(i&&navigator&&navigator.sendBeacon&&navigator.sendBeacon(e,t))a();else if(s().fetch)s().fetch(e,{method:"POST",body:t,headers:{"Content-Type":"text/plain"},keepalive:Fe(t)}).then((function(e){return a(null,e.ok?null:"Error")})).catch((function(e){return a(null,e)}));else{if(s().XMLHttpRequest){var o=new(s().XMLHttpRequest);return o.onreadystatechange=function(){if(4===o.readyState)return a(null,200!==o.status?"error":void 0)},o.open("POST",e),o.setRequestHeader("Content-Type","text/plain"),void o.send(t)}a()}},Be=Ne;function je(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function He(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Ge(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?He(Object(i),!0).forEach((function(t){qe(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):He(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ke(e){return Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ke(e)}function Ve(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function qe(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var We=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],Ye=["adplay","adplaying","adpause","adfirstquartile","admidpoint","adthirdquartile","adended","adresponse","adrequest"],ze=["ad_id","ad_creative_id","ad_universal_id"],Xe=["viewstart","error","ended","viewend"],Qe=function(){function e(t,i){var a,o,u,l,c,d,f,h,p,v,g,m,y,E,_,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),qe(this,"previousBeaconData",null),qe(this,"lastEventTime",0),qe(this,"rateLimited",!1),this.mux=t,this.envKey=i,this.options=T,this.eventQueue=new Be(function(e,t){var i=t.beaconCollectionDomain,a=t.beaconDomain;if(i)return"https://"+i;var s=a||"litix.io";return(e=e||"inferred").match(/^[a-z0-9]+$/)?"https://"+e+"."+s:"https://img.litix.io/a.gif"}(this.envKey,this.options)),this.sampleRate=null!==(a=this.options.sampleRate)&&void 0!==a?a:1,this.disableCookies=null!==(o=this.options.disableCookies)&&void 0!==o&&o,this.respectDoNotTrack=null!==(u=this.options.respectDoNotTrack)&&void 0!==u&&u,this.previousBeaconData=null,this.lastEventTime=0,this.rateLimited=!1,this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:null===(l=this.options.platform)||void 0===l?void 0:l.name,viewer_application_version:null===(c=this.options.platform)||void 0===c?void 0:c.version,viewer_application_engine:null===(d=this.options.platform)||void 0===d?void 0:d.layout,viewer_device_name:null===(f=this.options.platform)||void 0===f?void 0:f.product,viewer_device_category:"",viewer_device_manufacturer:null===(h=this.options.platform)||void 0===h?void 0:h.manufacturer,viewer_os_family:null===(p=this.options.platform)||void 0===p||null===(v=p.os)||void 0===v?void 0:v.family,viewer_os_architecture:null===(g=this.options.platform)||void 0===g||null===(m=g.os)||void 0===m?void 0:m.architecture,viewer_os_version:null===(y=this.options.platform)||void 0===y||null===(E=y.os)||void 0===E?void 0:E.version,viewer_connection_type:Le(),page_url:null===s()||void 0===s()||null===(_=s().location)||void 0===_?void 0:_.href},this.viewerData=this.disableCookies?{}:we()}var t,i;return t=e,(i=[{key:"send",value:function(e,t){var i;if(e&&null!=t&&t.view_id){if(this.respectDoNotTrack&&v())return p.info("Not sending `"+e+"` because Do Not Track is enabled");if(!t||"object"!==Ke(t))return p.error("A data object was expected in send() but was not provided");var a,s,u=this.disableCookies?{}:(a=Re(),s=g.now(),a.session_start&&(a.sst=a.session_start,delete a.session_start),a.session_id&&(a.sid=a.session_id,delete a.session_id),a.session_expires&&(a.sex=a.session_expires,delete a.session_expires),(!a.sex||a.sex<s)&&(a.sid=o(),a.sst=s),a.sex=s+15e5,Ae(a),{session_id:a.sid,session_start:a.sst,session_expires:a.sex}),l=Ge(Ge(Ge(Ge(Ge({},this.pageLevelData),t),u),this.viewerData),{},{event:e,env_key:this.envKey});l.user_id&&(l.viewer_user_id=l.user_id,delete l.user_id);var c=(null!==(i=l.mux_sample_number)&&void 0!==i?i:0)>=this.sampleRate,d=Pe(this._deduplicateBeaconData(e,l));if(this.lastEventTime=this.mux.utils.now(),c)return p.info("Not sending event due to sample rate restriction",e,l,d);if(this.envKey||p.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",e,l,d),!this.rateLimited)if(p.info("Sending event",e,l,d),this.rateLimited=!this.eventQueue.queueEvent(e,d),this.mux.WINDOW_UNLOADING&&"viewend"===e)this.eventQueue.destroy(!0);else if(this.mux.WINDOW_HIDDEN&&"hb"===e?this.eventQueue.flushEvents(!0):Xe.indexOf(e)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return l.event="eventrateexceeded",d=Pe(l),this.eventQueue.queueEvent(l.event,d),p.error("Beaconing disabled due to rate limit.")}}},{key:"destroy",value:function(){this.eventQueue.destroy(!1)}},{key:"_deduplicateBeaconData",value:function(e,t){var i=this,a={},s=t.view_id;if("-1"===s||"viewstart"===e||"viewend"===e||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)a=Ge({},t),s&&(this.previousBeaconData=a),s&&"viewend"===e&&(this.previousBeaconData=null);else{var o=0===e.indexOf("request");Object.entries(t).forEach((function(t){var s=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a,s,o=[],u=!0,l=!1;try{for(i=i.call(e);!(u=(a=i.next()).done)&&(o.push(a.value),!t||o.length!==t);u=!0);}catch(e){l=!0,s=e}finally{try{u||null==i.return||i.return()}finally{if(l)throw s}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return je(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?je(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),u=s[0],l=s[1];i.previousBeaconData&&(l!==i.previousBeaconData[u]||We.indexOf(u)>-1||i.objectHasChanged(o,u,l,i.previousBeaconData[u])||i.eventRequiresKey(e,u))&&(a[u]=l,i.previousBeaconData[u]=l)}))}return a}},{key:"objectHasChanged",value:function(e,t,i,a){return!(!e||0!==t.indexOf("request_")||"request_response_headers"!==t&&"object"===Ke(i)&&"object"===Ke(a)&&Object.keys(i||{}).length===Object.keys(a||{}).length)}},{key:"eventRequiresKey",value:function(e,t){return"renditionchange"===e&&0===t.indexOf("video_source_")||!(!ze.includes(t)||!Ye.includes(e))}}])&&Ve(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function $e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Je=function(e,t,i){return t&&$e(e.prototype,t),i&&$e(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}((function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=0,a=0,s=0,o=0,u=0,l=0,c=0;t.on("requestcompleted",(function(e,l){var c,d,f=l.request_start,h=l.request_response_start,p=l.request_response_end,v=l.request_bytes_loaded;if(o++,h?(c=h-(null!=f?f:0),d=(null!=p?p:0)-h):d=(null!=p?p:0)-(null!=f?f:0),d>0&&v&&v>0){var g=v/d*8e3;u++,a+=v,s+=d,t.data.view_min_request_throughput=Math.min(t.data.view_min_request_throughput||1/0,g),t.data.view_average_request_throughput=a/s*8e3,t.data.view_request_count=o,c>0&&(i+=c,t.data.view_max_request_latency=Math.max(t.data.view_max_request_latency||0,c),t.data.view_average_request_latency=i/u)}})),t.on("requestfailed",(function(e,i){o++,l++,t.data.view_request_count=o,t.data.view_request_failed_count=l})),t.on("requestcanceled",(function(e,i){o++,c++,t.data.view_request_count=o,t.data.view_request_canceled_count=c}))}));function Ze(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var et=function(e,t,i){return t&&Ze(e.prototype,t),i&&Ze(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}((function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.on("before*",(function(e,a){var s=a.viewer_time,o=g.now(),u=i._lastEventTime;if(i._lastEventTime=o,u&&o-u>36e5){var l=Object.keys(t.data).reduce((function(e,i){return 0===i.indexOf("video_")?Object.assign(e,function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},i,t.data[i])):e}),{});t.mux.log.info("Received event after at least an hour inactivity, creating a new view"),t.emit("viewinit",Object.assign({viewer_time:s},l)),t.playbackHeartbeat._playheadShouldBeProgressing&&"play"!==e.type&&"adbreakstart"!==e.type&&(t.emit("play",{viewer_time:s}),"playing"!==e.type&&t.emit("playing",{viewer_time:s}))}}))}));function tt(e){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(e)}function rt(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function nt(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function it(e,t){return it=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},it(e,t)}function at(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,a=ot(e);if(t){var s=ot(this).constructor;i=Reflect.construct(a,arguments,s)}else i=a.apply(this,arguments);return function(e,t){if(t&&("object"===tt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return st(e)}(this,i)}}function st(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ot(e){return ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ot(e)}var ut=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],lt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&it(e,t)}(s,e);var t,i,a=at(s);function s(e,t,i){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(u=a.call(this)).DOM_CONTENT_LOADED_EVENT_END=_(),u.NAVIGATION_START=T(),u.mux=e,u.id=t,(i=Object.assign({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(e){return e}},i)).data=i.data||{},i.data.property_key&&(i.data.env_key=i.data.property_key,delete i.data.property_key),p.setLevel(i.debug?"debug":"warn"),u.getPlayheadTime=i.getPlayheadTime,u.getStateData=i.getStateData||function(){return{}},u.getAdData=i.getAdData||function(){},u.minimumRebufferDuration=i.minimumRebufferDuration,u.sustainedRebufferThreshold=i.sustainedRebufferThreshold,u.playbackHeartbeatTime=i.playbackHeartbeatTime,u.disableRebufferTracking=i.disableRebufferTracking,u.disableRebufferTracking&&u.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),u.disablePlayheadRebufferTracking=i.disablePlayheadRebufferTracking,u.errorTranslator=i.errorTranslator,u.playbackEventDispatcher=new Qe(e,i.data.env_key,i),u.data={player_instance_id:o(),mux_sample_rate:i.sampleRate,beacon_domain:i.beaconCollectionDomain?i.beaconCollectionDomain:i.beaconDomain},u.data.view_sequence_number=1,u.data.player_sequence_number=1,u.oldEmit=u.emit,u.emit=function(e,t){t=Object.assign({viewer_time:this.mux.utils.now()},t),this.oldEmit(e,t)};var l=function(){void 0===this.data.view_start&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(st(u));u.on("viewinit",(function(e,t){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),Object.assign(this.data,t),this._initializeViewData(),this.one("play",l),this.one("adbreakstart",l)}));var c=function(e){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",e)}.bind(st(u));if(u.on("videochange",(function(e,t){c(t)})),u.on("programchange",(function(e,t){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),c(Object.assign(t,{view_program_changed:!0})),l(),this.emit("play"),this.emit("playing")})),u.on("fragmentchange",(function(e,t){this.currentFragmentPDT=t.currentFragmentPDT,this.currentFragmentStart=t.currentFragmentStart})),u.on("destroy",u.destroy),"undefined"!=typeof window&&"function"==typeof window.addEventListener&&"function"==typeof window.removeEventListener){var d=function(){var e=void 0!==u.data.view_start;u.mux.WINDOW_HIDDEN="hidden"===document.visibilityState,e&&u.mux.WINDOW_HIDDEN&&(u.data.player_is_paused||u.emit("hb"))};window.addEventListener("visibilitychange",d,!1);var f=function(e){e.persisted||u.destroy()};window.addEventListener("pagehide",f,!1),u.on("destroy",(function(){window.removeEventListener("visibilitychange",d),window.removeEventListener("pagehide",f)}))}return u.on("playerready",(function(e,t){Object.assign(this.data,t)})),ut.forEach((function(e){u.on(e,(function(t,i){0!==e.indexOf("ad")&&this._updateStateData(),Object.assign(this.data,i),this._sanitizeData()})),u.on("after"+e,(function(){("error"!==e||this.errorTracker.viewErrored)&&this.send(e)}))})),u.on("viewend",(function(e,t){Object.assign(u.data,t)})),u.one("playerready",(function(e){var t=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=t-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time})),u.longResumeTracker=new et(st(u)),u.errorTracker=new q(st(u)),new Ee(st(u)),u.seekingTracker=new le(st(u)),u.playheadTime=new $(st(u)),u.playbackHeartbeat=new K(st(u)),new oe(st(u)),u.watchTimeTracker=new Y(st(u)),new X(st(u)),u.adTracker=new ve(st(u)),new ne(st(u)),new ee(st(u)),new ae(st(u)),new me(st(u)),new Je(st(u)),i.hlsjs&&u.addHLSJS(i),i.dashjs&&u.addDashJS(i),u.emit("viewinit",i.data),u}return t=s,i=[{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,void 0!==this.data.view_start&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),window.clearTimeout(this._heartBeatTimeout))}},{key:"send",value:function(e){if(this.data.view_id){var t=Object.assign({},this.data);if(void 0===t.video_source_is_live&&(t.player_source_duration===1/0||t.video_source_duration===1/0?t.video_source_is_live=!0:(t.player_source_duration>0||t.video_source_duration>0)&&(t.video_source_is_live=!1)),t.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach((function(e){t[e]=void 0})),t.video_source_url=t.video_source_url||t.player_source_url,t.video_source_url){var i=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a,s,o=[],u=!0,l=!1;try{for(i=i.call(e);!(u=(a=i.next()).done)&&(o.push(a.value),!t||o.length!==t);u=!0);}catch(e){l=!0,s=e}finally{try{u||null==i.return||i.return()}finally{if(l)throw s}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return rt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?rt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(y(t.video_source_url),2),a=i[0],s=i[1];t.video_source_domain=s,t.video_source_hostname=a}delete t.ad_request_id,this.playbackEventDispatcher.send(e,t),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat(),"viewend"===e&&delete this.data.view_id}}},{key:"_updateStateData",value:function(){Object.assign(this.data,this.getStateData()),this.playheadTime._updatePlayheadTime(),this._sanitizeData()}},{key:"_sanitizeData",value:function(){var e=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach((function(t){var i=parseInt(e.data[t],10);e.data[t]=isNaN(i)?void 0:i})),["player_source_url","video_source_url"].forEach((function(t){if(e.data[t]){var i=e.data[t].toLowerCase();0!==i.indexOf("data:")&&0!==i.indexOf("blob:")||(e.data[t]="MSE style URL")}}))}},{key:"_resetVideoData",value:function(e,t){var i=this;Object.keys(this.data).forEach((function(e){0===e.indexOf("video_")&&delete i.data[e]}))}},{key:"_resetViewData",value:function(){var e=this;Object.keys(this.data).forEach((function(t){0===t.indexOf("view_")&&delete e.data[t]})),this.data.view_sequence_number=1}},{key:"_resetErrorData",value:function(e,t){delete this.data.player_error_code,delete this.data.player_error_message}},{key:"_initializeViewData",value:function(){var e=this,t=this.data.view_id=o(),i=function(){t===e.data.view_id&&b(e.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",i):i()}},{key:"_restartHeartBeat",value:function(){var e=this;window.clearTimeout(this._heartBeatTimeout),this.errorTracker.viewErrored||(this._heartBeatTimeout=window.setTimeout((function(){e.data.player_is_paused||e.emit("hb")}),1e4))}},{key:"addHLSJS",value:function(e){e.hlsjs?this.hlsjs?this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=e.hlsjs,function(e,t,i){var a=arguments.length>4?arguments[4]:void 0,s=e.log,o=e.utils.secondsToMs,u=function(e){var t,i=parseInt(a.version);return 1===i&&null!==e.programDateTime&&(t=e.programDateTime),0===i&&null!==e.pdt&&(t=e.pdt),t};if(E()){var l=function(i,a){return e.emit(t,i,a)},c=function(e,t){var i=t.levels,a=t.audioTracks,s=t.url,o=t.stats,u=t.networkDetails,c=t.sessionData,d={},f={};i.forEach((function(e,t){d[t]={width:e.width,height:e.height,bitrate:e.bitrate,attrs:e.attrs}})),a.forEach((function(e,t){f[t]={name:e.name,language:e.lang,bitrate:e.bitrate}}));var h=C(o),p=h.bytesLoaded,v=h.requestStart,g=h.responseStart,y=h.responseEnd;l("requestcompleted",L(L({},I(c)),{},{request_event_type:e,request_bytes_loaded:p,request_start:v,request_response_start:g,request_response_end:y,request_type:"manifest",request_hostname:m(s),request_response_headers:O(u),request_rendition_lists:{media:d,audio:f,video:{}}}))};i.on(a.Events.MANIFEST_LOADED,c);var d=function(e,t){var i=t.details,a=t.level,s=t.networkDetails,c=t.stats,d=C(c),f=d.bytesLoaded,h=d.requestStart,p=d.responseStart,v=d.responseEnd,g=i.fragments[i.fragments.length-1],y=u(g)+o(g.duration);l("requestcompleted",{request_event_type:e,request_bytes_loaded:f,request_start:h,request_response_start:p,request_response_end:v,request_current_level:a,request_type:"manifest",request_hostname:m(i.url),request_response_headers:O(s),video_holdback:i.holdBack&&o(i.holdBack),video_part_holdback:i.partHoldBack&&o(i.partHoldBack),video_part_target_duration:i.partTarget&&o(i.partTarget),video_target_duration:i.targetduration&&o(i.targetduration),video_source_is_live:i.live,player_manifest_newest_program_time:isNaN(y)?void 0:y})};i.on(a.Events.LEVEL_LOADED,d);var f=function(e,t){var i=t.details,a=t.networkDetails,s=t.stats,o=C(s),u=o.bytesLoaded,c=o.requestStart,d=o.responseStart,f=o.responseEnd;l("requestcompleted",{request_event_type:e,request_bytes_loaded:u,request_start:c,request_response_start:d,request_response_end:f,request_type:"manifest",request_hostname:m(i.url),request_response_headers:O(a)})};i.on(a.Events.AUDIO_TRACK_LOADED,f);var h=function(e,t){var a=t.stats,s=t.networkDetails,o=t.frag;a=a||o.stats;var u=C(a),c=u.bytesLoaded,d=u.requestStart,f=u.responseStart,h=u.responseEnd,p=s?O(s):void 0,v={request_event_type:e,request_bytes_loaded:c,request_start:d,request_response_start:f,request_response_end:h,request_hostname:s?m(s.responseURL):void 0,request_id:p?w(p):void 0,request_response_headers:p,request_media_duration:o.duration,request_url:null==s?void 0:s.responseURL};"main"===o.type?(v.request_type="media",v.request_current_level=o.level,v.request_video_width=(i.levels[o.level]||{}).width,v.request_video_height=(i.levels[o.level]||{}).height,v.request_labeled_bitrate=(i.levels[o.level]||{}).bitrate):v.request_type=o.type,l("requestcompleted",v)};i.on(a.Events.FRAG_LOADED,h);var p=function(e,t){var i=t.frag,a=i.start,s={currentFragmentPDT:u(i),currentFragmentStart:o(a)};l("fragmentchange",s)};i.on(a.Events.FRAG_CHANGED,p);var v=function(e,t){var i=t.type,s=t.details,o=t.response,u=t.fatal,c=t.frag,d=t.networkDetails,f=(null==c?void 0:c.url)||t.url||"",h=d?O(d):void 0;if(s!==a.ErrorDetails.MANIFEST_LOAD_ERROR&&s!==a.ErrorDetails.MANIFEST_LOAD_TIMEOUT&&s!==a.ErrorDetails.FRAG_LOAD_ERROR&&s!==a.ErrorDetails.FRAG_LOAD_TIMEOUT&&s!==a.ErrorDetails.LEVEL_LOAD_ERROR&&s!==a.ErrorDetails.LEVEL_LOAD_TIMEOUT&&s!==a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&s!==a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT&&s!==a.ErrorDetails.SUBTITLE_LOAD_ERROR&&s!==a.ErrorDetails.SUBTITLE_LOAD_TIMEOUT&&s!==a.ErrorDetails.KEY_LOAD_ERROR&&s!==a.ErrorDetails.KEY_LOAD_TIMEOUT||l("requestfailed",{request_error:s,request_url:f,request_hostname:m(f),request_id:h?w(h):void 0,request_type:s===a.ErrorDetails.FRAG_LOAD_ERROR||s===a.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":s===a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR||s===a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT?"audio":s===a.ErrorDetails.SUBTITLE_LOAD_ERROR||s===a.ErrorDetails.SUBTITLE_LOAD_TIMEOUT?"subtitle":s===a.ErrorDetails.KEY_LOAD_ERROR||s===a.ErrorDetails.KEY_LOAD_TIMEOUT?"encryption":"manifest",request_error_code:null==o?void 0:o.code,request_error_text:null==o?void 0:o.text}),u){var p,v="".concat(f?"url: ".concat(f,"\n"):"")+"".concat(o&&(o.code||o.text)?"response: ".concat(o.code,", ").concat(o.text,"\n"):"")+"".concat(t.reason?"failure reason: ".concat(t.reason,"\n"):"")+"".concat(t.level?"level: ".concat(t.level,"\n"):"")+"".concat(t.parent?"parent stream controller: ".concat(t.parent,"\n"):"")+"".concat(t.buffer?"buffer length: ".concat(t.buffer,"\n"):"")+"".concat(t.error?"error: ".concat(t.error,"\n"):"")+"".concat(t.event?"event: ".concat(t.event,"\n"):"")+"".concat(t.err?"error message: ".concat(null===(p=t.err)||void 0===p?void 0:p.message,"\n"):"");l("error",{player_error_code:i,player_error_message:s,player_error_context:v})}};i.on(a.Events.ERROR,v);var g=function(e,t){var i=t.frag,a=i&&i._url||"";l("requestcanceled",{request_event_type:e,request_url:a,request_type:"media",request_hostname:m(a)})};i.on(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,g);var y=function(e,t){var a=t.level,o=i.levels[a];if(o&&o.attrs&&o.attrs.BANDWIDTH){var u,c=o.attrs.BANDWIDTH,d=parseFloat(o.attrs["FRAME-RATE"]);isNaN(d)||(u=d),c?l("renditionchange",{video_source_fps:u,video_source_bitrate:c,video_source_width:o.width,video_source_height:o.height,video_source_rendition_name:o.name,video_source_codec:null==o?void 0:o.videoCodec}):s.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};i.on(a.Events.LEVEL_SWITCHED,y),i._stopMuxMonitor=function(){i.off(a.Events.MANIFEST_LOADED,c),i.off(a.Events.LEVEL_LOADED,d),i.off(a.Events.AUDIO_TRACK_LOADED,f),i.off(a.Events.FRAG_LOADED,h),i.off(a.Events.FRAG_CHANGED,p),i.off(a.Events.ERROR,v),i.off(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,g),i.off(a.Events.LEVEL_SWITCHED,y),i.off(a.Events.DESTROYING,i._stopMuxMonitor),delete i._stopMuxMonitor},i.on(a.Events.DESTROYING,i._stopMuxMonitor)}else s.warn("performance timing not supported. Not tracking HLS.js.")}(this.mux,this.id,e.hlsjs,{},e.Hls||window.Hls)):this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")}},{key:"removeHLSJS",value:function(){var e;this.hlsjs&&((e=this.hlsjs)&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor(),this.hlsjs=void 0)}},{key:"addDashJS",value:function(e){e.dashjs?this.dashjs?this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=e.dashjs,function(e,t,i){var a=e.log;if(i&&i.on){var s=function(i,a){return e.emit(t,i,a)},o=function(e){var t=e.type,i=(e.data||{}).url;s("requestcompleted",{request_event_type:t,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:m(i),request_url:i})};i.on("manifestLoaded",o);var u={},l=function(e){var t=e.type,a=e.fragmentModel,o=(e.chunk||{}).mediaInfo||{},l=o.type,c=o.bitrateList,d={};(c=c||[]).forEach((function(e,t){d[t]={},d[t].width=e.width,d[t].height=e.height,d[t].bitrate=e.bandwidth,d[t].attrs={}})),"video"===l?u.video=d:"audio"===l?u.audio=d:u.media=d;var f=N(a,i),h=f.requestStart,p=f.requestResponseStart,v=f.requestResponseEnd,g=f.requestResponseHeaders,m=f.requestMediaDuration,y=f.requestHostname,E=f.requestUrl,_=f.requestId;s("requestcompleted",{request_event_type:t,request_start:h,request_response_start:p,request_response_end:v,request_bytes_loaded:-1,request_type:l+"_init",request_response_headers:g,request_hostname:y,request_id:_,request_url:E,request_media_duration:m,request_rendition_lists:u})};i.on("initFragmentLoaded",l);var c=function(e){var t=e.type,a=e.fragmentModel,o=e.chunk||{},u=o.mediaInfo,l=o.start,c=(u||{}).type,d=N(a,i),f=d.requestStart,h=d.requestResponseStart,p=d.requestResponseEnd,v=d.requestBytesLoaded,g=d.requestResponseHeaders,m=d.requestMediaDuration,y=d.requestHostname,E=d.requestUrl,_=d.requestId,T=function(e,t){var i=t.getQualityFor(e),a=t.getCurrentTrackFor(e).bitrateList;return a?{currentLevel:i,renditionWidth:a[i].width||null,renditionHeight:a[i].height||null,renditionBitrate:a[i].bandwidth}:{}}(c,i),b=T.currentLevel,S=T.renditionWidth,R=T.renditionHeight,A=T.renditionBitrate;s("requestcompleted",{request_event_type:t,request_start:f,request_response_start:h,request_response_end:p,request_bytes_loaded:v,request_type:c,request_response_headers:g,request_hostname:y,request_id:_,request_url:E,request_media_start_time:l,request_media_duration:m,request_current_level:b,request_labeled_bitrate:A,request_video_width:S,request_video_height:R})};i.on("mediaFragmentLoaded",c);var d={video:void 0,audio:void 0,totalBitrate:void 0},f=function(e,t,o){if("number"==typeof e.newQuality){var u=e.mediaType;if("audio"===u||"video"===u){var l=i.getBitrateInfoListFor(u).find((function(t){return t.qualityIndex===e.newQuality}));if(l&&"number"==typeof l.bitrate){d[u]=x(x({},l),{},{codec:i.getCurrentTrackFor(u).codec});var c=function(){if(d.video&&"number"==typeof d.video.bitrate){if(d.video.width&&d.video.height){var e=d.video.bitrate;return d.audio&&"number"==typeof d.audio.bitrate&&(e+=d.audio.bitrate),e!==d.totalBitrate?(d.totalBitrate=e,{video_source_bitrate:e,video_source_height:d.video.height,video_source_width:d.video.width,video_source_codec:F(d.video.codec)}):void 0}a.warn("have bitrate info for video but missing width/height")}}();c&&s("renditionchange",c)}else a.warn("missing bitrate info for ".concat(u))}}else a.warn("missing evt.newQuality in qualityChangeRendered event",e)};i.on("qualityChangeRendered",f);var h=function(e){var t=e.request,i=e.mediaType;s("requestcanceled",{request_event_type:(t=t||{}).type+"_"+t.action,request_url:t.url,request_type:i,request_hostname:m(t.url)})};i.on("fragmentLoadingAbandoned",h);var p=function(e){var t,i,a=e.error,o=(null==a||null===(t=a.data)||void 0===t?void 0:t.request)||{},u=(null==a||null===(i=a.data)||void 0===i?void 0:i.response)||{};27===(null==a?void 0:a.code)&&s("requestfailed",{request_error:o.type+"_"+o.action,request_url:o.url,request_hostname:m(o.url),request_type:o.mediaType,request_error_code:u.status,request_error_text:u.statusText});var l="".concat(null!=o&&o.url?"url: ".concat(o.url,"\n"):"")+"".concat(null!=u&&u.status||null!=u&&u.statusText?"response: ".concat(null==u?void 0:u.status,", ").concat(null==u?void 0:u.statusText,"\n"):"");s("error",{player_error_code:null==a?void 0:a.code,player_error_message:null==a?void 0:a.message,player_error_context:l})};i.on("error",p),i._stopMuxMonitor=function(){i.off("manifestLoaded",o),i.off("initFragmentLoaded",l),i.off("mediaFragmentLoaded",c),i.off("qualityChangeRendered",f),i.off("error",p),i.off("fragmentLoadingAbandoned",h),delete i._stopMuxMonitor}}else a.warn("Invalid dash.js player reference. Monitoring blocked.")}(this.mux,this.id,e.dashjs)):this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")}},{key:"removeDashJS",value:function(){var e;this.dashjs&&((e=this.dashjs)&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor(),this.dashjs=void 0)}}],i&&nt(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),s}(H),ct=lt,dt=i(153),ft=i.n(dt);function ht(e){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ht(e)}function pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a,s,o=[],u=!0,l=!1;try{for(i=i.call(e);!(u=(a=i.next()).done)&&(o.push(a.value),!t||o.length!==t);u=!0);}catch(e){l=!0,s=e}finally{try{u||null==i.return||i.return()}finally{if(l)throw s}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return vt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?vt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var gt,mt=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],yt={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"};s()&&s().WeakMap&&(gt=new WeakMap);var Et=function(e){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(e),this.manifest};Et.prototype.process=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.processLine(this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},Et.prototype.processLine=function(e){var t=e.indexOf(":"),i=wt(e,t),a=i[0],s=2===i.length?bt(i[1]):void 0;if("#"!==a[0])this.currentUri.uri=a,this.manifest.segments.push(this.currentUri),this.manifest.targetDuration&&!("duration"in this.currentUri)&&(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(a){case"#EXT-X-TARGETDURATION":if(!isFinite(s)||s<0)return;this.manifest.targetDuration=s,this.setHoldBack();break;case"#EXT-X-PART-INF":_t(this.manifest,i),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case"#EXT-X-SERVER-CONTROL":_t(this.manifest,i),this.setHoldBack();break;case"#EXTINF":0===s?this.currentUri.duration=.01:s>0&&(this.currentUri.duration=s);break;case"#EXT-X-PROGRAM-DATE-TIME":var o=s,u=new Date(o);this.manifest.dateTimeString||(this.manifest.dateTimeString=o,this.manifest.dateTimeObject=u),this.currentUri.dateTimeString=o,this.currentUri.dateTimeObject=u;break;case"#EXT-X-VERSION":_t(this.manifest,i);break;case"#EXT-X-SESSION-DATA":var l=It(i[1]),c=I(l);Object.assign(this.manifest.sessionData,c)}},Et.prototype.setHoldBack=function(){var e=this.manifest,t=e.serverControl,i=e.targetDuration,a=e.partTargetDuration;if(t){var s="holdBack",o="partHoldBack",u=i&&3*i,l=a&&2*a;i&&!t.hasOwnProperty(s)&&(t[s]=u),u&&t[s]<u&&(t[s]=u),a&&!t.hasOwnProperty(o)&&(t[o]=3*a),a&&t[o]<l&&(t[o]=l)}};var _t=function(e,t){var i,a=Tt(t[0].replace("#EXT-X-",""));At(t[1])?(i={},i=Object.assign(Rt(t[1]),i)):i=bt(t[1]),e[a]=i},Tt=function(e){return e.toLowerCase().replace(/-(\w)/g,(function(e){return e[1].toUpperCase()}))},bt=function(e){if("yes"===e.toLowerCase()||"no"===e.toLowerCase())return"yes"===e.toLowerCase();var t=-1!==e.indexOf(":")?e:parseFloat(e);return isNaN(t)?e:t},St=function(e){var t={},i=e.split("=");return i.length>1&&(t[Tt(i[0])]=bt(i[1])),t},Rt=function(e){for(var t=e.split(","),i={},a=0;t.length>a;a++){var s=t[a],o=St(s);i=Object.assign(o,i)}return i},At=function(e){return e.indexOf("=")>-1},wt=function(e,t){return-1===t?[e]:[e.substring(0,t),e.substring(t+1)]},It=function(e){var t={};if(e){var i=e.search(",");return[e.slice(0,i),e.slice(i+1)].forEach((function(e,i){for(var a=e.replace(/['"]+/g,"").split("="),s=0;s<a.length;s++)"DATA-ID"===a[s]&&(t["DATA-ID"]=a[1-s]),"VALUE"===a[s]&&(t.VALUE=a[1-s])})),{data:t}}},Dt=Et,Lt={safeCall:function(e,t,i,a){var s=a;if(e&&"function"==typeof e[t])try{s=e[t].apply(e,i)}catch(e){p.info("safeCall error",e)}return s},safeIncrement:b,getComputedStyle:function(e,t){var i;if(e&&t&&s()&&"function"==typeof s().getComputedStyle)return gt&&gt.has(e)&&(i=gt.get(e)),i||(i=s().getComputedStyle(e,null),gt&&gt.set(e,i)),i.getPropertyValue(t)},secondsToMs:function(e){return Math.floor(1e3*e)},assign:Object.assign,headersStringToObject:A,cdnHeadersToRequestId:w,extractHostnameAndDomain:y,extractHostname:m,manifestParser:Dt,generateShortID:u,generateUUID:o,now:g.now};function kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var Ct={},Ot=function e(t){var i=arguments;"string"==typeof t?e.hasOwnProperty(t)?s().setTimeout((function(){i=Array.prototype.splice.call(i,1),e[t].apply(null,i)}),0):p.warn("`"+t+"` is an unknown task"):"function"==typeof t?s().setTimeout((function(){t(e)}),0):p.warn("`"+t+"` is invalid.")},Pt={loaded:g.now(),NAME:"mux-embed",VERSION:"4.26.0",API_VERSION:"2.1",PLAYER_TRACKED:!1,monitor:function(e,t){return function(e,t,i){var a=pt(c(t),3),s=a[0],o=a[1],u=a[2],l=e.log,d=e.utils.getComputedStyle,f=e.utils.secondsToMs;if(!s)return l.error("No element was found with the `"+o+"` query selector.");if("video"!==u&&"audio"!==u)return l.error("The element of `"+o+"` was not a media element.");s.mux&&(s.mux.destroy(),delete s.mux,l.warn("Already monitoring this video element, replacing existing event listeners")),(i=Object.assign({automaticErrorTracking:!0},i)).data=Object.assign({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:e.VERSION},i.data),i.getPlayheadTime=function(){return f(s.currentTime)},i.getStateData=function(){var e,t,a=this.hlsjs&&this.hlsjs.url,o=this.dashjs&&ht("function"===this.dashjs.getSource)&&this.dashjs.getSource(),u={player_is_paused:s.paused,player_playhead_time:f(s.currentTime),player_width:parseInt(d(s,"width")),player_height:parseInt(d(s,"height")),player_autoplay_on:s.autoplay,player_preload_on:s.preload,player_language_code:s.lang,player_is_fullscreen:ft()&&!!(ft().fullscreenElement||ft().webkitFullscreenElement||ft().mozFullScreenElement||ft().msFullscreenElement),video_poster_url:s.poster,video_source_url:a||o||s.currentSrc,video_source_duration:f(s.duration),video_source_height:s.videoHeight,video_source_width:s.videoWidth,view_dropped_frame_count:null===(e=s)||void 0===e||null===(t=e.getVideoPlaybackQuality)||void 0===t?void 0:t.call(e).droppedVideoFrames},l=i.getPlayheadTime();if(s.getStartDate&&l>0){var c=s.getStartDate();if(c&&"function"==typeof c.getTime&&c.getTime()){var h=c.getTime();if(u.player_program_time=h+l,s.seekable.length>0){var p=h+s.seekable.end(s.seekable.length-1);u.player_live_edge_program_time=p}}}return u},s.mux=s.mux||{},s.mux.deleted=!1,s.mux.emit=function(t,i){e.emit(o,t,i)};var h=function(){l.error("The monitor for this video element has already been destroyed.")};s.mux.destroy=function(){Object.keys(s.mux.listeners).forEach((function(e){s.removeEventListener(e,s.mux.listeners[e],!1)})),delete s.mux.listeners,s.mux.destroy=h,s.mux.swapElement=h,s.mux.emit=h,s.mux.addHLSJS=h,s.mux.addDashJS=h,s.mux.removeHLSJS=h,s.mux.removeDashJS=h,s.mux.deleted=!0,e.emit(o,"destroy")},s.mux.swapElement=function(t){var i=pt(c(t),3),a=i[0],o=i[1],u=i[2];return a?"video"!==u&&"audio"!==u?e.log.error("The element of `"+o+"` was not a media element."):(a.muxId=s.muxId,delete s.muxId,a.mux=a.mux||{},a.mux.listeners=Object.assign({},s.mux.listeners),delete s.mux.listeners,Object.keys(a.mux.listeners).forEach((function(e){s.removeEventListener(e,a.mux.listeners[e],!1),a.addEventListener(e,a.mux.listeners[e],!1)})),a.mux.swapElement=s.mux.swapElement,a.mux.destroy=s.mux.destroy,delete s.mux,void(s=a)):e.log.error("No element was found with the `"+o+"` query selector.")},s.mux.addHLSJS=function(t){e.addHLSJS(o,t)},s.mux.addDashJS=function(t){e.addDashJS(o,t)},s.mux.removeHLSJS=function(){e.removeHLSJS(o)},s.mux.removeDashJS=function(){e.removeDashJS(o)},e.init(o,i),e.emit(o,"playerready"),s.paused||(e.emit(o,"play"),s.readyState>2&&e.emit(o,"playing")),s.mux.listeners={},mt.forEach((function(t){("error"!==t||i.automaticErrorTracking)&&(s.mux.listeners[t]=function(){var i={};if("error"===t){if(!s.error)return;if(1===s.error.code)return;i.player_error_code=s.error.code,i.player_error_message=yt[s.error.code]||s.error.message}e.emit(o,t,i)},s.addEventListener(t,s.mux.listeners[t],!1))}))}(Ot,e,t)},destroyMonitor:function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a,s,o=[],u=!0,l=!1;try{for(i=i.call(e);!(u=(a=i.next()).done)&&(o.push(a.value),!t||o.length!==t);u=!0);}catch(e){l=!0,s=e}finally{try{u||null==i.return||i.return()}finally{if(l)throw s}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return kt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?kt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(c(e),1)[0];t&&t.mux&&"function"==typeof t.mux.destroy?t.mux.destroy():p.error("A video element monitor for `"+e+"` has not been initialized via `mux.monitor`.")},addHLSJS:function(e,t){var i=l(e);Ct[i]?Ct[i].addHLSJS(t):p.error("A monitor for `"+i+"` has not been initialized.")},addDashJS:function(e,t){var i=l(e);Ct[i]?Ct[i].addDashJS(t):p.error("A monitor for `"+i+"` has not been initialized.")},removeHLSJS:function(e){var t=l(e);Ct[t]?Ct[t].removeHLSJS():p.error("A monitor for `"+t+"` has not been initialized.")},removeDashJS:function(e){var t=l(e);Ct[t]?Ct[t].removeDashJS():p.error("A monitor for `"+t+"` has not been initialized.")},init:function(e,t){v()&&t&&t.respectDoNotTrack&&p.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var i=l(e);Ct[i]=new ct(Ot,i,t)},emit:function(e,t,i){var a=l(e);Ct[a]?(Ct[a].emit(t,i),"destroy"===t&&delete Ct[a]):p.error("A monitor for `"+a+"` has not been initialized.")},checkDoNotTrack:v,log:p,utils:Lt,events:{PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled"},WINDOW_HIDDEN:!1,WINDOW_UNLOADING:!1};Object.assign(Ot,Pt),void 0!==s()&&"function"==typeof s().addEventListener&&s().addEventListener("pagehide",(function(e){e.persisted||(Ot.WINDOW_UNLOADING=!0)}),!1);var xt=Ot},655:function(e,t,i){var a,s;function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}!function(u){var l=!1;if(void 0===(s="function"==typeof(a=u)?a.call(t,i,t,e):a)||(e.exports=s),l=!0,"object"===o(t)&&(e.exports=u(),l=!0),!l){var c=window.Cookies,d=window.Cookies=u();d.noConflict=function(){return window.Cookies=c,d}}}((function(){var e=function(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var a in i)t[a]=i[a]}return t};return function t(i){function a(t,s,o){var u;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(o=e({path:"/"},a.defaults,o)).expires){var l=new Date;l.setMilliseconds(l.getMilliseconds()+864e5*o.expires),o.expires=l}try{u=JSON.stringify(s),/^[\{\[]/.test(u)&&(s=u)}catch(e){}return s=i.write?i.write(s,t):encodeURIComponent(String(s)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[t,"=",s,o.expires?"; expires="+o.expires.toUTCString():"",o.path?"; path="+o.path:"",o.domain?"; domain="+o.domain:"",o.secure?"; secure":""].join("")}t||(u={});for(var c=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,f=0;f<c.length;f++){var h=c[f].split("="),p=h.slice(1).join("=");'"'===p.charAt(0)&&(p=p.slice(1,-1));try{var v=h[0].replace(d,decodeURIComponent);if(p=i.read?i.read(p,v):i(p,v)||p.replace(d,decodeURIComponent),this.json)try{p=JSON.parse(p)}catch(e){}if(t===v){u=p;break}t||(u[v]=p)}catch(e){}}return u}}return a.set=a,a.get=function(e){return a.call(a,e)},a.getJSON=function(){return a.apply({json:!0},[].slice.call(arguments))},a.defaults={},a.remove=function(t,i){a(t,"",e(i,{expires:-1}))},a.withConverter=t,a}((function(){}))}))},153:function(e,t,i){var a,s=void 0!==i.g?i.g:"undefined"!=typeof window?window:{},o=i(558);"undefined"!=typeof document?a=document:(a=s["__GLOBAL_DOCUMENT_CACHE@4"])||(a=s["__GLOBAL_DOCUMENT_CACHE@4"]=o),e.exports=a},48:function(e,t,i){var a;a="undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{},e.exports=a},640:function(e,t,i){var a,s;!function(o,u){"use strict";a=function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"];function s(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(t){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function u(a){return"debug"===a&&(a="log"),typeof console!==t&&("trace"===a&&i?o:void 0!==console[a]?s(console,a):void 0!==console.log?s(console,"log"):e)}function l(t,i){for(var s=0;s<a.length;s++){var o=a[s];this[o]=s<t?e:this.methodFactory(o,t,i)}this.log=this.debug}function c(e,i,a){return function(){typeof console!==t&&(l.call(this,i,a),this[e].apply(this,arguments))}}function d(e,t,i){return u(e)||c.apply(this,arguments)}function f(e,i,s){var o,u=this;i=null==i?"WARN":i;var c="loglevel";function f(e){var i=(a[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=i)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+i+";"}catch(e){}}}function h(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var i=window.document.cookie,a=i.indexOf(encodeURIComponent(c)+"=");-1!==a&&(e=/^([^;]+)/.exec(i.slice(a))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"==typeof e&&(c=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=s||d,u.getLevel=function(){return o},u.setLevel=function(i,a){if("string"==typeof i&&void 0!==u.levels[i.toUpperCase()]&&(i=u.levels[i.toUpperCase()]),!("number"==typeof i&&i>=0&&i<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+i;if(o=i,!1!==a&&f(i),l.call(u,i,e),typeof console===t&&i<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(e){i=e,h()||u.setLevel(e,!1)},u.resetLevel=function(){u.setLevel(i,!1),function(){if(typeof window!==t&&c){try{return void window.localStorage.removeItem(c)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)};var p=h();null==p&&(p=i),u.setLevel(p,!1)}var h=new f,p={};h.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new f(e,h.getLevel(),h.methodFactory)),t};var v=typeof window!==t?window.log:void 0;return h.noConflict=function(){return typeof window!==t&&window.log===h&&(window.log=v),h},h.getLoggers=function(){return p},h.default=h,h},void 0===(s=a.call(t,i,t,e))||(e.exports=s)}()},375:function(e,t){"use strict";var i=Object.prototype.hasOwnProperty;function a(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function s(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){t=t||"";var a,o,u=[];for(o in"string"!=typeof t&&(t="?"),e)if(i.call(e,o)){if((a=e[o])||null!=a&&!isNaN(a)||(a=""),o=s(o),a=s(a),null===o||null===a)continue;u.push(o+"="+a)}return u.length?t+u.join("&"):""},t.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,s={};t=i.exec(e);){var o=a(t[1]),u=a(t[2]);null===o||null===u||o in s||(s[o]=u)}return s}},558:function(){}},t={};function i(a){var s=t[a];if(void 0!==s)return s.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,i),o.exports}return i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i(80)}()},e.exports=t()},9911:(e,t)=>{"use strict";function i(e,t,i){var a;if(void 0===i&&(i={}),!t.codes){t.codes={};for(var s=0;s<t.chars.length;++s)t.codes[t.chars[s]]=s}if(!i.loose&&e.length*t.bits&7)throw new SyntaxError("Invalid padding");for(var o=e.length;"="===e[o-1];)if(--o,!(i.loose||(e.length-o)*t.bits&7))throw new SyntaxError("Invalid padding");for(var u=new(null!=(a=i.out)?a:Uint8Array)(o*t.bits/8|0),l=0,c=0,d=0,f=0;f<o;++f){var h=t.codes[e[f]];if(void 0===h)throw new SyntaxError("Invalid character "+e[f]);c=c<<t.bits|h,(l+=t.bits)>=8&&(l-=8,u[d++]=255&c>>l)}if(l>=t.bits||255&c<<8-l)throw new SyntaxError("Unexpected end of data");return u}function a(e,t,i){void 0===i&&(i={});for(var a=i.pad,s=void 0===a||a,o=(1<<t.bits)-1,u="",l=0,c=0,d=0;d<e.length;++d)for(c=c<<8|255&e[d],l+=8;l>t.bits;)l-=t.bits,u+=t.chars[o&c>>l];if(l&&(u+=t.chars[o&c<<t.bits-l]),s)for(;u.length*t.bits&7;)u+="=";return u}Object.defineProperty(t,"__esModule",{value:!0});var s={chars:"0123456789ABCDEF",bits:4},o={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},u={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},l={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},c={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},d={parse:function(e,t){return i(e.toUpperCase(),s,t)},stringify:function(e,t){return a(e,s,t)}},f={parse:function(e,t){return void 0===t&&(t={}),i(t.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,o,t)},stringify:function(e,t){return a(e,o,t)}},h={parse:function(e,t){return i(e,u,t)},stringify:function(e,t){return a(e,u,t)}},p={parse:function(e,t){return i(e,l,t)},stringify:function(e,t){return a(e,l,t)}},v={parse:function(e,t){return i(e,c,t)},stringify:function(e,t){return a(e,c,t)}},g={parse:i,stringify:a};t.base16=d,t.base32=f,t.base32hex=h,t.base64=p,t.base64url=v,t.codec=g},2480:()=>{}},t={};function i(a){var s=t[a];if(void 0!==s)return s.exports;var o=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var a={};(()=>{"use strict";var e=a;Object.defineProperty(e,"__esModule",{value:!0});const t=i(5117),s=i(7786);self.mlysdk.driver.extend(t.RadiantMPHlsPlugin,s.RadiantMPHlsPlayerPlugin),t.RadiantMPHlsPlugin.register(self.RadiantMP)})();var s=mlysdk="undefined"==typeof mlysdk?{}:mlysdk;for(var o in a)s[o]=a[o];a.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();